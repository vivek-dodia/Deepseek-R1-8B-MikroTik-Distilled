# Thread Information
Title: Thread-213649
Section: RouterOS
Thread ID: 213649

# Discussion

## Initial Question
Hi all, after some very good posts here, I sucessfully reconfigured my whole network and started to try out Wireguard.Connection is established and I can also access the internet with the VPN connection.I can also access my Proxmox Web Interface (connected to ether3 and has VLAN #100), but I can't access containers running inside my Proxmox which does not make sense to me. Some containers are untagged in Proxmox and some have are tagged. Within my LAN and without Wireguard, access works fine.I have tested pings from the command line (src 172.17.0.1 which is the Wireguard gateway) in RouterOs which confirms that the given IP addresses can't be reached.Can someone explain to me why the Wireguard interface can't ping these addresses or what I am missing?
```
# 2025-01-02 21:55:15 by RouterOS 7.15.3# software id = XBVQ-34SC## model = RB5009UG+S+# serial number = xxx/interfacebridgeaddname=bridge vlan-filtering=yes/interfaceethernetset[finddefault-name=ether5]name=dedicated-mgmt-ether5set[finddefault-name=ether3]name=nuc-ether3set[finddefault-name=ether1]name=trunk-switch1-ether1/interfacewireguardaddlisten-port=13231mtu=1420name=wireguard1/interfacevlanaddinterface=bridge name=CCTV vlan-id=21addinterface=bridge name=Clientsvlan-id=10addinterface=bridge name=Home-Automationvlan-id=50addinterface=bridge name=Kidsvlan-id=49addinterface=bridge name=Managementvlan-id=53addinterface=bridge name=Serversvlan-id=100addinterface=ether2 name=pppoe-na10 vlan-id=10/interfacepppoe-clientaddadd-default-route=yes allow=pap,chap,mschap2 comment=ISP disabled=no\interface=pppoe-na10 name=pppoe-nause-peer-dns=yes user=\
    notimportant/interfacelistaddname=MGMTaddname=WAN/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=dhcp_pool0 ranges=10.0.10.20-10.0.10.254addname=dhcp_pool1 ranges=10.0.21.20-10.0.21.254addname=dhcp_pool2 ranges=10.0.50.20-10.0.50.254addname=dhcp_pool3 ranges=10.0.53.20-10.0.53.254/ip dhcp-serveraddaddress-pool=dhcp_pool0interface=Clientsname=dhcp1addaddress-pool=dhcp_pool1interface=CCTV name=dhcp2addaddress-pool=dhcp_pool2interface=Home-Automationname=dhcp3addaddress-pool=dhcp_pool3interface=Managementname=dhcp4/interfacebridge portaddbridge=bridgeinterface=trunk-switch1-ether1addbridge=bridgeinterface=nuc-ether3 pvid=100addbridge=bridge frame-types=admit-only-untagged-and-priority-tagged \interface=ether4 pvid=53/interfacebridge vlanaddbridge=bridge tagged=trunk-switch1-ether1,bridge vlan-ids=10addbridge=bridge tagged=trunk-switch1-ether1,bridge,nuc-ether3 untagged=\
    ether4 vlan-ids=53addbridge=bridge tagged=trunk-switch1-ether1,bridge,nuc-ether3 vlan-ids=21addbridge=bridge tagged=trunk-switch1-ether1,bridge vlan-ids=49addbridge=bridge tagged=trunk-switch1-ether1,bridge,nuc-ether3 vlan-ids=50addbridge=bridge tagged=trunk-switch1-ether1,bridge untagged=nuc-ether3 \
    vlan-ids=100/interfacelist memberaddinterface=Managementlist=MGMTaddinterface=dedicated-mgmt-ether5 list=MGMTaddcomment=ISPinterface=pppoe-na list=WAN/interfacewireguard peersaddallowed-address=172.17.0.2/32client-address=172.17.0.2/32client-dns=\8.8.8.8client-endpoint=example.com client-keepalive=10s\interface=wireguard1 name=Homeprivate-key=\"redacted"public-key=\"redacted"/ip addressaddaddress=10.0.53.1/24interface=Managementnetwork=10.0.53.0addaddress=10.0.10.1/24interface=Clientsnetwork=10.0.10.0addaddress=10.0.21.1/24interface=CCTV network=10.0.21.0addaddress=10.0.49.1/24interface=KNX network=10.0.49.0addaddress=10.0.50.1/24interface=Home-Automationnetwork=10.0.50.0addaddress=10.0.100.1/24interface=Serversnetwork=10.0.100.0addaddress=172.17.0.1/24interface=wireguard1 network=172.17.0.0/ip cloudsetddns-enabled=yes/ip dhcp-server networkaddaddress=10.0.10.0/24dns-server=8.8.8.8,8.8.4.4gateway=10.0.10.1addaddress=10.0.21.0/24dns-server=8.8.8.8,8.8.4.4gateway=10.0.21.1addaddress=10.0.50.0/24dns-server=8.8.8.8,8.8.4.4gateway=10.0.50.1addaddress=10.0.53.0/24dns-server=8.8.8.8,8.8.4.4gateway=10.0.53.1/ip firewall address-listaddaddress=0.0.0.0/8comment="defconf: RFC6890"list=no_forward_ipv4addaddress=169.254.0.0/16comment="defconf: RFC6890"list=no_forward_ipv4addaddress=224.0.0.0/4comment="defconf: multicast"list=no_forward_ipv4addaddress=255.255.255.255comment="defconf: RFC6890"list=no_forward_ipv4/ip firewall filteraddaction=accept chain=input comment="defconf: accept ICMP after RAW"\
    protocol=icmpaddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=accept chain=input comment=Wireguarddst-port=13231in-interface=\
    pppoe-na log=yes log-prefix=wg protocol=udpaddaction=drop chain=input comment="defconf: drop all not coming from MGMT"\in-interface-list=!MGMTaddaction=accept chain=forward comment=\"defconf: accept all that matches IPSec policy"disabled=yes \
    ipsec-policy=in,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=drop chain=forward comment=\"defconf:  drop all from WAN not DSTNATed"connection-nat-state=!dstnat \
    connection-state=newin-interface-list=WANaddaction=drop chain=forward comment="defconf: drop bad forward IPs"\
    src-address-list=no_forward_ipv4addaction=drop chain=forward comment="defconf: drop bad forward IPs"\
    dst-address-list=no_forward_ipv4/ip firewall nataddaction=accept chain=srcnat comment=\"defconf: accept all that matches IPSec policy"disabled=yes \
    ipsec-policy=out,ipsecaddaction=masquerade chain=srcnat comment="defconf: masquerade"\out-interface-list=WAN/system notesetshow-at-login=noedit: Forgot to mention that I can see icmp in the connections tab of the firewall. But the state always stays with syn start and never changes.

---
```

## Response 1
Please forgive me for not reading your configuration. Try adding the allowed networks in the Peer of your Wireguard client, and add them in your own client within /ip routes pointing to your Wireguard interface. If the routes exist in the main table on your Wireguard server, you should have no problems. ---

## Response 2
Hi and thank you for your answer.I have played around with Allowed Addresses without any success.Maybe I need to create some routes by myself. Unfortunately I have no clue how such a route should look like. I am just using the routes, RouterOs has created for me after I have added IP addresses to RouterOs.Can you give me a hint? ---

## Response 3
Ok, I got it working with renewing everything (new wireguard interface and new peer) and another IP address for the wireguard interface.Everything works as expected.Is 172.17.0.1/24 not a good choice for a wireguard interface? I am now using 192.168.17.1/24 and this settings is fine.There are no other changes compared to the ones from my first post. ---

## Response 4
Ok, I got it working with renewing everything (new wireguard interface and new peer) and another IP address for the wireguard interface.Everything works as expected.Is 172.17.0.1/24 not a good choice for a wireguard interface? I am now using 192.168.17.1/24 and this settings is fine.There are no other changes compared to the ones from my first post.Maybe you should check if that ip segmentation is being used somewhere else readable by your mikrotik wireguard server. It should not cause any problems. You can try that segmentation again just by modifying the peers and the routing table. ---

## Response 5
1. slight mod/interface bridge portadd bridge=bridge ingress-filtering=yes frame-type=admit-only-vlan-tagged interface=trunk-switch1-ether1add bridge=bridge interface=nuc-ether3 pvid=100 comment="hybrid port"add bridge=bridge ingress-filtering=yes frame-type=admit-only-priority-and-untagged interface=ether4 pvid=532. You have six vlans identified ( seven including the pppoe vlan ) and six vlans noted in /interface bridge vlanWHY, are there only 4 pools, 4 dhcp servers etc.. ??????????3.Missing........ interface list of LANadd list=LAN add all (6) vlans to interface list of LAN (not the pppoe one )4. slight mods......./ip firewall filteradd action=accept chain=input connection-state=established, related, untrackedadd action=drop chain=input protocol=invalidadd action=accept chain=input protocol=icmpadd action=accept chain=input comment="wg handshake" dst-port=13231 protocol=udp log=yes log-prefix=wgadd action=accept chain=input comment="allow management" in-interface-list=MGMTadd action=accept chain=input comment="users to services" in-interface-list=LAN dst-port=53, 123 protocol=udpadd action=accept chain=input comment="users to services" in-interface-list=LAN dst-port=53 protocol=tcpadd action=drop chain=input comment="Drop all else"++++++++++++++++++++++++++++++++++++++++++++add action=fasttrack-connection chain=forward connection-state=established, related hw-offload=yesadd action=accept chain=forward connection-state=established, related, untrackedadd action=drop chain=forward connection-state=invalidadd action=accept chain=forward comment="internet traffic" in-interface-list=LAN out-interface-list=WANadd action=accept chain=forward comment="WG to vlans" in-interface=wireguard1 out-interface-list=LANadd action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat disabled=yes { enable or remove if not required }add action=drop chain=forward comment="drop all else"5.Missing:/ip neighbor discovery-settingsset discover-interface-list=MGMT/tool mac-serverset allowed-interface-list=none/tool mac-server mac-winboxset allowed-interface-list=MGMT6.Missing:IP address for offbridge access on either 5!!7.Missing: YOu want users to use 8.8.8.8 so need to add/ip dnsset allow-remote-requests=yes servers=8.8.8.8, 8.8.4.4 ---