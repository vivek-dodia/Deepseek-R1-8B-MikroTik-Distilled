---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=7&t=211538&p=1103050#p1103050
crawled_date: 2025-02-02T22:24:05.984381
section: Scripts
type: forum_thread
---

### Author: Sun Oct 06, 2024 10:52 pm
Date: Unknown

```
Code:Select all/interfacebridgeaddadmin-mac=XX:XX:XX:XX:XX:XXauto-mac=noname=main-bridge vlan-filtering=\
    yes/interfacevlanaddinterface=main-bridge name=vlan10-LAN vlan-id=10addinterface=main-bridge name=vlan20-IoTvlan-id=20addinterface=main-bridge name=vlan30-Guestvlan-id=30/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/interfacewifi channeladdband=5ghz-ax disabled=nofrequency=2300-7000name="5GHz AX"width=\20/40/80mhzaddband=2ghz-ax disabled=nofrequency=2300-7000name="2.4GHz AX"width=\20/40mhz/interfacewifi datapathaddbridge=main-bridge disabled=noname=Guestvlan-id=30addbridge=main-bridge disabled=noname=LAN vlan-id=10addbridge=main-bridge disabled=noname=IoTvlan-id=20/interfacewifi securityaddauthentication-types=wpa3-psk disabled=noname=LANaddauthentication-types=wpa3-psk disabled=noname=Guestaddauthentication-types=wpa3-psk disabled=noname=IoT/interfacewifi configurationaddcountry=Wonderlanddatapath=LAN disabled=noname=LAN qos-classifier=\
    priority security=LANaddcountry=Wonderlanddatapath=Guestdisabled=noname=Guestsecurity=Guestaddcountry=Wonderlanddatapath=IoTdisabled=noname=IoTsecurity=IoT/interfacewifiset[finddefault-name=wifi1]channel="5GHz AX"channel.band=5ghz-ax \.skip-dfs-channels=10min-cac.width=20/40/80mhzconfiguration=LAN \
    configuration.mode=ap.ssid=LAN datapath=LAN disabled=nosecurity=LAN \
    security.authentication-types=wpa3-psk.ft=yes.ft-over-ds=yesset[finddefault-name=wifi2]channel="2.4GHz AX"channel.band=2ghz-ax \.skip-dfs-channels=10min-cac.width=20/40mhzconfiguration=IoT\
    configuration.mode=ap.ssid=IoTdatapath=IoTdisabled=nosecurity=IoT\
    security.authentication-types=wpa3-psk.ft=yes.ft-over-ds=yesaddconfiguration=Guestconfiguration.mode=ap.ssid=Guestdatapath=Guest\
    disabled=nomac-address=7A:9A:18:3A:7A:5Dmaster-interface=wifi1 name=\
    wifi3 security=Guestsecurity.authentication-types=wpa3-psk.ft=yes \.ft-over-ds=yes/disk settingssetauto-media-interface=*9auto-media-sharing=yesauto-smb-sharing=yes/interfacebridge portaddbridge=main-bridgeinterface=ether2addbridge=main-bridgeinterface=ether3addbridge=main-bridgeinterface=ether4addbridge=main-bridgeinterface=ether5addbridge=main-bridge comment=rgrinterface=ether1internal-path-cost=10\
    path-cost=10addbridge=main-bridgeinterface=wifi1 pvid=10addbridge=main-bridgeinterface=wifi2 pvid=20/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=LAN/interfacebridge vlanaddbridge=main-bridge tagged=ether1,main-bridge untagged=wifi1 vlan-ids=10addbridge=main-bridge tagged=ether1,main-bridge untagged=wifi2 vlan-ids=20addbridge=main-bridge tagged=ether1,main-bridge untagged=wifi3 vlan-ids=30/interfacelist memberaddcomment=defconfinterface=ether1 list=LAN/ip addressaddaddress=192.168.10.2/24comment=LAN-IPinterface=vlan10-LAN network=\192.168.10.0addaddress=192.168.10.20/24comment=antilockoutinterface=ether2 network=\192.168.10.0/ip dhcp-relayadddhcp-server=192.168.10.1disabled=nointerface=vlan10-LANlocal-address=\192.168.10.2name=relay-lanadddhcp-server=192.168.20.1disabled=nointerface=vlan20-IoTlocal-address=\192.168.20.2name=relay-iotadddhcp-server=172.16.30.1disabled=nointerface=vlan30-Guestlocal-address=\172.16.30.2name=relay-guest/ip dnssetallow-remote-requests=yes/ip dnsstaticaddaddress=192.168.10.2name=hermes.lan/ip firewall service-portsetftp disabled=yessettftp disabled=yes/ipv6 firewall address-listaddaddress=::/128comment="defconf: unspecified address"list=bad_ipv6addaddress=::1/128comment="defconf: lo"list=bad_ipv6addaddress=fec0::/10comment="defconf: site-local"list=bad_ipv6addaddress=::ffff:0.0.0.0/96comment="defconf: ipv4-mapped"list=bad_ipv6addaddress=::/96comment="defconf: ipv4 compat"list=bad_ipv6addaddress=100::/64comment="defconf: discard only "list=bad_ipv6addaddress=2001:db8::/32comment="defconf: documentation"list=bad_ipv6addaddress=2001:10::/28comment="defconf: ORCHID"list=bad_ipv6addaddress=3ffe::/16comment="defconf: 6bone"list=bad_ipv6/ipv6 firewall filteraddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMPv6"protocol=\
    icmpv6addaction=accept chain=input comment="defconf: accept UDP traceroute"\
    dst-port=33434-33534protocol=udpaddaction=accept chain=input comment=\"defconf: accept DHCPv6-Client prefix delegation."dst-port=546protocol=\
    udp src-address=fe80::/10addaction=accept chain=input comment="defconf: accept IKE"dst-port=500,4500\
    protocol=udpaddaction=accept chain=input comment="defconf: accept ipsec AH"protocol=\
    ipsec-ahaddaction=accept chain=input comment="defconf: accept ipsec ESP"protocol=\
    ipsec-espaddaction=accept chain=input comment=\"defconf: accept all that matches ipsec policy"ipsec-policy=in,ipsecaddaction=drop chain=input comment=\"defconf: drop everything else not coming from LAN"disabled=yes \in-interface-list=!LANaddaction=accept chain=forward comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=drop chain=forward comment=\"defconf: drop packets with bad src ipv6"src-address-list=bad_ipv6addaction=drop chain=forward comment=\"defconf: drop packets with bad dst ipv6"dst-address-list=bad_ipv6addaction=drop chain=forward comment="defconf: rfc4890 drop hop-limit=1"\
    hop-limit=equal:1protocol=icmpv6addaction=accept chain=forward comment="defconf: accept ICMPv6"protocol=\
    icmpv6addaction=accept chain=forward comment="defconf: accept HIP"protocol=139addaction=accept chain=forward comment="defconf: accept IKE"dst-port=\500,4500protocol=udpaddaction=accept chain=forward comment="defconf: accept ipsec AH"protocol=\
    ipsec-ahaddaction=accept chain=forward comment="defconf: accept ipsec ESP"protocol=\
    ipsec-espaddaction=accept chain=forward comment=\"defconf: accept all that matches ipsec policy"ipsec-policy=in,ipsecaddaction=drop chain=forward comment=\"defconf: drop everything else not coming from LAN"disabled=yes \in-interface-list=!LAN/system identitysetname=Hermes/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=192.168.10.1/system routerboard wps-buttonsetenabled=yes on-event=wps-accept/system scriptaddcomment=defconf dont-require-permissions=noname=wps-accept owner=*sys \
    policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \
    source="\r\
    \n   :foreach iface in=[/interface/wifi find where (configuration.mode=\"a\
    p\" && disabled=no)] do={\r\
    \n     /interface/wifi wps-push-button \$iface;}\r\
    \n "/tool mac-serversetallowed-interface-list=LAN/tool mac-server mac-winboxsetallowed-interface-list=LAN
```

I'm trying to use the Router HAP AX3 as an AP to forward VLAN's with already working DHCP to separate WIFI's. Traffic inbetween the networks will be made on the opnsense firewall.Trunk port from managed switch with 3 VLANs is connected to ether1 (the 2.5Gbit Port).VLANs are working, testet with a Notebook over Cable, Problem needs to be on the Mikrotik.ether2 has an ip, to not lock me out, can remove that in the end.After hours of trying I'm now ready for a forum post.Problem:cannot get an IP when connecting to wifi1(LAN) and wifi2(IoT)but wifi3 (Guest) ist working perfectly fine.Also I don't know if those dhcp relays are even necessary.Here is my config (RouterOS 7.15.3):Thanks already for any help.


---
### Author: Sat Oct 12, 2024 2:00 pm
Date: Unknown

Now one able to see what's causing the problem?


---
### Author: Sat Oct 12, 2024 7:30 pm
Date: Unknown

> /interface vlanadd interface=main-bridge name=vlan10-LAN vlan-id=10add interface=main-bridge name=vlan20-IoT vlan-id=20add interface=main-bridge name=vlan30-Guest vlan-id=30

> /interface bridge portadd bridge=main-bridge interface=ether2add bridge=main-bridge interface=ether3add bridge=main-bridge interface=ether4add bridge=main-bridge interface=ether5add bridge=main-bridge comment=rgr interface=ether1 internal-path-cost=10 \path-cost=10add bridge=main-bridge interface=wifi1 pvid=10add bridge=main-bridge interface=wifi2 pvid=20

> /interface bridge vlanadd bridge=main-bridge tagged=ether1,main-bridgeuntagged=wifi1vlan-ids=10add bridge=main-bridge tagged=ether1,main-bridgeuntagged=wifi2vlan-ids=20add bridge=main-bridge tagged=ether1,main-bridgeuntagged=wifi3vlan-ids=30

> /ip dhcp-relayadd dhcp-server=192.168.10.1 disabled=no interface=vlan10-LAN local-address=\192.168.10.2 name=relay-lanadd dhcp-server=192.168.20.1 disabled=no interface=vlan20-IoT local-address=\192.168.20.2 name=relay-iotadd dhcp-server=172.16.30.1 disabled=no interface=vlan30-Guest local-address=\172.16.30.2 name=relay-guest

You don't need:This is done dynamically by datapathThis also done dynamically by datapathThis shouldn't be needed at all...I also wonder what IoT devices are compatible with WPA3...But beside that, I didn't notice anything particularly wrong.. You should check your DHCP server...


---
### Author: [SOLVED]Sun Oct 13, 2024 5:29 pm
Date: Unknown

If the  AX3 is simply an AP,  from an upstream router then it should be a relatively easy setup.Assuming wifi settings are good ............. will focus on mechanics of the rest.First, you need to identify the managment or Trusted vlan, from which the AX3 SHould get its IP address from.Only the trusted vlan need be tagged to the bridge as the rest of the vlans are simply flowing in one trunk and getting sent out other ports or WLAN ports.In your case it would appear vlan10 is that vlan so will use that................There is no such thing as WAN and LAN here, as its an AP, not a router!!!Not sure why you have wifi datapath........... not required!!I would remove all that noise which is related to capsman which is not being used./interface bridgeadd admin-mac=XX:XX:XX:XX:XX:XX auto-mac=no name=main-bridge vlan-filtering=\yes/interface ethernetset [ find default-name=ethe5 ] name=OffBridge5/interface vlanadd interface=main-bridge name=vlan10-LAN vlan-id=10add interface=main-bridge name=vlan20-IoT vlan-id=20add interface=main-bridge name=vlan30-Guest vlan-id=30/interface listadd name=TRUSTED/interface wifi channeladd band=5ghz-ax disabled=no frequency=2300-7000 name="5GHz AX" width=\20/40/80mhzadd band=2ghz-ax disabled=no frequency=2300-7000 name="2.4GHz AX" width=\20/40mh/interface wifi securityadd authentication-types=wpa3-psk disabled=no name=LANadd authentication-types=wpa3-psk disabled=no name=Guestadd authentication-types=wpa3-psk disabled=no name=Io/interface wifiset [ find default-name=wifi1 ] channel="5GHz AX" channel.band=5ghz-ax \.skip-dfs-channels=10min-cac .width=20/40/80mhz configuration=LAN \configuration.mode=ap  .ssid=LAN  disabled=no security=LAN \security.authentication-types=wpa3-psk .ft=yes .ft-over-ds=yesset [ find default-name=wifi2 ] channel="2.4GHz AX" channel.band=2ghz-ax \.skip-dfs-channels=10min-cac .width=20/40mhz configuration=IoT \configuration.mode=ap  .ssid=IoT  disabled=no security=IoT \security.authentication-types=wpa3-psk .ft=yes .ft-over-ds=yesadd configuration=Guest configuration.mode=ap .ssid=Guest \disabled=no mac-address=7A:9A:18:3A:7A:5D master-interface=wifi1 name=\wifi3 security=Guest security.authentication-types=wpa3-psk .ft=yes \.ft-over-ds=yes/interface bridge portadd bridge=main-bridge ingress-filtering=yes frame-types=admit-only-vlan-tagged interface=ether1add bridge=main-bridge ingress-filtering=yes frame-types=admit-untagged-and-priority interface=ether2 pvid=10add bridge=main-bridge ingress-filtering=yes frame-types=admit-untagged-and-priority interface=ether3 pvid=10add bridge=main-bridge ingress-filtering=yes frame-types=admit-untagged-and-priority interface=ethe4 pvid=10add bridge=main-bridge ingress-filtering=yes frame-types=admit-untagged-and-priority interface=wifi1 pvid=10add bridge=main-bridge ingress-filtering=yes frame-types=admit-untagged-and-priority interface=wifi2 pvid=20add bridge=main-bridge ingress-filtering=yes frame-types=admit-untagged-and-priority  interface=wifi3 pvid=30/ip neighbor discovery-settingsset discover-interface-list=TRUSTED/interface bridge vlanadd bridge=main-bridge tagged=main-bridge,ether1, untagged=ether2,ether3,ether4,wifi1 vlan-ids=10add bridge=main-bridge tagged=ether1 untagged=wifi2 vlan-ids=20add bridge=main-bridge tagged=ether1 untagged=wifi3 vlan-ids=30/interface list memberadd  interface=vlan10-LAN list=TRUSTEDadd interface=OffBridge5list=TRUSTED/ip addressadd address=192.168.10.2/24 comment=LAN-IP interface=vlan10-LAN network=\192.168.10.0add address=192.168.77.1/30 comment="Off bridge access"  network=192.168.77./ip dnsserver=192.168.10.1/ip routeadd dst-address=0.0.0.0/0  gateway=192.168.10.1/ipv6 settingsdisabled=yes/ipv6 firewall filteradd chain=input action=dropadd chain=forward action=drop/system ntp clientset enabled=yes/system ntp client serversadd address=192.168.10.1/tool mac-serverset allowed-interface-list=NONE/tool mac-server mac-winboxset allowed-interface-list=TRUSTEDAssumingport 5is not used, its been taken off the bridge given an IP address.Easy to configure the router if any vlan issues by plugging your laptop into port 5 and change IPV4 settings on laptop to 192.167.77.2  and you are in.


---
### Author: Tue Oct 15, 2024 9:10 am
Date: Unknown

Thanks for the helpful replies.@anav your advice was very helping. With getting rid of datapaths and working with Interface List made it working.I'm new to mikrotik, now I learned a bit more about configuring. Thanks a lot!

