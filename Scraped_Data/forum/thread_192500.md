---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=9&t=192500&p=977598#p977598
crawled_date: 2025-02-02T21:35:35.460087
section: mikrotik_forum
type: forum_thread
---

### Author: [SOLVED]Sat Jan 14, 2023 11:49 pm
Date: Unknown

```
:globaldatetime2epochdo={:localdtime[:tostr $1]/system clock:localcyear[getdate];:if($cyear~"....-..-..")do={:setcyear[:pick $cyear04]}else={:setcyear[:pick $cyear711]}:if(([:len $dtime]=10)or([:len $dtime]=11))do={:setdtime"$dtime 00:00:00"}:if([:len $dtime]=15)do={:setdtime"$[:pick $dtime 0 6]/$cyear $[:pick $dtime 7 15]"}:if([:len $dtime]=14)do={:setdtime"$cyear-$[:pick $dtime 0 5] $[:pick $dtime 6 14]"}:if([:len $dtime]=8)do={:setdtime"$[get date] $dtime"}:if([:tostr $1]="")do={:setdtime("$[get date] $[get time]")}:localvdate[:pick $dtime0[:find $dtime" "-1]]:localvtime[:pick $dtime([:find $dtime" "-1]+1)[:len $dtime]]:localvgmt[getgmt-offset];:if($vgmt>0x7FFFFFFF)do={:setvgmt($vgmt-0x100000000)}:if($vgmt<0)do={:setvgmt($vgmt*-1)}:localarrm[:toarray"0,0,31,59,90,120,151,181,212,243,273,304,334"]:localvdoff[:toarray"0,4,5,7,8,10"]:localMM[:pick $vdate($vdoff->2)($vdoff->3)]:localM[:tonum $MM]:if($vdate~".../../....")do={:setvdoff[:toarray"7,11,1,3,4,6"]:setM([:find"xxanebarprayunulugepctovecANEBARPRAYUNULUGEPCTOVEC"[:pick $vdate($vdoff->2)($vdoff->3)]-1]/2):if($M>12)do={:setM($M-12)}}:localyyyy[:pick $vdate($vdoff->0)($vdoff->1)];:if((($yyyy-1968)%4)=0)do={:set($arrm->1)-1;:set($arrm->2)30}:localtotd((($yyyy-1970)*365)+(($yyyy-1968)/4)+($arrm->$M)+([:pick $vdate($vdoff->4)($vdoff->5)]-1)):return(((((($totd*24)+[:pick $vtime02])*60)+[:pick $vtime35])*60)+[:pick $vtime68]-$vgmt)}{:localNOW[$datetime2epoch]/tool user-manager session:foreachsessioneTestin=[findwhereactive=yes]do={:localtilltime[$datetime2epoch[get$sessioneTest till-time]]:localdiff($NOW-$tilltime):localthreshold120:if($diff>$threshold)do={:log warning"Session closed: $[get $sessioneTest user] has been stalled for $diff seconds"close-session $sessioneTest}}}
```

Code:Select all


---
### Author: Sun Oct 27, 2024 5:05 pm
Date: Unknown

```
:globaldatetime2epochdo={:localdtime[:tostr]/system clock:localcyear[getdate];:if($cyear~"....-..-..")do={:setcyear[:pick $cyear04]}else={:setcyear[:pick $cyear711]}:if(([:len $dtime]=10)or([:len $dtime]=11))do={:setdtime"$dtime 00:00:00"}:if([:len $dtime]=15)do={:setdtime"$[:pick $dtime 0 6]/$cyear $[:pick $dtime 7 15]"}:if([:len $dtime]=14)do={:setdtime"$cyear-$[:pick $dtime 0 5] $[:pick $dtime 6 14]"}:if([:len $dtime]=8)do={:setdtime"$[get date] $dtime"}:if([:tostr]="")do={:setdtime("$[get date] $[get time]")}:localvdate[:pick $dtime0[:find $dtime" "-1]]:localvtime[:pick $dtime([:find $dtime" "-1]+1)[:len $dtime]]:localvgmt[getgmt-offset];:if($vgmt>0x7FFFFFFF)do={:setvgmt($vgmt-0x100000000)}:if($vgmt<0)do={:setvgmt($vgmt*-1)}:localarrm[:toarray"0,0,31,59,90,120,151,181,212,243,273,304,334"]:localvdoff[:toarray"0,4,5,7,8,10"]:localMM[:pick $vdate($vdoff->2)($vdoff->3)]:localM[:tonum $MM]:if($vdate~".../../....")do={:setvdoff[:toarray"7,11,1,3,4,6"]:setM([:find"xxanebarprayunulugepctovecANEBARPRAYUNULUGEPCTOVEC"[:pick $vdate($vdoff->2)($vdoff->3)]-1]/2):if($M>12)do={:setM($M-12)}}:localyyyy[:pick $vdate($vdoff->0)($vdoff->1)];:if((($yyyy-1968)%4)=0)do={:set($arrm->1)-1;:set($arrm->2)30}:localtotd((($yyyy-1970)*365)+(($yyyy-1968)/4)+($arrm->$M)+([:pick $vdate($vdoff->4)($vdoff->5)]-1)):return(((((($totd*24)+[:pick $vtime02])*60)+[:pick $vtime35])*60)+[:pick $vtime68]-$vgmt)}{:localNOW[$datetime2epoch]/tool user-manager session:foreachsessioneTestin=[findwhereactive=yes]do={:localtilltime[$datetime2epoch[get$sessioneTest till-time]]:localdiff($NOW-$tilltime):localthreshold120:if($diff>$threshold)do={:log warning"Session closed: $[get $sessioneTest user] has been stalled for $diff seconds"close-session $sessioneTest}}}
```

What is the idle time for this script ?I mean what is the user inactivity time before this script close the session?Is it still work for User in v6.49.17 ?Code:Select all

