# Thread Information
Title: Untitled Thread
Section: mikrotik_forum
Thread ID: 212309

# Discussion

## Initial Question
Author: Tue Nov 05, 2024 7:38 am
``` # 2024-11-05 06:31:28 by RouterOS 7.17beta2# software id =## model = C52iG-5HaxD2HaxD# serial number =/interfacebridgeaddadmin-mac=auto-mac=nocomment=defconf name=bridge/interfacewifiset[finddefault-name=wifi1]channel.band=5ghz-ax.skip-dfs-channels=\10min-cac.width=20/40/80mhzconfiguration.mode=ap.ssid=MikroTik-\ disabled=nosecurity.authentication-types=wpa2-psk, wpa3-psk.ft=yes \.ft-over-ds=yesset[finddefault-name=wifi2]channel.band=2ghz-ax.skip-dfs-channels=\10min-cac.width=20/40mhzconfiguration.mode=ap.ssid=MikroTik-\ disabled=nosecurity.authentication-types=wpa2-psk, wpa3-psk.ft=yes \.ft-over-ds=yes/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/ip pooladdname=default-dhcp ranges=192.168.88.10-192.168.88.254/ip dhcp-serveraddaddress-pool=default-dhcpinterface=bridge name=defconf/disk settingssetauto-media-interface=bridgeauto-media-sharing=yesauto-smb-sharing=yes/interfacebridge portaddbridge=bridge comment=defconfinterface=ether3addbridge=bridge comment=defconfinterface=ether4addbridge=bridge comment=defconfinterface=ether5addbridge=bridge comment=defconfinterface=wifi1addbridge=bridge comment=defconfinterface=wifi2/ip neighbor discovery-settingssetdiscover-interface-list=LAN/interfacelist memberaddcomment=defconfinterface=bridge list=LANaddcomment=defconfinterface=ether1 list=WANaddcomment=backupinterface=ether2 list=WAN/ip addressaddaddress=192.168.88.1/24comment=defconfinterface=bridge network=\192.168.88.0/ip dhcp-clientaddadd-default-route=nocomment=defconfinterface=ether1addadd-default-route=nocomment=backupinterface=ether2/ip dhcp-server networkaddaddress=192.168.88.0/24comment=defconf dns-server=192.168.88.1gateway=\192.168.88.1/ip dnssetallow-remote-requests=yes/ip dnsstaticaddaddress=192.168.88.1comment=defconf name=router.lan type=A/ip firewall filteraddaction=accept chain=input comment=\"defconf: accept established, related, untracked"connection-state=\ established, related, untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\ invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=drop chain=input comment="defconf: drop all not coming from LAN"\in-interface-list=!LANaddaction=accept chain=forward comment="defconf: accept in ipsec policy"\ ipsec-policy=in, ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\ ipsec-policy=out, ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\ connection-state=established, related hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established, related, untracked"connection-state=\ established, related, untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\ connection-state=invalidaddaction=drop chain=forward comment=\"defconf: drop all from WAN not DSTNATed"connection-nat-state=!dstnat \ connection-state=newin-interface-list=WAN/ip firewall nataddaction=masquerade chain=srcnat comment="defconf: masquerade"\ ipsec-policy=out, noneout-interface-list=WAN/ip routeadddisabled=nodistance=2dst-address=0.0.0.0/0gateway=192.168.188.1\ routing-table=main scope=30suppress-hw-offload=notarget-scope=10adddisabled=nodistance=1dst-address=0.0.0.0/0gateway=192.168.100.100\ routing-table=main scope=30suppress-hw-offload=notarget-scope=10addcheck-gateway=ping comment="Monitor ISP1"disabled=nodistance=1\ dst-address=8.8.8.8/32gateway=192.168.100.100routing-table=main scope=\10suppress-hw-offload=notarget-scope=10addcomment="Monitor ISP2"disabled=nodistance=1dst-address=1.1.1.1/32\ gateway=192.168.188.1routing-table=main scope=10suppress-hw-offload=no\ target-scope=10addcheck-gateway=ping comment=ISP1 disabled=nodistance=1dst-address=\0.0.0.0/0gateway=8.8.8.8routing-table=main scope=10\ suppress-hw-offload=notarget-scope=11addcomment=ISP2 disabled=nodistance=2dst-address=0.0.0.0/0gateway=1.1.1.1\ routing-table=main scope=10suppress-hw-offload=notarget-scope=11/ipv6 firewall address-listaddaddress=::/128comment="defconf: unspecified address"list=bad_ipv6addaddress=::1/128comment="defconf: lo"list=bad_ipv6addaddress=fec0::/10comment="defconf: site-local"list=bad_ipv6addaddress=::ffff:0.0.0.0/96comment="defconf: ipv4-mapped"list=bad_ipv6addaddress=::/96comment="defconf: ipv4 compat"list=bad_ipv6addaddress=100::/64comment="defconf: discard only "list=bad_ipv6addaddress=2001:db8::/32comment="defconf: documentation"list=bad_ipv6addaddress=2001:10::/28comment="defconf: ORCHID"list=bad_ipv6addaddress=3ffe::/16comment="defconf: 6bone"list=bad_ipv6/ipv6 firewall filteraddaction=accept chain=input comment=\"defconf: accept established, related, untracked"connection-state=\ established, related, untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\ invalidaddaction=accept chain=input comment="defconf: accept ICMPv6"protocol=\ icmpv6addaction=accept chain=input comment="defconf: accept UDP traceroute"\ dst-port=33434-33534protocol=udpaddaction=accept chain=input comment=\"defconf: accept DHCPv6-Client prefix delegation."dst-port=546protocol=\ udp src-address=fe80::/10addaction=accept chain=input comment="defconf: accept IKE"dst-port=500, 4500\ protocol=udpaddaction=accept chain=input comment="defconf: accept ipsec AH"protocol=\ ipsec-ahaddaction=accept chain=input comment="defconf: accept ipsec ESP"protocol=\ ipsec-espaddaction=accept chain=input comment=\"defconf: accept all that matches ipsec policy"ipsec-policy=in, ipsecaddaction=drop chain=input comment=\"defconf: drop everything else not coming from LAN"in-interface-list=\!LANaddaction=accept chain=forward comment=\"defconf: accept established, related, untracked"connection-state=\ established, related, untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\ connection-state=invalidaddaction=drop chain=forward comment=\"defconf: drop packets with bad src ipv6"src-address-list=bad_ipv6addaction=drop chain=forward comment=\"defconf: drop packets with bad dst ipv6"dst-address-list=bad_ipv6addaction=drop chain=forward comment="defconf: rfc4890 drop hop-limit=1"\ hop-limit=equal:1protocol=icmpv6addaction=accept chain=forward comment="defconf: accept ICMPv6"protocol=\ icmpv6addaction=accept chain=forward comment="defconf: accept HIP"protocol=139addaction=accept chain=forward comment="defconf: accept IKE"dst-port=\500, 4500protocol=udpaddaction=accept chain=forward comment="defconf: accept ipsec AH"protocol=\ ipsec-ahaddaction=accept chain=forward comment="defconf: accept ipsec ESP"protocol=\ ipsec-espaddaction=accept chain=forward comment=\"defconf: accept all that matches ipsec policy"ipsec-policy=in, ipsecaddaction=drop chain=forward comment=\"defconf: drop everything else not coming from LAN"in-interface-list=\!LAN/system clocksettime-zone-name=Europe/Zagreb/system notesetshow-at-login=no/tool mac-serversetallowed-interface-list=LAN/tool mac-server mac-winboxsetallowed-interface-list=LAN ``` I tried to create failover to backup ISP, i followed a few Youtube videos where everything is explained but I stuck... I can't get it to switch over to another ISP.If I disconnect the cable from primary ISP it's working, but if I simulate network outage by disconnecting WAN from the ISP router but router itself stays up I get the first route (marked as ISP1) as unreachable after 20 seconds but it doesn't switch over to another route. I tried watched different videos but nothing worked...Here is my test setup:
```
This is pure default configuration.


---
```

## Response 1
Author: Tue Nov 05, 2024 11:05 am
Provide the output of /ip route print, twice, once when in the "normal" state and once when you have the ISP WAN cable detached, as it will be more clear what actually happens.As a side note, and JFYI, another possible approach (IMHO simpler):viewtopic.php?t=198999 ---

## Response 2
Author: [SOLVED]Tue Nov 05, 2024 2:17 pm
You have too many routes LOL/ip routeadd check-gateway=ping comment=ISP1 dst-address=0.0.0.0/0 gateway=8.8.8.8 routing-table=main scope=10 target-scope=12add dst-address=8.8.8.8/32 gateway=192.168.100.100 routing-table=main scope=10 target-scope=11++++++++++++++++++++add check-gateway=ping distance=2 comment=ISP2 dst-address=0.0.0.0/0 gateway=1.1.1.1 routing-table=main scope=10 target-scope=12add dst-address=1.1.1.1/32 gateway=192.168.188.1 routing-table=main scope=10 target-scope=11Just ensure that you dont use 8.8.8.8 and 1.1.1.1 as dns servers in IP DNS. ---

## Response 3
Author: Tue Nov 05, 2024 2:57 pm
Confusing words............Lookiing at your config........./ip dhcp-clientaddadd-default-route=nocomment=defconf interface=ether1addadd-default-route=nocomment=backup interface=ether2a. based on the above, the router didnt create any default routes.b. if they had created them, they dont show up on the config anywayc. conclusion, they only can be there because you created them LOL. ---

## Response 4
Author: Tue Nov 05, 2024 3:35 pm
And again /ip route print will show whether the routes are static or dynamic or if coming from the dhcp, etc.. ---

## Response 5
Author: Tue Nov 05, 2024 5:44 pm
Confusing words............Lookiing at your config........./ip dhcp-clientaddadd-default-route=nocomment=defconf interface=ether1addadd-default-route=nocomment=backup interface=ether2a. based on the above, the router didnt create any default routes.b. if they had created them, they dont show up on the config anywayc. conclusion, they only can be there because you created them LOL.True... I had a version where DHCP client created routes automatically.@jaclazI will try to post it tomorrow as i test this at the office so i don't have access to the router right now. ---

## Response 6
Author: Wed Nov 06, 2024 8:55 am
``` [admin@MikroTik]>ip route p dFlags:D-dynamic;X-disabled, I-inactive, A-active;c-connect, s-static, r-rip, b-bgp, o-ospf, i-is-is, d-dhcp, v-vpn, m-modem, y-bgp-mpls-vpn;H-hw-offloaded;+-ecmp0As;;;ISP1 dst-address=0.0.0.0/0routing-table=main gateway=8.8.8.8immediate-gw=192.168.100.100%ether1 check-gateway=ping distance=1scope=10target-scope=12suppress-hw-offload=no1s;;;ISP2 dst-address=0.0.0.0/0routing-table=main gateway=1.1.1.1immediate-gw=192.168.188.1%ether2 check-gateway=ping distance=2scope=10target-scope=12suppress-hw-offload=no2As;;;MonitorISP2 dst-address=1.1.1.1/32routing-table=main gateway=192.168.188.1immediate-gw=192.168.188.1%ether2 distance=1scope=10target-scope=11suppress-hw-offload=no3As;;;MonitorISP1 dst-address=8.8.8.8/32routing-table=main gateway=192.168.100.100immediate-gw=192.168.100.100%ether1 check-gateway=ping distance=1scope=10target-scope=11suppress-hw-offload=noDAcdst-address=192.168.88.0/24routing-table=main gateway=bridge immediate-gw=bridge distance=0scope=10target-scope=5local-address=192.168.88.1%bridgeDAcdst-address=192.168.100.0/24routing-table=main gateway=ether1 immediate-gw=ether1 distance=0scope=10target-scope=5local-address=192.168.100.3%ether1DAcdst-address=192.168.188.0/24routing-table=main gateway=ether2 immediate-gw=ether2 distance=0scope=10target-scope=5local-address=192.168.188.252%ether2 ``` As soon as I disable routes I added and changed target scope as @ anav suggested everything is working.When I check my public IP first I get IP from the office internet connection. I disable WAN and after 20 seconds or so first route become unreachable and second route became active and after checking public IP i get IP address from my backup internet provider.Problem was indeed in too many routes.Now route list looks like this: