---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=21&t=184711&p=929194#p929194
crawled_date: 2025-02-02T21:19:57.666803
section: mikrotik_forum
type: forum_thread
---

### Author: Sun Apr 03, 2022 12:03 am
Date: Unknown

```
error creating backup file
```

I notice that problem happen sometime (also on previous 6.x versions) if the SSH host key (on devices with unused SSH service) certificate is invalid.And also that those devices generate corrupted backups.Code:Select allThe soluction, for me, is do "/ip ssh regenerate-host-key" on problematic device and, after that, the backup and/or upgrade happen without lost the config.Usually are devices with first software installation older than 6.44 and never netinstalled again, but only updated.This happen also ifsecurity package is disabledon the past software version (and enabled or not later), before upgrade to 7.x


---
### Author: Sun Apr 03, 2022 1:41 pm
Date: Unknown

Is there any way to know if a given router is affected by some bad RouterOS version of the past?Iguessthis is the very point of this thread ... to find out which old version went haywire (if that's indeed the case) and to try to fix it so that when mass of less ssvvy users start to upgradevfrom v6 to v7 they don't fail miserably.We should really not be comfortable with the notion that past versions of software can influence current device operation on latest installed software version... I'm surprised there's not already more noise about this. To what extent does RouterOS store past version configuration and to what extent can that configuration (which should arguably be rendered inert) still be able to influence/affect device operation when running on a new version? Are we talking about actual configuration, or just the underlying disk partitioning/layout? Can a Netinstall fix all of this or not? If MikroTik wants our assistance with this, we need some guidelines on where to look and how this important aspect of device operation and configuration integrity, operates beneath the scenesIs this somehow analogous to a Microsoft Windows Registry retaining entries from past OS revisions even if they are no longer in use? Surely if "/export" can provide a full, clean and sanitized output of the device configuration, then it should be possible for the router to clear extraneous/problematic configuration using similar functions to sanitize the current device config, negating it of any possible noise/interference? Furthermore, restoring that export on a device which has just been freshly wiped with "/system reset-configuration", should mean that this "registry" starts off with a clean state and that again, no prior installed RouterOS versions should have any effect on device stability going forward (from a config perspective). If it's a disk partitioning issue, then that is another story of course..  But in that case, Mikrotik should focus attention on comparing disk images structure from a device known to be prone to this config loss issue (such as my RB5009), against a similar device which has been freshly wiped with netinstallI suppose one thing we can already know with certainty that the problem doesn't stem from RouterOS v6 or lower, because RB5009 can't run that anyway.My money is on the problem existing in RouterOS v7 core software itself, in some new function somewhere, and that it still affects even latest versions and could strike anyone at any time regardless of past versions installed if they just meet all of the right conditions to trigger the bug... but that only a handful of people have deployed the specific config needed to trigger the bug, which is why it rarely occurs. But of course that is just my speculation which isn't likely to prove very useful, so I won't say any more on that until further research and investigation can be completed.Optimistic that this will be fully resolved sooner than later as MikroTik are clearly taking this matter very seriously now, as they of course should


---
### Author: Mon Apr 04, 2022 11:07 am
Date: Unknown

Hi:I recently make the move to 7.1.5 from 6.49.5 on a RB750 Gr3  All configs where messy or not present... It was working no dhcp (client and server no polls etc.. ), so i think i find the solution.After some more tests i noticed no vlans?? After the upgrade router seems ok but if  you do RoutherBoard upgrade, pufff its gone no dhcp etc.......Solution1 - Back to 6.49.52 - Save config for a file3 - reset to factory settings (still 6.49.5)4 - Upgrade to 7.1.5 OK5 - Reset Factory settings OK5 - RouterBoard Upgrade OK7 - Reset Factory settings OK8 - Upload config file (from 6.49.5) OKEverything was working vlans dhcp l2tp/ipsec sstp ... etc !!!!I do not know if all this resets are necessary but it works, i tested on another RB750 from a friend and it worked (of course different configs)I do not know if this helps but my experience stays hereI will use this procedure in CCR1009 and others.


---
### Author: Tue Apr 05, 2022 1:24 pm
Date: Unknown

```
/routing/filter/rule/add chain=ospf-out rule="if ( gw-interface ether1 || gw-interface wg-RedShield ) { reject; } accept;"
```

```
if ( gw-interface ether1 ) { reject; } accept;
```

Okay, I repeated that on another CHR that I almost don't use, so should not be a problem to reproduce it for you. The router was upgraded to v7.2 first.Create a WG interface named "wg-RedShield" (with an empty config) and add the following routing filter rule:Code:Select allThen reboot. A-a-and... It's goneNo more rule, just that WG interface. Some race condition while interfaces are not yet added during a boot?UPD: If there are another rules (like "accept;") around - they are still here.UPD2: I can reproduce it even without WG interface, with a simple rule:Code:Select all


---
### Author: Tue Apr 05, 2022 2:38 pm
Date: Unknown

```
/routing/filter/rule/add chain=ospf-out rule="if ( gw-interface ether1 || gw-interface wg-RedShield ) { reject; } accept;"
```

```
if ( gw-interface ether1 ) { reject; } accept;
```

Okay, I repeated that on another CHR that I almost don't use, so should not be a problem to reproduce it for you. The router was upgraded to v7.2 first.Create a WG interface named "wg-RedShield" (with an empty config) and add the following routing filter rule:Code:Select allThen reboot. A-a-and... It's goneNo more rule, just that WG interface. Some race condition while interfaces are not yet added during a boot?UPD: If there are another rules (like "accept;") around - they are still here.UPD2: I can reproduce it even without WG interface, with a simple rule:Code:Select allThis is a routing rule-specific issue which is being fixed at the moment. Not related to this global problem which we have not managed to reliably reproduce.


---
### Author: Fri Apr 08, 2022 10:30 pm
Date: Unknown

```
/interface bridge add name=LAN priority=0x7000 protocol-mode=mstp region-name=US-NY vlan-filtering=yes
/interface ethernet set [ find default-name=sfp-sfpplus1 ] name=WAN speed=100Mbps
/interface ethernet set [ find default-name=ether5 ] name="ZyXEL GS1920-24 Port 25" speed=100Mbps
/interface ethernet set [ find default-name=ether6 ] name="ZyXEL GS1920-24 Port 26" speed=100Mbps
/interface ethernet set [ find default-name=ether1 ] name="ZyXEL GS1920-24HP Port 23" speed=100Mbps
/interface ethernet set [ find default-name=ether2 ] name="ZyXEL GS1920-24HP Port 25" speed=100Mbps
/interface ethernet set [ find default-name=ether3 ] name="ZyXEL GS1920-24HP Port 26" speed=100Mbps
/interface ethernet set [ find default-name=ether4 ] disabled=yes name=eth4 speed=100Mbps
/interface ethernet set [ find default-name=ether7 ] disabled=yes name=eth7 speed=100Mbps
/interface ethernet set [ find default-name=ether8 ] name=eth8 speed=100Mbps
/interface 6to4 add comment="Hurricane Electric IPv6 Tunnel Broker" !keepalive local-address=*Private* mtu=1280 name=sit1 remote-address=*Private*
/interface wireguard add comment="KeepSolidVPN - Germany" disabled=yes listen-port=51821 mtu=1420 name=KeepSolidVPN-Germany private-key=*Private*
/interface wireguard add comment="KeepSolidVPN - France" disabled=yes listen-port=51822 mtu=1420 name=KeepSolidVPN-P2P private-key=*Private*
/interface wireguard add comment="KeepSolidVPN - Poland" disabled=yes listen-port=51823 mtu=1420 name=KeepSolidVPN-Poland private-key=*Private*
/interface wireguard add comment="KeepSolidVPN - UK" disabled=yes listen-port=51824 mtu=1420 name=KeepSolidVPN-UK private-key=*Private*
/interface wireguard add comment="VPN - Home Main Network" listen-port=52850 mtu=1420 name=wg0 private-key=*Private*
/interface wireguard add comment="VPN - Home Guest Network" listen-port=52860 mtu=1420 name=wg1 private-key=*Private*
/interface bonding add lacp-rate=1sec mode=802.3ad name="ZyXEL GS1920-24" slaves="ZyXEL GS1920-24 Port 25,ZyXEL GS1920-24 Port 26"
/interface bonding add lacp-rate=1sec mode=802.3ad name="ZyXEL GS1920-24HP" slaves="ZyXEL GS1920-24HP Port 23,ZyXEL GS1920-24HP Port 25,ZyXEL GS1920-24HP Port 26"
/interface list add name=WAN-list
/interface list add name=LAN-list
/interface list add comment="Own WireGuard VPN servers" name=WireGuard-Server
/interface list add comment="WireGuard VPN clients' connections" name=WireGuard-Clients
/interface list add name=WAN-interface-list
/interface list add name=WAN-Internet-list
/interface wireless security-profiles set [ find default=yes ] supplicant-identity=MikroTik
/interface bridge nat add action=accept chain=srcnat
/interface bridge port add bridge=LAN interface="ZyXEL GS1920-24HP"
/interface bridge port add bridge=LAN interface="ZyXEL GS1920-24"
/interface bridge port add bridge=LAN interface=eth4
/interface bridge port add bridge=LAN interface=eth7
/interface bridge port add bridge=LAN interface=eth8
/interface detect-internet set detect-interface-list=all internet-interface-list=WAN-interface-list lan-interface-list=LAN-list wan-interface-list=all
/interface list member add interface=WAN list=WAN-list
/interface list member add interface=LAN list=LAN-list
/interface list member add comment="VPN - Home Main Network" interface=wg0 list=WireGuard-Server
/interface list member add comment="VPN - Home Guest Network" interface=wg1 list=WireGuard-Server
/interface list member add interface=WAN list=WAN-Internet-list
/interface list member add interface=sit1 list=WAN-interface-list
/interface list member add interface=WAN list=WAN-interface-list
/interface list member add interface="ZyXEL GS1920-24" list=LAN-list
/interface list member add interface="ZyXEL GS1920-24HP" list=LAN-list
/interface list member add interface=eth4 list=LAN-list
/interface list member add interface=eth7 list=LAN-list
/interface list member add interface=eth8 list=LAN-list
/interface list member add interface=wg0 list=WAN-interface-list
/interface list member add interface=wg1 list=WAN-interface-list
/interface list member add interface=KeepSolidVPN-Germany list=WireGuard-Clients
/interface list member add interface=KeepSolidVPN-P2P list=WireGuard-Clients
/interface list member add interface=KeepSolidVPN-Poland list=WireGuard-Clients
/interface list member add interface=KeepSolidVPN-UK list=WireGuard-Clients
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg0 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg1 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg1 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=*Private* interface=wg1 persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=0.0.0.0/0 comment="KeepSolidVPN - Poland" endpoint-address=*Private* endpoint-port=51820 interface=KeepSolidVPN-Poland persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=0.0.0.0/0 comment="KeepSolidVPN - UK" endpoint-address=*Private* endpoint-port=51820 interface=KeepSolidVPN-UK persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=0.0.0.0/0 comment="KeepSolidVPN - Germany" endpoint-address=*Private* endpoint-port=51820 interface=KeepSolidVPN-Germany persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
/interface wireguard peers add allowed-address=0.0.0.0/0 comment="KeepSolidVPN - France" endpoint-address=*Private* endpoint-port=51820 interface=KeepSolidVPN-France persistent-keepalive=25s preshared-key=*Private* public-key=*Private*
```

in my experience, bridges and wireguard interfaces seem to be most commonly affected by the corruption, along with some firewall rulesAbsolutely. 100% right.So I never experienced this behavior on RB1100x4AHDude. I just upgraded to RB5009 and I lost my config more than once. And I was perplexed. Via backup and some upgrades, I was able to recover but with certain issues, it requires me to change network to be able to connect.1. Bridges - issues like hell. It just disappears later screw back-up as a certain portion of it is related to the bridge itself.2. WG peers - I found that they will disappear as well (have 15 peers and 6 interfaces)3. Firewall address lists - I have 21k entries there and ofter it will be reduced to 600 entriesI never had an issue with disappearing firewall rules but...My symptoms stopped after using the backup procedure in WinBox.I created a config (divided into 8 parts)Reset RB to 0Started with interfaces (going back where it stopped twice), then the other 7 parts (no issues).Created backup via export. Reviewed backup that it is proper.Created backup with WinBoxReset RB to 0Logged in - restored backup from WinBoxSince then - stable as a rock.It even survived the upgrade from 7.1.5 to 7.2 (although I had prepared everything)After upgrade - backup via export - comparing to 7.1.5 - no changes, created new backup via WinBox (just in case)So far no problemsAlso, I found that the MSTP bridge is more stable than RSTP (don't ask me why)The biggest issue is so far restoring interfaces. It can randomly stop, and I need to find which line it stopped moving onMy code:Code:Select allAgain few times I had to find out which line was executed prior WinBox being disconnected and running from that line. Bridges and WG peers were the main culprits.

