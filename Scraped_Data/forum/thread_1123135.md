---
title: Thread-1123135
url: https://forum.mikrotik.com/viewtopic.php?p=1123135&sid=3b77a3334c914448dbbc02bfdff4c3aa#p1123135
thread_id: 1123135
section: RouterOS
post_count: 7
date_crawled: 2025-02-03T19:54:04.747116
---

### Post 1
Author: Unknown
Date: Unknown

Hi,Recently I upgraded my Mikrotik setup to a more advanced setup. I introduced multiple VLANs and did the configuration from scratch.Ether 1 is my WAN, Ether 8 is the trunkport to the switch.In my old setup with no VLANs and just one local address pool (192.168.88.0/0), I was able to route any client I wanted thorugh the WG Tunnel by following these steps:Wireguard Setup for RouterOS with device Selection:1. Add a Wireguard Interface and a Wireguard Peer using the config file given by the wireguard server(Endpoint-Port == Listen-Port)2. Create a new Table /routing/table3. Add a new rule (/routing/rule):Src.Addr: device in the network which should use WireguardAction:   lookup only in tableTable:    Table which was created in step 24. Add new IP address (/ip/addresses):Address:   Interface address as seen in the config file given by the wireguard serverInterface: Choose interface created in step 1(This creates automatically a entry in /ip/routes)5. Create a new route (/ip/routes):Dst. Address:  0.0.0.0/0Gateway:       Name of the Interface defined in step 1Routing Table: Table which was created in step 26. Firewall rulw (/ip/firewall/)Chain: srcnatSrc.Address: 192.168.88.0/24Out.Interface: Interface of step 1Action: masqueradeNow I want the same with my more complex setup, but I am not able to get it to work.This is my current config where I am trying to route 10.0.10.246 through the WG Tunnel, which is not working!Code:Select all# 2025-01-31 09:42:21 by RouterOS 7.17# software id = 6Y1M-YB75## model = RB5009UG+S+# serial number = <removed>/interfacebridgeaddframe-types=admit-only-vlan-tagged name=BR1 vlan-filtering=yes/interfacewireguardaddcomment="Mullvad WG1"listen-port=51820mtu=1420name=MullvadWG_1/interfacevlanaddinterface=BR1 name=BASE_VLAN vlan-id=99addinterface=BR1 name=CAMERAS_VLAN vlan-id=30addinterface=BR1 name=GUEST_VLAN vlan-id=20addinterface=BR1 name=IOT_VLAN vlan-id=40addinterface=BR1 name=MAIN_VLAN vlan-id=10/interfacelistaddname=WANaddname=VLANaddname=BASE/interfacewifi configurationaddcountry=****disabled=noname=BASE security.authentication-types=wpa2-psk,wpa3-psk.encryption=""ssid=B1addcountry=****datapath.vlan-id=10disabled=noname=MAIN security.authentication-types=wpa2-psk,wpa3-psk ssid=B2addcountry=****datapath.vlan-id=20disabled=noname=GUEST security.authentication-types=wpa2-psk,wpa3-psk ssid=B3/interfacewifi securityaddauthentication-types=wpa2-psk,wpa3-psk disabled=noname=SEC_IOT_CAMERAS/interfacewifi configurationaddcountry=****datapath.vlan-id=40disabled=noname=IOT security=SEC_IOT_CAMERAS ssid=CrossbonesGarden_Iaddcountry=****datapath.vlan-id=30disabled=noname=CAMERAS security=SEC_IOT_CAMERAS ssid=CrossbonesGarden_C/ip pooladdname=BASE_POOL ranges=192.168.112.10-192.168.112.254addname=MAIN_POOL ranges=10.0.10.2-10.0.10.254addname=GUEST_POOL ranges=10.0.20.2-10.0.20.254addname=CAMERAS_POOL ranges=10.0.30.2-10.0.30.254addname=IOT_POOL ranges=10.0.40.2-10.0.40.254/ip dhcp-serveraddaddress-pool=BASE_POOLinterface=BASE_VLAN name=BASE_DHCPaddaddress-pool=MAIN_POOLinterface=MAIN_VLAN name=MAIN_DHCPaddaddress-pool=GUEST_POOLinterface=GUEST_VLAN name=GUEST_DHCPaddaddress-pool=CAMERAS_POOLinterface=CAMERAS_VLAN name=CAMERAS_DHCPaddaddress-pool=IOT_POOLinterface=IOT_VLAN name=IOT_DHCP/routing tableadddisabled=nofib name=MullvadWG_1_Table/interfacebridge portaddbridge=BR1interface=ether2 pvid=99addbridge=BR1interface=ether3 pvid=10addbridge=BR1interface=ether4 pvid=20addbridge=BR1interface=ether5 pvid=30addbridge=BR1interface=ether6 pvid=40addbridge=BR1 comment=Trunkframe-types=admit-only-vlan-taggedinterface=ether8/ip neighbor discovery-settingssetdiscover-interface-list=all discover-interval=5s/interfacebridge vlanaddbridge=BR1 tagged=BR1,ether8 untagged=ether2 vlan-ids=99addbridge=BR1 tagged=BR1,ether8 untagged=ether3 vlan-ids=10addbridge=BR1 tagged=BR1,ether8 untagged=ether4 vlan-ids=20addbridge=BR1 tagged=BR1,ether8 untagged=ether5 vlan-ids=30addbridge=BR1 tagged=BR1,ether8 untagged=ether6 vlan-ids=40/interfacelist memberaddinterface=ether1 list=WANaddinterface=MAIN_VLAN list=VLANaddinterface=GUEST_VLAN list=VLANaddinterface=CAMERAS_VLAN list=VLANaddinterface=IOT_VLAN list=VLANaddinterface=BASE_VLAN list=BASE/interfaceovpn-server serveraddmac-address=FE:6D:F2:68:A5:62name=ovpn-server1/interfacewifi capsmansetenabled=yespackage-path=""require-peer-certificate=noupgrade-policy=suggest-same-version/interfacewifi provisioningaddaction=create-dynamic-enabled comment=EG_OG_PROVISIONING disabled=noidentity-regexp=cAP112 master-configuration=BASE name-format=EG_OG_CONF_MASTER \
    slave-configurations=MAIN slave-name-format=EG_OG_CONF_SLAVEaddaction=create-dynamic-enabled comment=KG_PROVISIONING disabled=noidentity-regexp=wAP112 master-configuration=IOT name-format=KG_CONF_MASTER \
    slave-configurations=BASE,MAIN slave-name-format=KG_CONF_SLAVEaddaction=create-dynamic-enabled comment=GUEST_PROVISIONING disabled=yes master-configuration=GUEST name-format=GUEST_CONF/interfacewireguard peersaddallowed-address=0.0.0.0/0endpoint-address=185.209.196.76endpoint-port=51820interface=MullvadWG_1name=MullvadWG_1_Peerpersistent-keepalive=1m\public-key="<Removed by me, because of privacy reasons>"/ip addressaddaddress=192.168.112.1/24interface=BASE_VLAN network=192.168.112.0addaddress=10.0.10.1/24interface=MAIN_VLAN network=10.0.10.0addaddress=10.0.20.1/24interface=GUEST_VLAN network=10.0.20.0addaddress=10.0.30.1/24interface=CAMERAS_VLAN network=10.0.30.0addaddress=10.0.40.1/24interface=IOT_VLAN network=10.0.40.0addaddress=10.73.250.17interface=MullvadWG_1network=10.73.250.17/ip dhcp-clientaddinterface=ether1/ip dhcp-server leaseaddaddress=10.0.10.251client-id=1:de:e5:7f:69:c2:12mac-address=DE:E5:7F:69:C2:12server=MAIN_DHCPaddaddress=10.0.10.246client-id=1:80:e6:50:26:cb:8mac-address=80:E6:50:26:CB:08server=MAIN_DHCP/ip dhcp-server networkaddaddress=10.0.10.0/24dns-server=192.168.112.1gateway=10.0.10.1addaddress=10.0.20.0/24dns-server=192.168.112.1gateway=10.0.20.1addaddress=10.0.30.0/24dns-server=192.168.112.1gateway=10.0.30.1addaddress=10.0.40.0/24dns-server=192.168.112.1gateway=10.0.40.1addaddress=192.168.112.0/24dns-server=192.168.112.1gateway=192.168.112.1/ip dnssetallow-remote-requests=yes servers=9.9.9.9/ip firewall filteraddaction=passthrough chain=forward comment="special dummy rule to show fasttrack counters"addaction=accept chain=input comment="Allow Estab & Related"connection-state=established,relatedaddaction=accept chain=input comment="Allow VLAN"in-interface-list=VLANaddaction=accept chain=input comment="Allow Base_Vlan Full Access"in-interface-list=BASEaddaction=accept chain=input comment="accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=drop chain=input comment="Drop the rest"addaction=fasttrack-connection chain=forward comment=fasttrack connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment="Allow Estab & Related"connection-state=established,relatedaddaction=accept chain=forward comment="VLAN Internet access"connection-state=newin-interface-list=VLANout-interface-list=WANaddaction=accept chain=forward comment="BASE_VLAN Internet access"connection-state=newin-interface-list=BASEout-interface-list=WANaddaction=drop chain=forward comment="Drop the rest"/ip firewall nataddaction=masquerade chain=srcnatout-interface=ether1addaction=masquerade chain=srcnatout-interface=MullvadWG_1src-address=0.0.0.0/0/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip routeadddisabled=nodistance=1dst-address=0.0.0.0/0gateway=MullvadWG_1routing-table=MullvadWG_1_Tablesuppress-hw-offload=no/ip servicesettelnet disabled=yessetftp disabled=yessetwww address=192.168.112.0/24port=8080setssh address=192.168.112.0/24setwinbox address=192.168.112.0/24/ip smb sharesset[finddefault=yes]directory=pub/routing ruleaddaction=lookup-only-in-table disabled=nosrc-address=10.0.10.246table=MullvadWG_1_Table/system identitysetname=BBB/system notesetshow-at-login=no/tool mac-serversetallowed-interface-list=BASE/tool mac-server mac-winboxsetallowed-interface-list=BASEWould be awesome if you could help me!ThanksCheers

---
### Post 2
Author: Unknown
Date: Unknown

I appreciate any tip

---
### Post 3
Author: Unknown
Date: Unknown

Suggest adding the WG interface to the WAN interface list:Code:Select all/interfacelist memberaddinterface=MullvadWG_1list=WAN

---
### Post 4
Author: Unknown
Date: Unknown

Dont get your point in the added bit in orange, get rid of it./ip firewall natadd action=masquerade chain=srcnat out-interface=ether1add action=masquerade chain=srcnat out-interface=MullvadWG_1src-address=0.0.0.0/0add one of the two following rules, to help with MTU, whichever works better for you./ip firewall natadd action=masquerade chain=srcnat out-interface=ether1add action=masquerade chain=srcnat out-interface=MullvadWG_add action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=MullvadWG_1 passthrough=yes protocol=tcp tcp-flags=synORadd action=change-mss chain=forward new-mss=1380 out-interface=MullvadWG_1 protocol=tcp tcp-flags=syn tcp-mss=1381-65535

---
### Post 5
Author: Unknown
Date: Unknown

/interface bridgeadd  name=BR1 vlan-filtering=yes/interface bridge portadd bridge=BR1ingress-filtering=yes frame-types=admit-only-priority-and-untaggedinterface=ether2 pvid=99add bridge=BR1 ingress-filtering=yes frame-types=admit-only-priority-and-untagged  interface=ether3 pvid=10add bridge=BR1 ingress-filtering=yes frame-types=admit-only-priority-and-untagged  interface=ether4 pvid=20add bridge=BR1 ingress-filtering=yes frame-types=admit-only-priority-and-untagged  interface=ether5 pvid=30add bridge=BR1 ingress-filtering=yes frame-types=admit-only-priority-and-untagged  interface=ether6 pvid=40add bridge=BR1 ingress-filtering=yes frame-types=admit-only-vlan-tagged interface=ether8  comment=trunk/ip neighbor discovery-settingsset discover-interface-list=BASE/interface list memberadd interface=ether1 list=WANadd interface=MAIN_VLAN list=VLANadd interface=GUEST_VLAN list=VLANadd interface=CAMERAS_VLAN list=VLANadd interface=IOT_VLAN list=VLANadd interface=BASE_VLAN list=VLANadd interface=BASE_VLAN list=BASE/ip firewall address-listadd address=192.168.112.XX list=Authorizedcomment="admin desktop"add address=192.168.112.XY list=Authorized  comment="admin laptop"/ip firewall filteradd action=accept chain=input comment="Allow Estab & Related" connection-state=established,relatedadd action=drop chain=input connection-state=invalidadd action=accept chain=input protocol=icmpadd action=accept chain=input comment="accept to local loopback (for CAPsMAN)" dst-address=127.0.0.1add action=accept chain=input comment="admin only Access" in-interface-list=BASE src-address-list=Authorizedadd action=accept chain=input comment="Allow VLAN to services" in-interface-list=VLANdst-port=53 protocol=udpadd action=accept chain=input comment="Allow VLAN to services" in-interface-list=VLAN dst-port=53 protocol=tcpadd action=drop chain=input comment="Drop the rest"++++++++++++++++++++add action=fasttrack-connection chain=forward comment=fasttrack connection-state=established,related hw-offload=yesadd action=accept chain=forward comment="Allow Estab,Related&Untrack"  connection-state=established,related,untrackedadd action=drop chain=forward connection-state=invalidadd action=accept chain=forward comment="VLAN Internet access"  in-interface-list=VLAN out-interface-list=WANadd action=accept chain=forward comment="admin to LAN"in-interface=list=BASE src-address-list=Authorizedout-interface-list=VLANadd action=drop chain=forward comment="Drop the rest"/ip firewall natadd action=masquerade chain=srcnat out-interface=ether1add action=masquerade chain=srcnat out-interface=MullvadWG_1/ip firewall mangleadd action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=MullvadWG_1 passthrough=yes protocol=tcp tcp-flags=syn/tool mac-serverset allowed-interface-list=none/tool mac-server mac-winboxset allowed-interface-list=BASEDid mulvad give you a DNS address as well?

---
### Post 6
Author: Unknown
Date: Unknown

Suggest adding the WG interface to the WAN interface list:Code:Select all/interfacelist memberaddinterface=MullvadWG_1list=WANThat was it! Thanks@Anav, thanks for your feedback, I will adapt my config!

---
### Post 7
Author: Unknown
Date: Unknown

Just so you understand CATs advice......MULVAD gave you one IP address to use.  That is the address they have in their peer settings for your connection.If you send any of your internal user with their private lan subnet IP as source it will get rejected at the other end.We use sourcenat like (like normal local WAN)  to give all OUTGOING traffic the local wanip of the router,,,,,,,and the same goes for out the wireguard interface.  Here we give all LAN traffic the source IP of the mulvan IP address and thus all traffic is accepted at their end.There are two way to accomplish this:a.    add mulvad to the WAN interface listassumes that you have kept the default sourcenat rule/ip firewall natadd action=masquerade chain=srcnat comment="defconf: masquerade" \ipsec-policy=out,none out-interface-list=WANb.  Simply add another sourcenat rule, for example if you changed the default rule/ip firewall natadd action=masquerade chain=srcnat out-interface=ether1add action=masquerade chain=srcnat out-interface=wireguard

---
