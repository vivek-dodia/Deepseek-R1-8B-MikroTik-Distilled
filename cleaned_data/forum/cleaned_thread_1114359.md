# Thread Information
Title: Thread-1114359
Section: RouterOS
Thread ID: 1114359

# Discussion

## Initial Question
Hello everyone, I found the process of setting up the wireguard client extremely complicated. So here I am after about 8 hours of struggling.1. My wireguard server is working and it took me 30 seconds to set up a windows client and verify that the connection was not the problem.2. My setup in the router OS seems to be sending data over the WG interface correctly: I see it in Torch. But nothing comes back. I have inbound and outbound firewall rules, but inbound rule does not show any traffic. Maybe Tx requests never left my router? But the handshake is successful and being maintained. I am so confused!Could you please help me to solve this puzzle?here is the setup:
```
/interfacebridgeaddname=docker port-cost-mode=shortaddname=localport-cost-mode=short/interfacevethaddaddress=88.0.0.2/24gateway=88.0.0.1gateway6=""name=pihole-veth/interfacewireguardaddlisten-port=26015mtu=1420name=WG/interfacevlanaddinterface=ether1 name=vlan-telekom vlan-id=7/interfacepppoe-clientaddadd-default-route=yes disabled=nointerface=vlan-telekom max-mru=1492\
    max-mtu=1492name=pppoe-telekom-fiberuse-peer-dns=yes user=.../container mountsadddst=/etc/pihole name=etc_pihole src=/usb1/pihole-etcadddst=/etc/dnsmasq.d name=dnsmasq_pihole src=/usb1/pihole-dns/disksetusb1 media-interface=none media-sharing=noslot=usb1setusb2 media-interface=none media-sharing=no/interfacelistaddname=listBridgeaddname=LANaddname=WANaddname=DNSaddname=VPN/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=dhcp_pool0 ranges=192.168.0.100-192.168.0.254/ip dhcp-serveraddaddress-pool=dhcp_pool0interface=locallease-time=10mname=dhcp1/ip smb usersset[finddefault=yes]disabled=yes/routing tableadddisabled=nofib name="VPN table"/containeraddenvlist=envs_piholeinterface=pihole-veth logging=yes mounts=\
    etc_pihole,dnsmasq_pihole root-dir=usb1/pihole start-on-boot=yes/container configsetregistry-url=https://registry-1.docker.io tmpdir=usb1/containers/container envs.../interfacebridge portaddbridge=localinterface=ether2internal-path-cost=10path-cost=10addbridge=dockerinterface=pihole-vethinternal-path-cost=10path-cost=10addbridge=localinterface=ether3internal-path-cost=10path-cost=10/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=listBridge/interfacelist memberaddinterface=locallist=listBridgeaddinterface=ether1 list=WANaddinterface=pppoe-telekom-fiber list=WANaddinterface=vlan-telekom list=WANaddinterface=locallist=LANaddinterface=docker list=LANaddinterface=docker list=DNSaddinterface=WG list=VPN/interfacewireguard peersaddallowed-address=0.0.0.0/0endpoint-address=...endpoint-port=...interface=WG name=firetv-peer persistent-keepalive=25s\
    preshared-key=...public-key=.../ip addressaddaddress=192.168.0.1/24interface=localnetwork=192.168.0.0addaddress=88.0.0.1/24interface=docker network=88.0.0.0/ip cloudsetupdate-time=no/ip dhcp-clientadddisabled=yesinterface=ether1/ip dhcp-server leaseaddaddress=192.168.0.5mac-address=...server=dhcp1/ip dhcp-server networkaddaddress=192.168.0.0/24dns-server=88.0.0.2gateway=192.168.0.1/ip dnssetallow-remote-requests=yes/ip firewall address-listaddaddress=192.168.0.0/24list=Local-LANaddaddress=192.16.0.0/24list=Guest-LAN/ip firewall filteraddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment="WireGuard Handshake"dst-port=26015\
    protocol=udpaddaction=accept chain=input comment="Allow LAN"in-interface-list=LAN \
    src-address-list=Local-LANaddaction=drop chain=input comment="Drop all"addaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=accept chain=forward comment=DNSin-interface-list=LAN \out-interface-list=DNSaddaction=accept chain=forward comment="Internet traffic"in-interface-list=\
    LANout-interface-list=WANaddaction=accept chain=forward comment="LAN to VPN"in-interface-list=LAN \out-interface-list=VPNaddaction=accept chain=forward comment="VPN to LAN"in-interface-list=VPN \out-interface-list=LANaddaction=drop chain=forward comment="Drop all"/ip firewall nataddaction=masquerade chain=srcnatout-interface-list=WAN/ip routeadddisabled=nodistance=1dst-address=0.0.0.0/0gateway=WG routing-table=\"VPN table"scope=30suppress-hw-offload=notarget-scope=10adddisabled=nodistance=1dst-address=88.0.0.0/24gateway=docker \
    routing-table="VPN table"scope=30suppress-hw-offload=notarget-scope=10adddisabled=nodistance=1dst-address=192.168.0.0/24gateway=local\
    routing-table="VPN table"scope=30suppress-hw-offload=notarget-scope=10/ip service.../ip smb shares.../ip sshsetstrong-crypto=yes/ipv6 firewall address-listaddaddress=::/128comment="defconf: unspecified address"list=bad_ipv6addaddress=::1/128comment="defconf: lo"list=bad_ipv6addaddress=fec0::/10comment="defconf: site-local"list=bad_ipv6addaddress=::ffff:0.0.0.0/96comment="defconf: ipv4-mapped"list=bad_ipv6addaddress=::/96comment="defconf: ipv4 compat"list=bad_ipv6addaddress=100::/64comment="defconf: discard only "list=bad_ipv6addaddress=2001:db8::/32comment="defconf: documentation"list=bad_ipv6addaddress=2001:10::/28comment="defconf: ORCHID"list=bad_ipv6addaddress=3ffe::/16comment="defconf: 6bone"list=bad_ipv6addaddress=::224.0.0.0/100comment="defconf: other"list=bad_ipv6addaddress=::127.0.0.0/104comment="defconf: other"list=bad_ipv6addaddress=::/104comment="defconf: other"list=bad_ipv6addaddress=::255.0.0.0/104comment="defconf: other"list=bad_ipv6/ipv6 firewall filteraddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMPv6"protocol=\
    icmpv6addaction=accept chain=input comment="defconf: accept UDP traceroute"port=\33434-33534protocol=udpaddaction=accept chain=input comment=\"defconf: accept DHCPv6-Client prefix delegation."dst-port=546protocol=\
    udp src-address=fe80::/10addaction=accept chain=input comment="defconf: accept IKE"dst-port=500,4500\
    protocol=udpaddaction=accept chain=input comment="defconf: accept ipsec AH"protocol=\
    ipsec-ahaddaction=accept chain=input comment="defconf: accept ipsec ESP"protocol=\
    ipsec-espaddaction=accept chain=input comment=\"defconf: accept all that matches ipsec policy"ipsec-policy=in,ipsecaddaction=drop chain=input comment=\"defconf: drop everything else not coming from LAN"in-interface-list=\!LANaddaction=accept chain=forward comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=drop chain=forward comment=\"defconf: drop packets with bad src ipv6"src-address-list=bad_ipv6addaction=drop chain=forward comment=\"defconf: drop packets with bad dst ipv6"dst-address-list=bad_ipv6addaction=drop chain=forward comment="defconf: rfc4890 drop hop-limit=1"\
    hop-limit=equal:1protocol=icmpv6addaction=accept chain=forward comment="defconf: accept ICMPv6"protocol=\
    icmpv6addaction=accept chain=forward comment="defconf: accept HIP"protocol=139addaction=accept chain=forward comment="defconf: accept IKE"dst-port=\500,4500protocol=udpaddaction=accept chain=forward comment="defconf: accept ipsec AH"protocol=\
    ipsec-ahaddaction=accept chain=forward comment="defconf: accept ipsec ESP"protocol=\
    ipsec-espaddaction=accept chain=forward comment=\"defconf: accept all that matches ipsec policy"ipsec-policy=in,ipsecaddaction=drop chain=forward comment=\"defconf: drop everything else not coming from LAN"in-interface-list=\!LAN/routing ruleaddaction=lookup-only-in-table disabled=nosrc-address=192.168.0.112/32\
    table="VPN table"/system clock.../system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=time.nist.gov/system routerboard settingssetauto-upgrade=yes/tool bandwidth-serversetenabled=no/tool mac-serversetallowed-interface-list=listBridge/tool mac-server mac-winboxsetallowed-interface-list=listBridge

---
```

## Response 1
Anyone? ---

## Response 2
This is not paid support keep your underwear on, be patient!!A few things, 1. what is this guest network all about, its only defined in firewall address list ??2. Allowed IPs is incorrect. if the MT is the Server peer for handshake, the client peers EACH should be assigned as separate peers, with their respective wireguard IP address detailed as the allowed IP.For example 10.10.10.2/32 remote1, 10.10.10.3/32 remote2, etc..3. Which brings me to thebiggest problem, NO definition of wireguard Subnet./ip addressadd address=192.168.0.1/24 interface=local network=192.168.0.0add address=88.0.0.1/24 interface=docker network=88.0.0.0????????????wg address????????????4. This routing rule makes no sense to me.... Your router is the server, where do you propose this user is going??? Assuming I am missing some information, that would make this clear?/routing ruleadd action=lookup-only-in-table disabled=no src-address=192.168.0.112/32 \table="VPN table" ---

## Response 3
Hi! Thank you for looking into this issue!1. what is this guest network all about, its only defined in firewall address list ??Nothing, it doesn't exist yet2. Allowed IPs is incorrect. if the MT is the Server peer for handshake, the client peers EACH should be assigned as separate peers, with their respective wireguard IP address detailed as the allowed IP.For example 10.10.10.2/32 remote1, 10.10.10.3/32 remote2, etc..3. Which brings me to thebiggest problem, NO definition of wireguard Subnet./ip addressadd address=192.168.0.1/24 interface=local network=192.168.0.0add address=88.0.0.1/24 interface=docker network=88.0.0.0????????????wg address????????????I try to setup router as a client that connects to remote wire guard server (my another remote machine) and proxies all traffic from user 192.168.0.112 via that server4. This routing rule makes no sense to me.... Your router is the server, where do you propose this user is going??? Assuming I am missing some information, that would make this clear?/routing ruleadd action=lookup-only-in-table disabled=no src-address=192.168.0.112/32 \table="VPN table"No, my router is wire guard client, not a server. User is supposed to send all its traffic except DNS via that wire guard tunnel. ---

## Response 4
Ahh it was not clear that was the case, your first post mentioned you had setup it up as a server.Misunderstood.Okay with that in mind............1. The big mistake noted previously is still biting you in the ass here.MISSINGis wireguard interface address!!2. This is nonsense.........there is only one subnet --> add address=192.16.0.0/24 list=Guest-LANaka noise!! cluttering the config.3. To be clear you only want ONE IP address to use the tunnel to the wireguard server and its for internet purposesRouting rules should look like...../routing ruleadd action=lookup-only-in-table min-prefix=0 table=mainadd action=lookup-only-in-table src-address=192.168.0.112/32 table="VPN table"4. IP Routes/ip routeadd disabled=no dst-address=0.0.0.0/0 gateway=WG routing-table="VPN table"5. Last step is ensuring all users go to docker/pi for dns./ip firewall natadd action=masquerade chain=srcnat out-interface-list=WANadd action=dst-nat chain=dstnat in-interface=Local dst-port=53 protoco=udp to-address=(Docker/piDNS)-IPaddressadd action=dst-nat chain=dstnat in-interface=Local dst-port=53 protoco=tcp to-address=(Docker/piDNS)-IPaddress ---