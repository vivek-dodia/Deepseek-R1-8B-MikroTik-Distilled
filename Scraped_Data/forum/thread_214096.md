---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=2&t=214096&p=1121023&amp;sid=3b77a3334c914448dbbc02bfdff4c3aa#p1121023
crawled_date: 2025-02-02T21:56:27.495545
section: mikrotik_forum
type: forum_thread
keywords: ospf, route
---

### Author: Wed Jan 22, 2025 11:00 am
Date: Unknown

```
/interface wireguard
add listen-port=13231 mtu=1440 name=wireguard1
/interface wireguard peers
add allowed-address=0.0.0.0/0 interface=wireguard1 name=HOME public-key="REDACTED"
```

```
/interface wireguard
add listen-port=13231 mtu=1440 name=wireguard1
/interface wireguard peers
add allowed-address=0.0.0.0/0 endpoint-address=11.22.33.44 endpoint-port=13231 interface=wireguard1 name=COLO public-key="REDACTED"
```

Hi all,Having changed ISP I no longer have a static IP address so in preparation I moved from a GRE tunnel to my CoLo to a Wireguard one.The tunnel is between two RB5009s. Colo is dedicated 1Gbit and home is 1Gbps down and 100Mbps up.Using GRE at it's peak performance I was reaching a download from the Colo or approx 800 to 900Mbps, CPU usage on devices of approx 30%With Wireguard lt's rarely higher than 200Mbps.CPU Usage of 45% Tried changing MTU on Wireguard from 1420 to 1440 and no difference.I assume I'm hitting limitations of Wireguard performance on the devices? Would have expected better to be honest!Config is as basic as it gets which is par for the course for wireguard: IP Address at each end - routes via OSPFColo:Code:Select allHome:Code:Select all


---
### Author: Wed Jan 22, 2025 11:48 am
Date: Unknown

A dynamic IP address with IPSec generally isn't a problem if you're using DDNS, as long as the IP address doesn't change in the middle of a session. If you're using some sort of keep-alive traffic like IPsec dpd-interval, it's unlikely to happen. In case it does, there are household scripts that can help in scenarios like this, for exampleviewtopic.php?t=79981.


---
### Author: Wed Jan 22, 2025 10:23 pm
Date: Unknown

```
## any site2site IN/OUT with WAN addr (very permissive here, need to bet more filtered)
/ip firewall raw
add action=accept chain=prerouting comment="site2site prevent fasttrack" \
    in-interface-list=wan src-address-list=pub_site50
add action=accept chain=output comment="site2site prevent fasttrack" \
    dst-address-list=pub_site70 out-interface-list=wan

## all through the WG tunnel 
/ip firewall raw
add action=accept chain=prerouting comment="remote prevent fasttrack" \
    in-interface-list=remote
add action=accept chain=output comment="remote prevent fasttrack" \
    out-interface-list=remote
```

Hi,I've use a WG between two RB5009 with a fiber symetric 1G between two sites.I added the following rules on both sides, here, it's just one, to avoid site2site traffic to be fastracked.Code:Select all


---
### Author: Thu Jan 23, 2025 7:29 am
Date: Unknown

Very interesting, I have my CPU frequency set to auto, and the frequency normally jumps between 350MHz and 1400MHz and could still achieve those 1.3+Gbps numbers.However, @dang21000 post made me consider my configuration again. My configuration currently has fasttrack enabled but not working, see my post here and @EdPa post right below it:viewtopic.php?t=212754&start=300#p1118471Which means fasttrack is not really active. As a test, I disabled DHCP Snooping on my bridge to restore a functional fasttrack, and the same test that I performed through WG produces significantly worst numbers, with throughput values jumping up and down with every report line (every second) between a few hundred Mbps and over 1Gbps, but very inconsistent and as a result, the average is only under 1Gbps. Disabling fasttrack restores the consistent 1.3+Gbps figure.It looks like fasttrack causes less load on the CPU, but still with spike (because not all packets can be fasttracked) as a result the CPU is downclocked (due to lower utilisation), and then cannot raises the clock fast enough when a spike is needed.I made further tests, and with fasttrack enabled, but CPU set at a constant 1400Mhz, the throughput is more consistent, but still markedly lower than with fasttrack disabled! I got nearly constant 9xx Mbps values, instead of 1.3+Gbps. Which means fasttrack enabled causes the WG throughput to be about 30% lower.Could you try to (temporally) disable the fasttrack rule (don't forget to go to the Connections tab and delete existing connections) on both RB5009 and see if the WG performance improves?


---
### Author: Thu Jan 23, 2025 9:42 am
Date: Unknown

```
/ip/firewall/raw/add action=notrack chain=prerouting src-address=10.172.1.0/24 place-before=0
```

Added a no track raw rule for the wireguard tunnel subnet:Code:Select allPerformance was worse but CPU usage was significantly less - about 15% to 20% vs 40% to 50% but then again this seems to correspond neatly with throughput.Half the throughput = half the CPU usage!iperf3Jan25-04.pngAnd with the raw rule removed again:iperf3Jan25-05.png

