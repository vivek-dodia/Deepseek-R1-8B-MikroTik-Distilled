---
title: Thread-213879
url: https://forum.mikrotik.com/viewtopic.php?t=213879&sid=49f92a630bc7970d8ca50523be880e8f
thread_id: 213879
section: RouterOS
post_count: 5
date_crawled: 2025-02-03T13:45:42.078713
---

### Post 1
Author: Unknown
Date: Unknown

Today I wanted to build the following test setup as a required workaround and noticed that the traffic drops as soon as I attach the Mikrotik WAN port to the network. Am I missing out something?1. Until the WAN port is connected I can obtain a DHCP adress (192.168.80.x) or configure a static 10.0.0.x address and reach the ISP modem (10.0.0.138)2. As soon as I attach the WAN port I can reach the WAN IP of the Mikrotik Router but neither the Mikrotik Router nor my Client can reach 10.0.0.138I disabled all kind of STP already but it doesn't work.See diagram for details about the setup.Unbenanntes Diagramm.drawio.png

---
### Post 2
Author: Unknown
Date: Unknown

Such a setup definitely does not follow a "best current practice", but unless the WAN and LAN interface of the Mikrotik are member ports of the same bridge inside the Mikrotik, it should work. Post the export of your Mikrotik configuration - there are many posts here that explain how to properly obfuscate sensitive information. The DHCP server on the ISP router must be disabled, I assume you did that although you haven't explicitly mentioned it.

---
### Post 3
Author: Unknown
Date: Unknown

Thanks for your reply. I know that it's not good practice but a temorarily required workaround. Why do the ports have to be member ports of the same bridge? In my oppinion it should also work if they are on different networks.Config:Code:Select all/interfacebridgeaddadmin-mac=18:FD:74:D2:24:48auto-mac=nocomment=defconf name=bridge port-cost-mode=short/interfaceethernetset[finddefault-name=ether5]disabled=yes/interfacewireguardaddcomment=wg-mobile listen-port=13231mtu=1420name=wg-road-warrioraddlisten-port=13235mtu=1420name=wg-s2s/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/interfacelte apnset[finddefault=yes]ip-type=ipv4use-network-apn=no/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=default-dhcp ranges=192.168.80.100-192.168.80.200/ip dhcp-serveraddaddress-pool=default-dhcpinterface=bridge lease-time=10mname=defconf/ip smb usersset[finddefault=yes]disabled=yes/portset0name=serial0/routing tableadddisabled=nofib name=wg-s2s/snmp communityset[finddefault=yes]addresses=192.168.80.227/32/system logging actionaddemail-start-tls=yes email-to=wo@sensitive-field.at name=mail2wo target=email/interfacebridge portaddbridge=bridge comment=defconf ingress-filtering=nointerface=ether2internal-path-cost=10path-cost=10addbridge=bridge comment=defconf ingress-filtering=nointerface=ether3internal-path-cost=10path-cost=10addbridge=bridge comment=defconf ingress-filtering=nointerface=ether4internal-path-cost=10path-cost=10addbridge=bridge comment=defconf ingress-filtering=nointerface=ether5internal-path-cost=10path-cost=10/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=LAN/ipv6 settingssetdisable-ipv6=yes max-neighbor-entries=8192/interfacelist memberaddcomment=defconfinterface=bridge list=LANaddcomment=defconfinterface=ether1 list=WANaddinterface=wg-road-warrior list=LAN/interfaceovpn-server serversetauth=sha1,md5/interfacewireguard peersaddallowed-address=192.168.253.253/32,192.168.0.0/24,0.0.0.0/0comment=vpn-zeisigg.sensitive-field.eu endpoint-address=vpn-zeisigg.sensitive-field.eu endpoint-port=13235interface=wg-s2s name=peer1 persistent-keepalive=25spublic-key="bvQdMF8Pzz92L579jAG55TENJz4P62dM6EiYCkNVNG4="addallowed-address=192.168.253.252/32,192.168.2.0/24comment=stelzer-josefsw.duckdns.org endpoint-address=stelzer-vpn-josefsw.clients.sensitive-field.eu endpoint-port=13235interface=wg-s2s name=peer2 persistent-keepalive=25spublic-key="azLEiJUgVqZp1Mq+HWOJ7Hap2GEfunemJKyUHkOq114="addallowed-address=192.168.100.2/32,192.168.80.0/24comment=iphone-GRMinterface=wg-road-warrior name=peer3 persistent-keepalive=25spublic-key="XsWl5kvRBpRnq+Cgj0lFo/g7RriUAi3H17ztpy+ApAs="addallowed-address=192.168.253.250/32,192.168.80.0/24comment=pi-backup-fls46 endpoint-port=13235interface=wg-s2s name=peer4 persistent-keepalive=25spublic-key="1q9usEMqz/9kSdc5wADMLbLKU4p2MJc+JyL5cDcP32U="addallowed-address=192.168.253.251/32,192.168.40.0/24comment=nuf-innerm-vpn.sensitive-field.eu endpoint-address=nuf-innerm-vpn.sensitive-field.eu endpoint-port=13235interface=wg-s2s name=peer5 persistent-keepalive=25spublic-key="2j3fKAmYGQ74dip72i/cmymqiUG2c9VGfqwKGwuHzC4="/ip addressaddaddress=10.0.0.150/24interface=ether1 network=10.0.0.0addaddress=192.168.100.1/24interface=wg-road-warrior network=192.168.100.0addaddress=192.168.80.254/24interface=bridge network=192.168.80.0addaddress=192.168.253.254/24comment=wg-s2sinterface=wg-s2s network=192.168.253.0/ip dhcp-clientaddcomment=defconf disabled=yesinterface=ether1/ip dhcp-server leaseaddaddress=192.168.80.111mac-address=B8:27:EB:21:1A:1F/ip dhcp-server networkaddaddress=192.168.80.0/24comment=defconf dns-server=192.168.80.254gateway=192.168.80.254netmask=24/ip dnssetallow-remote-requests=yes cache-max-ttl=1dcache-size=4096KiBservers=192.168.253.252,1.1.1.1/ip dnsstaticaddaddress=192.168.80.203name=vu1.sensitive-field.lan type=A/ip firewall address-listaddaddress=prod1.sensitive-field.at list=RDP-Allow/ip firewall filteraddaction=accept chain=input comment="Allow WireGuard Traffic"src-address=192.168.100.0/24src-address-list=""addaction=accept chain=input comment=";wg-s2s-vpn-zg.sensitive-field.eu"dst-port=13235protocol=udpaddaction=accept chain=input comment=WireGuarddst-port=13231protocol=udpaddaction=accept chain=input comment="defconf: accept established,related,untracked"connection-state=established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment="defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=drop chain=input comment="defconf: drop all not coming from LAN"in-interface-list=!LANaddaction=accept chain=forward comment="defconf: accept in ipsec policy"ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment="defconf: accept established,related, untracked"connection-state=established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"connection-state=invalidaddaction=drop chain=forward comment="defconf: drop all from WAN not DSTNATed"connection-nat-state=!dstnat connection-state=newin-interface-list=WANaddaction=accept chain=input comment="Garage Opener"dst-port=443protocol=tcpaddaction=accept chain=input comment="Garage Opener"dst-port=80protocol=tcpaddaction=accept chain=input comment=RDP-MediaPCdst-port=3389in-interface-list=WAN protocol=tcp src-address-list=RDP-Allow/ip firewall nataddaction=masquerade chain=srcnat comment="defconf: masquerade"ipsec-policy=out,noneout-interface=ether1out-interface-list=WANaddaction=dst-nat chain=dstnat comment=docker1.sensitive-field.lan dst-port=80in-interface-list=WAN protocol=tcp to-addresses=192.168.80.221addaction=dst-nat chain=dstnat comment=docker1.sensitive-field.lan dst-port=443in-interface-list=WAN protocol=tcp to-addresses=192.168.80.221addaction=dst-nat chain=dstnat comment=unifi.sensitive-field.at dst-port=8443in-interface-list=WAN protocol=tcp to-addresses=192.168.80.221addaction=dst-nat chain=dstnat comment=unifi.sensitive-field.at dst-port=3478in-interface-list=WAN protocol=udp to-addresses=192.168.80.221addaction=dst-nat chain=dstnat comment=unifi.sensitive-field.at dst-port=10001in-interface-list=WAN protocol=udp to-addresses=192.168.80.221addaction=dst-nat chain=dstnat comment=unifi.sensitive-field.at dst-port=8080in-interface-list=WAN protocol=tcp to-addresses=192.168.80.221addaction=dst-nat chain=dstnat comment=Buero-PC dst-port=3389in-interface-list=WAN protocol=tcp src-address-list=RDP-Allowto-addresses=192.168.80.217addaction=dst-nat chain=dstnat comment=test disabled=yes dst-port=64001protocol=tcp to-addresses=192.168.80.224to-ports=443/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip routeadddisabled=nodst-address=0.0.0.0/0gateway=10.0.0.138routing-table=main suppress-hw-offload=noadddisabled=nodst-address=0.0.0.0/0gateway=wg-s2s routing-table=wg-s2s suppress-hw-offload=noadddisabled=nodst-address=192.168.2.0/24gateway=wg-s2s routing-table=main suppress-hw-offload=noadddisabled=nodst-address=192.168.0.0/24gateway=wg-s2s routing-table=main suppress-hw-offload=noadddisabled=nodst-address=192.168.40.0/24gateway=wg-s2s routing-table=main suppress-hw-offload=no/ip smb sharesset[finddefault=yes]directory=/flash/pub/ip traffic-flowsetinterfaces=WAN/routing bfd configurationadddisabled=no/routing ruleaddaction=lookup-only-in-table comment="fire-tv-stick -> Zemann"disabled=yes dst-address=0.0.0.0/0src-address=192.168.80.209/32table=wg-s2saddaction=lookup-only-in-table comment="Media-PC -> Zemann"disabled=yes dst-address=0.0.0.0/0src-address=192.168.80.217/32table=wg-s2s/snmpsetenabled=yes/system clocksettime-zone-name=Europe/Vienna/system identitysetname=gw.sensitive-field.lan/system loggingset1action=mail2wo topics=error,!scriptset3action=mail2wo disabled=yes topics=accountaddaction=mail2wo topics=critical/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=de.pool.ntp.org/system scheduleraddinterval=5mname="Update DynDNS every 5 Minutes"on-event=":log debug \"DynDNS Update Script started\"\r\
    \n/system script run \"DynDNS Update Script\""policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=2024-01-15start-time=22:36:02/system scriptadddont-require-permissions=yes name="DynDNS Update Script"owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=":global DynDNSDomain \"sensitive.duckdns.org\"\r\
    \n:global DynDNSUpdateURL \"https://www.duckdns.org/update\?domains=grm-ls&token=xxxx&ip=\$newIP\"\r\
    \n:local InternetCheckTimeoutCount 10\r\
    \n#Do not modify below\r\
    \n:log info (\"*** Freedns IP address update started ****\");\r\
    \n:local stayInLoop true;\r\
    \n:local counter 0;\r\
    \n:while (\$stayInLoop) do={\r\
    \n   :set counter (\$counter + 1);\r\
    \n   #check if internet is up\r\
    \n   :if ([:typeof ([:ping address=8.8.8.8 count=1 as-value]->\"time\")] = \"nothing\") do={\r\
    \n    :log info \"Freedns: reply NOT received, retry no \$counter in 10 seconds\"\r\
    \n    :delay 10\r\
    \n  } else={\r\
    \n    :log info \"Freedns: Internet is up\"\r\
    \n    :set stayInLoop false;\r\
    \n    #:global IPCurrent [:put [/ip cloud get public-address]];;\r\
    \n    :global IPCurrent [:put [:resolve myip.opendns.com server=208.67.222.222]];\r\
    \n    :log info \"Current IP: \$IPCurrent\"\r\
    \n    :global DynDNSIP [:put [:resolve \$DynDNSDomain server=1.1.1.1]];\r\
    \n    :log info \"DuckDNS IP address: \$DynDNSIP\"\r\
    \n    #check if if associated to domain is the same as the current ip\r\
    \n    :if (\$DynDNSIP != \$IPCurrent) do={\r\
    \n      #the IPs are different, update IP at DuckDNS.org\r\
    \n      :log info \"IPs are different, update IP at DuckDNS.org\"\r\
    \n      /tool fetch url=\$DynDNSUpdateURL keep-result=no\r\
    \n      :log info \"New IP Found and updated : \$DynDNSDomain - \$IPCurrent\"\r\
    \n     } else={\r\
    \n     :log info \"No need to update IP, as: CURRENT IP: \$NoCIDR  DuckDNS IP: \$DynDNSIP\";\r\
    \n    }\r\
    \n  }\r\
    \n   #if the timeout timer expires and there is no internet, then abort\r\
    \n   :if (\$counter=\$InternetCheckTimeoutCount) do={:set stayInLoop false;}\r\
    \n}\r\
    \n:log info \"**** Freedns update script finished **** \"\r\
    \n"adddont-require-permissions=noname="Enable S2S Routing of FireTVStick"owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=":log info (\"*** Enable S2S Routing of FireTVStick ****\");\r\
    \n\r\
    \n/routing/rule/enable numbers=0"adddont-require-permissions=noname="Disable S2S Routing of FireTVStick"owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=":log info (\"*** Disable S2S Routing of FireTVStick ****\");\r\
    \n\r\
    \n/routing/rule/disable numbers=0"/tool e-mailsetfrom=<xxx@sensitive-field.at>port=587server=xxxx.kasserver.com tls=starttls user=xxxx/tool mac-serversetallowed-interface-list=LAN/tool mac-server mac-winboxsetallowed-interface-list=LAN/tool sniffersetfilter-interface=all streaming-server=192.168.80.136

---
### Post 4
Author: Unknown
Date: Unknown

Why do the ports have to be member ports of the same bridge?unlessmeansif not. So what I was actually saying was that the two interfaces connected to the same external switchmust notbe members of the same bridge in the Mikrotik, because without STP, you would get an L2 loop, and with STP, one of the ports would get blocked.An issue I can see is that you have a DHCP server attached to the LAN interface (bridge) and a DHCP client attached to the WAN interface (ether1) of the Mikrotik. So to prevent accidents, you have to set the 10.0.0.x/24 address to ether1 "manually" (and manually add a default route via 10.0.0.138 and possibly the DNS server addresses) and disable/remove the DHCP client attached to ether1 (which will prevent the WAN interface from getting a LAN address from the LAN DHCP server), and you also have to disable the DHCP server on the ISP router (which will prevent the LAN hosts from getting a 10.0.0.x address from there).

---
### Post 5
Author: Unknown
Date: Unknown

You have switching loops in your broadcast domain: unmanaged switch and MikroTik bridge interface. TheSpanning Tree Protocolmay block ports.Placing insecure and secure subnets on same switch is bad practice; just plug modem directly into MT WAN port for security and reliability.

---
