---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=9&t=211962&p=1105856#p1105856
crawled_date: 2025-02-02T21:35:29.320872
section: mikrotik_forum
type: forum_thread
---

### Author: Wed Oct 23, 2024 2:01 am
Date: Unknown

```
:localversion"IP-Scanner_v2.3.4":localnote"Compatible with RouterOS versions 6.45.9 & above":localscanTime"30":localdate[/system clockgetdate]:localname[/system identitygetname]:put"":put"### $version":put"### $note"{# Convert date and time for the file name, needed for ROS version 6:localsimplercurrdatetimestrdo={/system clock:localvdate[getdate]:localvtime[gettime]:localvdoff[:toarray"0,4,5,7,8,10"]:localMM[:pick $vdate($vdoff->2)($vdoff->3)]:localM[:tonum $MM]:if($vdate~".../../....")do={:setvdoff[:toarray"7,11,1,3,4,6"]:setM([:find"xxanebarprayunulugepctovecANEBARPRAYUNULUGEPCTOVEC"[:pick $vdate($vdoff->2)($vdoff->3)]-1]/2):if($M>12)do={:setM($M-12)}:setMM[:pick(100+$M)13]}:localyyyy[:pick $vdate($vdoff->0)($vdoff->1)]:localdd[:pick $vdate($vdoff->4)($vdoff->5)]:localHH[:pick $vtime02]:localmm[:pick $vtime35]:localss[:pick $vtime68]:return"$MM-$dd-$yyyy_$HH.$mm.$ss"}:localdateTime[$simplercurrdatetimestr]# Gather network address from user & find the interface:put"":put"### Listing available address-list":put""/ip addressprint:put"":localrequestvaluedo={:put $1;:return}:localscanRange[$requestvalue"Enter the address of the interface to scan. Hint: not an ether# -- Example: 192.168.88.1/24"]:put"":localscanBridge[/ip addressget[findwhereaddress="$scanRange"]interface]:localscanInterface[/interfacebridge hostget[findinterface=$"scanBridge"]bridge]:put"### Found bridge: $scanInterface":localfileName"$name_IP-Scan_$scanInterface_$dateTime"/fileremove[findwherename=$"fileName".txt]:delay2s# Clear the arp table:put"### Clearing the arp table":localdumplist[/ip arp find]:foreachiin=$dumplistdo={/ip arpremove$i}# Scan the range, get macs, ip addresses, bridge host interface & ether name comments. Do a mac lookup for each item:localipScan"":localbuffer1"":localvendor:localarpCount0:delay2s:put"### Scanning $scanRange for $scanTime seconds. Standby...":put"":delay2s:set$ipScan($ipScan.[/tool ip-scan address-range="$scanRange"duration=$scanTime]):put"### Looking up OUI vendor info. Standby...\r\n"/ip arp:foreachitemin=[findinterface=$"scanInterface"]do={:localmac[get$item mac-address]:localarpIP[get$item address]:localipScanip"$ipScan$[get $item address]":localipScanmac"$ipScan$[get $item mac-address]":if([:len $mac]>0)do={:do{:localint[/interfacebridge hostget[findwheremac-address=$ipScanmac]interface]:localcomment[/interfaceethernetget[findwherename=$int]comment]:localsecBit[:pick"$ipScanmac"12]:if(($secBit="2")or($secBit="6")or($secBit="A")or($secBit="E"))do={:setvendor"* LOCAL PRIVATE *"}else={:localvendorResult[/tool fetch url=("https://api.maclookup.app/v2/macs/".[:pick $ipScanmac 0 8]."/company/name") as-value output=user]
        :if (($vendorResult->"status")="finished") do={:set vendor ($vendorResult->"data")}
        :delay 0.5}
          :if ($vendor = "IEEERegistrationAuthority") do={
          :local vendorResult2 [/tool fetch url=("https://api.maclookup.app/v2/macs/".[:pick $ipScanmac 0 10]."/company/name") as-value output=user]:if(($vendorResult2->"status")="finished")do={:setvendor($vendorResult2->"data")}:delay0.5}:if($vendor="IEEE Registration Authority")do={:localvendorResult3[/tool fetch url=("https://api.maclookup.app/v2/macs/".[:pick $ipScanmac 0 13]."/company/name") as-value output=user]
            :if (($vendorResult3->"status")="finished") do={:set vendor ($vendorResult3->"data")}
            :delay 0.5}
    :set $buffer1 ($buffer1."IP:$ipScanip|MAC:$ipScanmac|Interface:$int|Comment:$comment|MLU:$vendor\r\n")
    :set arpCount ($arpCount + 1)
  } on-error={};
}}

# Grab bridge-host items
:local brHost1   ""
:local brVendor ""
:local brCount 0
/interface bridge host
:foreach brItem in=[find bridge="$scanInterface" local=no] do={
    :do {
    :local brMac [get $brItem mac-address]
    :local brInt [get $brItem interface]
    :local secBit2 [:pick "$brMac" 1 2 ]
    :if ( ($secBit2 = "2") or ($secBit2 = "6") or ($secBit2 = "A") or ($secBit2 = "E") ) do={
      :set brVendor "*LOCAL PRIVATE*"}  else={
      :local brVendorResult [/tool fetch url=("https://api.maclookup.app/v2/macs/".[:pick $brMac 0 8]."/company/name") as-value output=user]:if(($brVendorResult->"status")="finished")do={:setbrVendor($brVendorResult->"data")}:delay0.5}:if($brVendor="IEEE Registration Authority")do={:localbrVendorResult2[/tool fetch url=("https://api.maclookup.app/v2/macs/".[:pick $ipScanmac 0 10]."/company/name") as-value output=user]
        :if (($brVendorResult2->"status")="finished") do={:set brVendor ($brVendorResult2->"data")}
        :delay 0.5}
          :if ($brVendor = "IEEERegistrationAuthority") do={
          :local brVendorResult3 [/tool fetch url=("https://api.maclookup.app/v2/macs/".[:pick $ipScanmac 0 13]."/company/name") as-value output=user]:if(($brVendorResult3->"status")="finished")do={:setbrVendor($brVendorResult3->"data")}:delay0.5}:set$brHost1($brHost1."MAC: $brMac | Interface: $brInt | MLU: $brVendor\r\n"):setbrCount($brCount+1)}on-error={:put"error - duplicate MAC detected"};}# ARP Clean-up/ip arpremove[findwhere!complete]# Messages:localtitle"Identity: $name | Scanned Bridge: $scanInterface | Scanned Range: $scanRange | Date: $date | Version: $version\r\n":localdetected"### Total devices with an address detected on '$scanInterface': $arpCount":localdump"### Below is a dump of the data collected from '$scanInterface' & IP range '$scanRange'. If there are duplicate MAC addresses, they will NOT be listed in the Bridge-Host dump\r\n":localbrCountNote"### Total items found in bridge-host for '$scanInterface': $brCount"# List the results:put"$detected":put"$buffer1":delay1s:put"$dump":put"$brCountNote":put"$brHost1"# Put the results in a file:put"### Writing to file"/fileprintfile=$fileName:delay1s:execute[/fileset$fileName contents="$title\r\n$detected\r\n$buffer1\r\n$dump\r\n$brCountNote\r\n$brHost1"]# Instructions:put"### The file: '$fileName' is located in 'Files' (left sidebar menu)":put"### To download the file locally, right click on the file & select download":put"### Be sure to delete the file from this device once it's downloaded locally":put""}
```

Greetings everyone. Looking for help in the script below. The script requires user input of the network address. Once the network address is known, it then finds the bridge name, clears the arp table, runs an ip-scan, gathers MACs from the found bridge & grabs the IP's by matching the MAC address to the arp table. Need help on how to reach out for each MAC address found to obtain the vendor name & add it to the file.I found a great script created by excession in a thread here:viewtopic.php?t=211539. Script works great in ROS 7 & only supported in ROS 7 as stated by the op. Looking for something similar to obtain the vendor names.The majority of Mikrotik's are mostly running 6.45.9 and some on 6.49.10. Does anyone know how, in ROS 6.45.x or above, to have the script below reach out & get the vendor info? The MAC address is defined as $mac in the script below.Update:Changed the script as it failed or skipped over duplicate macs. It clears the arp table, ip-scan the range, get macs, ip addresses, bridge host interface & ether name comments. Do a mac lookup for each item. Output is shown in cli & also saved to a file (identity_IP-Scan_interface_date-time.txt). A bridge must exist. The script will request a value, user inputs the ip range of the printed available networks (ip --> addresses), 192.168.88.1/24 as example, the script will find the interface & run with it.Update2:Updated to follow IEEE standards for OUI lookup. Replaced date/time conversion with rextended's version (works properly in all ROS versions). Removed some items needed for personal needs/use.Update3:Put back the date command that was missing for the title. Added arp cleanup suggested by wfburton.Update4:Added to validate that a bridge interface does exist in bridge hosts (/interface bridge host) prior to running.Thank you to excession for providing the code to make the mac lookup work.Thank you rextended for your input, suggestions and scripts.Thank you to all the forum guru's & users having this info available searching throughout the forum, and providing assistance when stumped.# disclaimer: novice attempt for this to work in ros 6.45.9 & above.Code:Select allHere's a screenshot of the outputScreenshot 2024-11-02 at 11.33.33â€¯AM.png


---
### Author: [SOLVED]Mon Oct 28, 2024 4:10 pm
Date: Unknown

```
:localvendor:localvendorResult[/tool fetch url="https://api.maclookup.app/v2/macs/$MAC-ADDRESS-HERE/company/name" as-value output=user]
:if (($vendorResult->"status")="finished") do={:set vendor ($vendorResult->"data")}
:delay 0.5
```

This part from my script is the bit I think you're after and this does work in ROS v6:Code:Select allAs I recall the only part from my script that doesn't work in v6 is the as-value parameter on the ip-scan function, and you're already working around that. Please keep the above :delay in your script, this is required to meet the usage limits on the api.


---
### Author: Sun Nov 03, 2024 2:10 pm
Date: Unknown

Thank you for this script!At the end of the script can you add this#ARP Clean-up/ip/arp/remove [find where !complete]I tried modifying it but got nowhere.Greetings wfburton. I added your suggestion for arp cleanup to the script. In ROS version 6, the "/" can't be used. The arp cleanup command, or any command, would look like:/ip arp remove [find where !complete]Initial post updated


---
### Author: Sun Nov 03, 2024 6:50 pm
Date: Unknown

Thanks for the fix but something broke.Nothing broke. Does your sfp-sfpplus1 exist as a "bridge" in /interface bridge host ? Assuming it doesn't would be reason why it failed to provide any data. Thanks for pointing that out though. I added to validate that a bridge does exist prior to running.Initial post updated


---
### Author: Sun Nov 03, 2024 8:29 pm
Date: Unknown

It is working properly. Again, the script requires that the bridge exists. In your printout of /interface bridge host, the "bridge" is not sfp-sfpplus1. The bridge is bridgeLocalI guess I can explain why the script was made this way. In what I do, we mostly deal with public LAN blocks. The addresses reside on a bridge. It's why the bridge must exist in this script in order for it to run.However, we can get this to work. Some changes are needed on how the script runs & where it's looking for the data. If you wouldn't mind, please create a new thread and I'll help you out there & post a script that'll work for your use case.Btw, I have no idea how to add an api key. I can look into it & try to implement it for you. But lets get the script working for you first before messing with the api key

