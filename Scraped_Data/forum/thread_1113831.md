---
title: Thread-1113831
url: https://forum.mikrotik.com/viewtopic.php?p=1113831#p1113831
thread_id: 1113831
section: RouterOS
post_count: 7
date_crawled: 2025-02-03T16:46:51.966202
---

### Post 1
Author: Unknown
Date: Unknown

I'm not sure if WAN access is expected to work out of the box with back to home? I cannot browse the web on my iPhone when connected via back to home.I see one other topic with a similar problem:viewtopic.php?t=207891But i'm not sure i see the solution to the problem in that thread, maybe i just don't understand the answers correctly.Here's my config:Code:Select all[myuser@MikroTik]>/export# 2024-12-08 18:32:18 by RouterOS 7.16.2# software id = 5TRY-6BL4## model = RB5009UG+S+# serial number = XXX/interfacebridgeaddadmin-mac=48:A9:8A:25:99:6Cauto-mac=nocomment=defconf name=deco port-cost-mode=short/interfacewireguardaddcomment=back-to-home-vpn listen-port=48027mtu=1420name=back-to-home-vpn/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=dhcp ranges=192.168.0.2-192.168.0.254/ip dhcp-serveraddaddress-pool=dhcpinterface=deco lease-time=10mname=defconf/ip smb usersset[finddefault=yes]disabled=yes/interfacebridge portaddbridge=deco comment=defconfinterface=ether2internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=ether3internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=ether4internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=ether5internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=ether6internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=ether7internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=ether8internal-path-cost=10path-cost=10addbridge=deco comment=defconfinterface=sfp-sfpplus1internal-path-cost=10path-cost=10/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=none/ipv6 settingssetdisable-ipv6=yes/interfacelist memberaddcomment=defconfinterface=deco list=LANaddcomment=defconfinterface=ether1 list=WAN/ip addressaddaddress=192.168.0.1/24comment=defconfinterface=deco network=192.168.0.0/ip cloudsetback-to-home-vpn=enabled ddns-enabled=yes ddns-update-interval=10mupdate-time=no/ip cloud back-to-home-usersaddallow-lan=yes comment="iPhone 12"name=RB5009UG+S+private-key="xxx="public-key=\"yyy="/ip dhcp-clientaddcomment=defconfinterface=ether1/ip dhcp-server leaseaddaddress=192.168.0.10client-id=1:98:1:a7:99:6f:cf mac-address=98:01:A7:99:6F:CF server=defconfaddaddress=192.168.0.5client-id=ff:f8:ce:1b:a1:0:2:0:0:ab:11:a3:5f:3b:bf:fe:9c:ba:7fmac-address=00:1E:06:43:D2:C0 server=defconfaddaddress=192.168.0.6client-id=1:0:1e:6:32:92:2fmac-address=00:1E:06:32:92:2Fserver=defconf/ip dhcp-server networkaddaddress=192.168.0.0/24comment=defconf dns-server=192.168.0.1gateway=192.168.0.1netmask=24/ip dnssetallow-remote-requests=yes/ip dnsstaticaddaddress=192.168.0.1comment=defconf name=router.lan type=A/ip firewall address-listaddaddress=192.168.0.2-192.168.0.254list=allowed_to_routeraddaddress=0.0.0.0/8comment=RFC6890 list=not_in_internetaddaddress=172.16.0.0/12comment=RFC6890 list=not_in_internetaddaddress=192.168.0.0/16comment=RFC6890 list=not_in_internetaddaddress=10.0.0.0/8comment=RFC6890 list=not_in_internetaddaddress=169.254.0.0/16comment=RFC6890 list=not_in_internetaddaddress=127.0.0.0/8comment=RFC6890 list=not_in_internetaddaddress=224.0.0.0/4comment=Multicastlist=not_in_internetaddaddress=198.18.0.0/15comment=RFC6890 list=not_in_internetaddaddress=192.0.0.0/24comment=RFC6890 list=not_in_internetaddaddress=192.0.2.0/24comment=RFC6890 list=not_in_internetaddaddress=198.51.100.0/24comment=RFC6890 list=not_in_internetaddaddress=203.0.113.0/24comment=RFC6890 list=not_in_internetaddaddress=100.64.0.0/10comment=RFC6890 list=not_in_internetaddaddress=240.0.0.0/4comment=RFC6890 list=not_in_internetaddaddress=192.88.99.0/24comment="6to4 relay Anycast [RFC 3068]"list=not_in_internetaddaddress=mydomain.net list=cloudflare/ip firewall filteraddaction=accept chain=input comment="default configuration"connection-state=established,relatedaddaction=accept chain=input src-address-list=allowed_to_routeraddaction=accept chain=input protocol=icmpaddaction=drop chain=inputaddaction=fasttrack-connection chain=forward comment=FastTrackconnection-state=established,related hw-offload=yesaddaction=accept chain=forward comment="Established, Related"connection-state=established,relatedaddaction=drop chain=forward comment="Drop invalid"connection-state=invalid log=yes log-prefix=invalidaddaction=drop chain=forward comment="Drop tries to reach not public addresses from LAN"dst-address-list=not_in_internetin-interface=\
    deco log=yes log-prefix=!public_from_LANout-interface=!decoaddaction=drop chain=forward comment="Drop incoming packets that are not NATted"connection-nat-state=!dstnat connection-state=new\in-interface=ether1 log=yes log-prefix=!NATaddaction=drop chain=forward comment="Drop incoming from internet which is not public IP"in-interface=ether1 log=yes log-prefix=\!publicsrc-address-list=not_in_internetaddaction=drop chain=forward comment="Drop packets from LAN that do not have LAN IP"in-interface=deco log=yes log-prefix=LAN_!LAN \
    src-address=!192.168.0.0/24/ip firewall nataddaction=masquerade chain=srcnat comment=Hairpindst-address=192.168.0.0/24src-address=192.168.0.0/24# Some open ports left out...addaction=masquerade chain=srcnat comment="defconf: masquerade"ipsec-policy=out,noneout-interface-list=WAN/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetssh port=2200setapi disabled=yessetapi-ssl disabled=yes/ip smb sharesset[finddefault=yes]directory=/pub/ip sshsetstrong-crypto=yes/ipv6 firewall address-listaddaddress=::/128comment="defconf: unspecified address"list=bad_ipv6addaddress=::1/128comment="defconf: lo"list=bad_ipv6addaddress=fec0::/10comment="defconf: site-local"list=bad_ipv6addaddress=::ffff:0.0.0.0/96comment="defconf: ipv4-mapped"list=bad_ipv6addaddress=::/96comment="defconf: ipv4 compat"list=bad_ipv6addaddress=100::/64comment="defconf: discard only "list=bad_ipv6addaddress=2001:db8::/32comment="defconf: documentation"list=bad_ipv6addaddress=2001:10::/28comment="defconf: ORCHID"list=bad_ipv6addaddress=3ffe::/16comment="defconf: 6bone"list=bad_ipv6/ipv6 firewall filteraddaction=accept chain=input comment="defconf: accept established,related,untracked"connection-state=established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=invalidaddaction=accept chain=input comment="defconf: accept ICMPv6"protocol=icmpv6addaction=accept chain=input comment="defconf: accept UDP traceroute"port=33434-33534protocol=udpaddaction=accept chain=input comment="defconf: accept DHCPv6-Client prefix delegation."dst-port=546protocol=udp src-address=fe80::/10addaction=accept chain=input comment="defconf: accept IKE"dst-port=500,4500protocol=udpaddaction=accept chain=input comment="defconf: accept ipsec AH"protocol=ipsec-ahaddaction=accept chain=input comment="defconf: accept ipsec ESP"protocol=ipsec-espaddaction=accept chain=input comment="defconf: accept all that matches ipsec policy"ipsec-policy=in,ipsecaddaction=drop chain=input comment="defconf: drop everything else not coming from LAN"in-interface-list=!LANaddaction=accept chain=forward comment="defconf: accept established,related,untracked"connection-state=established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"connection-state=invalidaddaction=drop chain=forward comment="defconf: drop packets with bad src ipv6"src-address-list=bad_ipv6addaction=drop chain=forward comment="defconf: drop packets with bad dst ipv6"dst-address-list=bad_ipv6addaction=drop chain=forward comment="defconf: rfc4890 drop hop-limit=1"hop-limit=equal:1protocol=icmpv6addaction=accept chain=forward comment="defconf: accept ICMPv6"protocol=icmpv6addaction=accept chain=forward comment="defconf: accept HIP"protocol=139addaction=accept chain=forward comment="defconf: accept IKE"dst-port=500,4500protocol=udpaddaction=accept chain=forward comment="defconf: accept ipsec AH"protocol=ipsec-ahaddaction=accept chain=forward comment="defconf: accept ipsec ESP"protocol=ipsec-espaddaction=accept chain=forward comment="defconf: accept all that matches ipsec policy"ipsec-policy=in,ipsecaddaction=drop chain=forward comment="defconf: drop everything else not coming from LAN"in-interface-list=!LAN/system clocksettime-zone-name=Europe/Copenhagen/system notesetshow-at-login=no/tool bandwidth-serversetenabled=no/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=LAN/tool mac-server pingsetenabled=noAny advice is appreciated, thanks in advance.

---
### Post 2
Author: Unknown
Date: Unknown

The  only thing I can suggest is a shot in the dark but its the  only idea I  have.add a firewall address list manually/ip firewall address-listadd IPaddress-peer1    list=back-to-home-lan-restricted-peersadd IPaddress-peer2    list=back-to-home-lan-restricted-peersHowever I do not know what that looks like to actually construct the  address list properlyYou can at least see it by NOT allowing wireguard users access to the LAN and then the router makes this list up dynamically and therefore this address list  show up on a /ip/firewall/address-list printetc....  Then copy it and make it a manually entered rule like above.Then make the following firewall rule./ip firewalladd chain=forward action=accept  src-address-list=back-to-home-lan-restricted-peers  out-interface-list=WAN

---
### Post 3
Author: Unknown
Date: Unknown

Thank you for your suggestion - I tried it it, but it didn't help.I was lucky to get closer to the issue. The wireguard peer2 (which is set dynamically) defaults to having a client DNS address as 192.168.216.1. That can be configured in the iOS app, and when it is changed to 8.8.8.8 i can browse WAN again... But if i set it to 192.168.0.1 (which is what my devices uses when connected on LAN), i get nothing. If i add 192.168.216.1 in WinBox > DNS Settings > Static > Name: router.vpn, Type: A, Value: 192.168.216.1 i also get nothing.I can ofc. just go with 8.8.8.8, but would like the default one to work, if i share the back-to-home with family. Any thoughts on why it seems like i cannot get those addresses to work as DNS servers?

---
### Post 4
Author: Unknown
Date: Unknown

Okay here is the way.On your router make a firewall address list like so/ip firewall address-listadd 192.168.216.2 list=BTH-to-WANadd 192.168.216.3 list=BTH-to-WAN....add 192.168.216.XX list=BTH-to-WAN/ip firewalladd chain=forward action=accept src-address-list=BTH-to-WAN  out-interface-list=WAN

---
### Post 5
Author: Unknown
Date: Unknown

Hmm, not 100% without more inspection....  But I think 192.168.216.0/24 needs to be in the "allowed_to_router" list.

---
### Post 6
Author: Unknown
Date: Unknown

Hmm, not 100% without more inspection....  But I think 192.168.216.0/24 needs to be in the "allowed_to_router" list.That would be for remote user access to the config of the router,  I thought he was asking for access to the LAN subnets......

---
### Post 7
Author: Unknown
Date: Unknown

Hmm, not 100% without more inspection....  But I think 192.168.216.0/24 needs to be in the "allowed_to_router" list.That would be for remote user access to the config of the router,  I thought he was asking for access to the LAN subnets......Now that I look, correct.  But I read the OP as internet bound traffic.  I still think it's the firewall,  But I'm not 100% sure myself â€” I just don't know what line may be dropping BTH traffic since it unclear what path is broken & the non-default "address-list" firewall with hairpin NAT rule make it bit confusing to sort out what's going on.

---
