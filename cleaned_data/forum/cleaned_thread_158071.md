# Thread Information
Title: Untitled Thread
Section: mikrotik_forum
Thread ID: 158071

# Discussion

## Initial Question
Author: Fri Feb 28, 2020 4:25 pm
Here's my router configuration/export# feb/28/2020 16:19:32 by RouterOS 6.46.4# software id = A534-W2FM## model = RB760iGS# serial number = SECRET/interface bridgeadd name=VLAN-Bridgeadd admin-mac=SECRET auto-mac=no comment="Default bridge" name=bridge/interface ethernetset [ find default-name=ether1 ] comment="WAN interface - Server3 temp." name=ETH1set [ find default-name=ether2 ] comment="HP Switch" name=ETH2set [ find default-name=ether3 ] comment=Server4 name=ETH3set [ find default-name=ether4 ] comment="Shon's room AP" name=ETH4set [ find default-name=ether5 ] comment="Office room AP" name=ETH5 poe-out=offset [ find default-name=sfp1 ] disabled=yes/interface vlanadd interface=VLAN-Bridge name=vlan99 vlan-id=99add interface=VLAN-Bridge name=vlan100 vlan-id=100add interface=VLAN-Bridge name=vlan200 vlan-id=200/interface listadd comment=defconf name=WANadd comment=defconf name=LAN/ip pooladd name=dhcp_pool100 ranges=192.168.100.30-192.168.100.254add name=dhcp_pool200-HASS ranges=192.168.200.30-192.168.200.254/ip dhcp-serveradd add-arp=yes address-pool=dhcp_pool100 always-broadcast=yes interface=vlan100 name=dhcp100add add-arp=yes address-pool=dhcp_pool200-HASS disabled=no interface=vlan200 name="dhcp 200-HASS"/interface bridge portadd bridge=VLAN-Bridge interface=ETH4add bridge=VLAN-Bridge interface=ETH5add bridge=bridge interface=ETH1add bridge=bridge interface=ETH2add bridge=bridge interface=ETH3/ip neighbor discovery-settingsset discover-interface-list=all/interface bridge vlanadd bridge=VLAN-Bridge vlan-ids=99, 100, 200add bridge=bridge tagged=vlan200 vlan-ids=""/interface detect-internetset lan-interface-list=LAN/interface list memberadd interface=ETH1 list=WAN/ip addressadd address=192.168.0.100/24 interface=bridge network=192.168.0.0add address=192.168.99.1/24 interface=vlan99 network=192.168.99.0add address=192.168.200.1/24 interface=vlan200 network=192.168.200.0add address=192.168.100.1/24 interface=vlan100 network=192.168.100.0/ip dhcp-client# DHCP client can not run on slave interface!add comment=defconf disabled=no interface=ETH1/ip dhcp-relayadd dhcp-server=192.168.0.5 disabled=no interface=vlan100 local-address=192.168.100.1 name=relay100/ip dhcp-server networkadd address=192.168.0.0/24 comment=defconf gateway=192.168.0.100 netmask=24add address=192.168.100.0/24 dns-server=192.168.0.4, 192.168.0.5 gateway=192.168.100.1 netmask=24add address=192.168.200.0/24 dns-server=192.168.0.4, 192.168.0.5 gateway=192.168.200.1 netmask=24/ip dnsset allow-remote-requests=yes servers=8.8.8.8/ip dns staticadd address=192.168.0.100 name=router.lan/ip firewall filteradd action=accept chain=forward comment="Allow HASS to communicate with DNS servers" connection-state=established, related, new dst-address=192.168.0.4 dst-port=53 in-interface=vlan200 protocol=udpadd action=accept chain=forward comment="Allow HASS to communicate with DNS servers" connection-state=established, related, new dst-address=192.168.0.5 dst-port=53 in-interface=vlan200 protocol=udpadd action=accept chain=forward comment="Allow Bridge SW to ICMP Vlan200" connection-state="" in-interface=vlan200 out-interface=bridge protocol=icmpadd action=drop chain=forward comment="Block all traffic" in-interface=vlan200add action=accept chain=input comment="defconf: accept established, related, untracked" connection-state=established, related, new, untrackedadd action=accept chain=input comment="defconf: accept ICMP"add action=fasttrack-connection chain=forward comment="defconf: fasttrack" connection-state=invalid, established, related, new, untrackedadd action=accept chain=forward comment="defconf: accept established, related, untracked" connection-state=established, related, new, untrackedadd action=drop chain=input comment="defconf: drop invalid" connection-state=invalidadd action=drop chain=input comment="defconf: drop all not coming from LAN" in-interface-list=!LANadd action=drop chain=forward comment="defconf: drop invalid" connection-state=invalid disabled=yes log=yesadd action=drop chain=forward comment="defconf: drop all from WAN not DSTNATed" connection-nat-state=!dstnat connection-state=new disabled=yes in-interface-list=WANadd action=accept chain=forward comment="defconf: accept out ipsec policy" disabled=yes ipsec-policy=out, ipsec log=yesadd action=accept chain=forward comment="defconf: accept in ipsec policy" disabled=yes ipsec-policy=in, ipsec log=yes/ip firewall natadd action=masquerade chain=srcnat comment="defconf: masquerade" ipsec-policy=out, none log=yes out-interface-list=WAN/ip traffic-flowset enabled=yes/ip traffic-flow targetaddadd dst-address=192.168.0.100add dst-address=192.168.0.100/system package updateset channel=development/tool mac-serverset allowed-interface-list=LAN/tool mac-server mac-winboxset allowed-interface-list=LAN ---

## Response 1
Author: Sat Feb 29, 2020 11:34 am
Anav, thanks for your informative\detailed replyQ1.The MT router will be the router attached to the INTERNET?Yes, it will be - but this is step #2 (configuring smart FW rules may take me some time).Q2a.Will it receive a dynamic or static WANIP from the ISP?The IP I'm receiving from the ISP is a Public IP address (DHCP client will be enabled on ETH1 port).Q2b.The WANIP looks like a LANIP at the moment in the diagram so will your router be connected to an ISP Modem receiving a WANIP ('normal' kind) or will it be attached to an ISPs router and getting a bastardized WANIP that looks more like a LANIP lol.The "default bridge" IP address will be set to 192.168.0.1 once I'll connect the ISP to the MT router.ETHER 3 connection is confusing. How many ethernet cables from it are attached to the MT router? Assuming one and thus how does it get multiple IPs??In any case, if like a switch and it has ethernet cards for other devices okay. Then a TRUNK Port.ETH3 in the MT router is directly connected, using 1x Ethernet cable, to a Server with Linux OS.In Linux, it is very easy to configure multiple IP addresses & VLANs - In Windows, it is a bit advanced but can be done - via a supported Ethernet adapter is a MUST.This is my "example ETH configuration" in 1x if my Linux OS (Ubuntu 19.04):yehonatan@server004:~$ cat /etc/network/interfaces# interfaces(5) file used by ifup(8) and ifdown(8)auto loiface lo inet loopback# enp0s31f6 configurationauto enp0s31f6iface enp0s31f6 inet staticaddress 192.168.0.4netmask 255.255.255.0gateway 192.168.0.100# VLAN 200 configurationauto enp0s31f6.200iface enp0s31f6.200 inet staticaddress 192.168.200.99netmask 255.255.255.0gateway 192.168.200.1vlan-raw-device enp0s31f6.What is not identified clearly on the map are the VLANs that cover the HP side of the house and what VLAN is used by the device attached at ETH1Ports ETH1 & ETH2 should be Access ports onlyPort ETH3 should be Native VLAN 1 (if I can describe PVID 1 like that) and Tagged for VLAN 200 and any future VLAN I'll require.Ports ETH4 & ETH5 are tagged only (VLANs 99, 100 & 200) - for now ---

## Response 2
Author: Sat Feb 29, 2020 12:41 pm
Great!pe1chl, thanks for your tip! I've made the configuration to work as needed!I'm attaching my current configuration - if it may help anybody else in the future.I've also changed my temp. router IP to use a different LAN pool 172.16.32.0/24 - so I can start to configure the Firewall rules./export# feb/29/2020 12:35:27 by RouterOS 6.46.4# software id = A534-W2FM## model = RB760iGS# serial number = SECRET/interface bridgeadd disabled=yes name=VLAN-Bridgeadd admin-mac=SECRET auto-mac=no comment="Default bridge" name=bridge/interface ethernetset [ find default-name=ether1 ] comment="WAN interface" name=ETH1set [ find default-name=ether2 ] comment="HP Switch" name=ETH2set [ find default-name=ether3 ] comment=Server4 name=ETH3set [ find default-name=ether4 ] comment="Shon's room AP" name=ETH4set [ find default-name=ether5 ] comment="Office room AP" name=ETH5 poe-out=offset [ find default-name=sfp1 ] disabled=yes/interface vlanadd interface=bridge name=vlan99 vlan-id=99add interface=bridge name=vlan100 vlan-id=100add interface=bridge name=vlan200 vlan-id=200/interface listadd comment=defconf name=WANadd comment=defconf name=LAN/ip pooladd name=dhcp_pool100 ranges=192.168.100.30-192.168.100.254add name=dhcp_pool200-HASS ranges=192.168.200.30-192.168.200.254/ip dhcp-serveradd add-arp=yes address-pool=dhcp_pool100 always-broadcast=yes interface=vlan100 name=dhcp100add add-arp=yes address-pool=dhcp_pool200-HASS disabled=no interface=vlan200 name="dhcp 200-HASS"/interface bridge portadd bridge=bridge interface=ETH2add bridge=bridge interface=ETH3add bridge=bridge interface=ETH4add bridge=bridge interface=ETH5/ip neighbor discovery-settingsset discover-interface-list=all/interface bridge vlanadd bridge=VLAN-Bridge vlan-ids=99, 100, 200add bridge=bridge vlan-ids=99, 100, 200/interface detect-internetset lan-interface-list=LAN/interface list memberadd interface=ETH1 list=WAN/ip addressadd address=192.168.0.1/24 interface=bridge network=192.168.0.0add address=192.168.99.1/24 interface=vlan99 network=192.168.99.0add address=192.168.100.1/24 interface=vlan100 network=192.168.100.0add address=192.168.200.1/24 interface=vlan200 network=192.168.200.0/ip dhcp-clientadd comment=defconf disabled=no interface=ETH1/ip dhcp-relayadd dhcp-server=192.168.0.5 disabled=no interface=vlan100 local-address=192.168.100.1 name=relay100/ip dhcp-server networkadd address=192.168.0.0/24 comment=defconf gateway=192.168.0.100 netmask=24add address=192.168.100.0/24 dns-server=192.168.0.4, 192.168.0.5 gateway=192.168.100.1 netmask=24add address=192.168.200.0/24 dns-server=192.168.0.4, 192.168.0.5 gateway=192.168.200.1 netmask=24/ip dnsset allow-remote-requests=yes servers=8.8.8.8/ip dns staticadd address=192.168.0.100 name=router.lan/ip firewall filteradd action=accept chain=forward comment="Allow HASS to communicate with DNS servers" connection-state=established, related, new dst-address=192.168.0.4 dst-port=53 in-interface=vlan200 protocol=udpadd action=accept chain=forward comment="Allow HASS to communicate with DNS servers" connection-state=established, related, new dst-address=192.168.0.5 dst-port=53 in-interface=vlan200 protocol=udpadd action=accept chain=forward comment="Allow Bridge SW to ICMP Vlan200" connection-state="" in-interface=vlan200 out-interface=bridge protocol=icmpadd action=accept chain=forward dst-address=192.168.200.2 log=yes src-address=192.168.100.43add action=accept chain=forward dst-address=192.168.100.43 log=yes src-address=192.168.200.2add action=drop chain=forward comment="Block all traffic" in-interface=vlan200add action=accept chain=input comment="defconf: accept established, related, untracked" connection-state=established, related, new, untrackedadd action=accept chain=input comment="defconf: accept ICMP"add action=fasttrack-connection chain=forward comment="defconf: fasttrack" connection-state=invalid, established, related, new, untrackedadd action=accept chain=forward comment="defconf: accept established, related, untracked" connection-state=established, related, new, untrackedadd action=drop chain=input comment="defconf: drop invalid" connection-state=invalidadd action=drop chain=input comment="defconf: drop all not coming from LAN" in-interface-list=!LANadd action=drop chain=forward comment="defconf: drop invalid" connection-state=invalid disabled=yes log=yesadd action=drop chain=forward comment="defconf: drop all from WAN not DSTNATed" connection-nat-state=!dstnat connection-state=new disabled=yes in-interface-list=WANadd action=accept chain=forward comment="defconf: accept out ipsec policy" disabled=yes ipsec-policy=out, ipsec log=yesadd action=accept chain=forward comment="defconf: accept in ipsec policy" disabled=yes ipsec-policy=in, ipsec log=yes/ip firewall natadd action=masquerade chain=srcnat comment="defconf: masquerade" ipsec-policy=out, none log=yes out-interface-list=WAN/ip traffic-flowset enabled=yes/system package updateset channel=stable/tool mac-serverset allowed-interface-list=LAN/tool mac-server mac-winboxset allowed-interface-list=LAN ---

## Response 3
Author: Sat Feb 29, 2020 3:52 pm
I see some issues with that config.........1. Although I see the VLAN99 setup/interface vlanadd interface=bridge name=vlan99 vlan-id=99/ip addressadd address=192.168.99.1/24 interface=vlan99 network=192.168.99.0Where is the corresponding configuration.......A. IP Pool??B. IP DHCP Serve?C. IP DHCP Server Network?2. Where did this mysterious unknown subnet come from 192.168.0 ?????/ip addressadd address=192.168.0.1/24 interface=bridge network=192.168.0.0/ip dhcp-server networkadd address=192.168.0.0/24 comment=defconf gateway=192.168.0.100 netmask=24a. its not defined in vlan?b. its not defined in ip pool or ip dhcp serverc. WORSE you have attached it to the interface bridge arggg........(If this is another subnet or homelan for example create vlan100 and simply add it to the mix.I do not recommend using the bridge for any addressing dhcp service etc..........)Also its not clear what the purpose of this subnet is so it needs to be explained...........3. I see where you have identified all the eth ports as trunk ports/interface bridge portadd bridge=bridge interface=ETH2add bridge=bridge interface=ETH3add bridge=bridge interface=ETH4add bridge=bridge interface=ETH5But the vlan bridge setup is confusing........./interface bridge vlanadd bridge=bridge vlan-ids=99, 100, 200Normally one states what is tagged and untagged here........... ??add bridge=bridge tagged=bridge, eth2, eth3, eth4, eth5 vlan-ids=99, 100, 200The firewall rules at first glance look butt ugly but not concerned as you said you were working on them and would rather see a later version but would want the above addressed first.I may be missing something as pe1chl didnt make the same comments................