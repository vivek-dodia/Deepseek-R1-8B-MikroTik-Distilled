---
title: Thread-1117079
url: https://forum.mikrotik.com/viewtopic.php?p=1117079&sid=49f92a630bc7970d8ca50523be880e8f#p1117079
thread_id: 1117079
section: RouterOS
post_count: 20
date_crawled: 2025-02-03T21:18:13.002043
---

### Post 1
Author: Unknown
Date: Unknown

Hi,I've recently introduced vlan filtering in my home network and wired connectivity seems to be working OK after implementing suggestions shared in the below post:viewtopic.php?t=213134One remaining issue I have is the WIFI performance where I consistently get speeds below 100 Mbps when connected to 5GHz ac network (all my tests were performed less than 2 meters from the AP).My home network consists of:hex poe - acting as router/gateway/firewall/CAPsMAN2x hex - acting as bridge with vlan filtering3x audience - acting as CAPs controlled by hex poeBelow is the simple diagram of how they are connected:IAS-NET.pngThe network uses following vlans:vlan10 for 192.168.1.0 network meant for wired and wireless clients (this eventually becomes untagged traffic)vlan90 meant for 192.168.90.0 network used for management access to Mikrotik devices.I intend to introduce additional vlans got guest and IoT WIFI, but I need to resolve the current performance issues first.Below is how I intended to configure the ports:hex poe:ether1 - WANether2 - hybrid port (vlan10 untagged, vlan90 tagged)ether3,4,5 - trunk ports (vlan10 and vlan90 tagged)hexether1,5 - trunk ports (vlan10 and vlan90 tagged)ether2 - hybrid port (vlan10 untagged, vlan90 tagged)ether3,4 - access ports (vlan10 untagged)audience - ether1 - trunk port (vlan10 and vlan90 tagged)ether2 - hybrid port (vlan10 untagged, vlan90 tagged)The idea behind hybrid ports is to have them working as access ports for most devices, but also to be able to access management vlan with PC/laptop with virtual NIC configured for vlan90.The performance issue I'm trying to narrow down is mostly visible on WIFI clients, but it seems there is something off with the wired network as well, even though it's not noticeable in everyday use, without looking at network stats. Tests performed with Tamosoft Throughput Test gave me following results in below 3 scenarios:a) Server and client on 192.168.90.0 network - speed above 900 Mbps, occasional single digit % packet lossb) Server and client on 192.168.1.0 network - speed above 800 Mbps, frequent single and double digit % packet lossc) Server on wired and client on wireless 192.168.1.0 network - speed below 100 Mbps, consistent packet drops above 90%So, I clearly broke something big time when introducing vlan setup but I'm not sure where precisely I went wrong. I suspect some default (or lack of) routing settings, or misconfiguration of firewall.Here are exports of my configurations (hex, and audience configs are basically copies of one another). These are full exports, baring passwords, DHCP reservations and port forwarding rules, which are somewhat sensitive.hex poe:Code:Select all# 2024-12-29 15:59:25 by RouterOS 7.16.2# software id = E8G3-FMJZ## model = RB960PGS/caps-man channeladdband=2ghz-g/n extension-channel=Cefrequency=2412name=2g-1addband=5ghz-a/n/ac extension-channel=Ceeefrequency=5180name=5g-36addband=2ghz-g/n extension-channel=Cefrequency=2437name=2g-6addband=2ghz-g/n extension-channel=eC frequency=2472name=2g-13addband=5ghz-a/n/ac extension-channel=Ceeefrequency=5260name=5g-52addband=5ghz-a/n/ac extension-channel=Ceeefrequency=5320name=5g-64/interfacebridgeaddigmp-snooping=yes name=bridge-lan/interfaceethernetset[finddefault-name=sfp1]disabled=yes/interfacevlanaddinterface=bridge-lan name=MGMT vlan-id=90addinterface=ether1 name=vlan-internet vlan-id=20addinterface=bridge-lan name=vlanGUEST vlan-id=30addinterface=bridge-lan name=vlanIAS vlan-id=10/caps-man datapathaddbridge=bridge-lanlocal-forwarding=noname=datapath-intvlan-id=10\
    vlan-mode=use-tag/interfacepppoe-clientaddadd-default-route=yes disabled=nointerface=vlan-internet name=Benet\use-peer-dns=yes/caps-man securityaddauthentication-types=wpa2-psk encryption=aes-ccm name=DefSec/caps-man configurationaddchannel=2g-1channel.band=2ghz-g/n country=poland datapath=datapath-int\
    installation=indoor mode=ap name=2g-1-cfg security=DefSecssid=domek-wifiaddchannel=5g-36channel.band=5ghz-a/n/ac country=poland datapath=\
    datapath-intinstallation=indoor mode=ap name=5g-36-cfg security=DefSec\
    ssid=domek-wifiaddchannel=2g-6channel.band=2ghz-g/n country=poland datapath=datapath-int\
    installation=indoor mode=ap name=2g-6-cfg security=DefSecssid=domek-wifiaddchannel=2g-13channel.band=2ghz-g/n country=poland datapath=datapath-int\
    installation=indoor mode=ap name=2g-13-cfg security=DefSecssid=\
    domek-wifiaddchannel=5g-52channel.band=5ghz-a/n/ac country=poland datapath=\
    datapath-intinstallation=indoor mode=ap name=5g-52-cfg security=DefSec\
    ssid=domek-wifiaddchannel=5g-64channel.band=5ghz-a/n/ac country=poland datapath=\
    datapath-intinstallation=indoor mode=ap name=5g-64-cfg security=DefSec\
    ssid=domek-wifi/interfaceethernetswitchportset1default-vlan-id=10vlan-mode=secureset2vlan-mode=secureset3vlan-mode=secureset4vlan-mode=secureset5vlan-mode=secure/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LANaddname=TRUSTED/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=pool_lan ranges=192.168.1.2-192.168.1.254addname=pool_guest ranges=192.168.3.2-192.168.3.254addname=pool_mgmt ranges=192.168.90.2-192.168.90.254/ip dhcp-serveraddaddress-pool=pool_laninterface=vlanIAS name=dhcp_lanaddaddress-pool=pool_guestinterface=vlanGUEST name=dhcp_guestaddaddress-pool=pool_mgmtinterface=MGMT name=dhcp_mgmt/caps-man managersetenabled=yes/caps-man provisioningaddaction=create-dynamic-enabled hw-supported-modes=gn identity-regexp=\"WIFI-2\$"master-configuration=2g-1-cfg name-format=prefix-identity \
    name-prefix=2Gaddaction=create-dynamic-enabled hw-supported-modes=a,ac,an identity-regexp=\"WIFI-2\$"master-configuration=5g-36-cfg name-format=prefix-identity \
    name-prefix=5Gaddaction=create-dynamic-enabled hw-supported-modes=gn identity-regexp=\"WIFI-1\$"master-configuration=2g-6-cfg name-format=prefix-identity \
    name-prefix=2Gaddaction=create-dynamic-enabled hw-supported-modes=gn identity-regexp=\"WIFI-0\$"master-configuration=2g-13-cfg name-format=prefix-identity \
    name-prefix=2Gaddaction=create-dynamic-enabled hw-supported-modes=a,ac,an identity-regexp=\"WIFI-1\$"master-configuration=5g-52-cfg name-format=prefix-identity \
    name-prefix=5Gaddaction=create-dynamic-enabled hw-supported-modes=a,ac,an identity-regexp=\"WIFI-0\$"master-configuration=5g-36-cfg name-format=prefix-identity \
    name-prefix=5G/interfacebridge portaddbridge=bridge-laninterface=ether2addbridge=bridge-laninterface=ether3addbridge=bridge-laninterface=ether4addbridge=bridge-laninterface=ether5/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/ip settingssetmax-neighbor-entries=8192/ipv6 settingssetdisable-ipv6=yes max-neighbor-entries=8192/interfaceethernetswitchvlanaddindependent-learning=yes ports=ether2,ether3,ether4,ether5,switch1-cpu \switch=switch1 vlan-id=10addindependent-learning=yes ports=ether3,ether4,ether5,switch1-cpuswitch=\
    switch1 vlan-id=30addindependent-learning=yes ports=ether2,ether3,ether4,ether5,switch1-cpu \switch=switch1 vlan-id=90/interfacelist memberaddcomment=defconfinterface=ether1 list=WANaddinterface=ether2 list=LANaddinterface=ether3 list=LANaddinterface=ether4 list=LANaddinterface=ether5 list=LANaddinterface=vlanIAS list=LANaddinterface=vlanGUEST list=LANaddinterface=MGMT list=LANaddinterface=MGMT list=TRUSTED/ip addressaddaddress=192.168.1.1/24interface=vlanIAS network=192.168.1.0addaddress=192.168.3.1/24interface=vlanGUEST network=192.168.3.0addaddress=192.168.90.1/24interface=MGMT network=192.168.90.0/ip dhcp-clientaddinterface=vlan-internet/ip dhcp-server networkaddaddress=192.168.1.0/24gateway=192.168.1.1addaddress=192.168.3.0/24gateway=192.168.3.1addaddress=192.168.90.0/24gateway=192.168.90.1/ip firewall filteraddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=drop chain=input comment="defconf: drop all not coming from LAN"\in-interface-list=!LANaddaction=accept chain=forward comment="defconf: accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=drop chain=forward comment=\"defconf: drop all from WAN not DSTNATed"connection-nat-state=!dstnat \
    connection-state=newin-interface-list=WAN/ip firewall nataddaction=masquerade chain=srcnatout-interface=Benet/ip firewall service-portsetsip disabled=yes/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yes/system clocksettime-zone-name=Europe/Warsaw/system identitysetname=IAS-NET-1/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp serversetenabled=yes/system ntp client serversaddaddress=212.1.104.9/system routerboard settingssetauto-upgrade=yes/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTED/tool mac-server pingsetenabled=nohex:Code:Select all# 2024-12-29 18:11:14 by RouterOS 7.16.2# software id = AZ9Q-ZAMF## model = RB750Gr3/interfacebridgeaddname=bridge-lan protocol-mode=none pvid=90vlan-filtering=yes/interfacevlanaddinterface=bridge-lan name=MGMT vlan-id=90addinterface=bridge-lan name=vlanIAS vlan-id=10/interfacelistaddname=TRUSTED/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip smb usersset[finddefault=yes]disabled=yes/interfacebridge portaddbridge=bridge-lan comment="trunk port from hex"frame-types=\
    admit-only-vlan-taggedinterface=ether1addbridge=bridge-lan comment="hybrid port for PC"interface=ether2 pvid=10addbridge=bridge-lan comment="access port to client"frame-types=\
    admit-only-untagged-and-priority-taggedinterface=ether3 pvid=10addbridge=bridge-lan comment="access port to client"frame-types=\
    admit-only-untagged-and-priority-taggedinterface=ether4 pvid=10addbridge=bridge-lan comment="trunk port for AP"frame-types=\
    admit-only-vlan-taggedinterface=ether5/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/ipv6 settingssetdisable-ipv6=yes max-neighbor-entries=8192/interfacebridge vlanaddbridge=bridge-lan tagged=ether1,ether5 untagged=ether2,ether3,ether4 \
    vlan-ids=10addbridge=bridge-lan tagged=ether1,ether2,ether5,bridge-lan vlan-ids=90/interfacelist memberaddinterface=MGMT list=TRUSTED/ip addressaddaddress=192.168.90.3/24disabled=yesinterface=MGMT network=192.168.90.0/ip dhcp-clientaddinterface=MGMT/ip servicesettelnet disabled=yessetftp disabled=yessetapi disabled=yessetapi-ssl disabled=yes/ip smb sharesset[finddefault=yes]directory=/flash/pub/system clocksettime-zone-name=Europe/Warsaw/system identitysetname=IAS-NET-2/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=192.168.90.1/system routerboard settingssetauto-upgrade=yes/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTED/tool mac-server pingsetenabled=noaudience:Code:Select all# 2024-12-29 18:14:25 by RouterOS 7.16.2# software id = 0YDV-TKFC## model = RBD25G-5HPacQD2HPnD/interfacebridgeaddname=bridge-lan protocol-mode=none pvid=90vlan-filtering=yes/interfacewireless# managed by CAPsMAN# channel: 2472/20-eC/gn(16dBm), SSID: domek-wifi, CAPsMAN forwardingset[finddefault-name=wlan1]ssid=MikroTik# managed by CAPsMAN# channel: 5180/20-Ceee/ac/P(18dBm), SSID: domek-wifi, CAPsMAN forwardingset[finddefault-name=wlan2]ssid=MikroTikset[finddefault-name=wlan3]ssid=MikroTik/interfacevlanaddinterface=bridge-lan name=MGMT vlan-id=90/interfacelistaddname=TRUSTED/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/interfacebridge portaddbridge=bridge-lan comment="trunk port from hex"frame-types=\
    admit-only-vlan-taggedinterface=ether1addbridge=bridge-lan comment="hybrid port for PC"interface=ether2 pvid=10/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/interfacebridge vlanaddbridge=bridge-lan tagged=ether1 untagged=ether2 vlan-ids=10addbridge=bridge-lan tagged=ether1,ether2,bridge-lan vlan-ids=90/interfacelist memberaddinterface=MGMT list=TRUSTED/interfacewireless cap#setcaps-man-addresses=192.168.90.1enabled=yes interfaces=wlan2,wlan1/ip addressaddaddress=192.168.90.6/24disabled=yesinterface=MGMT network=192.168.90.0/ip dhcp-clientaddinterface=MGMT/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/system clocksettime-zone-name=Europe/Warsaw/system identitysetname=IAS-WIFI-2/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=192.168.90.1/system routerboard settingssetauto-upgrade=yes/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTEDIn case you're wondering about disabled IP addresses, I initially configured them as static but then changed to the same addresses being served by hex poe via DHCP reservation.I would appreciate any suggestions on how to improve this configuration to eliminate the WIFI bottleneck (and potentially also the reason behind other pocket drops).Sorry for the lengthy post but I tried to include all information which may be relevant - although chances are that I still managed to miss something

---
### Post 2
Author: Unknown
Date: Unknown

You have configured the only datapath row for capsman forwarding, which means that the CAP receives a wireless frame, encapsulates it into an Ethernet transport one and sends the result to the CAPsMAN device; the CAPsMAN device extracts the Ethernet frame from the transport one on a virtual wireless interface. That virtual interface is then a member port of the local bridge on the CAPsMAN sevice (the hEX PoE). I'm not sure whether the encapsulated traffic doesn't attempt to use L2 at some point and hit a wrong VLAN tagging/untagging, but if that was the case and something wouldn't pass due to that, I would expect a 100% loss.So the only thing to come to my mind is to change thelocal-forwardingon the datapath row toyes, causing the wireless frames to be converted straight to the final Ethernet ones already on each cAP, relieving the hEX PoE from that extra load and maybe avoid some issue I haven't exactly identified.Other than that, the Audiences have almost twice as powerful CPEs than the hEX PoE, so depending on your uplink bandwidth, it may make more sense to make one of them the router and use the hEX PoE only as a switch. But I'd definitely do this as a separate step.And finally, as you do not use any fancy featues of CAPsMAN like placement of individual clients into VLANs dynamically depending on RADIUS response or access list rules, you may also consider switching to qcom-ac (wifi) drivers on the Audiences, the benefits being beamforming in the 5 GHz band and assisted roaming in both bands.

---
### Post 3
Author: Unknown
Date: Unknown

Hi sindy,Thanks for your prompt response,I've just tried to enable the local forwarding on the CapsMan datapath, but the effect was quite opposite to what I hoped for i.e. the wireless client couldn't even obtain an IP address after the changeAlso, before submitting the original post I tired experimenting with moving CAPsMAN to one of the audiences (thinking that it had far more resources than hex poe) but even thought the first test results were encouraging, as the WIFI speeds on a client connected to audience running both CAPsMAN and Cap were around 300/300 Mbps (down/up) compared to my 600/600 WAN, when switching connection to other Caps, the speeds dropped to single digits (like 6-8 Mbps). This makes me think it's not about resources but configuration.Also, before I configured hardware offloading, hex poe was often hitting 100% CPU utilisation during speedtests, but with the current configuration it doesn't go above 60-70% during speedtests that hits or go above 600/600 Mbps.Do you have other suggestions as for what I might have misconfigured?

---
### Post 4
Author: Unknown
Date: Unknown

On the CAPs (the audiences), what does/interface wireless cap printshow?

---
### Post 5
Author: Unknown
Date: Unknown

It prints the same on all three of them:Code:Select all/interface/wireless/cap>printenabled:yes
                         interfaces:wlan2,wlan1
                        certificate:nonelock-to-caps-man:nodiscovery-interfaces:caps-man-addresses:192.168.90.1caps-man-names:caps-man-certificate-common-names:bridge:nonestatic-virtual:no

---
### Post 6
Author: Unknown
Date: Unknown

OK, so changebridgefromnonetobridge-lanon all three and try withlocal-forwarding=yeson the datapath row again. What is above my head is why it worked at all withnone- again, I would expect a 100 % loss with this misconfiguration.

---
### Post 7
Author: Unknown
Date: Unknown

I think I got where your question was going (or maybe I got it wrong?) and I tried enabling local forwarding on the datapath once again, but this time I also set the bridge on tha CAPs to the local bridge, meaning that the print now looks like this:Code:Select all/interface/wireless/cap>printenabled:yes
                         interfaces:wlan2,wlan1
                        certificate:nonelock-to-caps-man:nodiscovery-interfaces:caps-man-addresses:192.168.90.1caps-man-names:caps-man-certificate-common-names:bridge:bridge-lanstatic-virtual:noThis restored the connectivity (i.e. the wireless clients are again being assigned their IPs on 192.168.1.0 network), but the bandwidth test results are exactly as they were before.The last Tamosoft test from a Pixel phone to a PC running Tamosoft server (connected to the same hex the Audience serving that phone is connected to) is showing 97 Mbps UDP Up (interestingly there is 0% packet drop there) and 60 Mbps UDP Down with packet drop ranging between 80% and 98%

---
### Post 8
Author: Unknown
Date: Unknown

While the PC is connected to etherX of the hEX, what does/interface ethernet monitor etherX onceshow?

---
### Post 9
Author: Unknown
Date: Unknown

The PC is on ether2 on IAS-NET-2 (hex). Here is the output:Code:Select all/interfaceethernet monitor ether2
                      name:ether2
                    status:link-okauto-negotiation:donerate:1Gbpsfull-duplex:yes
           tx-flow-control:norx-flow-control:nosupported:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-full
               advertising:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-full
  link-partner-advertising:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-full

---
### Post 10
Author: Unknown
Date: Unknown

And if you connect the PC to ether2 of the same Audience to which the wireless client is connected (still with local forwarding of course), what are the results of the throughput test, and what does the/interface ethernet monitor ether2once show?

---
### Post 11
Author: Unknown
Date: Unknown

Here is the the output of Audience ether2 monitor with laptop now connected the that port:Code:Select all/interfaceethernet monitor ether2
                      name:ether2
                    status:link-okauto-negotiation:donerate:1Gbpsfull-duplex:yes
           tx-flow-control:norx-flow-control:nosupported:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-full
               advertising:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-full
  link-partner-advertising:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-fullAs the laptop has physical NIC handling untagged traffic and virtual NIC configured for tagged vlan90 traffic (similarly to the PC running Tamasoft server), I can perform tests on both 192.168.1.0 and 192.168.90.0 networks. Below are the results:Untagged vlan10:Audience2_Ether2_vlan10.pngTagged vlan90Audience2_Ether2_vlan90.pngThe speeds are fairly stable and averages shown on the screenshots are reflective of the speed. I'm somewhat concerned about these UDP packet drops, though (however, it's nothing near what I see when connected via WIFI).

---
### Post 12
Author: Unknown
Date: Unknown

Did you disable the 192.168.1.11 address on the test PC when you've told the client to connect to 192.168.90.11, or change it to some address in another subnet than 192.168.1.0/24 and 192.168.90.0/24? I don't know the Tamosoft product so I want to be sure it does not take shortcuts - a "normal" application that uses the Windows networking stack would use the interface to which 192.168.1.11 is attached to send data to 192.168.1.x even if using 192.168.90.11 as the source address in the packets.Because when both the wireless client and the PC are in VLAN 10, the traffic between them is forwarded at L2 so it never leaves the Audience, so the result of almost 1000 Mbit/s in both directions is possible. But when the PC is in VLAN 90, the traffic from the wireless client must get from the Audience via the hEX Gr3 to hEX PoE, get routed from one subnet to the other, and go back to Audience. Since the Tamosoft thing seems to test both directions simultaneously, there is no way how the two 1 Gbit/s streams (192.168.1.x -> 192.168.90.11 and 192.168.90.11 -> 192.168.1.x) could fit into the same 1 Gbit/s capacity of the Ethernet uplink of the Audience. So here, I suspect that only the 192.168.1.x -> 192.168.90.11 traffic takes the long path, but the 192.168.90.11 -> 192.168.1.x one takes the shortcut.

---
### Post 13
Author: Unknown
Date: Unknown

Interesting. I didn't consider testing across vlans. In my above test both: the PC acting as the Tamosoft server (192.168.1.11 / 192.168.90.11) and the test laptop acting as the Tamosoft client (192.168.1.x / 192.168.90.x) were connected to hybrid ports and got IPs from both network on their physical and virtual NICs. I assumed that the tests in this scenario would go through respective vlans depending on which "server" address I'd choose (and the speeds suggested that they did).Anyway, I've now disabled IPv4 in the properties of the physical NIC of the test laptop and checked that it is now only assigned the 192.168.90.x address. Then I repeated the tests to 192.168.90.11 (no real change there as far as I can tell) and subsequently to 192.168.1.1 (which in this case became a cross vlan scenario).Results are below:vlan90 to vlan90 ( IPv4 disabled on "untagged NIC")Audience2_Ether2_vlan90_Disabled_vlan10.pngvlan90 to vlan10 ( IPv4 disabled on "untagged NIC")Audience2_Ether2_vlan10_Disabled_vlan10.pngAlso, while during the first test the CPU on hex PoE remained between 5-9% during the second test it was regularly jumping to 30% indicating that in 2nd scenario the router had more work to do.

---
### Post 14
Author: Unknown
Date: Unknown

Sorry, I only now understood that you wanted me to connect the server PC to the ether2 on audience, while I misunderstood and connected the test laptop (client there). I'll repeat the tests in the scenario you suggested i.e. "server PC" connected to the audience ether2 and test laptop (client) connected to audience over WIFI. Give me a moment.

---
### Post 15
Author: Unknown
Date: Unknown

In my above test both: the PC acting as the Tamosoft server (192.168.1.11 / 192.168.90.11) and the test laptop acting as the Tamosoft client (192.168.1.x / 192.168.90.x) were connected to hybrid ports and got IPs from both network on their physical and virtual NICs. I assumed that the tests in this scenario would go through respective vlans depending on which "server" address I'd choose (and the speeds suggested that they did).Sorry, I only now understood that you wanted me to connect the server PC to the ether2 on audience, while I misunderstood and connected the test laptop (client there).Yes, you have actually tested something else than I've thought I've asked you to test. Initially, you had a wireless client and a server connected to ether2 of hEX Gr3. What I wanted you to do was to only move the server from ether2 of hEX Gr3 to ether2 of the Audience to which the wireless client was connected (and obviously test again using the wireless client, why would I mention the local forwarding otherwise); instead, you've poked another PC with a wired port from your magician's hat and tested between two Ethernet ports. As I haven't expected that, I also haven't expected that the client could have an interface in both subnets. As it did, one test was indeed 10 to 10 and the other one was 90 to 90, no routing involved and hence no path via hEX PoE involved in either direction.But OK, the ethernet to ethernet testing has shown us that even though vlan filtering is enabled on both the hEX Gr3 and the Audience, the hEX-ether2-to-Audience-ether2 L2-only test can reach wire speeds even when tagging and untagging VLAN 10, so there is nothing wrong with the VLAN setup, at least on the path between those two.Now with the second round of tests when the path via hEX PoE was involved, the speed has dropped to ~100 Mbit/s again for most measurements. So let's see what the wireless-to-Ethernet test shows on the Audience alone and we'll see where to run next.

---
### Post 16
Author: Unknown
Date: Unknown

Indeed you got precisely right, what I got wrongI've basically performed a number of Ethernet tests in different scenarios. Sorry for the confusion.So coming back to wireless; below is the missing test where the PC running the Tamosoft server is connected to the ether2 onhexand test laptop is connected to Audience overWIFI(connection properties showed connection over 5GHz 866/866 Mbps).SerHexEther2_vlan10_CliWIFI_vlan10.pngBelow is the test performed with the "server PC" connected to the ether2 onAudienceand test laptop is still connected to Audience overWIFI.SerAudienceEther2_vlan10_CliWIFI_vlan10.pngThere is only marginal difference in the average speeds in these two scenarios as far as I can see.However, these speeds are still much higher than an external speedtest from the test laptop which is still below 100/100 Mbps (compared to ~600/600 Mbps over wired network).SpeedtestWIFI.pngWhat should I target next?

---
### Post 17
Author: Unknown
Date: Unknown

OK, these tests seem much more realistic to me; even though the difference is not big, it is surprising that the throughput is better when the server is connected to hEX Gr3 than when it is connected to Audience, but that may be related to interference unless you live in the countryside without any neighbors. Does/caps-man interface scaninterface-namespawned on hEX PoE show any 5 GHz networks around except your other APs?Now I would check that the link between hEX PoE and hEX Gr3 has established on 1 Gbit/s full duplex (again using/interface ethernet monitor ether1 onceon hEX Gr3). If yes, I'd check whether any of the Ethernet ports of both the hEX Gr3 and hEX PoE is not linked at 100 Mbit/s - it's a bit esoteric but that's for later. If it is, I'd disable it if possible and try the speedtest via internet again and also a test from a wireless client to a server connected to ether2 of hEX PoE, both within VLAN 10 and when only the address from the .90. subnet is up on the server (so that we could compare the "bridging" and "routing" performance).

---
### Post 18
Author: Unknown
Date: Unknown

First of all you were right in searching for any 100 Mbps ports. I was pretty certain I won't find anything as I checked the negotiated port speeds before, but there is was: the connection between hex (ether1) and hex poe (ether 3) was showing 100 MbpsI disconnected it and connected again and it's now showing 1 Gbps.Code:Select all/interfaceethernet monitor ether1
                      name:ether1
                    status:link-okauto-negotiation:donerate:1Gbpsfull-duplex:yes
           tx-flow-control:norx-flow-control:nosupported:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-full
               advertising:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-full
  link-partner-advertising:10M-baseT-half,10M-baseT-full,100M-baseT-half,100M-baseT-full,1G-baseT-half,1G-baseT-fullWith that change the results of the external speediest improved however the results of the test of internal network speed seems to be slightly lower than in the previous round (maybe it just shows its variability).Tamosoft test (test laptop connected to Audience via WIFI, "server PC" connected to Audience on ether2):SerAudienceEther2_vlan10_CliWIFI2_vlan10_2.pngSpeedtest over WIFI:Speedtest_WIFI2.pngHaving said that it's still quite far from the wired external speed test, And I'm not sure if that's the best I can expect from 5GHz ac network? Or if I should be worried about all that pocket loss?For reference, these are the results of the wired speedtest:Speedtest_Wired.pngI'll now proceed with the below step to check how it compares with the tests to the server connected to Audience:and also a test from a wireless client to a server connected to ether2 of hEX PoE

---
### Post 19
Author: Unknown
Date: Unknown

OK, so the test with the Tamosoft server connected to hex poe ether2 left me somewhat surprised. I don't know what I expected, but I guess I expected that the results will be worse, or for some mysterious reason they will be better. I surely didn't expect the mix. I performed the test twice with lot of time in between to make sure it wasn't some momentary, non-replicable condition but both tests concluded with very similar results.So here is the test where the Tamosoft server is connected to hex poe ether2 and the test laptop is still connected via WIFI to the same Audience as in previous tests (this means that there is now Audience, hex and hex poe between the client and the server):SerHex1Ether2_vlan10_CliWIFI2_vlan10_2.pngWhat I find strange is that average TCP speeds are significantly lower here than in the previous test (where server was connected directly to ether2 on Audience) the UDP Down speed is slightly lower (but comparable) but the UDP Up average speed is significantly higher than in the previous test. While I don't quite understand this, I think it indicates that the wireless connection is not the main influencing factor here as in both tests the client is connected to the same AP, is in the same distance from the AP (less than 1m actually) and is subject to the same interference.Anyway, thanks sindy for your insights so far. You already identified the reason behind the sub 100 Mbps speeds, and since then I've already noticed this issue twice: first on the link between hex poe and hex, and later on the link between hex poe and other Audience (to be clear I checked that link after your initial post and it was 1 Gbps but later I found it reverted to 100 Mbps). I'll monitor this some more to check if it's something that happens regularly on my network.

---
### Post 20
Author: Unknown
Date: Unknown

On networks with any kind of problems (real or perceived, e.g. packet loss or large RTT), TCP and UDP connections behave very much differently.For UDP connections packet drop is fine and stats show high throughput with high packet loss. Usually throughput shown on Tx side reflects throughput of first link leg ... Tx stack does wait for Tx buffers to flush properly ... if there's a bottleneck on link legs beyond the first one, then the nearer device has to drop packets which overflow the buffer. So receiving end shows thtoughput, achieved by narrowest bottleneck on the whole link.For TCP connections packet drop is not an option, there are mechanizms which ensure packet delivery (retransmissions) and to avoid excessive triggering of those mechanizms, there's Tx window size which effectively reduces rate of transmission (trying to reduce throughput below the packet drop threshold). Since they're driven by feedback from receiver, these mechanizms reflect conditions of the whole link between transmitter and receiver (all legs) and sometines also the reverse direction (which can be even more important in case of very asymmetrical link legs or half-duplex link legs). Due to these (and a few other) reasons it's very hard to achieve wire (or "wire" in case of wifi) speed using TCP connections ... even on a perfect link one can expect to achieve results a few percent below full capacity.I don't know what exactly the results shown on screenshot  are telling. I'm more used to iperf3 (I guess tamosoft adds a fancy GUI to iperf3 CLI and tries to make dispkay of results nicer, but along the way some important stuff gets hidden). Running iperf3 it's possible to directly compare results from both ends (server and client) which allows to diagnose point of the probkem a bit easier. E.g. it's not clear what "UDP up:" resukt means ... is it end-to-end result, reported by receiver (server)? Or is it report from sender (client) ... which then shows thtoughput of first link leg (wifi) which in turn means that there's another bottleneck further beyond wifi which causes packet drop?Iperf3 also allows to set Tx rate for UDP ... setting it to values below expected bottleneck bandwidth allows to verify that packet drop is indeed caused by low bandwidth of a bottleneck rather than poor link leg quality (e.g. faulty UTP cable or noisy/congested wifi connection) which would drop random packets regardless the data rate.

---
