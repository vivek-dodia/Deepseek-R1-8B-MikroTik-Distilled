---
title: Thread-213269
url: https://forum.mikrotik.com/viewtopic.php?t=213269
thread_id: 213269
section: RouterOS
post_count: 23
date_crawled: 2025-02-03T15:17:37.386446
---

### Post 1
Author: Unknown
Date: Unknown

Hello everyone,I'm currently facing an issue with my CCR2216 when using a full BGP routing table. The device starts to lose packets, and the CPU usage spikes to 95%. I need a solution capable of handling approximately 100 Gbps of traffic.Here are the options I've considered so far:1. Install Mikrotik CHR on a PROXMOX server with an Intel Xeon CPU E5-2699C v4 (88 cores) that I already own.2. Install Mikrotik ISO on an Ampere Altra Q80-30 server (which I would need to purchase).I'm open to exploring other solutions as well. Your advice and recommendations would be greatly appreciated.Thanks in advance!

---
### Post 2
Author: Unknown
Date: Unknown

Probably your setup, the router is spec'd at handling up to approx 180Gbps of traffic with filter rules.

---
### Post 3
Author: Unknown
Date: Unknown

1. Install Mikrotik CHR on a PROXMOX server with an Intel Xeon CPU E5-2699C v4 (88 cores) that I already own.I'm open to exploring other solutions as well. Your advice and recommendations would be greatly appreciated.Thanks in advance!That CPU is 22 core, dont confuse cores with threads.I suggest you for your kind of setup, a Juniper MX204 (that I have for sale brand new boxed)Unfortunately your post doesnt have any conf so we cannot see where issues are on the conf... we are not wizards!the 2216 should do that traffic in the right scenario.

---
### Post 4
Author: Unknown
Date: Unknown

That CPU is 22 ore, dont confuse cores with thread.I suggest you for your kind of setup, a Juniper MX204 (that I have for sale brand new boxed)Unfortunately your post doesnt have any conf so we cannot see where issues are on the conf... we are not wizards!the 2216 should do that traffic in the right scenario.Thank you, please PM to discuss about Juniper MX204.

---
### Post 5
Author: Unknown
Date: Unknown

HelloMy mail is admin at spadhausen dot comI dont know how PM here works.

---
### Post 6
Author: Unknown
Date: Unknown

I dont know how PM here works.It doesn't.

---
### Post 7
Author: Unknown
Date: Unknown

Any other sugestion?

---
### Post 8
Author: Unknown
Date: Unknown

Any other sugestion?Your question is  missing important detail:How many upstream peers?How many downstream peers (if any)?Do youneedfull BGP tables?Are you using L3HW offload, and if so, is the router configured properly to support hardware offload?What does the profiler say is pegging your CPU?

---
### Post 9
Author: Unknown
Date: Unknown

hi,Three upstream and downstream peers, I need full BGP tables, I have enabled L3HW offload.Currently without full BGP tables the CPU is at 60% at peak tiemes, of course I have no firewall rules, no nat, just BGP. A couple of bonding and some VLANs

---
### Post 10
Author: Unknown
Date: Unknown

Are you using the single-bridge configuration to benefit from l3-hw?can you post your config?

---
### Post 11
Author: Unknown
Date: Unknown

I have no bridge.Should I create a bridge with all physical ports or bonds that I am using and set up properly in VLAN tab of the bridge?

---
### Post 12
Author: Unknown
Date: Unknown

Absolutely yes!  You should do a single bridge and put VLAN there, otherwhise they are via CPU!Attaching the VLAN to the phisical port is an old-way procedure that has been replaced by the single bridge!https://help.mikrotik.com/docs/spaces/R ... p+features

---
### Post 13
Author: Unknown
Date: Unknown

I have no bridge.Should I create a bridge with all physical ports or bonds that I am using and set up properly in VLAN tab of the bridge?Double yes.

---
### Post 14
Author: Unknown
Date: Unknown

Absolutely yes!  You should do a single bridge and put VLAN there, otherwhise they are via CPU!Attaching the VLAN to the phisical port is an old-way procedure that has been replaced by the single bridge!https://help.mikrotik.com/docs/spaces/R ... p+featuresEither I'm reading help page incorrectly but It didn't occur to me that all interface that you want to use L3HW offloading has to be done via bridge... I'm not sure it's clear enough in documentation. The L3HW offloading is under the bridge and switching section though.So we can't just have 2 or more ports that are part of any bridge to be routed and take advantage of L3HW? Why do I still see the H on my routes then...

---
### Post 15
Author: Unknown
Date: Unknown

the main objective using single bridge is to use bridge vlan filteringhttps://help.mikrotik.com/docs/spaces/R ... NFiltering

---
### Post 16
Author: Unknown
Date: Unknown

the main objective using single bridge is to use bridge vlan filteringhttps://help.mikrotik.com/docs/spaces/R ... NFilteringYes agreed but in my case particularly I don't need vlansExample:Ether1 is isp with public ip and bgpEther2...10 is internal network with public ip from own as number....No vlans, no bridge, no dhcp, no firewall, no nat, no connection tracking, just routing packets from ether1 to ether2 and back as example.

---
### Post 17
Author: Unknown
Date: Unknown

No vlans, no bridgethen you won't have L3 hardware offload acceleration, which is the key feature of ccr2216even if you dont use vlans (or tag vlans), you can implement/convert your scheme to using bridge vlan filtering

---
### Post 18
Author: Unknown
Date: Unknown

Then why use RouterOS / CCR-box ? do this on native Linux ?Get yourself some 25/40/100Gbps NIC's and perform some tuning.https://fasterdata.es.net/host-tuning/l ... 0g-tuning/

---
### Post 19
Author: Unknown
Date: Unknown

No vlans, no bridgethen you won't have L3 hardware offload acceleration, which is the key feature of ccr2216even if you dont use vlans (or tag vlans), you can implement/convert your scheme to using bridge vlan filteringYes I understand that now but It wasn't perfectly clear to me that L3HW is directly linked to working off bridge.I can convert the configuration very easy to use the bridge setup but I didn't know was full requirement.Thank you for clearing this up for me.

---
### Post 20
Author: Unknown
Date: Unknown

Then why use RouterOS / CCR-box ? do this on native Linux ?Get yourself some 25/40/100Gbps NIC's and perform some tuning.https://fasterdata.es.net/host-tuning/l ... 0g-tuning/The setup I gave was an example, not specifically my setup.

---
### Post 21
Author: Unknown
Date: Unknown

This doc specifically explains many key concepts about L3HW:https://help.mikrotik.com/docs/spaces/ ... OffloadingThe dependency on L2HW (https://help.mikrotik.com/docs/spaces/ ... Dependency), some basic config and typical errors.

---
### Post 22
Author: Unknown
Date: Unknown

L3HW should work if you don't have any VLANs, and simply assign IP's to each port.It is "best practices" to put everything in the bridge, build VLANs on the bridge, tag those VLANs to the bridge ports, create VLAN interfaces on the bridge, and assign IP's to the bridge VLAN interfaces instead of directly on physical interfaces.  This gives you flexibility down the road.Any time you create new VLAN interfaces, you have to synchronize those changes with the ASIC by disabling/enabling L3HW offload on the Switch.

---
### Post 23
Author: Unknown
Date: Unknown

L3HW should work if you don't have any VLANs, and simply assign IP's to each port.It is "best practices" to put everything in the bridge, build VLANs on the bridge, tag those VLANs to the bridge ports, create VLAN interfaces on the bridge, and assign IP's to the bridge VLAN interfaces instead of directly on physical interfaces.  This gives you flexibility down the road.Any time you create new VLAN interfaces, you have to synchronize those changes with the ASIC by disabling/enabling L3HW offload on the Switch.Ok this is a much better answer and explains why I still have L3HW working (on some of my devices) so yes it will work but advised to use bridge for best practices and flexability.Right now "most" of other devices I cant use L3HW due to VRF's I'm waiting for L3HW with VRF support.

---
