---
title: Thread-1117403
url: https://forum.mikrotik.com/viewtopic.php?p=1117403&sid=49f92a630bc7970d8ca50523be880e8f#p1117403
thread_id: 1117403
section: RouterOS
post_count: 6
date_crawled: 2025-02-03T21:15:18.870089
---

### Post 1
Author: Unknown
Date: Unknown

I have established the IPSec Site to Site from my home to Office. It is succeeded to established the connection. However, the connection is unstable which keep to drop the connection.I have another Site to Site to my customer and customer side is using Draytek, which is working well.Kindly assist.

---
### Post 2
Author: Unknown
Date: Unknown

Even if someone is willing help you there are not too many information provided.Kind of: "If I use my friend's trailer branded XYZ with car branded WSXEDC it is working well but if I use trailer branded ZYX then it has problems from time to time. Help me please".No configuration, no models, no precise problem description ... seems that crystall ball is needed.

---
### Post 3
Author: Unknown
Date: Unknown

the connection is unstable which keep to drop the connection.On mikrotik side, an IPsec connection may be mistakenly reported as up for a second whilst it actually did not succeed, so when you say "keeps dropping", what exactly does it mean? Drops every few seconds, or every 25 minutes? Does it recover on its own or you have to disable and re-enable it?Besides answering those questions, the best would be to do the following steps on the Mikrotik:disable the peer representing the Fortigateopen a command line window (using the Terminal button in Winbox or WebFIG)unless you've done that already, run/system logging add topics=ipsec,!packetrunlog print follow-only file=ipsec-start where topics~"ipsec"enable the peer representing the Fortigate, wait until the connection establishes and failsreturn to the command line window where thelog print ...command is running and press Ctrl-C to stop itdownload the fileipsec-start.txtand find out what is going on; if it is above your head, use a text editor to substitute every occurrence of each individual public or global IP address with a unique pattern (likemik.ro.tik.ipfor the WAN address of the Mikrotik andfor.ti.gate.ipfor the Fortigate one), copy the whole contents of the modified file and paste it here between [code] and [/code] tags (that can be added using the </> button above the form field).

---
### Post 4
Author: Unknown
Date: Unknown

Thanks, SindyMy Fortigate is using IKE2, so I can't find peer ID and any option about this.Code:Select all# jan/ 3/2025 22:48:28 by RouterOS 7.8# software id = HE5N-242Y#22:48:58ipsec sending dpd packet22:48:58ipsec<-ike2 request,exchange:INFORMATIONAL:177office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:48:58ipsec,debug=====sending128bytesfrom{my-ip-address}[500]to office-ip-address[500]22:48:58ipsec,debug1timesof128bytes message will be sent to office-ip-address[500]22:48:58ipsec,debug=====received80bytesfromoffice-ip-address[500]tomy-ip-address[500]22:48:58ipsec->ike2 reply,exchange:INFORMATIONAL:177office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:48:58ipsec payload seen:ENC(52bytes)22:48:58ipsec processing payload:ENC22:48:58ipsec,debug=>iv(size0x10)22:48:58ipsec,debug1ef1fc879d7087f2e31a9132 f02d575422:48:58ipsec,debug decrypted packet22:48:58ipsec respond:info22:48:58ipsec,debug reply ignored22:49:24ipsec adding payload:DELETE22:49:24ipsec,debug=>(size0xc)22:49:24ipsec,debug0000000c0304000108c9814722:49:24ipsec<-ike2 request,exchange:INFORMATIONAL:178office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:49:24ipsec,debug=====sending304bytesfrommy-ip-address[500]to office-ip-address[500]22:49:24ipsec,debug1timesof304bytes message will be sent to office-ip-address[500]22:49:24ipsecIPsec-SA killing:office-ip-address[500]->my-ip-address[500]spi=0x8c9814722:49:24ipsecIPsec-SA killing:my-ip-address[500]->office-ip-address[500]spi=0x5943a6e922:49:24ipsec policy update killed someSAs22:49:24ipsec,debug=====received80bytesfromoffice-ip-address[500]tomy-ip-address[500]22:49:24ipsec->ike2 reply,exchange:INFORMATIONAL:178office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:49:24ipsec payload seen:ENC(52bytes)22:49:24ipsec processing payload:ENC22:49:24ipsec,debug=>iv(size0x10)22:49:24ipsec,debug775e7b0d9607e1001961eff2f2a17b6322:49:24ipsec,debug decrypted packet22:49:24ipsec payload seen:DELETE(12bytes)22:49:24ipsec respond:info22:49:24ipsec processing payloads:NOTIFY(none found)22:49:24ipsec got reply22:49:24ipsec,debug=====received400bytesfromoffice-ip-address[500]tomy-ip-address[500]22:49:24ipsec->ike2 request,exchange:CREATE_CHILD_SA:1office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:49:24ipsec payload seen:ENC(372bytes)22:49:24ipsec processing payload:ENC22:49:24ipsec,debug=>iv(size0x10)22:49:24ipsec,debug29cdf5cdbd49a396 fecc3b4d9b778d2922:49:24ipsec,debug decrypted packet22:49:24ipsec payload seen:SA(52bytes)22:49:24ipsec payload seen:NONCE(20bytes)22:49:24ipsec payload seen:KE(200bytes)22:49:24ipsec payload seen:TS_I(24bytes)22:49:24ipsec payload seen:TS_R(24bytes)22:49:24ipsec create child:respond22:49:24ipsec processing payloads:NOTIFY(none found)22:49:24ipsec processing payloads:NOTIFY(none found)22:49:24ipsec peer wants tunnel mode22:49:24ipsec processing payload:CONFIG(notfound)22:49:24ipsec processing payload:SA22:49:24ipsec IKEProtocol:ESP22:49:24ipsec  proposal#122:49:24ipsec   enc:aes256-cbc22:49:24ipsec   auth:sha25622:49:24ipsec   dh:modp153622:49:24ipsec processing payload:TS_I22:49:24ipsec192.168.0.0/2422:49:24ipsec processing payload:TS_R22:49:24ipsec172.16.0.0/2322:49:24ipsec candidate selectors:172.16.0.0/23<=>192.168.0.0/2422:49:24ipsec searchingforpolicyforselector:172.16.0.0/23<=>192.168.0.0/2422:49:24ipsec policynotfound22:49:24ipsec,errornopolicy found/generated22:49:24ipsec adding notify:TS_UNACCEPTABLE22:49:24ipsec,debug=>(size0x8)22:49:24ipsec,debug000000080000002622:49:24ipsec<-ike2 reply,exchange:CREATE_CHILD_SA:1office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:49:24ipsec,debug=====sending288bytesfrommy-ip-address[500]to office-ip-address[500]22:49:24ipsec,debug1timesof288bytes message will be sent to office-ip-address[500]22:49:27ipsec policy installedforconnected peer,creating child SA22:49:27ipsec init childforpolicy:172.16.0.0/23<=>192.168.0.0/2422:49:27ipsec init childcontinue22:49:27ipsec offering proto:322:49:27ipsec  proposal#122:49:27ipsec   enc:aes256-cbc22:49:27ipsec   auth:sha25622:49:27ipsec   dh:modp153622:49:27ipsec adding payload:NONCE22:49:27ipsec,debug=>(size0x1c)22:49:27ipsec,debug0000001c61f8f59f3e5caf56989d50e42e9f1129b029b99286f6726022:49:27ipsec adding payload:KE22:49:27ipsec,debug=>(size0xc8)22:49:27ipsec,debug000000c8000500002518d0bb7bc993fe4e9dcb2491fdbd572624d62e517d132e22:49:27ipsec,debug e3cd9d90 de0b9d4585da85885e1c66078651772f751ebc982a741cc4bae11e6722:49:27ipsec,debug30f6ba2517ec9384c9a2f21a2b605c892a2a772668b322dac734a66c5caad0c322:49:27ipsec,debug9c49e142c4630848 b81ea1b1 af358499017a347693d49bba4d356894fc01297522:49:27ipsec,debug e1d6c8b01ef1ee810a65fb90e49503a0615c9fd5ec84b9363d7c6fb0d4c746ea22:49:27ipsec,debug c19ef0c6 ed6391811c1fcdda2335882a5c457992966714a828797ea203f5ac4222:49:27ipsec,debug37fa916d5b55073b22:49:27ipsec adding payload:SA22:49:27ipsec,debug=>(size0x34)22:49:27ipsec,debug00000034000000300103040403de67080300000c0100000c800e01000300000822:49:27ipsec,debug0300000c0300000804000005000000080500000022:49:27ipsec initiator selector:172.16.0.0/2322:49:27ipsec adding payload:TS_I22:49:27ipsec,debug=>(size0x18)22:49:27ipsec,debug0000001801000000070000100000ffffac100000 ac1001ff22:49:27ipsec responder selector:192.168.0.0/2422:49:27ipsec adding payload:TS_R22:49:27ipsec,debug=>(size0x18)22:49:27ipsec,debug0000001801000000070000100000ffffc0a80000 c0a800ff22:49:27ipsec<-ike2 request,exchange:CREATE_CHILD_SA:179office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:49:27ipsec,debug=====sending512bytesfrommy-ip-address[500]to office-ip-address[500]22:49:27ipsec,debug1timesof512bytes message will be sent to office-ip-address[500]22:49:27ipsec,debug=====received400bytesfromoffice-ip-address[500]tomy-ip-address[500]22:49:27ipsec->ike2 reply,exchange:CREATE_CHILD_SA:179office-ip-address[500]3e30b8b834fad5b9:d4b0d55999bab81922:49:27ipsec payload seen:ENC(372bytes)22:49:27ipsec processing payload:ENC22:49:27ipsec,debug=>iv(size0x10)22:49:27ipsec,debug addec523497906a4cc3a89b64fef79a322:49:27ipsec,debug decrypted packet22:49:27ipsec payload seen:SA(52bytes)22:49:27ipsec payload seen:NONCE(20bytes)22:49:27ipsec payload seen:KE(200bytes)22:49:27ipsec payload seen:TS_I(24bytes)22:49:27ipsec payload seen:TS_R(24bytes)22:49:27ipsec create child:initiator finish22:49:27ipsec processing payloads:NOTIFY(none found)22:49:27ipsec peer selected tunnel mode22:49:27ipsec processing payload:SA22:49:27ipsec IKEProtocol:ESP22:49:27ipsec  proposal#122:49:27ipsec   enc:aes256-cbc22:49:27ipsec   auth:sha25622:49:27ipsec   dh:modp153622:49:27ipsec matched proposal:22:49:27ipsec  proposal#122:49:27ipsec   enc:aes256-cbc22:49:27ipsec   auth:sha25622:49:27ipsec   dh:modp153622:49:27ipsec processing payload:TS_I22:49:27ipsec172.16.0.0/2322:49:27ipsec processing payload:TS_R22:49:27ipsec192.168.0.0/2422:49:27ipsecmyvs peer's selectors: 
22:49:27 ipsec 172.16.0.0/23 vs 172.16.0.0/23 
22:49:27 ipsec 192.168.0.0/24 vs 192.168.0.0/24 
22:49:27 ipsec processing payload: NONCE 
22:49:27 ipsec processing payload: KE 
22:49:27 ipsec,debug => shared secret (size 0xc0) 
22:49:27 ipsec,debug de5318fb aaaa81da bee003da 8c07f861 4f7d49d7 3b3150ba 1956b3dc c6106ea2 
22:49:27 ipsec,debug 3118ce87 67bf9185 ea81d7c1 0b98601e cd7eccb7 7f19863f 27521cbb b22dd00b 
22:49:27 ipsec,debug 18fe9eae 49433688 f5edbe8e b0e6e470 270f248b c02d1bc3 6303ef7c 92ba9760 
22:49:27 ipsec,debug 3f101f12 1dcd664b 777e1029 6266252d feb19db5 dab6b5e9 3892112f 0baeb1b1 
22:49:27 ipsec,debug fda1a23d f5a8642a b492d27d c605916f b5fe8b46 ef582d1e dc4e7be7 3469d6b9 
22:49:27 ipsec,debug 4747d6be 56f90c0f b78716f7 4403cc30 a3ede056 9bf4a1d0 e4019f5d 7808e6f8 
22:49:27 ipsec,debug => child keymat (size 0x80) 
22:49:27 ipsec,debug f1ae1bbd 6bc3fb66 6d453440 5174b650 f6d296db d0b2438d cc3c75a2 dea09b8e 
22:49:27 ipsec,debug 91346136 a712ad45 62c3bddc 7a55fe4e 7cbd8510 2841a6b2 8d095f7a 67de1b37 
22:49:27 ipsec,debug a2001072 433efde0 4a78203d ccae6bae 6141c8af 7a33a3fa d0e3c3d3 ebd29d36 
22:49:27 ipsec,debug 0b245599 c084f514 92a2a5ac bcea1582 ae845108 fcedb37f b884fac8 3cafee71 
22:49:27 ipsec IPsec-SA established: office-ip-address[500]->my-ip-address[500] spi=0x3de6708 
22:49:27 ipsec IPsec-SA established: my-ip-address[500]->office-ip-address[500] spi=0x5943a6eb 
22:49:53 ipsec sending dpd packet 
22:49:53 ipsec <- ike2 request, exchange: INFORMATIONAL:130 customer-ip-address[500] ae0256aafe52a6fa:298a76acceaa2b48 
22:49:53 ipsec,debug ===== sending 160 bytes from my-ip-address[500] to customer-ip-address[500] 
22:49:53 ipsec,debug 1 times of 160 bytes message will be sent to customer-ip-address[500] 
22:49:53 ipsec,debug ===== received 80 bytes from customer-ip-address[500] to my-ip-address[500] 
22:49:53 ipsec -> ike2 reply, exchange: INFORMATIONAL:130 customer-ip-address[500] ae0256aafe52a6fa:298a76acceaa2b48 
22:49:53 ipsec payload seen: ENC (52 bytes) 
22:49:53 ipsec processing payload: ENC 
22:49:53 ipsec,debug => iv (size 0x10) 
22:49:53 ipsec,debug 58ac0054 a8fc50a4 f84ca0f4 489cf044 
22:49:53 ipsec,debug decrypted packet 
22:49:53 ipsec respond: info 
22:49:53 ipsec,debug reply ignoredAnd I attached the log here. Thanks!the connection is unstable which keep to drop the connection.On mikrotik side, an IPsec connection may be mistakenly reported as up for a second whilst it actually did not succeed, so when you say "keeps dropping", what exactly does it mean? Drops every few seconds, or every 25 minutes? Does it recover on its own or you have to disable and re-enable it?Besides answering those questions, the best would be to do the following steps on the Mikrotik:disable the peer representing the Fortigateopen a command line window (using the Terminal button in Winbox or WebFIG)unless you've done that already, run/system logging add topics=ipsec,!packetrunlog print follow-only file=ipsec-start where topics~"ipsec"enable the peer representing the Fortigate, wait until the connection establishes and failsreturn to the command line window where thelog print ...command is running and press Ctrl-C to stop itdownload the fileipsec-start.txtand find out what is going on; if it is above your head, use a text editor to substitute every occurrence of each individual public or global IP address with a unique pattern (likemik.ro.tik.ipfor the WAN address of the Mikrotik andfor.ti.gate.ipfor the Fortigate one), copy the whole contents of the modified file and paste it here between [code] and [/code] tags (that can be added using the </> button above the form field).

---
### Post 5
Author: Unknown
Date: Unknown

@LeoleokidNo configuration, no models, too little information/export file=anynameyouwish ( minus router serial number, any public WANIP information, keys etc.)

---
### Post 6
Author: Unknown
Date: Unknown

My Fortigate is using IKE2, so I can't find peer ID and any option about this.There is a row in the/ip ipsec peertable on your Mikrotik that represents the Fortigate. That's the "peer" I wanted you to disable first and re-enable after starting mirroring the log into the ipsec-start file. The goal is to see the process of establishing the IPsec connection and the "spontaneous  drop" you mention in the log.In the log you have sent, I can see you have disabled and then re-enabled the policy, but it did not run for long enough to show the spontaneous drop.You also haven't answered the questions from my previous post.

---
