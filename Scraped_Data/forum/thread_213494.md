---
title: Thread-213494
url: https://forum.mikrotik.com/viewtopic.php?t=213494&sid=49f92a630bc7970d8ca50523be880e8f
thread_id: 213494
section: RouterOS
post_count: 10
date_crawled: 2025-02-03T14:11:25.710145
---

### Post 1
Author: Unknown
Date: Unknown

Hi, I spent a few days researching/configuring/testing this setup and I think it's doing everything I want. Before I put it into production could you have a look over the config and see if there are any glaring mistakes or anything to optimise the setup.My must have with this setup is:-1 - Dual WAN Load Balance (PCC) with failover. WAN1 is Dynamic IP (Virgin router in Bridge Mode) and WAN2 is PPPOE (BT router in Bridge Mode)2 - Dual Wireguard connections to allow employees to connect over both connections using two separate WG tunnels and let them decide which one to use.(There maybe a further firewall rule to add to allow the WG VPN to access the subnet but I'll test and amend when it's installed)[admin@MikroTik] > export hide-sensitive# 2024-12-25 11:03:17 by RouterOS 7.16.2# software id = 8J44-GUKS## model = CCR1009-8G-1S-1S+# serial number = *************/interface bridgeadd name=bridge1 port-cost-mode=short/interface ethernetset [ find default-name=ether1 ] name=ether1-gatewayset [ find default-name=ether2 ] name=ether2-gateway/interface pppoe-clientadd add-default-route=yes disabled=no interface=ether2-gateway name=pppoe-out1 user=btbusinesshub@business.btclick.com/interface wireguardadd comment=WAN2 listen-port=14231 mtu=1420 name="VDSL(WG)"add comment=WAN1 listen-port=13231 mtu=1420 name="Virgin(WG)"/interface listadd comment=defconf name=WANadd comment=defconf name=LANadd comment=Wireguard name=WG/interface lte apnset [ find default=yes ] ip-type=ipv4 use-network-apn=no/interface wireless security-profilesset [ find default=yes ] supplicant-identity=MikroTik/ip pooladd name=dhcp ranges=192.168.1.2-192.168.1.254/ip dhcp-serveradd address-pool=dhcp interface=bridge1 name=dhcp1/portset 0 name=serial0set 1 name=serial1/routing tableadd disabled=no fib name=to_ether1add disabled=no fib name=to_ether2/interface bridge portadd bridge=bridge1 ingress-filtering=no interface=ether3 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether4 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether5 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether6 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether7 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether8 internal-path-cost=10 path-cost=10/ip firewall connection trackingset udp-timeout=10s/ip neighbor discovery-settingsset discover-interface-list=LAN/ip settingsset max-neighbor-entries=8192/ipv6 settingsset disable-ipv6=yes max-neighbor-entries=8192/interface list memberadd interface=ether1-gateway list=WANadd interface=bridge1 list=LANadd interface=ether2-gateway list=WANadd interface=pppoe-out1 list=WANadd interface="VDSL(WG)" list=WGadd interface="Virgin(WG)" list=WG/interface ovpn-server serverset auth=sha1,md5/interface wireguard peersadd allowed-address=192.168.30.1/32 interface="Virgin(WG)" name=Gary1 public-key="1bukt0UMWs4/5LFGh38sIcqUWh58EESEeD3pHXhzfD8="add allowed-address=192.168.31.1/32 interface="VDSL(WG)" name=Gary2 public-key="7yZysM02Q7ITAuT2Fcj6NrK4oU57f8zwI4josSfmgQw="/ip addressadd address=192.168.1.1/24 interface=bridge1 network=192.168.1.0add address=192.168.30.254/24 interface="Virgin(WG)" network=192.168.30.0add address=192.168.31.254/24 interface="VDSL(WG)" network=192.168.31.0/ip cloudset ddns-enabled=yes/ip dhcp-clientadd add-default-route=no interface=ether1-gatewayadd add-default-route=no disabled=yes interface=ether2-gateway/ip dhcp-server networkadd address=192.168.1.0/24 dns-server=192.168.1.1 gateway=192.168.1.1 netmask=24/ip dnsset allow-remote-requests=yes servers=8.8.8.8,8.8.4.4/ip firewall address-listadd address=192.168.30.0/24 list=WG-subnetsadd address=192.168.31.0/24 list=WG-subnets/ip firewall filteradd action=accept chain=input comment="defconf: accept established,related,untracked" connection-state=established,related,untrackedadd action=accept chain=input comment="WAN1 - Allow Wireguard" dst-port=13231 protocol=udpadd action=accept chain=input comment="WAN2 - Allow Wireguard" dst-port=14231 protocol=udpadd action=accept chain=input comment="Allow router access across Wireguard" dst-address=192.168.1.0/24 in-interface="Virgin(WG)"add action=accept chain=input comment="defconf: accept to local loopback (for CAPsMAN)" dst-address=127.0.0.1add action=accept chain=input comment="defconf: accept ICMP" protocol=icmpadd action=drop chain=input comment="defconf: drop invalid" connection-state=invalidadd action=drop chain=input comment="defconf: drop all not coming from LAN" in-interface-list=!LANadd action=fasttrack-connection chain=forward comment="defconf: fasttrack" connection-state=established,related disabled=yes hw-offload=yesadd action=accept chain=forward comment="defconf: accept established,related, untracked" connection-state=established,related,untrackedadd action=accept chain=forward comment="Allow Wireguard " dst-address=192.168.1.0/24 in-interface="Virgin(WG)"add action=accept chain=forward comment="defconf: accept in ipsec policy" ipsec-policy=in,ipsecadd action=accept chain=forward comment="defconf: accept out ipsec policy" ipsec-policy=out,ipsecadd action=drop chain=forward comment="defconf: drop invalid" connection-state=invalidadd action=drop chain=forward comment="defconf: drop all from WAN not DSTNATed" connection-nat-state=!dstnat connection-state=new in-interface-list=WAN/ip firewall mangleadd action=mark-connection chain=prerouting comment="Load Balance" connection-mark=no-mark connection-state=new in-interface=ether1-gateway \new-connection-mark=ether1_conn passthrough=yesadd action=mark-connection chain=prerouting connection-mark=no-mark connection-state=new in-interface=pppoe-out1 new-connection-mark=ether2_conn \passthrough=yesadd action=mark-routing chain=output connection-mark=ether1_conn new-routing-mark=to_ether1 passthrough=yesadd action=mark-routing chain=output connection-mark=ether2_conn new-routing-mark=to_ether2 passthrough=yesadd action=mark-connection chain=prerouting connection-mark=no-mark connection-state=new dst-address-type=!local in-interface-list=LAN \new-connection-mark=ether1_conn passthrough=yes per-connection-classifier=both-addresses-and-ports:2/0add action=mark-connection chain=prerouting connection-mark=no-mark connection-state=new dst-address-type=!local in-interface-list=LAN \new-connection-mark=ether2_conn passthrough=yes per-connection-classifier=both-addresses-and-ports:2/1add action=mark-routing chain=prerouting connection-mark=ether1_conn in-interface-list=LAN new-routing-mark=to_ether1 passthrough=yesadd action=mark-routing chain=prerouting connection-mark=ether2_conn in-interface-list=LAN new-routing-mark=to_ether2 passthrough=yes/ip firewall natadd action=masquerade chain=srcnat out-interface=ether1-gatewayadd action=masquerade chain=srcnat out-interface=pppoe-out1add action=dst-nat chain=dstnat dst-address-type=local in-interface=pppoe-out1 protocol=udp to-addresses=192.168.18.93 to-ports=14231/ip ipsec profileset [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5/ip routeadd check-gateway=ping comment="Ether1-Wan routing gateway" disabled=no distance=1 dst-address=0.0.0.0/0 gateway=192.168.18.1 pref-src=0.0.0.0 \routing-table=to_ether1 scope=30 suppress-hw-offload=no target-scope=10add comment=Ether1-Wan distance=1 gateway=192.168.18.1add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=ether1-gateway routing-table=to_ether2 scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=2 dst-address=0.0.0.0/0 gateway=pppoe-out1 routing-table=to_ether2 scope=30 suppress-hw-offload=no \target-scope=10add disabled=no distance=1 dst-address=192.168.0.0/24 gateway="Virgin(WG)" routing-table=main scope=30 suppress-hw-offload=no target-scope=10/ip smb sharesset [ find default=yes ] directory=/flash/pub/ipv6 firewall address-listadd address=::/128 comment="defconf: unspecified address" list=bad_ipv6add address=::1/128 comment="defconf: lo" list=bad_ipv6add address=fec0::/10 comment="defconf: site-local" list=bad_ipv6add address=::ffff:0.0.0.0/96 comment="defconf: ipv4-mapped" list=bad_ipv6add address=::/96 comment="defconf: ipv4 compat" list=bad_ipv6add address=100::/64 comment="defconf: discard only " list=bad_ipv6add address=2001:db8::/32 comment="defconf: documentation" list=bad_ipv6add address=2001:10::/28 comment="defconf: ORCHID" list=bad_ipv6add address=3ffe::/16 comment="defconf: 6bone" list=bad_ipv6/lcdset time-interval=hour/routing bfd configurationadd disabled=no interfaces=all min-rx=200ms min-tx=200ms multiplier=5/system clockset time-zone-name=Europe/London/system noteset show-at-login=no/system scheduleradd interval=2s name=ChangeGateways on-event=":global newgw [/ip dhcp-client get [find interface=\"ether1-gateway\" ] gateway ]\r\\n:global activegw [/ip route get [/ip route find comment=\"Ether1-Wan\"] gateway ]\r\\n:if (\$newgw != \$activegw) do={\r\\n/ip route set [find comment=\"Ether1-Wan\"] gateway=\$newgw\r\\n/ip route set [find comment=\"Ether1-Wan routing gateway\"] gateway=\$newgw\r\\n}" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=2024-12-15 start-time=23:12:33

---
### Post 2
Author: Unknown
Date: Unknown

THere is no need to provide two wireguard connections......Simply use WAN1 and if WAN1 fails wireguard has the capacity to move traffic to WAN2for any current connection.HOwever if someone attempts to establish a tunnel while WAN1 is down, then having the backup is a decent option but let them know its only if Wireguard through WAN1 does not seem to be working.Remove default router you set to yes for PPPOE,   that way we can effect the rules required.Re-ordered firewall rulesinput chain rule to allow wireguard to subnet is wrongly place it would seem to be a forward chain ruleadded a rule to allow access to router from wg subnets using wg interface list.  If there are normal users besides admin coming in on wireguard then create a firewall address list for only admin IPs and then add scr-address-list=ADMIN to the new rule for better specificity.Code:Select all# model = CCR1009-8G-1S-1S+# serial number = *************/interfacebridgeaddname=bridge1 port-cost-mode=short/interfaceethernetset[finddefault-name=ether1]name=ether1-gatewayset[finddefault-name=ether2]name=ether2-gateway/interfacepppoe-clientaddadd-default-route=nodisabled=nointerface=ether2-gateway name=pppoe-out1 user=btbusinesshub@business.btclick.com/interfacewireguardaddcomment=WAN2 listen-port=14231mtu=1420name="VDSL(WG)"addcomment=WAN1 listen-port=13231mtu=1420name="Virgin(WG)"/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LANaddcomment=Wireguardname=WG/interfacelte apnset[finddefault=yes]ip-type=ipv4use-network-apn=no/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=dhcp ranges=192.168.1.2-192.168.1.254/ip dhcp-serveraddaddress-pool=dhcpinterface=bridge1 name=dhcp1/portset0name=serial0set1name=serial1/routing tableadddisabled=nofib name=use-WAN1adddisabled=nofib name=use-WAN2Comment="backup vpn"/interfacebridge portaddbridge=bridge1 ingress-filtering=nointerface=ether3internal-path-cost=10path-cost=10addbridge=bridge1 ingress-filtering=nointerface=ether4internal-path-cost=10path-cost=10addbridge=bridge1 ingress-filtering=nointerface=ether5internal-path-cost=10path-cost=10addbridge=bridge1 ingress-filtering=nointerface=ether6internal-path-cost=10path-cost=10addbridge=bridge1 ingress-filtering=nointerface=ether7internal-path-cost=10path-cost=10addbridge=bridge1 ingress-filtering=nointerface=ether8internal-path-cost=10path-cost=10/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=LAN/ip settingssetmax-neighbor-entries=8192/ipv6 settingssetdisable-ipv6=yes max-neighbor-entries=8192/interfacelist memberaddinterface=ether1-gateway list=WANaddinterface=bridge1 list=LANaddinterface=ether2-gateway list=WANaddinterface=pppoe-out1 list=WANaddinterface="VDSL(WG)"list=WGaddinterface="Virgin(WG)"list=WG/interfaceovpn-server serversetauth=sha1,md5/interfacewireguard peersaddallowed-address=192.168.30.1/32interface="Virgin(WG)"name=Gary1public-key="1bukt0UMWs4/5LFGh38sIcqUWh58EESEeD3pHXhzfD8="addallowed-address=192.168.31.1/32interface="VDSL(WG)"name=Gary2public-key="7yZysM02Q7ITAuT2Fcj6NrK4oU57f8zwI4josSfmgQw="/ip addressaddaddress=192.168.1.1/24interface=bridge1 network=192.168.1.0addaddress=192.168.30.254/24interface="Virgin(WG)"network=192.168.30.0addaddress=192.168.31.254/24interface="VDSL(WG)"network=192.168.31.0/ip cloudsetddns-enabled=yes/ip dhcp-clientaddadd-default-route=nointerface=ether1-gatewayaddadd-default-route=nodisabled=yesinterface=ether2-gateway/ip dhcp-server networkaddaddress=192.168.1.0/24dns-server=192.168.1.1gateway=192.168.1.1/ip dnssetallow-remote-requests=yes servers=8.8.8.8,8.8.4.4/ip firewall address-listaddaddress=192.168.30.0/24list=WG-subnetsaddaddress=192.168.31.0/24list=WG-subnets/ip firewall filteraddaction=accept chain=input comment="defconf: accept established,related,untracked"connection-state=established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment="defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input comment="WAN1 - Allow Wireguard"dst-port=13231protocol=udpaddaction=accept chain=input comment="WAN2 - Allow Wireguard"dst-port=14231protocol=udpaddaction=accept chain=input comment="Allow admin from Wireguard"in-interface-list=WG{option toaddsrc address listifneeded}addaction=drop chain=input comment="defconf: drop all not coming from LAN"in-interface-list=!LANaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"connection-state=established,related disabled=yes connection-mark=no-markaddaction=accept chain=forward comment="defconf: accept established,related, untracked"connection-state=established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"connection-state=invalidaddaction=accept chain=forward comment="internet access"in-interface-list=LANout-interface-list=WANaddaction=accept chain=forward comment="Allow Wireguard to LAN"dst-address=192.168.1.0/24in-interface-list=WGaddaction=drop chain=forward comment="drop all else"/ip firewall mangle{mangle traffic TO the router aka VPNS}addaction=mark-connection chain=input comment="vpn to WAN1"connection-mark=no-markin-interface=ether1-gateway  \new-connection-mark=incoming-wan1  passthrough=yesaddaction=mark-connection chain=input comment="vpn to WAN2"connection-mark=no-markin-interface=pppoe-out1  \new-connection-mark=incoming-wan2  passthrough=yes++++++++++++++++addaction=mark-routing chain=output connection-mark=incoming-wan1 \new-routing-mark=use-WAN1  passthrough=noaddaction=mark-routing chain=output connection-mark=incoming-wan2 \new-routing-mark=use-WAN2  passthrough=no{mangleforload balancing}addaction=mark-connection chain=forward connection-mark=no-mark  dst-address-type=!localin-interface-list=LAN \new-connection-mark=ether1_conn passthrough=yes per-connection-classifier=both-addresses-and-ports:2/0addaction=mark-connection chain=forward connection-mark=no-mark connection-state=newdst-address-type=!localin-interface-list=LAN \new-connection-mark=ether2_conn passthrough=yes per-connection-classifier=both-addresses-and-ports:2/1+++++++++++++++++++++addaction=mark-routing chain=prerouting connection-mark=ether1_conn \new-routing-mark=use-WAN1 passthrough=noaddaction=mark-routing chain=prerouting connection-mark=ether2_conn \new-routing-mark=use-WAN2 passthrough=no/ip firewall nataddaction=masquerade chain=srcnatout-interface=ether1-gatewayaddaction=masquerade chain=srcnatout-interface=pppoe-out1/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip route{main table routes recursive}addcheck-gateway=ping  dst-address=0.0.0.0/0gateway=1.1.1.1routing-table=main scope=10target-scope=12comment=WAN1addcheck-gateway=ping  distance=2dst-address=0.0.0.0/0gateway=9.9.9.9routing-table=main scope=10target-scope=12comment=WAN2adddst-address=1.1.1.1/32gateway=ether1-gateway-IP routing-table=main scope=10target scope=11adddistance=2dst-address=9.9.9.9gateway=pppoe-out1-gateway-IP routing-table=main scope=10target scope=11{special routesforLB}adddst-address=0.0.0.0/0gateway=ether1-gateway-ip  routing-table=use-WAN1adddst-address=0.0.0.0/0gateway=pppoe-out1-gateway-ip routing-table=use-WAN2set[finddefault=yes]directory=/flash/pub/lcdsettime-interval=hour/routing bfd configurationadddisabled=nointerfaces=all min-rx=200msmin-tx=200msmultiplier=5/system clocksettime-zone-name=Europe/London/system notesetshow-at-login=no/system scheduleraddinterval=2sname=ChangeGatewayson-event=":global newgw [/ip dhcp-client get [find interface=\"ether1-gateway\" ] gateway ]\r\
\n:global activegw [/ip route get [/ip route find comment=\"Ether1-Wan\"] gateway ]\r\
\n:if (\$newgw != \$activegw) do={\r\
\n/ip route set [find comment=\"Ether1-Wan\"] gateway=\$newgw\r\
\n/ip route set [find comment=\"Ether1-Wan routing gateway\"] gateway=\$newgw\r\
\n}"policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=2024-12-15start-time=23:12:33

---
### Post 3
Author: Unknown
Date: Unknown

In these lines in your config{ special routes for LB }add dst-address=0.0.0.0/0 gateway=ether1-gateway-ip  routing-table=use-WAN1add dst-address=0.0.0.0/0 gateway=pppoe-out1-gateway-ip routing-table=use-WAN2What is ether1-gateway-ip if that connection is dynamic? Where is this variable being supplied from?Do I substitute the gateway IP for the pppoe connection in here?

---
### Post 4
Author: Unknown
Date: Unknown

Good questions!I believe this should address the dynamic nature of the WAN1 gateway as per your script!!When installing the config the for wan1  use theactual current gateway IP.  The script you made will keep the routes up to date./ip route{ main table routes recursive }add check-gateway=ping  dst-address=0.0.0.0/0 gateway=1.1.1.1 routing-table=main scope=10 target-scope=12 comment=WAN1add check-gateway=ping  distance=2 dst-address=0.0.0.0/0 gateway=9.9.9.9  routing-table=main scope=10 target-scope=12  comment=WAN2add dst-address=1.1.1.1/32 gateway=ether1-gateway-IProuting-table=main scope=10 target scope=11comment=Ether1-Wanadd distance=2 dst-address=9.9.9.9  gateway=pppoe-out1-gateway-IP routing-table=main scope=10 target scope=11{ special routes for LB }add dst-address=0.0.0.0/0 gateway=ether1-gateway-iprouting-table=use-WAN1comment=Ether1-Wanadd dst-address=0.0.0.0/0 gateway=pppoe-out1-gateway-ip routing-table=use-WAN2++++++++++++++Now for pppoe I never remember.  I do believe that one can use the interface name "pppoe-out1"  for gatewayIP and it should work.Can you test to see if true??

---
### Post 5
Author: Unknown
Date: Unknown

No WAN2 gateway remains as 9.9.9.9 and doesn't update. In PPPOE client I haven't added default route.In Route List WAN2 remains 9.9.9.9 and USHI

---
### Post 6
Author: Unknown
Date: Unknown

Okay so WAN1 works as is....Suspect for WAN2 you will need the same thing. So see if this works........a.  a similar script to capture the change of IP address  ---> find comment=\"PPOE-Wan\b.  put the current pppoe gateway in on the config so it would look like.../ip route{ main table routes recursive }add check-gateway=ping dst-address=0.0.0.0/0 gateway=1.1.1.1 routing-table=main scope=10 target-scope=12 comment=WAN1add check-gateway=ping distance=2 dst-address=0.0.0.0/0 gateway=9.9.9.9 routing-table=main scope=10 target-scope=12 comment=WAN2add dst-address=1.1.1.1/32 gateway=ether1-gateway-IP routing-table=main scope=10 target scope=11 comment=Ether1-Wanadd distance=2 dst-address=9.9.9.9 gateway=pppoe-out1-gateway-IProuting-table=main scope=10 target scope=11 comment=PPPOE-Wan{ special routes for LB }add dst-address=0.0.0.0/0 gateway=ether1-gateway-ip routing-table=use-WAN1 comment=Ether1-Wanadd dst-address=0.0.0.0/0 gateway=pppoe-out1-gateway-iprouting-table=use-WAN2  comment=PPPOE-Wan

---
### Post 7
Author: Unknown
Date: Unknown

Ok got the script working and it's populating the route but no internet. Here is the current config.# 2024-12-27 13:13:34 by RouterOS 7.16.2# software id = 8J44-GUKS## model = CCR1009-8G-1S-1S+# serial number = **************/interface bridgeadd name=bridge1 port-cost-mode=short/interface ethernetset [ find default-name=ether1 ] name=ether1-gatewayset [ find default-name=ether2 ] name=ether2-gateway/interface pppoe-clientadd disabled=no interface=ether2-gateway name=pppoe-out1 user=btbusinesshub@business.btclick.com/interface wireguardadd comment=WAN2 listen-port=14231 mtu=1420 name="VDSL(WG)"add comment=WAN1 listen-port=13231 mtu=1420 name="Virgin(WG)"/interface listadd comment=defconf name=WANadd comment=defconf name=LANadd comment=Wireguard name=WG/interface lte apnset [ find default=yes ] ip-type=ipv4 use-network-apn=no/interface wireless security-profilesset [ find default=yes ] supplicant-identity=MikroTik/ip pooladd name=dhcp ranges=192.168.1.2-192.168.1.254/ip dhcp-serveradd address-pool=dhcp interface=bridge1 name=dhcp1/portset 0 name=serial0set 1 name=serial1/routing tableadd disabled=no fib name=use-WAN1add disabled=no fib name=use-WAN2/interface bridge portadd bridge=bridge1 ingress-filtering=no interface=ether3 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether4 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether5 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether6 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether7 internal-path-cost=10 path-cost=10add bridge=bridge1 ingress-filtering=no interface=ether8 internal-path-cost=10 path-cost=10/ip firewall connection trackingset udp-timeout=10s/ip neighbor discovery-settingsset discover-interface-list=LAN/ip settingsset max-neighbor-entries=8192/ipv6 settingsset disable-ipv6=yes max-neighbor-entries=8192/interface list memberadd interface=ether1-gateway list=WANadd interface=bridge1 list=LANadd interface=ether2-gateway list=WANadd interface=pppoe-out1 list=WANadd interface="VDSL(WG)" list=WGadd interface="Virgin(WG)" list=WG/interface ovpn-server serverset auth=sha1,md5/interface wireguard peersadd allowed-address=192.168.30.1/32 interface="Virgin(WG)" name=Gary1 public-key="1bukt0UMWs4/5LFGh38sIcqUWh58EESEeD3pHXhzfD8="add allowed-address=192.168.31.1/32 interface="VDSL(WG)" name=Gary2 public-key="7yZysM02Q7ITAuT2Fcj6NrK4oU57f8zwI4josSfmgQw="/ip addressadd address=192.168.1.1/24 interface=bridge1 network=192.168.1.0add address=192.168.30.254/24 interface="Virgin(WG)" network=192.168.30.0add address=192.168.31.254/24 interface="VDSL(WG)" network=192.168.31.0/ip cloudset ddns-enabled=yes/ip dhcp-clientadd add-default-route=no interface=ether1-gatewayadd add-default-route=no disabled=yes interface=ether2-gateway/ip dhcp-server networkadd address=192.168.1.0/24 dns-server=192.168.1.1 gateway=192.168.1.1/ip dnsset allow-remote-requests=yes servers=8.8.8.8,8.8.4.4/ip firewall address-listadd address=192.168.30.0/24 list=WG-subnetsadd address=192.168.31.0/24 list=WG-subnets/ip firewall filteradd action=accept chain=input comment="defconf: accept established,related,untracked" connection-state=established,related,untrackedadd action=drop chain=input comment="defconf: drop invalid" connection-state=invalidadd action=accept chain=input comment="defconf: accept ICMP" protocol=icmpadd action=accept chain=input comment="defconf: accept to local loopback (for CAPsMAN)" dst-address=127.0.0.1add action=accept chain=input comment="WAN1 - Allow Wireguard" dst-port=13231 protocol=udpadd action=accept chain=input comment="WAN2 - Allow Wireguard" dst-port=14231 protocol=udpadd action=accept chain=input comment="Allow admin from Wireguard" in-interface-list=WGadd action=drop chain=input comment="defconf: drop all not coming from LAN" in-interface-list=!LANadd action=fasttrack-connection chain=forward comment="defconf: fasttrack" connection-mark=no-mark connection-state=established,related disabled=yes hw-offload=\yesadd action=accept chain=forward comment="defconf: accept established,related, untracked" connection-state=established,related,untrackedadd action=drop chain=forward comment="defconf: drop invalid" connection-state=invalidadd action=accept chain=forward comment="internet access" in-interface-list=LAN out-interface-list=WANadd action=accept chain=forward comment="Allow Wireguard to LAN" dst-address=192.168.1.0/24 in-interface-list=WGadd action=drop chain=forward comment="drop all else"/ip firewall mangleadd action=mark-connection chain=input comment="vpn to WAN1" connection-mark=no-mark in-interface=ether1-gateway new-connection-mark=incoming-wan1 passthrough=\yesadd action=mark-connection chain=input comment="vpn to WAN2" connection-mark=no-mark in-interface=pppoe-out1 new-connection-mark=incoming-wan2 passthrough=yesadd action=mark-routing chain=output connection-mark=incoming-wan1 new-routing-mark=use-WAN1 passthrough=noadd action=mark-routing chain=output connection-mark=incoming-wan2 new-routing-mark=use-WAN2 passthrough=noadd action=mark-connection chain=forward connection-mark=no-mark dst-address-type=!local in-interface-list=LAN new-connection-mark=ether1_conn passthrough=yes \per-connection-classifier=both-addresses-and-ports:2/0add action=mark-connection chain=forward connection-mark=no-mark connection-state=new dst-address-type=!local in-interface-list=LAN new-connection-mark=\ether2_conn passthrough=yes per-connection-classifier=both-addresses-and-ports:2/1add action=mark-routing chain=prerouting connection-mark=ether1_conn new-routing-mark=use-WAN1 passthrough=noadd action=mark-routing chain=prerouting connection-mark=ether2_conn new-routing-mark=use-WAN2 passthrough=no/ip firewall natadd action=masquerade chain=srcnat out-interface=ether1-gatewayadd action=masquerade chain=srcnat out-interface=pppoe-out1/ip ipsec profileset [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5/ip routeadd check-gateway=ping comment=WAN1 dst-address=0.0.0.0/0 gateway=192.168.18.1 routing-table=main scope=10 target-scope=12add check-gateway=ping comment=WAN2 distance=2 dst-address=0.0.0.0/0 gateway=81.134.176.1 routing-table=main scope=10 target-scope=12add disabled=no dst-address=1.1.1.1/32 gateway=ether1-gateway routing-table=main scope=10 suppress-hw-offload=no target-scope=11add disabled=no distance=2 dst-address=9.9.9.9/32 gateway=pppoe-out1 routing-table=main scope=10 suppress-hw-offload=no target-scope=11add disabled=no dst-address=0.0.0.0/0 gateway=ether1-gateway routing-table=use-WAN1 suppress-hw-offload=noadd disabled=no dst-address=0.0.0.0/0 gateway=pppoe-out1 routing-table=use-WAN2 suppress-hw-offload=no/system noteset show-at-login=no/system scheduleradd interval=2s name=ChangeGateways on-event=":global newgw [/ip dhcp-client get [find interface=\"ether1-gateway\" ] gateway ]\r\\n:global activegw [/ip route get [/ip route find comment=\"WAN1\"] gateway ]\r\\n:if (\$newgw != \$activegw) do={\r\\n/ip route set [find comment=\"WAN1\"] gateway=\$newgw\r\\n/ip route set [find comment=\"WAN1 routing gateway\"] gateway=\$newgw\r\\n}\r\\n\r\\n:global newgw [/ip address get [/ip address find interface=\"pppoe-out1\" ] network ]\r\\n:global activegw [/ip route get [/ip route find comment=\"WAN2\"] gateway ]\r\\n:if (\$newgw != \$activegw) do={\r\\n/ip route set [find comment=\"WAN2\"] gateway=\$newgw\r\\n/ip route set [find comment=\"WAN2 routing gateway\"] gateway=\$newgw\r\\n}" policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon start-date=1970-01-02 start-time=00:02:27

---
### Post 8
Author: Unknown
Date: Unknown

Routes are incorrect......From/ip routeadd check-gateway=ping comment=WAN1 dst-address=0.0.0.0/0 gateway=192.168.18.1 routing-table=main scope=10 target-scope=12add check-gateway=ping comment=WAN2 distance=2dst-address=0.0.0.0/0 gateway=81.134.176.1 routing-table=main scope=10 target-scope=12add disabled=no dst-address=1.1.1.1/32 gateway=ether1-gateway routing-table=main scope=10 suppress-hw-offload=no target-scope=11add disabled=no distance=2dst-address=9.9.9.9/32 gateway=pppoe-out1 routing-table=main scope=10 suppress-hw-offload=no target-scope=11add disabled=no dst-address=0.0.0.0/0 gateway=ether1-gateway routing-table=use-WAN1 suppress-hw-offload=noadd disabled=no dst-address=0.0.0.0/0 gateway=pppoe-out1 routing-table=use-WAN2 suppress-hw-offload=noTO:/ip routeadd check-gateway=ping  dst-address=0.0.0.0/0gateway=1.1.1.1routing-table=main scope=10 target-scope=12add check-gateway=ping  distance=2 dst-address=0.0.0.0/0gateway=9.9.9.9routing-table=main scope=10 target-scope=12add  dst-address=1.1.1.1/32 gateway=actual-gatewayIP-WAN1 routing-table=main scope=10  target-scope=11comment="WAN1"add  distance=2 dst-address=9.9.9.9/32 gateway=actual-gateway-IP-WAN2 routing-table=main scope=10 target-scope=11comment="WAN2"add  dst-address=0.0.0.0/0 gateway=actual-gatewayIP-WAN1 routing-table=use-WAN1comment="WAN1 routing gateway"add  dst-address=0.0.0.0/0 gateway=actual-gatewayIP-WAN2 routing-table=use-WAN2comment="WAN2 routing gateway"

---
### Post 9
Author: Unknown
Date: Unknown

With those changes I can ping 8.8.8.8 from the router but not from anything behind the router.When I check connections I'm seeing 4 connection marksether1_connether2_connincoming-wan1incoming-wan2Is that correct?

---
### Post 10
Author: Unknown
Date: Unknown

Thats why I put separate names so that you can see if all four are being seen.It must be something else in the config, will look at it later when I have time.

---
