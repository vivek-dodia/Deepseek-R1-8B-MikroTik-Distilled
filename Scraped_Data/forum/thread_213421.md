---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=2&t=213421&p=1115765&amp;sid=3b77a3334c914448dbbc02bfdff4c3aa#p1115765
crawled_date: 2025-02-02T21:57:02.857589
section: mikrotik_forum
type: forum_thread
keywords: vpn, ppp, pppoe, configuration, setup
---

### Author: Sat Dec 21, 2024 12:22 pm
Date: Unknown

this takes several steps, start with the correct configuration of the policy routing:/routing tableadd disabled=no fib name=to_WAN_mainadd disabled=no fib name=to_WAN_bkp/routing ruleadd action=lookup disabled=no src-address=1.1.1.0/30 table=to_WAN_mainadd action=lookup disabled=no routing-mark=to_WAN_main table=to_WAN_mainadd action=lookup disabled=no src-address=2.2.2.0/30 table=to_WAN_bkpadd action=lookup disabled=no routing-mark=to_WAN_bkp table=to_WAN_bkp/ip routeadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=1.1.1.1 pref-src=1.1.1.2 routing-table=mainadd disabled=no distance=2 dst-address=0.0.0.0/0 gateway=2.2.2.1 pref-src=2.2.2.2 routing-table=mainadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=1.1.1.1 pref-src=1.1.1.2 routing-table=to_WAN_mainadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=2.2.2.1 pref-src=2.2.2.2 routing-table=to_WAN_bkpcheck it by ping:/ping address=8.8.8.8 src-address=1.1.1.2/ping address=8.8.8.8 src-address=2.2.2.2If it works, I will in step 2 write you the Wireguard configuration


---
### Author: Sat Dec 21, 2024 2:36 pm
Date: Unknown

this takes several steps, start with the correct configuration of the policy routing:/routing tableadd disabled=no fib name=to_WAN_mainadd disabled=no fib name=to_WAN_bkp/routing ruleadd action=lookup disabled=no src-address=1.1.1.0/30 table=to_WAN_mainadd action=lookup disabled=no routing-mark=to_WAN_main table=to_WAN_mainadd action=lookup disabled=no src-address=2.2.2.0/30 table=to_WAN_bkpadd action=lookup disabled=no routing-mark=to_WAN_bkp table=to_WAN_bkp/ip routeadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=1.1.1.1 pref-src=1.1.1.2 routing-table=mainadd disabled=no distance=2 dst-address=0.0.0.0/0 gateway=2.2.2.1 pref-src=2.2.2.2 routing-table=mainadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=1.1.1.1 pref-src=1.1.1.2 routing-table=to_WAN_mainadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=2.2.2.1 pref-src=2.2.2.2 routing-table=to_WAN_bkpcheck it by ping:/ping address=8.8.8.8 src-address=1.1.1.2/ping address=8.8.8.8 src-address=2.2.2.2If it works, I will in step 2 write you the Wireguard configurationthank you for the instruction, I'm sorry that forgot to inform WAN1 is PPPoE, not static, so the config is different ?


---
### Author: Sat Dec 21, 2024 4:06 pm
Date: Unknown

MAIN ROUTER A ( server peer for wireguard handshake )/routing tableadd disabled=no fib name=use-WAN2/ip route( minimum )add distance=2 check-gateway=ping dst-address=0.0.0.0/0 gateway=pppoe-out1add distance=4 dst-address=0.0.0.0/0 gateway=WAN2-gateway-ipadd dst-address=0.0.0.0/0  gateway=WAN2-gateway-ip routing-table=use-WAN2/ip route( better - recursive - checks connection to internet is actually up, not just connection to ISP )add distance=2 check-gateway=ping dst-address=0.0.0.0/0 gateway=1.0.0.1 scope=10 target-scope=12add distance=2 dst-address=1.0.0.1/32 gateway=pppoe-out1 scope=10 target-scope=11add distance=4 dst-address=0.0.0.0/0 gateway=WAN2-gateway-ipadd dst-address=0.0.0.0/0  gateway=WAN2-gateway-ip routing-table=use-WAN2Now all traffic will go to WAN1, and if WAN1 is not available traffic will move to WAN2 and will go back to WAN1 when it is functional.Ensure you use the standard masquerade sourcenat  rule as well./ip firewall mangle ( to ensure traffic coming in on WAN2 goes back out WAN2 )add chain=input action=mark-connection connection-mark=no-mark \in-interface=WAN2 new-connection-mark=incomingWAN2 passthrough=yesadd chain=output action=mark-routing connection-mark=incomingWAN2 \new-routing-mark=use-WAN2 passthrough=noEnsure on the forward chain fasttrack rule you add the following:add action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established,relatedconnection=mark=no-markFinally to deal with the bug, we need a trick destination nat rule to ensure wireguard traffic does NOT go back out WAN1/ip firewall natadd action=masquerade chain=srcnat out-interface-list=WANadd action=dstnat chain=dst-nat in-interface=WAN2 dst-address-type=local dst-port=wireguardport protocol=udp to-address=staticWAN1-ipThe idea being, the router will assume all wireguard traffic that wants to exit WAN1, will be un-detinatted to wan2........+++++++++++++++++++++Basically the same for Router B.Main differences - no need for input chain rule for handshake.Allowed peers need endpoint address of WAN2 on router A,  and wireguard port and persistent keep alive set.Would add another mangle rule on router B as first rule to ensure MTU handling....add action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=wireguard1 passthrough=yes protocol=tcp tcp-flags=syn++++++++++++Best bet is to post complete config for review after an attempt to incorporate method of choice./export file=anynameyouwish   ( minus router serial number, any public WANIP information, keys etc. )


---
### Author: Sun Dec 22, 2024 1:43 am
Date: Unknown

MAIN ROUTER A ( server peer for wireguard handshake )/routing tableadd disabled=no fib name=use-WAN2/ip route( minimum )add distance=2 check-gateway=ping dst-address=0.0.0.0/0 gateway=pppoe-out1add distance=4 dst-address=0.0.0.0/0 gateway=WAN2-gateway-ipadd dst-address=0.0.0.0/0  gateway=WAN2-gateway-ip routing-table=use-WAN2/ip route( better - recursive - checks connection to internet is actually up, not just connection to ISP )add distance=2 check-gateway=ping dst-address=0.0.0.0/0 gateway=1.0.0.1 scope=10 target-scope=12add distance=2 dst-address=1.0.0.1/32 gateway=pppoe-out1 scope=10 target-scope=11add distance=4 dst-address=0.0.0.0/0 gateway=WAN2-gateway-ipadd dst-address=0.0.0.0/0  gateway=WAN2-gateway-ip routing-table=use-WAN2Now all traffic will go to WAN1, and if WAN1 is not available traffic will move to WAN2 and will go back to WAN1 when it is functional.Ensure you use the standard masquerade sourcenat  rule as well./ip firewall mangle ( to ensure traffic coming in on WAN2 goes back out WAN2 )add chain=input action=mark-connection connection-mark=no-mark \in-interface=WAN2 new-connection-mark=incomingWAN2 passthrough=yesadd chain=output action=mark-routing connection-mark=incomingWAN2 \new-routing-mark=use-WAN2 passthrough=noEnsure on the forward chain fasttrack rule you add the following:add action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established,relatedconnection=mark=no-markFinally to deal with the bug, we need a trick destination nat rule to ensure wireguard traffic does NOT go back out WAN1/ip firewall natadd action=masquerade chain=srcnat out-interface-list=WANadd action=dstnat chain=dst-nat in-interface=WAN2 dst-address-type=local dst-port=wireguardport protocol=udp to-address=staticWAN1-ipThe idea being, the router will assume all wireguard traffic that wants to exit WAN1, will be un-detinatted to wan2........+++++++++++++++++++++Basically the same for Router B.Main differences - no need for input chain rule for handshake.Allowed peers need endpoint address of WAN2 on router A,  and wireguard port and persistent keep alive set.Would add another mangle rule on router B as first rule to ensure MTU handling....add action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=wireguard1 passthrough=yes protocol=tcp tcp-flags=syn++++++++++++Best bet is to post complete config for review after an attempt to incorporate method of choice./export file=anynameyouwish   ( minus router serial number, any public WANIP information, keys etc. )The command:add action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established,related connection=mark=no-markneed to correct with:add action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established,related connection-mark=no-markAfter I followed your config, Wireguard traffic still go on WAN1, I will give you my current configuration.


---
### Author: Sun Dec 22, 2024 2:47 am
Date: Unknown

MAIN ROUTER A ( server peer for wireguard handshake )/routing tableadd disabled=no fib name=use-WAN2/ip route( minimum )add distance=2 check-gateway=ping dst-address=0.0.0.0/0 gateway=pppoe-out1add distance=4 dst-address=0.0.0.0/0 gateway=WAN2-gateway-ipadd dst-address=0.0.0.0/0  gateway=WAN2-gateway-ip routing-table=use-WAN2/ip route( better - recursive - checks connection to internet is actually up, not just connection to ISP )add distance=2 check-gateway=ping dst-address=0.0.0.0/0 gateway=1.0.0.1 scope=10 target-scope=12add distance=2 dst-address=1.0.0.1/32 gateway=pppoe-out1 scope=10 target-scope=11add distance=4 dst-address=0.0.0.0/0 gateway=WAN2-gateway-ipadd dst-address=0.0.0.0/0  gateway=WAN2-gateway-ip routing-table=use-WAN2Now all traffic will go to WAN1, and if WAN1 is not available traffic will move to WAN2 and will go back to WAN1 when it is functional.Ensure you use the standard masquerade sourcenat  rule as well./ip firewall mangle ( to ensure traffic coming in on WAN2 goes back out WAN2 )add chain=input action=mark-connection connection-mark=no-mark \in-interface=WAN2 new-connection-mark=incomingWAN2 passthrough=yesadd chain=output action=mark-routing connection-mark=incomingWAN2 \new-routing-mark=use-WAN2 passthrough=noEnsure on the forward chain fasttrack rule you add the following:add action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established,relatedconnection=mark=no-markFinally to deal with the bug, we need a trick destination nat rule to ensure wireguard traffic does NOT go back out WAN1/ip firewall natadd action=masquerade chain=srcnat out-interface-list=WANadd action=dstnat chain=dst-nat in-interface=WAN2 dst-address-type=local dst-port=wireguardport protocol=udp to-address=staticWAN1-ipThe idea being, the router will assume all wireguard traffic that wants to exit WAN1, will be un-detinatted to wan2........+++++++++++++++++++++Basically the same for Router B.Main differences - no need for input chain rule for handshake.Allowed peers need endpoint address of WAN2 on router A,  and wireguard port and persistent keep alive set.Would add another mangle rule on router B as first rule to ensure MTU handling....add action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=wireguard1 passthrough=yes protocol=tcp tcp-flags=syn++++++++++++Best bet is to post complete config for review after an attempt to incorporate method of choice./export file=anynameyouwish   ( minus router serial number, any public WANIP information, keys etc. )Site A:# 2024-12-22 07:27:56 by RouterOS 7.16.2# software id = 9931-M8FK## model = CCR1016-12G# serial number =/interface bridgeadd name=guest-lanadd name=py1-lan/interface ethernetset [ find default-name=ether1 ] comment=WAN-FTTHset [ find default-name=ether2 ] comment=WAN-ILL/interface pppoe-clientadd disabled=no interface=ether1 name=WAN-FTTH user=netnam_manipy/interface wireguardadd listen-port=51248 mtu=1420 name=WG-VPN-To-PY2add listen-port=12677 mtu=1420 name=WG-client-to-site-PY1/interface listadd name=LANadd name=WAN/interface wireless security-profilesset [ find default=yes ] supplicant-identity=MikroTik/ip pooladd name=dhcp_pool0 ranges=10.0.255.1-10.0.255.253add name=dhcp_pool1 ranges=10.22.10.10-10.22.10.200/ip dhcp-serveradd address-pool=dhcp_pool0 interface=guest-lan lease-time=1d name=guest-dhcpadd address-pool=dhcp_pool1 interface=py1-lan lease-time=8h name=dhcp1/portset 0 name=serial0set 1 name=serial1/routing tableadd disabled=no fib name=FTTH-tableadd disabled=no fib name=ILL-table/interface bridge portadd bridge=py1-lan interface=ether11add bridge=py1-lan interface=ether12add bridge=guest-lan interface=ether8add bridge=py1-lan interface=ether9add bridge=py1-lan interface=ether10/ip neighbor discovery-settingsset discover-interface-list=!dynamic/interface l2tp-server serverset use-ipsec=yes/interface list memberadd interface=guest-lan list=LANadd interface=py1-lan list=LANadd interface=WAN-FTTH list=WANadd interface=ether2 list=WAN/interface wireguard peersadd allowed-address=172.25.0.0/16 endpoint-address=SiteB-WAN2-IP \endpoint-port=51248 interface=WG-VPN-To-PY2 name=vpn-to-PY2 public-key=\""add allowed-address=10.22.19.2/32 interface=WG-client-to-site-PY1 name=\hangmmh public-key=""add allowed-address=10.22.19.1/32 interface=WG-client-to-site-PY1 name=bh.anh \public-key=""add allowed-address=10.22.19.3/32 interface=WG-client-to-site-PY1 name=\ngocmmh public-key=""add allowed-address=10.22.19.4/32 interface=WG-client-to-site-PY1 name=\damhammh public-key=""add allowed-address=10.22.19.5/32 interface=WG-client-to-site-PY1 name=\hung.bravo public-key=""add allowed-address=10.22.19.6/32 interface=WG-client-to-site-PY1 name=\hoangbravo public-key=""add allowed-address=10.22.19.7/32 interface=WG-client-to-site-PY1 name=\bh.anh2 public-key=""add allowed-address=10.22.19.8/32 interface=WG-client-to-site-PY1 name=\bh.anh3 public-key=""add allowed-address=10.22.19.9/32 interface=WG-client-to-site-PY1 name=\lanbravo public-key=""add allowed-address=10.22.19.10/32 interface=WG-client-to-site-PY1 name=\nm.hung public-key=""/ip addressadd address=10.22.10.254/24 interface=py1-lan network=10.22.10.0add address=10.0.255.254/24 interface=guest-lan network=10.0.255.0add address=202.151.163.46/30 interface=ether2 network=202.151.163.44add address=10.22.0.254/30 interface=WG-VPN-To-PY2 network=10.22.0.252add address=10.22.19.254/24 interface=WG-client-to-site-PY1 network=\10.22.19.0/ip cloudset ddns-enabled=yes/ip dhcp-server networkadd address=10.0.255.0/24 gateway=10.0.255.254add address=10.22.10.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.22.10.254/ip dnsset servers=8.8.8.8,8.8.4.4/ip firewall address-listadd address=172.20.0.0/16 list=LANadd address=10.0.255.0/24 list=LANadd address=10.22.10.0/24 list=LANadd address=thuedientu.gdt.gov.vn list=traffic-via-ILLadd address=172.25.0.0/16 list=VPNadd address=tracuunnt.gdt.gov.vn list=traffic-via-ILLadd address=vieclamthainguyen.gov.vn list=traffic-via-ILLadd address=sn.mynetname.net list=WANadd address=dichvucong.thainguyen.gov.vn list=traffic-via-ILLadd address=hoadondientu.gdt.gov.vn list=traffic-via-ILLadd address=www.gdt.gov.vnlist=traffic-via-ILLadd address=thainguyen.gov.vn list=traffic-via-ILLadd address=canhan.gdt.gov.vn list=traffic-via-ILLadd address=kcn.thainguyen.gov.vn list=traffic-via-ILLadd address=speedtest.vn list=traffic-via-ILL/ip firewall filteradd action=accept chain=input comment="allow WireGuard" dst-port=12677 \protocol=udpadd action=accept chain=input src-address=10.22.19.0/24add action=accept chain=input dst-port=51248 protocol=udp src-address=\SiteB-WAN1-IPadd action=accept chain=input dst-port=51248 protocol=udp src-address=\SiteB-WAN2-IP/ip firewall natadd action=dst-nat chain=dstnat dst-address=WAN1-IP dst-port=443 \protocol=tcp to-addresses=10.22.10.253 to-ports=443add action=dst-nat chain=dstnat dst-address=WAN2-IP dst-port=443 \protocol=tcp to-addresses=10.22.10.253 to-ports=443add action=masquerade chain=srcnat out-interface=WAN-FTTH to-addresses=\WAN1-IPadd action=masquerade chain=srcnat out-interface=ether2 to-addresses=\WAN2-IP/ip ipsec profileset [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5/ip routeadd disabled=no distance=1 dst-address=172.20.0.0/16 gateway=10.22.10.253 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add disabled=no distance=1 dst-address=172.25.0.0/16 gateway=WG-VPN-To-PY2 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add disabled=no distance=1 dst-address=10.22.20.0/24 gateway=10.22.0.253 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add check-gateway=ping disabled=no distance=4 dst-address=0.0.0.0/0 gateway=\WAN2-Gateway-IP routing-table=main scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN2-Gateway-IP routing-table=ILL-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN1-Gateway-IP routing-table=FTTH-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=2 dst-address=0.0.0.0/0 gateway=\8.8.8.8 routing-table=main scope=10 suppress-hw-offload=no target-scope=\12add check-gateway=ping disabled=no distance=2 dst-address=8.8.8.8/32 gateway=\WAN1-Gateway-IP routing-table=main scope=10 suppress-hw-offload=no \target-scope=11/ip serviceset telnet disabled=yesset ftp disabled=yesset www disabled=yesset ssh disabled=yesset api disabled=yesset api-ssl disabled=yes/lcdset time-interval=daily/system clockset time-zone-name=Asia/Ho_Chi_Minh/system identityset name=PY1-router-mikrotik/system noteset show-at-login=no/system ntp clientset enabled=yes/system ntp client serversadd address=vn.pool.ntp.org/tool e-mailset from=1@gmail.comport=465 server=smtp.gmail.com tls=yes user=\1@gmail.comSite B:# 2024-12-22 07:29:16 by RouterOS 7.16.2# software id = 2M0R-ULGQ## model = CCR2004-16G-2S+# serial number =/interface bridgeadd name=guest-lanadd name=py2-lan/interface ethernetset [ find default-name=ether1 ] comment=WAN-FTTHset [ find default-name=ether2 ] comment=WAN-ILL/interface pppoe-clientadd disabled=no interface=ether1 name=netnam-ftth user=netnam_manitn2/interface wireguardadd listen-port=51248 mtu=1420 name=WG-VPN-To-PY1add listen-port=35359 mtu=1420 name=wg-vpn-client-to-PY2/interface listadd name=LAN/ip pooladd name=dhcp_pool0 ranges=10.255.255.1-10.255.255.250/ip dhcp-serveradd address-pool=dhcp_pool0 interface=guest-lan lease-time=8h name=dhcp1/portset 0 name=serial0set 1 name=serial1/routing tableadd disabled=no fib name=FTTH-tableadd disabled=no fib name=ILL-table/interface bridge portadd bridge=py2-lan interface=ether16add bridge=py2-lan interface=ether15add bridge=py2-lan interface=ether14add bridge=py2-lan interface=ether13add bridge=guest-lan interface=ether12/ip neighbor discovery-settingsset discover-interface-list=!dynamic/interface list memberadd interface=guest-lan list=LANadd interface=py2-lan list=LAN/interface wireguard peersadd allowed-address=172.20.0.0/16 endpoint-address=SiteB-WAN2-IP \endpoint-port=51248 interface=WG-VPN-To-PY1 name=vpn-to-PY1 public-key=\""add allowed-address=10.22.29.1/24 interface=wg-vpn-client-to-PY2 name=bh.anh \public-key=""/ip addressadd address=10.22.20.254/24 interface=py2-lan network=10.22.20.0add address=10.255.255.254/24 interface=guest-lan network=10.255.255.0add address=101.96.76.126/30 interface=ether2 network=101.96.76.124add address=10.22.0.253/30 interface=WG-VPN-To-PY1 network=10.22.0.252add address=10.22.29.254/24 interface=wg-vpn-client-to-PY2 network=10.22.29.0/ip cloudset ddns-enabled=yes/ip dhcp-server networkadd address=10.255.255.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.255.255.254/ip dnsset servers=8.8.8.8,8.8.4.4/ip firewall address-listadd address=172.25.0.0/16 list=LANadd address=10.255.255.0/24 list=LANadd address=10.22.20.0/24 list=LANadd address=10.22.29.0/24 list=VPNadd address=172.20.0.0/16 list=VPN/ip firewall filteradd action=accept chain=input dst-port=35359 protocol=udpadd action=accept chain=input src-address=10.22.29.0/24add action=accept chain=input dst-port=51248 protocol=udp src-address=\SiteA-WAN1-IPadd action=accept chain=input dst-port=51248 protocol=udp src-address=\SiteA-WAN2-IP/ip firewall natadd action=dst-nat chain=dstnat dst-address=WAN2-IP dst-port=443 \protocol=tcp to-addresses=10.22.20.253 to-ports=443add action=dst-nat chain=dstnat dst-address=WAN1-IP dst-port=443 \protocol=tcp to-addresses=10.22.20.253 to-ports=443add action=masquerade chain=srcnat out-interface=netnam-ftth to-addresses=\WAN1-IPadd action=masquerade chain=srcnat out-interface=ether2 to-addresses=\WAN2-IP/ip ipsec profileset [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5/ip routeadd check-gateway=ping disabled=no distance=4 dst-address=0.0.0.0/0 gateway=\WAN2-Gateway-IP routing-table=main scope=30 suppress-hw-offload=no \target-scope=10add disabled=no distance=4 dst-address=10.22.10.0/24 gateway=10.22.0.254 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN1-Gateway-IP routing-table=FTTH-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN2-Gateway-IP routing-table=ILL-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=2 dst-address=0.0.0.0/0 gateway=\8.8.8.8 routing-table=main scope=10 suppress-hw-offload=no target-scope=\12add disabled=no distance=1 dst-address=172.20.0.0/16 gateway=WG-VPN-To-PY1 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add disabled=no dst-address=172.25.0.0/16 gateway=10.22.20.253 routing-table=\main suppress-hw-offload=noadd check-gateway=ping disabled=no distance=2 dst-address=8.8.8.8/32 gateway=\WAN1-Gateway-IP routing-table=main scope=10 suppress-hw-offload=no \target-scope=11/ip serviceset telnet disabled=yesset ftp disabled=yesset www disabled=yesset ssh disabled=yesset api disabled=yesset api-ssl disabled=yes/system clockset time-zone-name=Asia/Ho_Chi_Minh/system identityset name=PY2-Mikrotik-Router/system noteset show-at-login=no/system ntp clientset enabled=yes/system ntp client serversadd address=vn.pool.ntp.org/system routerboard settingsset enter-setup-on=delete-key


---
### Author: Sun Dec 22, 2024 4:52 pm
Date: Unknown

```
# 2024-12-22 07:27:56 by RouterOS 7.16.2
# software id = 9931-M8FK
#
# model = CCR1016-12G
# serial number =
/interface bridge
add name=guest-lan
add name=py1-lan
/interface ethernet
set [ find default-name=ether1 ] comment=WAN-FTTH
set [ find default-name=ether2 ] comment=WAN-ILL
/interface pppoe-client
add disabled=no interface=ether1 name=WAN-FTTH user=netnam_manipy
/interface wireguard
add listen-port=51248 mtu=1420 name=WG-RouterA
/interface list
add name=LAN
add name=WAN
add name=TRUSTED
/interface wireless security-profiles
set [ find default=yes ] supplicant-identity=MikroTik
/ip pool
add name=dhcp_pool0 ranges=10.0.255.1-10.0.255.253
add name=dhcp_pool1 ranges=10.22.10.10-10.22.10.200
/ip dhcp-server
add address-pool=dhcp_pool0 interface=guest-lan lease-time=1d name=guest-dhcp
add address-pool=dhcp_pool1 interface=py1-lan lease-time=8h name=dhcp1
/port
set 0 name=serial0
set 1 name=serial1
/interface bridge port
add bridge=guest-lan interface=ether8
add bridge=py1-lan interface=ether9
add bridge=py1-lan interface=ether10
add bridge=py1-lan interface=ether11
add bridge=py1-lan interface=ether12
/ip neighbor discovery-settings
set discover-interface-list=TRUSTED
/interface l2tp-server server
set use-ipsec=yes
/interface list member
add interface=WAN-FTTH list=WAN
add interface=ether2 list=WAN
add interface=guest-lan list=LAN
add interface=py1-lan list=LAN
add interface=WG-RouterA list=LAN
add interface=py1-lan list=TRUSTED
add interface=WG-RouterA list=TRUSTED
/interface wireguard peers
add allowed-address=10.22.0.2/32,10.22.20.0/24  interface=WG-RouterA  public-key="--"  comment="site to site"
add allowed-address=10.22.19.1/32 interface=WG-RouterA  name=bh.anh public-key=""
add allowed-address=10.22.19.2/32 interface=WG-RouterA  name=hangmmh public-key=""
add allowed-address=10.22.19.3/32 interface=WG-RouterA  name=ngocmmh public-key=""
add allowed-address=10.22.19.4/32 interface=WG-RouterA  name=damhammh public-key=""
add allowed-address=10.22.19.5/32 interface=WG-RouterA  name=hung.bravo public-key=""
add allowed-address=10.22.19.6/32 interface=WG-RouterA  name=hoangbravo public-key=""
add allowed-address=10.22.19.7/32 interface=WG-RouterA name=bh.anh2 public-key=""
add allowed-address=10.22.19.8/32 interface=WG-RouterA name=bh.anh3 public-key=""
add allowed-address=10.22.19.9/32 interface=WG-RouterA name=lanbravo public-key=""
add allowed-address=10.22.19.10/32 interface=WG-RouterA name=nm.hung public-key=""
/ip address
add address=202.151.163.46/30 interface=ether2 network=202.151.163.44
add address=10.22.10.254/24 interface=py1-lan network=10.22.10.0
add address=10.0.255.254/24 interface=guest-lan network=10.0.255.0
add address=10.22.0.1/30 interface=WG-RouterA network=10.22.0.0 comment="site to site"
add address=10.22.19.254/24 interface=WG-RouterA network=10.22.19.0 comment="remote users"
/ip cloud
set ddns-enabled=yes
/ip dhcp-server network
add address=10.0.255.0/24 gateway=10.0.255.254
add address=10.22.10.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.22.10.254
/ip dns
set servers=8.8.8.8,8.8.4.4
/ip firewall address-list
add address=10.22.10.XX  list=AUTHORIZED  comment="local admin pc"
add address=10.22.10.YY list=AUTHORIZED comment="local admin device2"
add address=10.22.19.AB list=AUTHORIZED comment="remote wg admin laptop"
add address=10.22.19.CD list=AUTHORIZED comment="remote wg admin smartphone/ipad"
add address=10.22.20.EF  list=AUTHORIZED comment="admin local IP at RouterB"
add address=10.22.20.GH  list=AUTHORIZED comment="admin local IP at RouterB device 2"
/ip firewall filter
add action=accept chain=input connection-state=established,related,untracked
add action=drop chain=input  connection-state=invalid
add action=accept chain=input  protocol=icmp
add action=accept chain=input dst-address=127.0.0.1
add action=accept chain=input comment="wireguard handshake" dst-port=51248
add action=accept chain=input comment="admin access" src-address=list=AUTHORIZED
add action=accept chain=input comment="users to services" in-interface-list=LAN dst-port=53,123 protocol=udp
add action=accept chain=input comment="users to services" in-interface-list=LAN dst-port=53 protocol=tcp
add action=drop chain=input comment="Drop all else"  { make this rule last }
+++++++++++++++++++++++++++
add action=fasttrack-connection chain=forward connection-state=established,related hw-offload=yes
add action=accept chain=forward connection-state=established,related,untracked
add action=drop chain=forward connection-state=invalid
add action=accept chain=forward comment="internet traffic"  in-interface-list=LAN out-interface-list=WAN
add action=accept chain=forward commeint="RB to RA" in-interface=WG-RouterA src-address=10.22.20.0/24 dst-address=10.22.10.0/24
add action=accept chain=forward comment="RA to RB" out-interface=WG-RouterA src-address=10.22.10.0/24 dst-address=10.22.20.0/24
add action=accept chain=forward comment="remote users to RA" in-interface=WG-RouterA src-address=10.22.19.0/24 dst-address=10.22.10.0/24
add action=accept chain=forward comment="relay remote to RB" in-interface=WG-RouterA src-address=10.22.19.0/24 out-interface=WG-RouterA
add action=accept chain=forward comment="admin access" src-address-list=Authorized out-interface-list=LAN
add action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat
add action=drop chain=forward comment="drop all else"
/ip firewall nat
add action=masquerade chain=srcnat out-interface=WAN-FTTH 
add action=masquerade chain=srcnat out-interface=ether2 
add action=dst-nat chain=dstnat in-interface-list=WAN dst-port=443 protocol=tcp to-addresses=10.22.10.253
/ip route
{ Main routes for backup }
add  check-gateway=ping dst-address=0.0.0.0/0 gateway=1.0.0.1 routing-table=main scope=10 target-scope=12
add  dst-address=1.0.0.1/32 gateway=WAN1-Gateway-IP routing-table=main scope=10 target-scope=11
++++++++++++++++
add check-gateway=ping  distance=2 dst-address=0.0.0.0/0 gateway=WAN2-Gateway-IP routing-table=main
++++++++++++++++
{ to ensure traffic to Router B subnet }
add dst-address=10.22.20.0/24 gateway=WG-RouterA  routing-table=main
+++++++++++++++
{ special route for wireguard to wan2 }
add dst-address=ip.of.siteB.wan2/32 gateway=ip.or.siteA.wan2-gw
/ip service
set telnet disabled=yes
set ftp disabled=yes
set www disabled=yes
set ssh disabled=yes
set api disabled=yes
set api-ssl disabled=yes
/lcd
set time-interval=daily
/system clock
set time-zone-name=Asia/Ho_Chi_Minh
/system identity
set name=PY1-router-mikrotik
/system note
set show-at-login=no
/system ntp client
set enabled=yes
/system ntp client servers
add address=vn.pool.ntp.org
/tool mac-server
set allowed-interface-list=none
/tool mac-server mac-winbox
set allowed-interface-list=TRUSTED
/tool e-mail
set from=1@gmail.com port=465 server=smtp.gmail.com tls=yes user=\
1@gmail.com
```

```
# 2024-12-22 07:29:16 by RouterOS 7.16.2
# software id = 2M0R-ULGQ
#
# model = CCR2004-16G-2S+
# serial number =
/interface bridge
add name=guest-lan
add name=py2-lan
/interface ethernet
set [ find default-name=ether1 ] comment=WAN-FTTH
set [ find default-name=ether2 ] comment=WAN-ILL
/interface pppoe-client
add disabled=no interface=ether1 name=netnam-ftth user=netnam_manitn2
/interface wireguard
add listen-port=35359 mtu=1420 name=WG-RouterB
/interface list
add name=LAN
add name=WAN
add name=TRUSTED
/ip pool
add name=dhcp_pool0 ranges=10.255.255.1-10.255.255.250
add name=dhcp_pool2 ranges=10.22.20.1-10.22.20.250
/ip dhcp-server
add address-pool=dhcp_pool0 interface=guest-lan lease-time=8h name=dhcp1
add address-pool=dhcp_pool2 interface=py2-lan lease-time=8h name=dhcp2
/port
set 0 name=serial0
set 1 name=serial1
/interface bridge port
add bridge=py2-lan interface=ether16
add bridge=py2-lan interface=ether15
add bridge=py2-lan interface=ether14
add bridge=py2-lan interface=ether13
add bridge=guest-lan interface=ether12
/ip neighbor discovery-settings
set discover-interface-list=TRUSTED
/interface list member
add interface=netnam-ftth list=WAN
add interface=ether2 list=WAN
add interface=guest-lan list=LAN
add interface=py2-lan list=LAN
add interface=py2-lan list=TRUSTED
add interface=WG-RouterB list=TRUSTED
/interface wireguard peers
add allowed-address=10.22.0.1/32, 10.22.19.0/24,10.22.10.0/24 endpoint-address=SiteB-WAN2-IP \
endpoint-port=51248 interface=WG-RouterB  persistent-keep-alive=25s  public-key="----"
/ip address
add address=10.22.20.254/24 interface=py2-lan network=10.22.20.0
add address=10.255.255.254/24 interface=guest-lan network=10.255.255.0
add address=101.96.76.126/30 interface=ether2 network=101.96.76.124
add address=10.22.0.2/30 interface=WG-RouterB network=10.22.0.0
/ip cloud
set ddns-enabled=yes
/ip dhcp-server network
add address=10.255.255.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.255.255.254
add address=10.22.20.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.22.20.254
/ip dns
set servers=8.8.8.8,8.8.4.4
/ip firewall address-list
add address=10.22.10.XX  list=AUTHORIZED  comment="admin local IP at RouterA"
add address=10.22.10.YY list=AUTHORIZED comment="admin local IP at RouterA device2"
add address=10.22.19.AB list=AUTHORIZED comment="remote wg admin laptop"
add address=10.22.19.CD list=AUTHORIZED comment="remote wg admin smartphone/ipad"
add address=10.22.20.EF  list=AUTHORIZED comment="local admin IP"
add address=10.22.20.GH  list=AUTHORIZED comment="local admin IP device 2"
/ip firewall filter
add action=accept chain=input connection-state=established,related,untracked
add action=drop chain=input  connection-state=invalid
add action=accept chain=input  protocol=icmp
add action=accept chain=input dst-address=127.0.0.1
add action=accept chain=input comment="admin access" src-address=list=AUTHORIZED
add action=accept chain=input comment="users to services"  in-interface-list=LAN dst-port=53,123 protocol=udp
add action=accept chain=input comment="users to services"  in-interface-list=LAN dst-port=53 protocol=tcp
add action=drop chain=input comment="Drop all else"  make this rule last 
+++++++++++++++++++++++++++
add action=fasttrack-connection chain=forward connection-state=established,related hw-offload=yes
add action=accept chain=forward connection-state=established,related,untracked
add action=drop chain=forward connection-state=invalid
add action=accept chain=forward comment="internet traffic"  in-interface-list=LAN out-interface-list=WAN
add action=accept chain=forward commeint="RA to RB"  in-interface=WG-RouterB  src-address=10.22.10.0/24  dst-address=10.22.20.0/24
add action=accept chain=forward comment="RB to RB"  out-interface=WG-RouterB  src-address=10.22.20.0/24  dst-address=10.22.10.0/24
add action=accept chain=forward comment="remote users to RB"  in-interface=WG-RouterB src-address=10.22.19.0/24 dst-address=10.22.20.0/24
add action=accept chain=forward comment="admin access"  src-address-list=AUTHORIZED out-interface-list=LAN
add action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat
add action=drop chain=forward comment="drop all else"
/ip firewall nat
add action=masquerade chain=srcnat out-interface-list=WAN
add action=dst-nat chain=dstnat in-interface-list=WAN dst-port=443 protocol=tcp to-addresses=10.22.20.253
/ip firewall mangle
add action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=WG-RouterB passthrough=yes protocol=tcp tcp-flags=syn
/ip route
{ Main routes for backup }
add  check-gateway=ping dst-address=0.0.0.0/0 gateway=1.1.1.1 routing-table=main scope=10 target-scope=12
add  dst-address=1.1.1.1/32 gateway=WAN1-Gateway-IP routing-table=main scope=10 target-scope=11
++++++++++++++++
add check-gateway=ping  distance=2 dst-address=0.0.0.0/0 gateway=WAN2-Gateway-IP routing-table=main
++++++++++++++++
{ to ensure traffic to Router A subnet }
add dst-address=10.22.10.0/24 gateway=WG-RouterA  routing-table=main
{ to ensure return traffic for remote wg users }
add dst-address=10.22.19.0/24  gateway=WG-RouterB  routing-table=main
+++++++++++++++
{ special route for wireguard to wan2 }
add dst-address=ip.of.siteA.wan2/32 gateway=ip.or.siteB.wan2-gw
/ip service
set telnet disabled=yes
set ftp disabled=yes
set www disabled=yes
set ssh disabled=yes
set api disabled=yes
set api-ssl disabled=yes
/system clock
set time-zone-name=Asia/Ho_Chi_Minh
/system identity
set name=PY2-Mikrotik-Router
/system note
set show-at-login=no
/system ntp client
set enabled=yes
/system ntp client servers
add address=vn.pool.ntp.org
/tool mac-server
set allowed-interface-list=none
/tool mac-server mac-winbox
set allowed-interface-list=TRUSTED
/system routerboard settings
set enter-setup-on=delete-key
```

Okay, I see what Sindy means now..........  possible due to all static public IP addresses...Further its simply router to router connectivity no need to go out internet of the other.....Thus Router B being peer client will send wireguard handshake and due to SIndys rule go out its WAN2 ( heading for WAN2 of Router A)Router A will respond to the handshake and using its static route ensure the reply goes out its WAN2.+++++++++++++++++++Thus we avoid mangling rules or routing rules altogether and also getting rid of two Wireguard interfaces, when only one is required.Simplify where possible is a decent MT motto.Also in your config,  besides some allowed IPs missing the wireguard address (site to site) you have some weird non-existant IPs in the mix  172.25.xx  AND 172.20.xxWhat I did do is create two subnets for the single wireguard interface separating remote warrior access to Router A and the site to site between Router A and Router B, for some clarity.Simplified dstnat rules and masquerade rules.Site A:....Code:Select all...............Missing pool for main lan???Missing interface list entries???Site B:...............Code:Select all


---
### Author: Mon Dec 23, 2024 5:13 pm
Date: Unknown

Here is my 2 factory's network diagram:Currently, I have configured remote access on each router, no need to access other one's network.Wireguard site to site between 2 factory is now using WAN2.Wireguard client to site VPN still using WAN1, how can I make these connection usng WAN2.Another issue, I cannot connect to WAN2 by winbox on both Router.I make WAN2 primary but still not work, while WAN1 still accessible, I think it's cause maybe by ISP's Security.Current config after following anav's advice:Router A:# 2024-12-23 21:51:14 by RouterOS 7.16.2# software id = 9931-M8FK## model = CCR1016-12G/interface bridgeadd name=guest-lanadd name=py1-lan/interface ethernetset [ find default-name=ether1 ] comment=WAN-FTTHset [ find default-name=ether2 ] comment=WAN-ILL/interface pppoe-clientadd disabled=no interface=ether1 name=WAN-FTTH user=netnam_manipy/interface wireguardadd listen-port=51248 mtu=1420 name=PY1-Wireguard/interface listadd name=LANadd name=WAN/interface wireless security-profilesset [ find default=yes ] supplicant-identity=MikroTik/ip pooladd name=dhcp_pool0 ranges=10.0.255.1-10.0.255.253add name=dhcp_pool1 ranges=10.22.10.10-10.22.10.200/ip dhcp-serveradd address-pool=dhcp_pool0 interface=guest-lan lease-time=1d name=guest-dhcpadd address-pool=dhcp_pool1 interface=py1-lan lease-time=8h name=dhcp1/portset 0 name=serial0set 1 name=serial1/routing tableadd disabled=no fib name=FTTH-tableadd disabled=no fib name=ILL-table/interface bridge portadd bridge=py1-lan interface=ether11add bridge=py1-lan interface=ether12add bridge=guest-lan interface=ether8add bridge=py1-lan interface=ether9add bridge=py1-lan interface=ether10/ip neighbor discovery-settingsset discover-interface-list=!dynamic/interface l2tp-server serverset use-ipsec=yes/interface list memberadd interface=guest-lan list=LANadd interface=py1-lan list=LANadd interface=WAN-FTTH list=WANadd interface=ether2 list=WAN/interface wireguard peersadd allowed-address=172.25.0.0/16 endpoint-address=RouterB-WAN2-IP \endpoint-port=51248 interface=PY1-Wireguard name=vpn-to-PY2 public-key=\"1"add allowed-address=10.22.0.2/32 interface=PY1-Wireguard name=hangmmh \public-key="1"add allowed-address=10.22.0.1/32 interface=PY1-Wireguard name=bh.anh \public-key="1"add allowed-address=10.22.0.3/32 interface=PY1-Wireguard name=ngocmmh \public-key="1"add allowed-address=10.22.0.4/32 interface=PY1-Wireguard name=damhammh \public-key="1"add allowed-address=10.22.0.5/32 interface=PY1-Wireguard name=hung.bravo \public-key="1"add allowed-address=10.22.0.6/32 interface=PY1-Wireguard name=hoangbravo \public-key="1"add allowed-address=10.22.0.7/32 interface=PY1-Wireguard name=bh.anh2 \public-key="1"add allowed-address=10.22.0.8/32 interface=PY1-Wireguard name=bh.anh3 \public-key="1"add allowed-address=10.22.0.9/32 interface=PY1-Wireguard name=lanbravo \public-key="1"add allowed-address=10.22.0.10/32 interface=PY1-Wireguard name=nm.hung \public-key="1"/ip addressadd address=10.22.10.254/24 interface=py1-lan network=10.22.10.0add address=10.0.255.254/24 interface=guest-lan network=10.0.255.0add address=WAN2-IP interface=ether2 network=WAN2-DG-IPadd address=10.22.0.254/24 interface=PY1-Wireguard network=10.22.0.0/ip cloudset ddns-enabled=yes/ip dhcp-server networkadd address=10.0.255.0/24 gateway=10.0.255.254add address=10.22.10.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.22.10.254/ip dnsset servers=8.8.8.8,8.8.4.4/ip firewall address-listadd address=172.20.0.0/16 list=LANadd address=10.0.255.0/24 list=LANadd address=10.22.10.0/24 list=LANadd address=thuedientu.gdt.gov.vn list=traffic-via-ILLadd address=172.25.0.0/16 list=VPNadd address=tracuunnt.gdt.gov.vn list=traffic-via-ILLadd address=vieclamthainguyen.gov.vn list=traffic-via-ILLadd address=dichvucong.thainguyen.gov.vn list=traffic-via-ILLadd address=hoadondientu.gdt.gov.vn list=traffic-via-ILLadd address=www.gdt.gov.vnlist=traffic-via-ILLadd address=thainguyen.gov.vn list=traffic-via-ILLadd address=canhan.gdt.gov.vn list=traffic-via-ILLadd address=kcn.thainguyen.gov.vn list=traffic-via-ILLadd address=10.22.0.0/24 list=VPNadd address=speedtest.vn list=traffic-via-ILLadd address=smartone.vps.com.vn list=traffic-via-ILL/ip firewall filteradd action=accept chain=input dst-port=51248 in-interface-list=WAN protocol=\udp/ip firewall mangleadd action=mark-routing chain=prerouting dst-address-list=traffic-via-ILL \dst-address-type=!local new-routing-mark=ILL-table passthrough=yes \src-address-list=LAN/ip firewall natadd action=dst-nat chain=dstnat dst-port=443 in-interface-list=WAN protocol=\tcp to-addresses=10.22.10.253 to-ports=443add action=masquerade chain=srcnat out-interface-list=WAN/ip ipsec profileset [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5/ip routeadd disabled=no distance=1 dst-address=172.20.0.0/16 gateway=10.22.10.253 \	*To RouterA's Factory LAN*routing-table=main scope=30 suppress-hw-offload=no target-scope=10add disabled=no distance=1 dst-address=172.25.0.0/16 gateway=PY1-Wireguard \	*To RouterB's Factory LAN*routing-table=main scope=30 suppress-hw-offload=no target-scope=10add disabled=no distance=1 dst-address=10.22.20.0/24 gateway=10.22.0.253 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add check-gateway=ping disabled=no distance=4 dst-address=0.0.0.0/0 gateway=\WAN2-DG-IP routing-table=main scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN2-IP routing-table=ILL-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN1-DG-IP routing-table=FTTH-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=2 dst-address=0.0.0.0/0 gateway=\8.8.8.8 routing-table=main scope=10 suppress-hw-offload=no target-scope=\12add check-gateway=ping disabled=no distance=2 dst-address=8.8.8.8/32 gateway=\WAN1-DG-IP routing-table=main scope=10 suppress-hw-offload=no \target-scope=11add comment=vpn-to-py2 disabled=no distance=1 dst-address=RouterB-WAN2-IP \gateway=RouterA-WAN2-DG-IP routing-table=main scope=30 suppress-hw-offload=no \target-scope=10/ip serviceset telnet disabled=yesset ftp disabled=yesset www disabled=yesset ssh disabled=yesset api disabled=yesset api-ssl disabled=yes/lcdset time-interval=daily/system clockset time-zone-name=Asia/Ho_Chi_Minh/system identityset name=PY1-router-mikrotik/system noteset show-at-login=no/system ntp clientset enabled=yes/system ntp client serversadd address=vn.pool.ntp.org/tool e-mailset from="" server=smtp.gmail.com tls=yesRouter B:# 2024-12-23 21:53:09 by RouterOS 7.16.2# software id = 2M0R-ULGQ## model = CCR2004-16G-2S+/interface bridgeadd name=guest-lanadd name=py2-lan/interface ethernetset [ find default-name=ether1 ] comment=WAN-FTTHset [ find default-name=ether2 ] comment=WAN-ILL/interface pppoe-clientadd disabled=no interface=ether1 name=netnam-ftth user=netnam_manitn2/interface wireguardadd listen-port=51248 mtu=1420 name=PY2-Wireguard/interface listadd name=LANadd name=WAN/ip pooladd name=dhcp_pool0 ranges=10.255.255.1-10.255.255.250/ip dhcp-serveradd address-pool=dhcp_pool0 interface=guest-lan lease-time=8h name=dhcp1/portset 0 name=serial0set 1 name=serial1/routing tableadd disabled=no fib name=FTTH-tableadd disabled=no fib name=ILL-table/interface bridge portadd bridge=py2-lan interface=ether16add bridge=py2-lan interface=ether15add bridge=py2-lan interface=ether14add bridge=py2-lan interface=ether13add bridge=guest-lan interface=ether12/ip neighbor discovery-settingsset discover-interface-list=!dynamic/interface list memberadd interface=guest-lan list=LANadd interface=py2-lan list=LANadd interface=netnam-ftth list=WANadd interface=ether2 list=WAN/interface wireguard peersadd allowed-address=172.20.0.0/16 endpoint-address=RouterA-WAN2-IP \endpoint-port=51248 interface=PY2-Wireguard name=vpn-to-PY1 \persistent-keepalive=25s public-key=\"1"add allowed-address=10.22.29.1/24 interface=PY2-Wireguard name=bh.anh \public-key="1"/ip addressadd address=10.22.20.254/24 interface=py2-lan network=10.22.20.0 	*RouterB's LAN*add address=10.255.255.254/24 interface=guest-lan network=10.255.255.0 	*Guest LAN*add address=WAN2-IP interface=ether2 network=WAN2-DG-IP			*WAN2*add address=10.22.0.253/24 interface=PY2-Wireguard network=10.22.0.0	*PY2-Wireguard*/ip cloudset ddns-enabled=yes/ip dhcp-server networkadd address=10.255.255.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.255.255.254/ip dnsset servers=8.8.8.8,8.8.4.4/ip firewall address-listadd address=172.25.0.0/16 list=LANadd address=10.255.255.0/24 list=LANadd address=10.22.20.0/24 list=LANadd address=10.22.29.0/24 list=VPNadd address=172.20.0.0/16 list=VPN/ip firewall filteradd action=accept chain=input dst-port=51248 in-interface-list=WAN protocol=\udp/ip firewall natadd action=dst-nat chain=dstnat dst-port=443 in-interface-list=WAN protocol=\tcp to-addresses=10.22.20.253 to-ports=443add action=masquerade chain=srcnat out-interface-list=WAN to-addresses=\14.241.82.232/ip ipsec profileset [ find default=yes ] dpd-interval=2m dpd-maximum-failures=5/ip routeadd check-gateway=ping disabled=no distance=4 dst-address=0.0.0.0/0 gateway=\WAN2-DG-IP routing-table=main scope=30 suppress-hw-offload=no \target-scope=10add disabled=no distance=4 dst-address=10.22.10.0/24 gateway=10.22.0.254 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN1-DG-IP routing-table=FTTH-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=1 dst-address=0.0.0.0/0 gateway=\WAN2-DG-IP routing-table=ILL-table scope=30 suppress-hw-offload=no \target-scope=10add check-gateway=ping disabled=no distance=2 dst-address=0.0.0.0/0 gateway=\8.8.8.8 routing-table=main scope=10 suppress-hw-offload=no target-scope=\12add disabled=no distance=1 dst-address=172.20.0.0/16 gateway=PY2-Wireguard \	*To RouterA's Facotry LAN*routing-table=main scope=30 suppress-hw-offload=no target-scope=10add disabled=no dst-address=172.25.0.0/16 gateway=10.22.20.253 routing-table=\	*To RouterB's Factory LAN*main suppress-hw-offload=noadd check-gateway=ping disabled=no distance=2 dst-address=8.8.8.8/32 gateway=\WAN1-DG-IP routing-table=main scope=10 suppress-hw-offload=no \target-scope=11add comment=vpn-to-py1 disabled=no distance=1 dst-address=RouterA-WAN2-IP \gateway=WAN2-DG-IP routing-table=main scope=30 suppress-hw-offload=no \target-scope=10/ip serviceset telnet disabled=yesset ftp disabled=yesset www disabled=yesset ssh disabled=yesset api disabled=yesset api-ssl disabled=yes/system clockset time-zone-name=Asia/Ho_Chi_Minh/system identityset name=PY2-Mikrotik-Router/system noteset show-at-login=no/system ntp clientset enabled=yes/system ntp client serversadd address=vn.pool.ntp.org/system routerboard settingsset enter-setup-on=delete-key


---
### Author: Tue Dec 24, 2024 11:28 am
Date: Unknown

@haianh, before diving any deeper into the topic of Wireguard on dual WAN, there is a serious security flaw in your configurations - you have got no firewall at all. By design, the default handling of packets in firewall is "accept". So whatever is not explicitly dropped is accepted. When any of the tutorials and videos here and there say "you must add an accept rule to make it work", they assume that at least the default firewall rules that come pre-set in the SOHO product line are in place. In your case, you have added thechain=input protocol=udp dst-port=51248 action=acceptrules to/ip firewall filterin order to allow incoming Wireguard traffic, but as there are no other rules in filter, all the incoming traffic that does not match to the rules you have added is accepted anyway due to the default being accept as well. The CCR product line is intended for use by networking professionals mostly in ISP networks where the requirements are site-specific so the default configuration contains no firewall rules, assuming that the administrators will add their own ones before connecting the device to the internet for the first time.So as you have public IP addresses on your CCRs themselves, the only things that prevent people who would like to also become their administrators from breaking in is the uniquity of your usernames and strength of your passwords on one hand and the security of of the Winbox server on the other one. Leaving Winbox access open to the world has not been considered safe since years ago - in the past, vulnerabilities in Winbox existed and have been exploited, and there may still be more ones, just not widely known and thus not patched yet.I will continue later regarding the failover routing and the "Wireguard via WAN 2" issue.


---
### Author: Tue Dec 24, 2024 5:25 pm
Date: Unknown

Regarding making the Wireguard respond via the interface through which the request came in, you following settings on Router B are necessary:/ip firewall natadd action=masquerade chain=srcnat out-interface-list=WAN(this one is already in place, I just reiterate it here because it is essential for the rest to work; also, as far as I am aware, theto-addressesparameter is ignored in case ofaction=masqueradeso I don't get why it even got exported. Also, forgot to obfuscate it so it reveals one of your public addresses, you may want to edit the post.)/ip route set [find where dst-address=0.0.0.0/0 gateway=WAN2-DG-IP] pref-src=WAN1-IPThis one is necessary for the situation where WAN1 is down so the initial round of routing finds a route via WAN2 - in order that the workaround to Wireguard's specific behavior worked, we have to make sure that the original source address of the Wireguard packets will be the WAN1 one even in this situation./ip firewall mangle add chain=prerouting in-interface=ether2 protocol=udp dst-port=51248 dst-address-type=local connection-state=new action=mark-connection new-connection-mark=ILL-cmThis one makes sure that connections created by incoming Wireguard connection attempts that arrive via WAN2 to router's own address will be marked, so that the outgoing packets belonging to these connection would be routed via WAN2./ip firewall mangle add chain=output connection-mark=ILL-cm action=mark-routing new-routing-mark=ILL-tableThis one tells the router to use the ILL table for the second round of routing of packets belonging to the connections marked withILL-cm./ip firewall nat add connection-mark=ILL-cm action=dst-nat to-addresses=WAN1-IPThis one makes sure that the connection tracking will properly un-dst-nat the packets whose original source address will be WAN1-IP to WAN2-IP.Such a setup is a slight overkill as compared to your requirements because it allows the roaming Wireguard peers to connect to either WAN1-IP or WAN2-IP. A setup that would only accept incoming Wireguard connections on WAN2-IP would be only a tad simpler - instead of marking the connections and assigning therouting-markbased onconnection-mark, it would assign the routing mark based onprotocol=udp src-port=51248.


---
### Author: Wed Dec 25, 2024 7:56 am
Date: Unknown

@haianh, before diving any deeper into the topic of Wireguard on dual WAN, there is a serious security flaw in your configurations - you have got no firewall at all. By design, the default handling of packets in firewall is "accept". So whatever is not explicitly dropped is accepted. When any of the tutorials and videos here and there say "you must add an accept rule to make it work", they assume that at least the default firewall rules that come pre-set in the SOHO product line are in place. In your case, you have added thechain=input protocol=udp dst-port=51248 action=acceptrules to/ip firewall filterin order to allow incoming Wireguard traffic, but as there are no other rules in filter, all the incoming traffic that does not match to the rules you have added is accepted anyway due to the default being accept as well. The CCR product line is intended for use by networking professionals mostly in ISP networks where the requirements are site-specific so the default configuration contains no firewall rules, assuming that the administrators will add their own ones before connecting the device to the internet for the first time.So as you have public IP addresses on your CCRs themselves, the only things that prevent people who would like to also become their administrators from breaking in is the uniquity of your usernames and strength of your passwords on one hand and the security of of the Winbox server on the other one. Leaving Winbox access open to the world has not been considered safe since years ago - in the past, vulnerabilities in Winbox existed and have been exploited, and there may still be more ones, just not widely known and thus not patched yet.I will continue later regarding the failover routing and the "Wireguard via WAN 2" issue.Hi sindy, if winbox is security risk, which option for remote management ?Beside, the config anav provided before have basic firewall is for block anything else that.


---
### Author: Thu Dec 26, 2024 10:49 pm
Date: Unknown

```
# 2024-12-22 07:27:56 by RouterOS 7.16.2
# software id = 9931-M8FK
#
# model = CCR1016-12G
# serial number =
/interface bridge
add name=guest-lan
add name=py1-lan
/interface ethernet
set [ find default-name=ether1 ] comment=WAN-FTTH
set [ find default-name=ether2 ] comment=WAN-ILL
/interface pppoe-client
add disabled=no interface=ether1 name=WAN-FTTH user=netnam_manipy
/interface wireguard
add listen-port=51248 mtu=1420 name=WG-RouterA
/interface list
add name=LAN
add name=WAN
add name=TRUSTED
/interface wireless security-profiles
set [ find default=yes ] supplicant-identity=MikroTik
/ip pool
add name=dhcp_pool0 ranges=10.0.255.1-10.0.255.253
add name=dhcp_pool1 ranges=10.22.10.10-10.22.10.200
/ip dhcp-server
add address-pool=dhcp_pool0 interface=guest-lan lease-time=1d name=guest-dhcp
add address-pool=dhcp_pool1 interface=py1-lan lease-time=8h name=dhcp1
/port
set 0 name=serial0
set 1 name=serial1
/interface bridge port
add bridge=guest-lan interface=ether8
add bridge=py1-lan interface=ether9
add bridge=py1-lan interface=ether10
add bridge=py1-lan interface=ether11
add bridge=py1-lan interface=ether12
/ip neighbor discovery-settings
set discover-interface-list=TRUSTED
/interface l2tp-server server
set use-ipsec=yes
/interface list member
add interface=WAN-FTTH list=WAN
add interface=ether2 list=WAN
add interface=guest-lan list=LAN
add interface=py1-lan list=LAN
add interface=WG-RouterA list=LAN
add interface=py1-lan list=TRUSTED
add interface=WG-RouterA list=TRUSTED
/interface wireguard peers
add allowed-address=10.22.0.2/32,172.25.0.0/24 interface=WG-RouterA  public-key="--"  comment="site to site"
add allowed-address=10.22.19.1/32 interface=WG-RouterA  name=bh.anh public-key=""
add allowed-address=10.22.19.2/32 interface=WG-RouterA  name=hangmmh public-key=""
add allowed-address=10.22.19.3/32 interface=WG-RouterA  name=ngocmmh public-key=""
add allowed-address=10.22.19.4/32 interface=WG-RouterA  name=damhammh public-key=""
add allowed-address=10.22.19.5/32 interface=WG-RouterA  name=hung.bravo public-key=""
add allowed-address=10.22.19.6/32 interface=WG-RouterA  name=hoangbravo public-key=""
add allowed-address=10.22.19.7/32 interface=WG-RouterA name=bh.anh2 public-key=""
add allowed-address=10.22.19.8/32 interface=WG-RouterA name=bh.anh3 public-key=""
add allowed-address=10.22.19.9/32 interface=WG-RouterA name=lanbravo public-key=""
add allowed-address=10.22.19.10/32 interface=WG-RouterA name=nm.hung public-key=""
/ip address
add address=202.151.163.46/30 interface=ether2 network=202.151.163.44
add address=10.22.10.254/24 interface=py1-lan network=10.22.10.0
add address=10.0.255.254/24 interface=guest-lan network=10.0.255.0
add address=10.22.0.1/30 interface=WG-RouterA network=10.22.0.0 comment="site to site"
add address=10.22.19.254/24 interface=WG-RouterA network=10.22.19.0 comment="remote users"
/ip cloud
set ddns-enabled=yes
/ip dhcp-server network
add address=10.0.255.0/24 gateway=10.0.255.254
add address=10.22.10.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.22.10.254
/ip dns
set servers=8.8.8.8,8.8.4.4
/ip firewall address-list
add address=10.22.10.XX  list=AUTHORIZED  comment="local admin pc"
add address=10.22.10.YY list=AUTHORIZED comment="local admin device2"
add address=10.22.19.AB list=AUTHORIZED comment="remote wg admin laptop"
add address=10.22.19.CD list=AUTHORIZED comment="remote wg admin smartphone/ipad"
add address=10.22.20.EF  list=AUTHORIZED comment="admin local IP at RouterB"
add address=10.22.20.GH  list=AUTHORIZED comment="admin local IP at RouterB device 2"
/ip firewall filter
add action=accept chain=input connection-state=established,related,untracked
add action=drop chain=input  connection-state=invalid
add action=accept chain=input  protocol=icmp
add action=accept chain=input dst-address=127.0.0.1
add action=accept chain=input comment="wireguard handshake" dst-port=51248
add action=accept chain=input comment="admin access" src-address=list=AUTHORIZED
add action=accept chain=input comment="users to services" in-interface-list=LAN dst-port=53,123 protocol=udp
add action=accept chain=input comment="users to services" in-interface-list=LAN dst-port=53 protocol=tcp
add action=drop chain=input comment="Drop all else"  { make this rule last }
+++++++++++++++++++++++++++
add action=fasttrack-connection chain=forward connection-state=established,related hw-offload=yes
add action=accept chain=forward connection-state=established,related,untracked
add action=drop chain=forward connection-state=invalid
add action=accept chain=forward comment="internet traffic"  in-interface-list=LAN out-interface-list=WAN
add action=accept chain=forward comment="remote users to RA" in-interface=WG-RouterA src-address=10.22.19.0/24 dst-address=10.22.10.0/24
add action=accept chain=forward comment="relay remote to RB" in-interface=WG-RouterA src-address=10.22.19.0/24 out-interface=WG-RouterA
add action=accept chain=forward comment="admin access" src-address-list=Authorized out-interface-list=LAN
add action=accept chain=forward comment="FGB to FGA"  in-interface=WG-RouterA src-address=175.25.0.0/24 dst-address=175.20.0.0/24 dst-port=443
add action=accept chain=forward comment="FGA to FGB"  out-interface=WG-RouterA src-address=175.20.0.0/24 dst-address=175.25.0.0/24 dst-port=443
add action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat
add action=drop chain=forward comment="drop all else"
/ip firewall nat
add action=masquerade chain=srcnat out-interface=WAN-FTTH 
add action=masquerade chain=srcnat out-interface=ether2 
/ip route
{ Main routes for backup }
add  check-gateway=ping dst-address=0.0.0.0/0 gateway=1.0.0.1 routing-table=main scope=10 target-scope=12
add  dst-address=1.0.0.1/32 gateway=WAN1-Gateway-IP routing-table=main scope=10 target-scope=11
++++++++++++++++
add check-gateway=ping  distance=2 dst-address=0.0.0.0/0 gateway=WAN2-Gateway-IP routing-table=main
++++++++++++++++
{ to ensure incoming RouterB Fortigate traffic gets to local FGA subnet }
add dst-address=175.20.0.0/24 gateway=10.22.10.253  routing-table=main
{ to ensure outgoing RouterA Fortigate traffic gets into tunnel for RouterB }
add dst-address=175.25.0.0/24  gateway=WG-RouterA  routing-table=main
+++++++++++++++
{ special route for wireguard to wan2 }
add dst-address=ip.of.siteB.wan2/32 gateway=ip.or.siteA.wan2-gw
/ip service
set telnet disabled=yes
set ftp disabled=yes
set www disabled=yes
set ssh disabled=yes
set api disabled=yes
set api-ssl disabled=yes
/lcd
set time-interval=daily
/system clock
set time-zone-name=Asia/Ho_Chi_Minh
/system identity
set name=PY1-router-mikrotik
/system note
set show-at-login=no
/system ntp client
set enabled=yes
/system ntp client servers
add address=vn.pool.ntp.org
/tool mac-server
set allowed-interface-list=none
/tool mac-server mac-winbox
set allowed-interface-list=TRUSTED
/tool e-mail
set from=1@gmail.com port=465 server=smtp.gmail.com tls=yes user=\
1@gmail.com
```

```
# 2024-12-22 07:29:16 by RouterOS 7.16.2
# software id = 2M0R-ULGQ
#
# model = CCR2004-16G-2S+
# serial number =
/interface bridge
add name=guest-lan
add name=py2-lan
/interface ethernet
set [ find default-name=ether1 ] comment=WAN-FTTH
set [ find default-name=ether2 ] comment=WAN-ILL
/interface pppoe-client
add disabled=no interface=ether1 name=netnam-ftth user=netnam_manitn2
/interface wireguard
add listen-port=35359 mtu=1420 name=WG-RouterB
/interface list
add name=LAN
add name=WAN
add name=TRUSTED
/ip pool
add name=dhcp_pool0 ranges=10.255.255.1-10.255.255.250
add name=dhcp_pool2 ranges=10.22.20.1-10.22.20.250
/ip dhcp-server
add address-pool=dhcp_pool0 interface=guest-lan lease-time=8h name=dhcp1
add address-pool=dhcp_pool2 interface=py2-lan lease-time=8h name=dhcp2
/port
set 0 name=serial0
set 1 name=serial1
/interface bridge port
add bridge=py2-lan interface=ether16
add bridge=py2-lan interface=ether15
add bridge=py2-lan interface=ether14
add bridge=py2-lan interface=ether13
add bridge=guest-lan interface=ether12
/ip neighbor discovery-settings
set discover-interface-list=TRUSTED
/interface list member
add interface=netnam-ftth list=WAN
add interface=ether2 list=WAN
add interface=guest-lan list=LAN
add interface=py2-lan list=LAN
add interface=py2-lan list=TRUSTED
add interface=WG-RouterB list=TRUSTED
/interface wireguard peers
add allowed-address=10.22.0.1/32, 10.22.19.0/24,175.20.0.0/24 endpoint-address=SiteB-WAN2-IP \
endpoint-port=51248 interface=WG-RouterB  persistent-keep-alive=25s  public-key="----"
/ip address
add address=10.22.20.254/24 interface=py2-lan network=10.22.20.0
add address=10.255.255.254/24 interface=guest-lan network=10.255.255.0
add address=101.96.76.126/30 interface=ether2 network=101.96.76.124
add address=10.22.0.2/30 interface=WG-RouterB network=10.22.0.0
/ip cloud
set ddns-enabled=yes
/ip dhcp-server network
add address=10.255.255.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.255.255.254
add address=10.22.20.0/24 dns-server=8.8.8.8,8.8.4.4 gateway=10.22.20.254
/ip dns
set servers=8.8.8.8,8.8.4.4
/ip firewall address-list
add address=10.22.10.XX  list=AUTHORIZED  comment="admin local IP at RouterA"
add address=10.22.10.YY list=AUTHORIZED comment="admin local IP at RouterA device2"
add address=10.22.19.AB list=AUTHORIZED comment="remote wg admin laptop"
add address=10.22.19.CD list=AUTHORIZED comment="remote wg admin smartphone/ipad"
add address=10.22.20.EF  list=AUTHORIZED comment="local admin IP"
add address=10.22.20.GH  list=AUTHORIZED comment="local admin IP device 2"
/ip firewall filter
add action=accept chain=input connection-state=established,related,untracked
add action=drop chain=input  connection-state=invalid
add action=accept chain=input  protocol=icmp
add action=accept chain=input dst-address=127.0.0.1
add action=accept chain=input comment="admin access" src-address=list=AUTHORIZED
add action=accept chain=input comment="users to services"  in-interface-list=LAN dst-port=53,123 protocol=udp
add action=accept chain=input comment="users to services"  in-interface-list=LAN dst-port=53 protocol=tcp
add action=drop chain=input comment="Drop all else"  make this rule last 
+++++++++++++++++++++++++++
add action=fasttrack-connection chain=forward connection-state=established,related hw-offload=yes
add action=accept chain=forward connection-state=established,related,untracked
add action=drop chain=forward connection-state=invalid
add action=accept chain=forward comment="internet traffic"  in-interface-list=LAN out-interface-list=WAN
add action=accept chain=forward comment="FGA to FGB"  in-interface=WG-RouterB src-address=175.20.0.0/24 dst-address=175.25.0.0/24 dst-port=443
add action=accept chain=forward comment="FGB to FGA"  out-interface=WG-RouterB src-address=175.25.0.0/24 dst-address=175.20.0.0/24 dst-port=443
add action=accept chain=forward comment="remote users to RB"  in-interface=WG-RouterB src-address=10.22.19.0/24 dst-address=10.22.20.0/24
add action=accept chain=forward comment="admin access"  src-address-list=AUTHORIZED out-interface-list=LAN
add action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat
add action=drop chain=forward comment="drop all else"
/ip firewall nat
add action=masquerade chain=srcnat out-interface-list=WAN
/ip firewall mangle
add action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=WG-RouterB passthrough=yes protocol=tcp tcp-flags=syn
/ip route
{ Main routes for backup }
add  check-gateway=ping dst-address=0.0.0.0/0 gateway=1.1.1.1 routing-table=main scope=10 target-scope=12
add  dst-address=1.1.1.1/32 gateway=WAN1-Gateway-IP routing-table=main scope=10 target-scope=11
++++++++++++++++
add check-gateway=ping  distance=2 dst-address=0.0.0.0/0 gateway=WAN2-Gateway-IP routing-table=main
++++++++++++++++
{ to ensure incoming RouterA Fortigate traffic gets to local FGB subnet }
add dst-address=175.25.0.0/24 gateway=10.22.20.253  routing-table=main
{ to ensure outgoing RouterB Fortigate traffic gets into tunnel for RouterA }
add dst-address=175.20.0.0/24  gateway=WG-RouterB  routing-table=main
+++++++++++++++
{ special route for wireguard to wan2 }
add dst-address=ip.of.siteA.wan2/32 gateway=ip.or.siteB.wan2-gw
/ip service
set telnet disabled=yes
set ftp disabled=yes
set www disabled=yes
set ssh disabled=yes
set api disabled=yes
set api-ssl disabled=yes
/system clock
set time-zone-name=Asia/Ho_Chi_Minh
/system identity
set name=PY2-Mikrotik-Router
/system note
set show-at-login=no
/system ntp client
set enabled=yes
/system ntp client servers
add address=vn.pool.ntp.org
/tool mac-server
set allowed-interface-list=none
/tool mac-server mac-winbox
set allowed-interface-list=TRUSTED
/system routerboard settings
set enter-setup-on=delete-key
```

Still confusing.  If the Foritgates have no NAT,  then how does it get an IP address from the MT,  and yet have other subnets behind it????I think the idea is to push the data to the fortigates and let them deal with it.  So Removed the Port forwarding (dstnat)  and doing it through firewall rules and routes.Okay thanks based on the new info.........  minor changes to the previous configs.......Changes1. Removed the local subnet from RouterB and added the subnet behind the fortigate./interface wireguard peersadd allowed-address=10.22.0.2/32,172.25.0.0/24interface=WG-RouterA  public-key="--"  comment="site to site"2.   Removed the two firewall rules allowing local lan to local lan traffic.add action=accept chain=forward commeint="RB to RA" in-interface=WG-RouterA src-address=10.22.20.0/24 dst-address=10.22.10.0/24add action=accept chain=forward comment="RA to RB" out-interface=WG-RouterA src-address=10.22.10.0/24 dst-address=10.22.20.0/243.  Added firewall rules for management FG access both ways.  You may want to refine to specific IPs....4.  Removed Routes for local LAN through wireguard and replaced witha.  static route for local FGA as Router does not know its existence when incoming FGB traffic arrives and exits the tunnel, andb.  route to wireguard for outgoing local FG to the FGB aka needs to enter tunnel.....Code:Select all................Code:Select all


---
### Author: Fri Jan 03, 2025 7:17 am
Date: Unknown

Hello guys,Sorry for my long time offline,I have received technical support from my local Mikrotik seller, due to their security contract I cannot post current configuration.In the future, if I have any new I ideal, I'm looking forward to receive your support.Thank you for your kindly support once again.Best regards,Sindi's initial solution is accurate. You just need to point the IP of another WG to the corresponding WAN gateway in the routing table. In case you have dynamic WG clients (Road Warrior) you will need a script that regularly reads their peer logs and adjusts their main table. Don't mess with mangles, tags or additional tables, it will only mess up your configuration.

