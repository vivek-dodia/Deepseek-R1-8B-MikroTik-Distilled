# Thread Information
Title: Untitled Thread
Section: mikrotik_forum
Thread ID: 212081

# Discussion

## Initial Question
Author: Mon Oct 28, 2024 10:31 pm
``` chain=forward action=drop src-address=10.1.3.6/31out-interface-list=WAN chain=forward action=acceptin-interface=Homeout-interface=IoTchain=forward action=dropin-interface-list=VLANout-interface-list=!WAN ``` ``` chain=forward action=drop src-address-list=ipcamout-interface-list=WAN ``` If your VLAN interface list contains Home, IoT and Guest interfaces, insert the following rules between the last two at your initial screenshot:
```
I prefer to use address lists for such cases in the first rule:
```

```
---
```

## Response 1
Author: Mon Oct 28, 2024 11:16 pm
``` chain=forward action=drop src-address=10.1.3.6/31out-interface-list=WAN chain=forward action=acceptin-interface=Homeout-interface=IoTchain=forward action=dropin-interface-list=VLANout-interface-list=!WAN ``` ``` chain=forward action=drop src-address-list=ipcamout-interface-list=WAN ``` If your VLAN interface list contains Home, IoT and Guest interfaces, insert the following rules between the last two at your initial screenshot:
```
I prefer to use address lists for such cases in the first rule:
```

```
With these rules, I also lost control to see the camera from LAN.Here's the current config attached in full:


---
```

## Response 2
Author: Tue Oct 29, 2024 12:13 am
To make this clear, These cameras can be accessed by you the admin from the LAN.They are designed to be accessible while away from home via the cloud.You want to stop them talking to the cloud.+++++++++++++++++++++++++++++++++++++++++++++You didnt make it clear what is connected on each port, but you will get the idea.whatever is simply going to a dumb device is an access port and needs a pvid on /interface bridge port and to be untagged on /interface bridge vlanswhatever is going to a smart device is a trunk port and has no pvid assigned, and is tagged along with the bridge on /interface bridge vlans.ALSO Keep names distinct, its better on the reader and for the router..........Bridge is no longer required for participation in LAN interface list.model = RB5009UG+S+# serial number = *************/interface bridgeadd admin-mac=***************** auto-mac=no name=bridge vlan-filtering=yes/interface ethernetset [ find default-name=ether1 ] name=ether1_WANset [ find default-name=sfp-sfpplus1 ] auto-negotiation=no name=sfp speed=\10G-baseSR-LR/interface vlanadd interface=bridge name=Guest20vlan-id=20add interface=bridge name=Home10vlan-id=10add interface=bridge name=IoT30vlan-id=30/interface listadd name=WANadd name=LANadd name=TRUSTED/ip pooladd name=Home ranges=10.1.1.4-10.1.1.254add name=Guest ranges=10.1.2.2-10.1.2.254add name=IoT ranges=10.1.3.2-10.1.3.254/ip dhcp-serveradd address-pool=Guest interface=Guest20name=Guest-dhcpadd address-pool=IoT interface=IoT30name=IoT-dhcpadd address-pool=Home interface=Home10name=Home-dhcp/disk settingsset auto-media-interface=bridge auto-media-sharing=yes auto-smb-sharing=yes/interface bridge portadd bridge=bridge ingress-filtering=yes frame-types=admit-only-tagged-vlans interface=ether2 comment="trunk port'add bridge=bridge ingress-filtering=yes frame-types=admit-priority-and-untagged interface=ether3 pvid=10add bridge=bridge ingress-filtering=yes frame-types=admit-priority-and-untagged interface=ether4 pvid=10add bridge=bridge ingress-filtering=yes frame-types=admit-priority-and-untagged interface=ether5 pvid=10add bridge=bridge ingress-filtering=yes frame-types=admit-priority-and-untagged interface=ether6 pvid=10add bridge=bridge ingress-filtering=yes frame-types=admit-priority-and-untagged interface=ether7 pvid=10add bridge=bridge ingress-filtering=yes frame-types=admit-priority-and-untagged interface=ether8 pvid=10add bridge=bridge ingress-filtering=yes frame-types=admit-only-tagged-vlans interface=sfp comment="trunk port'/ip neighbor discovery-settingsset discover-interface-list=LAN/interface bridge vlanadd bridge=bridge tagged=bridge, ether2, sfp untagged=ether3, ether4, ether5, ether6, ether7, ether8 vlan-ids=10add bridge=bridge tagged=bridge, ether2, sfp vlan-ids=20, 30/interface list member {note we do NOT make the IOT vlan a member of the LAN interface list!!}add interface=ether1_WAN list=WANadd interface=Home10 list=LANadd interface=Guest20 list=LANadd interface=Home10 list=TRUSTED/ip addressadd address=10.1.1.1/24 comment=Home interface=Home10 network=10.1.1.0add address=10.1.2.1/24 comment=Guest interface=Guest20 network=10.1.2.0add address=10.1.3.1/24 comment=IoT interface=IoT30 network=10.1.3.0/ip dhcp-clientadd comment=defconf interface=ether1_WAN/ip dhcp-server leaseadd address=10.1.1.10 lease-time=1d mac-address=9C:6B:00:39:A9:AE server=Homeadd address=10.1.3.3 client-id=1:0:a08f:5d:c7 mac-address=\00:A0:DE:8F:5D:C7 server=IoTadd address=10.1.1.11 client-id=1:ac:5f:ea:12f9 mac-address=\AC:5F:EA:12:DE:F9 server=Homeadd address=10.1.3.4 client-id=1:78:5d:c8b5:ab mac-address=\78:5D:C8:AB:B5:AB server=IoTadd address=10.1.3.2 client-id=1:a8:93:4a:67:d6:f6 comment=Tulostin \mac-address=A8:93:4A:67:D6:F6 server=IoTadd address=10.1.3.6 client-id=1:54:af:97:dc:f5:d comment=*** mac-address=\54:AF:97:DC:F5:0D server=IoTadd address=10.1.3.7 client-id=1:5c:a6:e6:7e:c8:c comment=*** mac-address=\5C:A6:E6:7E:C8:0C server=IoT/ip dhcp-server networkadd address=10.1.1.0/24 comment=Home dns-server=10.1.1.1 gateway=10.1.1.1 \netmask=24add address=10.1.2.0/24 comment=Guest dns-server=10.1.1.1 gateway=10.1.2.1add address=10.1.3.0/24 comment=IoT dns-server=10.1.1.1 gateway=10.1.3.1/ip dnsset allow-remote-requests=yes/ip dns staticadd address=10.1.1.1 comment=defconf name=router.lan type=A/ip firewall address-listadd address=10.1.3.6/31 list=Cameraadd address=10.1.1.X list=TRUSTED comment="admin pc"add address=10.1.1.YY list=TRUSTED comment="admin device2"/ip firewall filteradd action=accept chain=input comment=\"defconf: accept established, related, untracked" connection-state=\established, related, untrackedadd action=drop chain=input comment="defconf: drop invalid" connection-state=\invalidadd action=accept chain=input comment="defconf: accept ICMP" protocol=icmpadd action=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)" dst-address=127.0.0.1add action=accept chain=input comment="admin access" in-interface=Home10{ one should use an address list here (source) to limit to admin only TRUSTED }add action=accept chain=inputin-interface-list=LANdst-port=53 protocol=udp comment="users to router services"add action=accept chain=input in-interface-list=LANdst-port=53 protocol=tcp comment="users to router services"add action=drop chain=input comment="drop all else{add this rule last or you will lock yourself out}++++++++++++++++++++++++++++++++++++++++++add action=accept chain=forward comment="defconf: accept in ipsec policy" \ipsec-policy=in, ipsecadd action=accept chain=forward comment="defconf: accept out ipsec policy" \ipsec-policy=out, ipsecadd action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established, related hw-offload=yesadd action=accept chain=forward comment=\"defconf: accept established, related, untracked" connection-state=\established, related, untrackedadd action=drop chain=forward comment="defconf: drop invalid" \connection-state=invalidadd action=accept chain=forward comment="internet access"in-interface-list=LANout-interface-list=WANadd action=accept chain=forward comment="Accept Home to IoT traffic" in-interface=Home10 out-interface=IoT30 \src-address=10.1.1.0/24 dst-address=10.1.3.0/24add action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat { disable or remove if not required }add action=drop chain=forward comment="drop all else"/ip firewall natadd action=masquerade chain=srcnat comment="defconf: masquerade" \ipsec-policy=out, none out-interface-list=WAN/ip serviceset telnet disabled=yesset ftp disabled=yesset www disabled=yesset api disabled=yesset api-ssl disabled=yes/ipv6 firewall address-listadd address=::/128 comment="defconf: unspecified address" list=bad_ipv6add address=::1/128 comment="defconf: lo" list=bad_ipv6add address=fec0::/10 comment="defconf: site-local" list=bad_ipv6add address=::ffff:0.0.0.0/96 comment="defconf: ipv4-mapped" list=bad_ipv6add address=::/96 comment="defconf: ipv4 compat" list=bad_ipv6add address=100::/64 comment="defconf: discard only " list=bad_ipv6add address=2001:db8::/32 comment="defconf: documentation" list=bad_ipv6add address=2001:10::/28 comment="defconf: ORCHID" list=bad_ipv6add address=3ffe::/16 comment="defconf: 6bone" list=bad_ipv6/ipv6 firewall filteradd action=accept chain=input comment=\"defconf: accept established, related, untracked" connection-state=\established, related, untrackedadd action=drop chain=input comment="defconf: drop invalid" connection-state=\invalidadd action=accept chain=input comment="defconf: accept ICMPv6" protocol=\icmpv6add action=accept chain=input comment="defconf: accept UDP traceroute" \dst-port=33434-33534 protocol=udpadd action=accept chain=input comment=\"defconf: accept DHCPv6-Client prefix delegation." dst-port=546 protocol=\udp src-address=fe80::/10add action=accept chain=input comment="defconf: accept IKE" dst-port=500, 4500 \protocol=udpadd action=accept chain=input comment="defconf: accept ipsec AH" protocol=\ipsec-ahadd action=accept chain=input comment="defconf: accept ipsec ESP" protocol=\ipsec-espadd action=accept chain=input comment=\"defconf: accept all that matches ipsec policy" ipsec-policy=in, ipsecadd action=drop chain=input comment=\"defconf: drop everything else not coming from LAN" in-interface-list=\!LANadd action=accept chain=forward comment=\"defconf: accept established, related, untracked" connection-state=\established, related, untrackedadd action=drop chain=forward comment="defconf: drop invalid" \connection-state=invalidadd action=drop chain=forward comment=\"defconf: drop packets with bad src ipv6" src-address-list=bad_ipv6add action=drop chain=forward comment=\"defconf: drop packets with bad dst ipv6" dst-address-list=bad_ipv6add action=drop chain=forward comment="defconf: rfc4890 drop hop-limit=1" \hop-limit=equal:1 protocol=icmpv6add action=accept chain=forward comment="defconf: accept ICMPv6" protocol=\icmpv6add action=accept chain=forward comment="defconf: accept HIP" protocol=139add action=accept chain=forward comment="defconf: accept IKE" dst-port=\500, 4500 protocol=udpadd action=accept chain=forward comment="defconf: accept ipsec AH" protocol=\ipsec-ahadd action=accept chain=forward comment="defconf: accept ipsec ESP" protocol=\ipsec-espadd action=accept chain=forward comment=\"defconf: accept all that matches ipsec policy" ipsec-policy=in, ipsecadd action=drop chain=forward comment=\"defconf: drop everything else not coming from LAN" in-interface-list=\!LAN/system clockset time-zone-name=Europe/Helsinki/system identityset name=r1/system noteset show-at-login=no/tool mac-serverset allowed-interface-list=NONE/tool mac-server mac-winboxset allowed-interface-list=LANIf not using IPV6 remove address list and disable ipv6 in settings and remove all rules saveadd chain=input action=dropadd chain=forward action=drop ---

## Response 3
Author: [SOLVED]Thu Oct 31, 2024 1:39 am
Well when you hide requirements expect an incomplete or incorrect answer...............Then we take a different approach ensuring IOT vlan is part of LAN interface list./interface list memberadd interface=ether1_WAN list=WANadd interface=Home10 list=LANadd interface=Guest20 list=LANadd interface=IoT30 list=LANadd interface=Home10 list=TRUSTED/ip firewall address-listadd address=10.1.3.AA list=BlockCameracomment="camera location X"add address=10.1.3.BB list=BlockCamera comment="camera location Y"add address=10.1.3.CC list=BlockCamera comment="camera location Z"add action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established, related hw-offload=yesadd action=accept chain=forward comment=\"defconf: accept established, related, untracked" connection-state=\established, related, untrackedadd action=drop chain=forward comment="defconf: drop invalid" \connection-state=invalidadd action=accept chain=forward comment="internet access" in-interface-list=LAN out-interface-list=WANsrc-address-list=!BlockCameraadd action=accept chain=forward comment="Accept Home to IoT traffic" in-interface=Home10 out-interface=IoT30 \src-address=10.1.1.0/24 dst-address=10.1.3.0/24add action=accept chain=forward comment="port forwarding" connection-nat-state=dstnat { disable or remove if not required }add action=drop chain=forward comment="drop all else"