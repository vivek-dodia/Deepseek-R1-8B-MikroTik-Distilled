# Thread Information
Title: Untitled Thread
Section: mikrotik_forum
Thread ID: 204076

# Discussion

## Initial Question
Author: Sat Feb 03, 2024 2:44 am
Hi guys, I need you to please help me adapt the following code to OS 7.13.3:local tminutos 0:local thoras 0:local tdias 0:local atime [ /system clock get time ];:local adate [ /system clock get date ];:local temp1 [:pick $adate 0 3];:local temp2 [:pick $adate 4 6];:local temp3 [:pick $atime 0 5];:local folio [/ip hotspot user get $user comment];:local comentario1 "El Usuario $user Ha Iniciado Session";:local comentario2 "El Usuario $user Se Eliminara Automáticamente";:if ([ /ip hotspot user get $user comment ]="") do={ [ /ip hotspot user set $user comment="$comentario1" ]}:local mesarray ("jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"):local diaarray ("31","28","31","30","31","30","31","31","30","31","30","31"):local day [:pick $adate 4 6];:local monthtxt [:pick $adate 0 3];:local year [:pick $adate 7 11];:local months ([:find $mesarray $monthtxt]):local dia ([:pick $diaarray $months]):local fhora [:pick $atime 0 2];:local fminutos [:pick $atime 3 5];:local fsegundos [:pick $atime 6 9];:local mayormin (($fminutos+$tminutos)-60):local mayorhora (($fhora+$thoras)-24):if (($fminutos+$tminutos)>59) do={:set $thoras ($thoras+1);:set $fminutos ($mayormin);} else={:set $fminutos ($fminutos+$tminutos) ;}#si fhoras + thoras(1) es mayor que 23:if (($fhora+$thoras)>23) do={#seteo la variable atime por:set atime ("0".$mayorhora.":".$fminutos.":".fsegundos);:set $tdias ($tdias+1);} else={:set atime (($fhora+$thoras).":".$fminutos.":".fsegundos) ;}#si day + tdias es mayo que los dias del mes:if (($day+$tdias)>$dia) do={:if ($months=11) do={:set months 0;:set year ($year+1);:set day (($day+$tdias)-$dia);:local mes ([:pick $mesarray $months]);:set adate ($mes."/".$day."/".$year);} else={:set months ($months+1);:set day (($day+$tdias)-$dia);:local mes ([:pick $mesarray $months]);:set adate ($mes."/".$day."/".$year);}} else={:set day ($day+$tdias);:local mes ([:pick $mesarray $months]);:set adate ($mes."/".$day."/".$year);}[/system scheduler add interval=1m comment="$comentario2" name=$user on-event="/ip hotspot user disable [find name=$user] \r\\n/ip hotspot active remove [find user=$user] \r\\n/ip hotspot cookie remove [find user=$user] \r\\n/system scheduler remove [find name=$user] \r\\n/\r\" start-date=$adate start-time=$atime]I would be very grateful to you.Greetings ---

## Response 1
Author: Sat Feb 03, 2024 8:21 pm
Hi Thanks for answering.Basically what it does is validate the times established in each case, for example, when a user requests 1 hour of usage time, 1 day or 1 month. The Schedule at the end ensures that when the user logs in it begins to validate that any time set for the user is met and when this happens, it disables the user. Don't worry about the comments:local comment1 "User $user Has Logged In";:local comment2 "User $user Will Be Disabled Automatically";:if ([ /ip hotspot user get $user comment ]="") do={ [ /ip hotspot user set $user comment="$comment1" ]}[/system scheduler add interval=1m comment="$comment2" name=$user on-event="/ip hotspot user disable [search name=$user] \r\\n/ip hotspot active delete [search user=$user] \r\\n/delete hotspot cookie ip [search user=$user] \r\\n/remove system scheduler [search name=$user] \r\\n/\r\" start-date=$ adate start-time=$atime] ---

## Response 2
Author: [SOLVED]Sun Feb 11, 2024 4:14 am
``` :localtminutos1:localthoras0:localtdias0:localatime[/system clockgettime]:localadate[/system clockgetdate]:localtask($atime."_".$adate):localtemp1[:pick $adate04]:localtemp2[:pick $adate57]:localtemp3[:pick $adate810]:localtemp4[:pick $atime09]:localtemp5($temp3."/".$temp2."/".$temp1." - ".$temp4." Dias: ".$tdias):localcomentario1"El usuario $user ha iniciado sesion el: $temp5":if([/ip hotspot user find name="$user"]!="")do={:if([/ip hotspot userget"$user"comment]="")do={/ip hotspot userset"$user"comment="$comentario1"}}else={:log error"El usuario $user no existe":error"El usuario $user no existe"}:localmesarray("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"):localdiaarray("31","28","31","30","31","30","31","31","30","31","30","31"):localday[:pick $adate810]:localmonthtxt[:pick $adate57]:localyear[:pick $adate04]:localmonthnum(([:find $mesarray $monthtxt])+1):localmonths([:pick $mesarray $monthnum]):localdia([:pick $diaarray $monthnum]):localfhora[:pick $atime02]:localfminutos[:pick $atime35]:localfsegundos[:pick $atime69]:localmayormin(($fminutos+$tminutos)-60):localmayorhora(($fhora+$thoras)-24):if(($fminutos+$tminutos)>59)do={:setthoras($thoras+1):setfminutos($mayormin)}else={:setfminutos($fminutos+$tminutos)}:if(($fhora+$thoras)>23)do={:setatime("0".$mayorhora.":".$fminutos.":".fsegundos):settdias($tdias+1)}else={:setatime(($fhora+$thoras).":".$fminutos.":".fsegundos)}:if(($day+$tdias)>$dia)do={:if($monthnum=11)do={:setmonthnum0:setyear($year+1):setday(($day+$tdias)-$dia):localmes([:pick $mesarray $monthnum]):setadate($mes."/".$day."/".$year)}else={:setmonthnum($monthnum+1):setday(($day+$tdias)-$dia):localmes([:pick $mesarray $monthnum]):setadate($mes."/".$day."/".$year):log info"else monts $adate"}}else={:setday($day+$tdias):localmes([:pick $mesarray $monthnum]):setadate($mes."/".$day."/".$year)}:localcomentario2"El usuario $user se deshabilitara automáticamente el: $adate $atime":localcomentario3"Se ha cumplido el tiempo solicitado desde:$temp5 hasta: $adate $atime"/system scheduleraddinterval=1scomment="$comentario2"name="$task"on-event=" /ip hotspot user disable [find name=\"$user\"] \r /ip hotspot active remove [find user=\"$user\"] \r /ip hotspot cookie remove [find user=\"$user\"] \r /ip hotspot user reset-counter [find name=\"$user\"] \r :if ([/ip hotspot user get [find name=\"$user\"] comment] = \"$comentario1\") do={ /ip hotspot user set [find name=\"$user\"] comment=\"$comentario3\" } \r /system scheduler remove [find name=\"$task\"] \r "start-date=$adate start-time=$atime ``` In case anyone comes here interested in the thread, I leave you the appropriate script: