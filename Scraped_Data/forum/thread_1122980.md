---
title: Thread-1122980
url: https://forum.mikrotik.com/viewtopic.php?p=1122980&sid=49f92a630bc7970d8ca50523be880e8f#p1122980
thread_id: 1122980
section: RouterOS
post_count: 20
date_crawled: 2025-02-03T13:15:27.585237
---

### Post 1
Author: Unknown
Date: Unknown

Hello,Before I was on AzireVPN, where here good users helped to configure itviewtopic.php?t=194705So after setting up all, being happy for 1y+ , they change the Port forward policy....i decided to try new provider.I came around this AirVPN and seems to have big community and stable service, so i gave it a try....I realized new feature in WinBox - Wireguard - WG Import - Greaat!Mikrotik OS is on 16.2 , but on my BITTER surprise  - WG Import doesn't work...I checked OS update and 7.17 (yesteday fresh update), probably a bug in previous FW, so did update and same problem...This drives me Insane so many years on market and still issues with OpenVPN / Wireguard seamless configs imports-Did ticket and got notice just now - This is fixed on 7.18beta (at least they are fast)image-1.png_thumb_270994.png----Anyway back to ISSUE spend few hours to set all manually (based on previous AzireVPN provider settings) into some working level.My setup is that i have also Docker hosted on Server for PiHole where I have 2x DNS from previous provider (still working fine)AzireVPN91.231.153.2192.211.0.2Now the issues are:1. AirVPN DNS 10.128.0.1 seems to be working only if the client (VPN Whitelist) is connected to the VPN tunnel2. The rest clients (not on VPN) are having issues with pages , connectivity etc. (using AirVPN DNS 10.128.0.1)When is take Client1 out from VPN and is connected "via regular internet" issues with pages are gone and everything runs/loads smoothly.VPN Client list i manage via routing table (not sure if there is any other better way)Code:Select all/routing ruleaddaction=lookup-only-in-table comment=ZigBee-Hubdisabled=nosrc-address=\192.168.10.20/32table=mainaddaction=lookup-only-in-table comment=Mini-PC disabled=yes src-address=\192.168.10.50/32table=mainaddaction=lookup-only-in-table comment="Redmi 8"disabled=no\
    src-address=192.168.10.64/32table=mainaddaction=lookup disabled=nosrc-address=192.168.10.0/24table=useWG3. I removed completely AirVPN DNS 10.128.0.1 and kept only 91.231.153.2 , 192.211.0.2 on PiholeNow nonVPN clients run great all pages etc.Client on Air VPN tunnel runs 80-90% fine some pages do not load or partially and for example paint.NET update is faling (see pic) vs On nonVPN clients work finepaint.pngI recall having similar issues with AzireVPN and then someone suggested:"With adding the command , started to work, changing to MTU 1500 didnt worked out./ip firewall mangleadd action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=wg-az-se-sto passthrough=yes protocol=tcp tcp-flags=syn"I tried to edit it for current interface , seems it help at bit to get access , but somehow the few MB update is extremely sloweven speed on VPN is like 50/5mb (before i start to look for faster server, would like to have this issue resolved)Also how is see that something is not right is via this Browser plugin (https://github.com/AykutCevik/Geolocate ... -Extension)Where it shows ERROR and no data about IP vs in normal state it changes/update country flag within secondsvpn.JPGHere is my config:Seems like now they have new featurehttps://help.mikrotik.com/docs/spaces/R ... Managementshow-sensitive (yes|no; Default: no). RouterOS version 7 onlyhide-sensitive (yes|no; Default: no). RouterOS version 6 onlySo hope all needed is thereCode:Select all#doesnt work with =yes / no switchexporthide-sensitive=yes file=VPN#worksexporthide-sensitives file=VPNCode:Select all# 2025-01-25 12:20:13 by RouterOS 7.17# software id = NNA1-7M3W## model = C53UiG+5HPaxD2HPaxD# serial number = xxx/interfacebridgeaddadmin-mac=XX:XX:XX:XX:XX:XXauto-mac=nocomment=defconf name=bridge \
    port-cost-mode=short/interfaceethernetset[finddefault-name=ether1]comment=WAN mac-address=XX:XX:XX:XX:XX:XX \
    name=ether1-WAN/interfacewireguardaddlisten-port=13231mtu=1320name=AirVPN_Swedenaddcomment=back-to-home-vpn disabled=yes listen-port=40556mtu=1420name=\
    back-to-home-vpn/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/interfacewifi channeladdband=2ghz-ax disabled=nofrequency=2422,2447,2467name=ch-2ghz\
    skip-dfs-channels=10min-cac width=20mhzaddband=5ghz-ax disabled=nofrequency=5180,5260,5320name=ch-5ghz\
    skip-dfs-channels=10min-cac width=20/40/80mhz/interfacewifi securityaddauthentication-types=wpa2-psk,wpa3-psk disabled=noname=wifi-sec wps=\
    disable/interfacewifi configurationaddantenna-gain=0channel=ch-2ghzcountry=Czechdisabled=noname=\
    wifi-conf-2.4Ghzsecurity=wifi-sec ssid=XXXaddantenna-gain=0channel=ch-5ghzcountry=Czechdisabled=noname=\
    wifi-conf-5Ghzsecurity=wifi-sec ssid=XXX_5G/interfacewifiaddconfiguration=wifi-conf-5Ghzconfiguration.mode=ap.tx-power=24disabled=\noname=cap-wifi1 radio-mac=XX:XX:XX:XX:XX:XXaddconfiguration=wifi-conf-2.4Ghzconfiguration.mode=ap.tx-power=24\
    disabled=noname=cap-wifi2 radio-mac=XX:XX:XX:XX:XX:XXset[finddefault-name=wifi1]configuration=wifi-conf-5Ghz\
    configuration.mode=ap disabled=noname=wifi1-5gset[finddefault-name=wifi2]configuration=wifi-conf-2.4Ghz\
    configuration.mode=ap disabled=noname=wifi2-2g/iot lora serversaddaddress=eu1.cloud.thethings.industries name="TTS Cloud (eu1)"protocol=\
    UDPaddaddress=nam1.cloud.thethings.industries name="TTS Cloud (nam1)"protocol=\
    UDPaddaddress=au1.cloud.thethings.industries name="TTS Cloud (au1)"protocol=\
    UDPaddaddress=eu1.cloud.thethings.network name="TTN V3 (eu1)"protocol=UDPaddaddress=nam1.cloud.thethings.network name="TTN V3 (nam1)"protocol=UDPaddaddress=au1.cloud.thethings.network name="TTN V3 (au1)"protocol=UDP/ip kid-controladdfri=0s-1dmon=0s-1dname=system-dummy sat=0s-1dsun=0s-1dthu=0s-1dtue=\0s-1dtur-fri=0s-1dtur-mon=0s-1dtur-sat=0s-1dtur-sun=0s-1dtur-thu=\0s-1dtur-tue=0s-1dtur-wed=0s-1dwed=0s-1dadddisabled=yes fri=17h30m-19hmon=17h30m-19hname=kids sat=17h30m-19h30m\
    sun=17h30m-19hthu=17h30m-19htue=17h30m-19hwed=17h30m-19h/ip pooladdname=dhcp ranges=192.168.10.10-192.168.10.254/ip dhcp-serveraddaddress-pool=dhcpinterface=bridge lease-time=10mname=dhcp1/ip smb usersset[finddefault=yes]disabled=yes/queue simpleaddcomment=Arduino-Boxmax-limit=10/10name=Arduino-Boxtarget=\192.168.10.112/32addcomment=Arduino-Garazmax-limit=10/10name=Arduino-Garaztarget=\192.168.10.110/32/queue treeaddmax-limit=1Gname=TotalBandparent=globaladdmax-limit=50Mname="01 Games"packet-mark=games parent=TotalBandaddmax-limit=20Mname="02 YouTube"packet-mark=youtube parent=TotalBandaddcomment="Browsing, downloads"max-limit=1Gname="03 Other"packet-mark=\no-mark parent=TotalBand/routing tableadddisabled=nofib name=useWG/zerotiersetzt1 disabled=nodisabled=no/interfacebridge portaddbridge=bridge comment=defconfinterface=ether2internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=ether3internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=ether4internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=ether5internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=wifi1-5ginternal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=wifi2-2ginternal-path-cost=10\
    path-cost=10/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=LAN/ip settingssetallow-fast-path=no/ipv6 settingssetmax-neighbor-entries=15360/interfacedetect-internetsetdetect-interface-list=all internet-interface-list=all lan-interface-list=\
    all wan-interface-list=all/interfacelist memberaddcomment=defconfinterface=bridge list=LANaddcomment=defconfinterface=ether1-WAN list=WAN/interfacewifi access-listaddaction=reject allow-signal-out-of-range=10sdisabled=nointerface=\
    wifi1-5gsignal-range=-120..-85addaction=reject allow-signal-out-of-range=10sdisabled=nointerface=\
    wifi2-2gsignal-range=-120..-85/interfacewifi capsmansetca-certificate=autoenabled=yespackage-path=""require-peer-certificate=\noupgrade-policy=require-same-version/interfacewifi provisioningaddaction=create-enabled disabled=nomaster-configuration=wifi-conf-5Ghz\
    supported-bands=5ghz-axaddaction=create-enabled disabled=nomaster-configuration=wifi-conf-2.4Ghz\
    supported-bands=2ghz-ax/interfacewireguard peersaddallowed-address=0.0.0.0/0endpoint-address=se3.vpn.airdns.org \
    endpoint-port=51820interface=AirVPN_Swedenname=peer4 \
    persistent-keepalive=35spreshared-key=\"XXX"public-key=\"XXX"/iot lora traffic optionssetcrc-errors=nosetcrc-errors=no/ip addressaddaddress=192.168.10.1/24comment=defconfinterface=bridge network=\192.168.10.0addaddress=10.142.189.241interface=AirVPN_Swedennetwork=10.142.189.0/ip cloudsetback-to-home-vpn=enabled ddns-enabled=yes ddns-update-interval=10m/ip cloud back-to-home-usersaddallow-lan=yes comment=" Xiaomi 2201122G"name="MikroTik hAP AX3"\private-key="XXX"public-key=\"XXX"/ip dhcp-clientaddcomment=defconfinterface=ether1-WAN/ip dhcp-server leaseaddaddress=192.168.10.50client-id=1:a8:a1:59:44:6f:3bcomment=MiniPC\
    mac-address=A8:A1:59:44:6F:3Brate-limit=1000M/1000Mserver=dhcp1addaddress=192.168.10.70client-id=1:4:cf:8c:e8:42:18comment="Vacuum"\
    mac-address=04:CF:8C:E8:42:18server=dhcp1/ip dhcp-server networkaddaddress=192.168.10.0/24comment="VPN DNS Servers"dns-server=192.168.10.2\
    gateway=192.168.10.1/ip dnssetallow-remote-requests=yes servers=8.8.8.8,8.8.4.4/ip firewall address-listaddaddress=192.168.10.51list=No-Internetaddaddress=se3.vpn.airdns.org list=3rdPartyVPN2/ip firewall filteraddaction=jump chain=forward comment="jump to kid-control rules"\
    jump-target=kid-controladdaction=log chain=forward connection-state=newdisabled=yes dst-port=\80,443log=yes protocol=tcpaddaction=drop chain=forward comment="No-Internet Rule"log=yes log-prefix=\Blocked-Internet-Triesout-interface-list=WAN src-address-list=\No-Internetaddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input dst-port=51820in-interface=ether1-WAN \
    protocol=udpaddaction=accept chain=input comment="defconf: allow all coming from LAN"\in-interface-list=LANaddaction=accept chain=input comment="allow Winbox"port=8291protocol=tcpaddaction=drop chain=input comment="drop all else"addaction=accept chain=forward comment="defconf: accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related disabled=yes hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=accept chain=forwardin-interface=bridgeout-interface-list=WANaddaction=accept chain=forwardin-interface=bridgeout-interface=\AirVPN_Swedenaddaction=accept chain=forward comment="port forwarding"\
    connection-nat-state=dstnataddaction=drop chain=forward comment="drop all else"/ip firewall mangleaddaction=change-mss chain=forward comment=\"Clamp MSS to PMTU for Outgoing packets"new-mss=clamp-to-pmtu \out-interface=AirVPN_Swedenprotocol=tcp tcp-flags=syn/ip firewall nataddaction=masquerade chain=srcnat comment="defconf: masquerade"\
    ipsec-policy=out,noneout-interface-list=WANaddaction=masquerade chain=srcnatout-interface=AirVPN_Swedenaddaction=dst-nat chain=dstnat comment=Loxonedst-port=7777in-interface=\
    ether1-WAN log=yes log-prefix=Loxoneprotocol=tcp to-addresses=\192.168.10.100to-ports=7777addaction=dst-nat chain=dstnat comment="Transmission BT - Work"dst-port=\7778in-interface=ether1-WAN log=yes protocol=tcp to-addresses=\192.168.10.101to-ports=7788addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54518in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=tcp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54518in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=udp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54519in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=tcp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54519in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=udp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="SSH Router"disabled=yes dst-port=\2220in-interface=ether1-WAN log=yes protocol=tcp to-addresses=\192.168.10.1to-ports=2222/ip firewall service-portsetftp disabled=yes/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip kid-control deviceaddmac-address=60:45:CB:9A:3F:F0 name=Toweruser=system-dummy/ip routeadddisabled=nodistance=1dst-address=0.0.0.0/0gateway=AirVPN_Sweden\
    routing-table=useWG scope=30suppress-hw-offload=notarget-scope=10/ip servicesettelnet disabled=yessetftp disabled=yessetssh port=2222setapi disabled=yes/ip smb sharesset[finddefault=yes]directory=/pub/routing ruleaddaction=lookup-only-in-table comment=Mini-PC disabled=yes src-address=\192.168.10.50/32table=mainaddaction=lookup-only-in-table comment=Laptopdisabled=no\
    src-address=192.168.10.51/32table=mainaddaction=lookup disabled=nosrc-address=192.168.10.0/24table=useWG/system clocksettime-zone-name=Europe/Prague/system identitysetname="MikroTik hAP AX3"/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=0.cz.pool.ntp.orgaddaddress=time1.google.comaddaddress=time2.google.com/tool bandwidth-serversetenabled=no/tool mac-serversetallowed-interface-list=LAN/tool mac-server mac-winboxsetallowed-interface-list=LAN

---
### Post 2
Author: Unknown
Date: Unknown

anyone?

---
### Post 3
Author: Unknown
Date: Unknown

Sure but how bout first you get rid of all the noise.Delete all the unused config as it makes it harder to read and diagnose issues.Once done repost and will have  a look.

---
### Post 4
Author: Unknown
Date: Unknown

I edited the 1st port and added "cleaned" config with removed "disabled" itemsShould be better nowEDIT:Seems like I need to have AirVPN DNS for AirVPN active connections onlyFor all the rest I have to use NON-AirVPN DNS server.At the moment I use NON-AirVPN DNS servers via IP-Hole for everythingJust got confirmed from AiRVPN forum:To reach 10.128.0.1 (or rather AirDNS in general) you will need an active VPN connection, yes.

---
### Post 5
Author: Unknown
Date: Unknown

Did AirVPN provide any DNS servers for you to use?You have two PCs you dont want going out wireguard sweden?Assuming these need to go out regular local WAN?Any other local traffic that should occur ( between LANIPs  ) ??You noted PI server, if all are going out internet via sweden what is the purpose of PI server then?  Still used....???The IP not allowed internet, I gather thats for both local and Wireguard correct?What is strange is that you dont want the laptop to go out sweden, which is fine but its also a laptop you dont want to have any internet so no local wan access either???Assuming since you had BTH, and no regular wireguard, you do not get a public IP address and cannot forward a port from ISP provider, so one could conclude you dont need a port forwarding rule??Why do you have port forward rules at all is my question?Further why do you attempt to use airpvpn to port forward to your router,  do they provide such a service?/////////// My experience is that its only outgoing traffic they support..........to provide you with internet at a different location etc...

---
### Post 6
Author: Unknown
Date: Unknown

Did AirVPN provide any DNS servers for you to use?In generated config for WG VPN was this one 10.128.0.1Also here in specs i foundhttps://airvpn.org/specs/DoH, DoTEvery gateway/daemon assigned to you acts as a DNS (port 53), DoH (dns-over-http, port 443), DoT (dns-over-tls, port 853).DoH and DoT don't add any actual benefit, because plain DNS requests are encrypted inside our tunnel anyway.However, users might need it for special configurations. In such cases, use dns.airservers.org (automatically resolved into VPN gateway address).Our DNS returns a NXDOMAIN for "use-application-dns.net", for compatibility reasons.Code:Select allAddress=10.142.189.241/32PrivateKey=xxx
MTU=1320DNS=10.128.0.1[Peer]PublicKey=xxxPresharedKey=xxxEndpoint=se3.vpn.airdns.org:51820AllowedIPs=0.0.0.0/0PersistentKeepalive=15You have two PCs you dont want going out wireguard sweden?There are multiple PCs, but for better transparency i kept only few clients in configCurrently i'm using this "Rules" list where I:- ENABLE client to be OUT of VPN- DISABLE client to be IN -> VPNCode:Select all/routing ruleaddaction=lookup-only-in-table comment=Mini-PC disabled=yes src-address=\192.168.10.50/32table=mainaddaction=lookup-only-in-table comment=Laptopdisabled=no\
    src-address=192.168.10.51/32table=mainaddaction=lookup disabled=nosrc-address=192.168.10.0/24table=useWGvpn-list.pngAssuming these need to go out regular local WAN?as stated above I ENABLE / DISABLE in Rules depends if they should be on VPN or NOT.Eg some page is not working in Sweden (I Enable rule)Any other local traffic that should occur ( between LANIPs ) ??just regular Local network , no VLANs or similar. All clients on same IP range on single DHCPif that's what you are askingThe IP not allowed internet, I gather thats for both local and Wireguard correct?I have somewhere rules to block Internet sometimes (for kids in case is too much)Otherwise all clients have full LAN / Internet access. Only main grouping is clients ON->VPN (sweden) , OFF VPN (local)

---
### Post 7
Author: Unknown
Date: Unknown

okay understood.Flexible list that need to go out wireguard swedenFlexible list that needs to be blocked from any Internet access.So you need to keep two firewall address lists up to date.those allowed LOCAL WANthose not allowed any WAN accessRest go through Sweden.You didnt confirm whether or not you get a public IP or that ISP router can forward a port to your router.This is to either keep or remove any port forwardings you have through the local WAN.Also to confirm no port forwarding is provided by Air wireguard so we can get rid of that noise too.

---
### Post 8
Author: Unknown
Date: Unknown

You didnt confirm whether or not you get a public IP or that ISP router can forward a port to your router.This is to either keep or remove any port forwardings you have through the local WAN.Also to confirm no port forwarding is provided by Air wireguard so we can get rid of that noise too.Yes, Port Forwarding is there and working. AirVPN is offering 5 ports, currently for test I'm using 2 port fwd without prerouting.This is how it looks like. You pick from the list of ports what is open and then they are keeping them on your account , regardless on which Country/City server you are using for VPNports.JPGI havent set yet Portfwd prerouting/remap rule,port2.JPGAs herehttps://airvpn.org/faq/port_forwarding/they say "do NOT forward on your router the same ports you use on your listening services while connected to the VPN."Probably this is for Remote connection,Server WebUI interfaces and such...?In PORTS setup page they say they NOT suggesting remap due to Tracker issueThis is only for p2p torrents,DC++ etc...?Otherwise bit confused, what is right to do in the end...Before i had torrent client like example: incoming port: 55555 and for VPN was 66666, then i set remap/preroute in Firewall rulesPorts setup Page notesport3.JPG

---
### Post 9
Author: Unknown
Date: Unknown

This is my first take on the subject.   This should resolve most issues.What is not clear is what the airvpn does with the original source addresses of the incoming traffic to its site.In other words we do not know if airvpn  sourcnats the incoming traffic to its own wireguard IP or not.If it does not, then return traffic from your router will get complex and will need more work.# 2025-01-25 12:20:13 by RouterOS 7.17CHANGES:/ip settingsset allow-fast-path=yes/interface detect-internetset detect-interface-list=none/interface list memberadd comment=defconf interface=bridge list=LANadd comment=defconf interface=ether1-WAN list=WANadd interface=AirVPN_Sweden list=WAN/ip firewall address-listadd address=192.168.10.X  list=Authorizedcomment="admin PC"add address=192.168.10.Y  list=Authorized comment="admin laptop"add address=192.168.10.Z  list=Authorized comment="admin smartphone"add address=......... list=exceptionscomment="as required, LAN IPs using local WAN"add address= ........ list=no-internetcommment="as required, LAN IPs with no WAN access"/ip firewall filteradd action=accept chain=input comment=\"defconf: accept established,related,untracked" connection-state=\established,related,untrackedadd action=drop chain=input comment="defconf: drop invalid" connection-state=\invalidadd action=accept chain=input comment="defconf: accept ICMP" protocol=icmpadd action=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)" dst-address=127.0.0.1add action=accept chain=input comment="admin access"  in-interface-list=LAN src-address-list=Authorizedadd action=accept chain=input comment="users to services" in-interface-list=LAN src-address-list=exceptionsdst-port=53 protocol=udpadd action=accept chain=input comment="users to services" in-interface-list=LAN src-address-list=exceptions dst-port=53 protocol=tcpadd action=drop chain=input comment="drop all else"add action=accept chain=forward comment="defconf: accept in ipsec policy" \ipsec-policy=in,ipsecadd action=accept chain=forward comment="defconf: accept out ipsec policy" \ipsec-policy=out,ipsecadd action=fasttrack-connection chain=forward comment="defconf: fasttrack" \connection-state=established,relateddisabled=yeshw-offload=yesadd action=accept chain=forward comment=\"defconf: accept established,related, untracked" connection-state=\established,related,untrackedadd action=drop chain=forward comment="defconf: drop invalid" \connection-state=invalidadd action=accept chain=forward in-interface-list=LAN out-interface=AirVPN_Sweden src-address-list=!no-Internetadd action=accept chain=forward in-interface-list=LAN out-interface-list=WAN src-address-list=exceptionsadd action=accept chain=forward comment="port forwarding" connection-nat-state=dstnatadd action=drop chain=forward comment="drop all else"/ip firewall natadd action=masquerade chain=srcnat comment="defconf: masquerade" \ipsec-policy=out,none out-interface-list=WANadd action=dst-nat chain=dstnat dst-port=53 protocol=udp src-address-list=!exceptions to-address=10.128.0.1add action=dst-nat chain=dstnat dst-port=53 protocol=tcp src-address-list=!exceptions to-address=10.128.0.1add action=dst-nat chain=dstnat comment="Transmission BT - VPN" dst-port=\54518 in-interface=AirVPN_Sweden log-prefix=TransmissionBT protocol=tcp \to-addresses=192.168.10.101add action=dst-nat chain=dstnat comment="Transmission BT - VPN" dst-port=\54518 in-interface=AirVPN_Sweden log-prefix=TransmissionBT protocol=udp \to-addresses=192.168.10.101add action=dst-nat chain=dstnat comment="Transmission BT - VPN" dst-port=\54519 in-interface=AirVPN_Sweden log-prefix=TransmissionBT protocol=tcp \to-addresses=192.168.10.101add action=dst-nat chain=dstnat comment="Transmission BT - VPN" dst-port=\54519 in-interface=AirVPN_Sweden log-prefix=TransmissionBT protocol=udp \to-addresses=192.168.10.101/ip routeadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=AirVPN_Sweden \routing-table=useWG scope=30 suppress-hw-offload=no target-scope=10add dst-address=10.128.0.1 gateway=AirVPN_Sweden routing-table=main/routing rule{exceptions stated first in order - as required - ensure keep firewall address list up to date}add action=lookup-only-in-table comment="LANIP-1 going out local WAN"  src-address=as required   table=mainadd action=lookup-only-in-table comment="LANIP-2 going out local WAN"  src-address=as required   table=main...add action=lookup-only-in-table comment=LANIP-N going out local WAN"  src-address=as required   table=main{ rest of LAN goes through Sweden }add action=lookup-only-in-table src-address=192.168.10.0/24 table=useWG  comment="Rest of LAN thru Sweden"/tool mac-serverset allowed-interface-list=none/tool mac-server mac-winboxset allowed-interface-list=LAN

---
### Post 10
Author: Unknown
Date: Unknown

If we find out that airvpn does not sourcnat external user source IP, then we may look at some additional work to ensure traffic flows properly in all situations.So far there are no issues for the traffic to reach the router and the LAN server.Lets say this time the request is not sourcenatted to airvpnIP but from a public IP.Router will attempt to return traffic how.......................Normally it would be sent to local WAN, but we have to be cognizant of the sending device and what rules it lives under.Thus the serverIP is critical.If the serverIP is captured by the Routing Rule, then no change is required as any return traffic from this IP (or originating traffic for that matter) would get caught in the routing rule.Assessing therefore, mangling or other rules are likely not needed as the above config works for both cases.

---
### Post 11
Author: Unknown
Date: Unknown

thanks for update...Seems to be much better now!Browser Extension for IP resolves the VPN IP right away (thats a good sign)Also the paintnet update works.I will use it for few days, to test everything and see...then the last thing will be to- add different VPN countries- modify this rule for VPN DNS - add dst-address=10.128.0.1 gateway=AirVPN_Sweden routing-table=mainto be able to read address from dns.airservers.org (in case VPN provider will change DNS IP)Here the "LIVE" config exportCode:Select all# 2025-01-27 15:40:47 by RouterOS 7.17# software id = NNA1-7M3W## model = C53UiG+5HPaxD2HPaxD# serial number = xxx/interfacebridgeaddadmin-mac=XX:XX:XX:XX:XX:XXauto-mac=nocomment=defconf name=bridge \
    port-cost-mode=short/interfaceethernetset[finddefault-name=ether1]comment=WAN mac-address=XX:XX:XX:XX:XX:XX\
    name=ether1-WAN/interfacewireguardaddlisten-port=13231mtu=1320name=AirVPN_Swedenaddcomment=back-to-home-vpn disabled=yes listen-port=40556mtu=1420name=\
    back-to-home-vpn/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/interfacewifi channeladdband=2ghz-ax disabled=nofrequency=2422,2447,2467name=ch-2ghz\
    skip-dfs-channels=10min-cac width=20mhzaddband=5ghz-ax disabled=nofrequency=5180,5260,5320name=ch-5ghz\
    skip-dfs-channels=10min-cac width=20/40/80mhz/interfacewifi securityaddauthentication-types=wpa2-psk,wpa3-psk disabled=noname=wifi-sec wps=\
    disable/interfacewifi configurationaddantenna-gain=0channel=ch-2ghzcountry=Czechdisabled=noname=\
    wifi-conf-2.4Ghzsecurity=wifi-sec ssid=xxxaddantenna-gain=0channel=ch-5ghzcountry=Czechdisabled=noname=\
    wifi-conf-5Ghzsecurity=wifi-sec ssid=xxx_5G/interfacewifiaddconfiguration=wifi-conf-5Ghzconfiguration.mode=ap.tx-power=24disabled=\noname=cap-wifi1 radio-mac=XX:XX:XX:XX:XX:XXaddconfiguration=wifi-conf-2.4Ghzconfiguration.mode=ap.tx-power=24\
    disabled=noname=cap-wifi2 radio-mac=XX:XX:XX:XX:XX:XXset[finddefault-name=wifi1]configuration=wifi-conf-5Ghz\
    configuration.mode=ap disabled=noname=wifi1-5gset[finddefault-name=wifi2]configuration=wifi-conf-2.4Ghz\
    configuration.mode=ap disabled=noname=wifi2-2g/iot lora serversaddaddress=eu1.cloud.thethings.industries name="TTS Cloud (eu1)"protocol=\
    UDPaddaddress=nam1.cloud.thethings.industries name="TTS Cloud (nam1)"protocol=\
    UDPaddaddress=au1.cloud.thethings.industries name="TTS Cloud (au1)"protocol=\
    UDPaddaddress=eu1.cloud.thethings.network name="TTN V3 (eu1)"protocol=UDPaddaddress=nam1.cloud.thethings.network name="TTN V3 (nam1)"protocol=UDPaddaddress=au1.cloud.thethings.network name="TTN V3 (au1)"protocol=UDP/ip kid-controladdfri=0s-1dmon=0s-1dname=system-dummy sat=0s-1dsun=0s-1dthu=0s-1dtue=\0s-1dtur-fri=0s-1dtur-mon=0s-1dtur-sat=0s-1dtur-sun=0s-1dtur-thu=\0s-1dtur-tue=0s-1dtur-wed=0s-1dwed=0s-1dadddisabled=yes fri=17h30m-19hmon=17h30m-19hname=kids sat=17h30m-19h30m\
    sun=17h30m-19hthu=17h30m-19htue=17h30m-19hwed=17h30m-19h/ip pooladdname=dhcp ranges=192.168.10.10-192.168.10.254/ip dhcp-serveraddaddress-pool=dhcpinterface=bridge lease-time=10mname=dhcp1/ip smb usersset[finddefault=yes]disabled=yes/queue simpleaddcomment=Arduino-Boxmax-limit=10/10name=Arduino-Boxtarget=\192.168.10.112/32addcomment=Arduino-Garazmax-limit=10/10name=Arduino-Garaztarget=\192.168.10.110/32/queue treeaddmax-limit=1Gname=TotalBandparent=globaladdmax-limit=50Mname="01 Games"packet-mark=games parent=TotalBandaddmax-limit=20Mname="02 YouTube"packet-mark=youtube parent=TotalBandaddcomment="Browsing, downloads"max-limit=1Gname="03 Other"packet-mark=\no-mark parent=TotalBand/routing tableadddisabled=nofib name=useWG/zerotiersetzt1 disabled=nodisabled=no/interfacebridge portaddbridge=bridge comment=defconfinterface=ether2internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=ether3internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=ether4internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=ether5internal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=wifi1-5ginternal-path-cost=10\
    path-cost=10addbridge=bridge comment=defconfinterface=wifi2-2ginternal-path-cost=10\
    path-cost=10/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=LAN/ip settingssetallow-fast-path=yes/ipv6 settingssetmax-neighbor-entries=15360/interfacedetect-internetsetinternet-interface-list=all lan-interface-list=all wan-interface-list=all/interfacelist memberaddcomment=defconfinterface=bridge list=LANaddcomment=defconfinterface=ether1-WAN list=WANaddinterface=AirVPN_Swedenlist=WAN/interfacewifi access-listaddaction=reject allow-signal-out-of-range=10sdisabled=nointerface=\
    wifi1-5gsignal-range=-120..-85addaction=reject allow-signal-out-of-range=10sdisabled=nointerface=\
    wifi2-2gsignal-range=-120..-85/interfacewifi capsmansetca-certificate=autoenabled=yespackage-path=""require-peer-certificate=\noupgrade-policy=require-same-version/interfacewifi provisioningaddaction=create-enabled disabled=nomaster-configuration=wifi-conf-5Ghz\
    supported-bands=5ghz-axaddaction=create-enabled disabled=nomaster-configuration=wifi-conf-2.4Ghz\
    supported-bands=2ghz-ax/interfacewireguard peersaddallowed-address=0.0.0.0/0endpoint-address=se3.vpn.airdns.org \
    endpoint-port=51820interface=AirVPN_Swedenname=peer4 \
    persistent-keepalive=35spreshared-key=\"xxx"public-key=\"xxx"/iot lora traffic optionssetcrc-errors=nosetcrc-errors=no/ip addressaddaddress=192.168.10.1/24comment=defconfinterface=bridge network=\192.168.10.0addaddress=10.142.189.241interface=AirVPN_Swedennetwork=10.142.189.0/ip cloudsetback-to-home-vpn=enabled ddns-enabled=yes ddns-update-interval=10m/ip cloud back-to-home-usersaddallow-lan=yes comment=" Xiaomi 2201122G"name="MikroTik hAP AX3"\private-key="xxx"public-key=\"xxx"/ip dhcp-clientaddcomment=defconfinterface=ether1-WAN/ip dhcp-server leaseaddaddress=192.168.10.50client-id=1:a8:a1:59:44:6f:3bcomment=MiniPC\
    mac-address=A8:A1:59:44:6F:3Brate-limit=1000M/1000Mserver=dhcp1addaddress=192.168.10.70client-id=1:4:cf:8c:e8:42:18comment="Vacuum"\
    mac-address=04:CF:8C:E8:42:18server=dhcp1/ip dhcp-server networkaddaddress=192.168.10.0/24comment="VPN DNS Servers"dns-server=192.168.10.2\
    gateway=192.168.10.1/ip dnssetallow-remote-requests=yes servers=8.8.8.8,8.8.4.4/ip firewall address-listaddaddress=192.168.10.51list=No-Internetaddaddress=se3.vpn.airdns.org list=3rdPartyVPN2addaddress=192.168.10.50comment=MiniPClist=Authorizedaddaddress=192.168.10.60comment=M12Pro list=Authorized/ip firewall filteraddaction=jump chain=forward comment="jump to kid-control rules"\
    jump-target=kid-controladdaction=drop chain=forward comment="No-Internet Rule"log=yes log-prefix=\Blocked-Internet-Triesout-interface-list=WAN src-address-list=\No-Internetaddaction=accept chain=input dst-port=51820in-interface=ether1-WAN \
    protocol=udpaddaction=accept chain=input comment="defconf: allow all coming from LAN"\in-interface-list=LANaddaction=accept chain=forwardin-interface=bridgeout-interface-list=WANaddaction=accept chain=forwardin-interface=bridgeout-interface=\AirVPN_Swedenaddaction=accept chain=input comment="allow Winbox"port=8291protocol=tcpaddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input comment="admin access"in-interface-list=LAN \
    src-address-list=Authorizedaddaction=accept chain=input comment="users to services"dst-port=53\in-interface-list=LAN protocol=udp src-address-list=exceptionsaddaction=accept chain=input comment="users to services"dst-port=53\in-interface-list=LAN protocol=tcp src-address-list=exceptionsaddaction=drop chain=input comment="drop all else"addaction=accept chain=forward comment="defconf: accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related disabled=yes hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=accept chain=forwardin-interface-list=LANout-interface=\AirVPN_Swedensrc-address-list=!no-Internetaddaction=accept chain=forwardin-interface-list=LANout-interface-list=WAN \
    src-address-list=exceptionsaddaction=accept chain=forward comment="port forwarding"\
    connection-nat-state=dstnataddaction=drop chain=forward comment="drop all else"/ip firewall mangleaddaction=change-mss chain=forward comment=\"Clamp MSS to PMTU for Outgoing packets"new-mss=clamp-to-pmtu \out-interface=AirVPN_Swedenprotocol=tcp tcp-flags=syn/ip firewall nataddaction=masquerade chain=srcnat disabled=yesout-interface=AirVPN_Swedenaddaction=masquerade chain=srcnat comment="defconf: masquerade"\
    ipsec-policy=out,noneout-interface-list=WANaddaction=dst-nat chain=dstnat dst-port=53protocol=udp src-address-list=\!exceptions to-addresses=10.128.0.1addaction=dst-nat chain=dstnat dst-port=53protocol=tcp src-address-list=\!exceptions to-addresses=10.128.0.1addaction=dst-nat chain=dstnat comment=Loxonedst-port=7777in-interface=\
    ether1-WAN log=yes log-prefix=Loxoneprotocol=tcp to-addresses=\192.168.10.100to-ports=7777addaction=dst-nat chain=dstnat comment="Transmission BT - Work"dst-port=\7778in-interface=ether1-WAN log=yes protocol=tcp to-addresses=\192.168.10.101to-ports=7788addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54518in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=tcp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54518in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=udp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54519in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=tcp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=\54519in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=udp \
    to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="SSH Router"disabled=yes dst-port=\2220in-interface=ether1-WAN log=yes protocol=tcp to-addresses=\192.168.10.1to-ports=2222/ip firewall service-portsetftp disabled=yes/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip kid-control deviceaddmac-address=60:45:CB:9A:3F:F0 name=Toweruser=system-dummy/ip routeadddisabled=nodistance=1dst-address=0.0.0.0/0gateway=AirVPN_Sweden\
    routing-table=useWG scope=30suppress-hw-offload=notarget-scope=10adddst-address=10.128.0.1gateway=AirVPN_Swedenrouting-table=main/ip servicesettelnet disabled=yessetftp disabled=yessetssh port=2222setapi disabled=yes/ip smb sharesset[finddefault=yes]directory=/pub/routing ruleaddaction=lookup-only-in-table comment=Mini-PC disabled=yes src-address=\192.168.10.50/32table=mainaddaction=lookup-only-in-table comment=Laptopdisabled=no\
    src-address=192.168.10.51/32table=mainaddaction=lookup comment="Rest of LAN thru Sweden"disabled=nosrc-address=\192.168.10.0/24table=useWG/system clocksettime-zone-name=Europe/Prague/system identitysetname="MikroTik hAP AX3"/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=0.cz.pool.ntp.orgaddaddress=time1.google.comaddaddress=time2.google.com/tool bandwidth-serversetenabled=no/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=LANOnly issue what presist is unRAID servers - Docker update check, but this seems to be an generic issue with VPN server which are probably blacklisted on docker.com domainCode:Select allJan2715:15:08unRAIDTower nginx:2025/01/2715:15:08[error]20521#20521: *1630914 upstream timed out (110: Connection timed out) while reading response header from upstream, client: 192.168.x.x, server: , request: "POST /plugins/dynamix.docker.manager/include/DockerUpdate.php HTTP/1.1", upstream: "fastcgi://unix:/var/run/php-fpm.sock", host: "192.168.x.x", referrer: "http://192.168.x.x/Docker"m4.JPGI did most of the changes, but what im not sure about is FW rules.1. The clients via VPN or NOTI need to maintain FW address-list?Code:Select all/ip firewall address-listaddaddress=192.168.10.Xlist=Authorizedcomment="admin PC"addaddress=192.168.10.Ylist=Authorizedcomment="admin laptop"addaddress=192.168.10.Zlist=Authorizedcomment="admin smartphone"addaddress=.........list=exceptions comment="as required, LAN IPs using local WAN"addaddress=........list=no-internet commment="as required, LAN IPs with no WAN access"Including Routing rule?Code:Select all/routing rule{exceptions stated firstinorder-asrequired-ensurekeep firewall address list up to date}addaction=lookup-only-in-table comment="LANIP-1 going out local WAN"src-address=asrequired table=mainaddaction=lookup-only-in-table comment="LANIP-2 going out local WAN"src-address=asrequired table=main...addaction=lookup-only-in-table comment=LANIP-N goingoutlocalWAN" src-address=as required table=main
{ rest of LAN goes through Sweden }
add action=lookup-only-in-table src-address=192.168.10.0/24 table=useWG comment="RestofLAN thruSweden"So if i want "Admin PC" on VPN/NOTonVPN i need to Enable / Disable in both Lists?as until now I was doing it only in "/routing rule" list2. I did make them in order as you suggested, but few rules are gonne. Want to confirm if I should completely disable/remove them0-7 FW valuesCode:Select all/ip firewall filteraddaction=jump chain=forward comment="jump to kid-control rules"\
    jump-target=kid-controladdaction=drop chain=forward comment="No-Internet Rule"log=yes log-prefix=\Blocked-Internet-Triesout-interface-list=WAN src-address-list=\No-Internetaddaction=accept chain=input dst-port=51820in-interface=ether1-WAN \
    protocol=udpaddaction=accept chain=input comment="defconf: allow all coming from LAN"\in-interface-list=LANaddaction=accept chain=forwardin-interface=bridgeout-interface-list=WANaddaction=accept chain=forwardin-interface=bridgeout-interface=\AirVPN_Swedenaddaction=accept chain=input comment="allow Winbox"port=8291protocol=tcpaddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input comment="admin access"in-interface-list=LAN \
    src-address-list=Authorizedaddaction=accept chain=input comment="users to services"dst-port=53\in-interface-list=LAN protocol=udp src-address-list=exceptionsaddaction=accept chain=input comment="users to services"dst-port=53\in-interface-list=LAN protocol=tcp src-address-list=exceptionsaddaction=drop chain=input comment="drop all else"addaction=accept chain=forward comment="defconf: accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related disabled=yes hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=accept chain=forwardin-interface-list=LANout-interface=\AirVPN_Swedensrc-address-list=!no-Internetaddaction=accept chain=forwardin-interface-list=LANout-interface-list=WAN \
    src-address-list=exceptionsaddaction=accept chain=forward comment="port forwarding"\
    connection-nat-state=dstnataddaction=drop chain=forward comment="drop all else"m2.JPG- back-to-home is not possible to remove via WinBox interface (feature or bug?)m1.JPG3. NAT rulesupdated as suggested- rule 0 can be disabled/ removed now?m3.JPG4. /routing rule{exceptions stated first in order - as required - ensure keep firewall address list up to date}Not possible to "change order" in WinBox UI, but I assume it doesnt matter as it seems to work fine5. Thought this might help for not able to connect to (via WinBox) Router via IP , but not working only via MACNot sure where is the issue, but i've learned to live with itCode:Select all/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=LAN

---
### Post 12
Author: Unknown
Date: Unknown

a small update...after setting up everything there seems to be portfwd issue, which I later find out that was due to another Transmission/torrent client setting...Wanted be sure, so cleared the whole config of ROS and strarted from scratch...seems that even I did the same config as i had before, line by line as it didnt want to take whole import at once (next time will do "/export show-sensitive verbose file=01-default" backup) , yeah we learn on mistakes(now is by default many IPv6 settings, i dont use any so I disabled it...)I still had issues...mostly with loading pages. So in config I had this line, which did the trick also 1y ago with similar issue. But you didnt mention it now...Code:Select all/ip firewall mangleaddaction=change-mss chain=forward comment=\"Clamp MSS to PMTU for Outgoing packets"new-mss=clamp-to-pmtu \out-interface=AirVPN_Swedenprotocol=tcp tcp-flags=syn

---
### Post 13
Author: Unknown
Date: Unknown

Yes it still recommended for third party VPNs, there are actually two in case one doesnt work welladd action=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets" new-mss=clamp-to-pmtu out-interface=wireguard1 passthrough=yes protocol=tcp tcp-flags=synadd action=change-mss chain=forward new-mss=1380 out-interface=wireguard1 protocol=tcp tcp-flags=syn tcp-mss=1381-65535

---
### Post 14
Author: Unknown
Date: Unknown

Thanks I've added also 2nd oneseems like those "fasttrack" were added and cant be deleted from WinBox UI, but disabled...Code:Select all[admin@MikroTik hAP AX3]/ip/firewall/mangle>printFlags:X-disabled,I-invalid;D-dynamic0D;;;special dummy rule to show fasttrack counters
      chain=prerouting action=passthrough1D;;;special dummy rule to show fasttrack counters
      chain=forward action=passthrough2D;;;special dummy rule to show fasttrack counters
      chain=postrouting action=passthrough3;;;ClampMSS to PMTUforOutgoingpackets
      chain=forward action=change-mssnew-mss=clamp-to-pmtu passthrough=yes tcp-flags=syn protocol=tcpout-interface=AirVPN_Swedenlog=nolog-prefix=""4chain=forward action=change-mssnew-mss=1380tcp-flags=syn protocol=tcpout-interface=AirVPN_Swedentcp-mss=1381-65535Anyway still i find the setting up WG on Mikrotik is way too complex vs other router where i can import config and it just works...1. Did output again(easier to read), please could you check on FW what can be removed disabled?01-defaultTerse5-edit.rsc2. IPv6 rules can be left there? as with "lastest" factory reset they just shown upso did "/ipv6 settings set disable-ipv6=yes" hope it wont interfere with VPN now3. For adding another VPN location , I need to basically setup each line/setting where it says "AirVPN_Sweden" duplicate to "AirVPN_NL" or such way?Thanks!

---
### Post 15
Author: Unknown
Date: Unknown

butt ugly format for export.................Also, pay more attention to security this opens up winbox to the entire internet.add action=accept chain=input comment="allow Winbox" port=8291 protocol=tcpSimply only allow admin "authorized IPs" to access the router via the input chain, job done!!Use only one of the clamp mangle rules not both.If doing ssh to router, then drop the dstnat rule ( only if ssh is a server running on LAN).Your queue rules are meaningless, unless I misunderstood simple queues, and thus you should disable them for now and articulate what it is you wish to accomplish.Then this will likely precipitate disabling fastrack.As for adding another VPN location, another instance of wireguard or both,You would need to provide more details...............   What does the provider give to you for this functionality, ........???...Code:Select all# model = C53UiG+5HPaxD2HPaxD# serial number = xxx/interfacebridgeaddadmin-mac=48:A9:8A:07:9A:63auto-mac=nocomment=defconf name=bridge/interfaceethernetset[finddefault-name=ether1]comment=WAN mac-address=F8:32:E4:4F:98:B8 name=ether1-WAN/interfacewireguardaddcomment="AirVPN SE"listen-port=13231mtu=1320name=AirVPN_Swedenprivate-key="xxx"/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LAN/interfacewifi channeladdband=2ghz-ax disabled=nofrequency=2422,2447,2467name=ch-2ghzskip-dfs-channels=10min-cac width=20mhzaddband=5ghz-ax disabled=nofrequency=5180,5260,5320name=ch-5ghzskip-dfs-channels=10min-cac width=20/40/80mhz/interfacewifi securityaddauthentication-types=wpa2-psk,wpa3-psk disabled=noname=wifi-sec passphrase=xxx wps=disable/interfacewifi configurationaddantenna-gain=0channel=ch-2ghzcountry=Czechdisabled=noname=wifi-conf-2.4Ghzsecurity=wifi-sec ssid=XXXaddantenna-gain=0channel=ch-5ghzcountry=Czechdisabled=noname=wifi-conf-5Ghzsecurity=wifi-sec ssid=XXX_5Gaddconfiguration=wifi-conf-5Ghzconfiguration.mode=ap.tx-power=24disabled=noname=cap-wifi1 radio-mac=48:A9:8A:C2:8D:EEaddconfiguration=wifi-conf-2.4Ghzconfiguration.mode=ap.tx-power=24disabled=noname=cap-wifi2 radio-mac=48:A9:8A:C2:8D:EF/interfacewifiset[finddefault-name=wifi1]channel=ch-5ghzconfiguration=wifi-conf-5Ghzconfiguration.mode=ap disabled=noname=wifi1-5gsecurity=wifi-sec security.ft=yes.ft-over-ds=yesset[finddefault-name=wifi2]channel=ch-2ghzconfiguration=wifi-conf-2.4Ghzconfiguration.mode=ap disabled=noname=wifi2-2gsecurity=wifi-sec security.authentication-types=wpa2-psk,wpa3-psk.ft=yes.ft-over-ds=yes/iot lora serversaddaddress=eu1.cloud.thethings.industries name="TTS Cloud (eu1)"protocol=UDPaddaddress=nam1.cloud.thethings.industries name="TTS Cloud (nam1)"protocol=UDPaddaddress=au1.cloud.thethings.industries name="TTS Cloud (au1)"protocol=UDPaddaddress=eu1.cloud.thethings.network name="TTN V3 (eu1)"protocol=UDPaddaddress=nam1.cloud.thethings.network name="TTN V3 (nam1)"protocol=UDPaddaddress=au1.cloud.thethings.network name="TTN V3 (au1)"protocol=UDP/ip kid-controladdfri=0s-1dmon=0s-1dname=system-dummy sat=0s-1dsun=0s-1dthu=0s-1dtue=0s-1dtur-fri=0s-1dtur-mon=0s-1dtur-sat=0s-1dtur-sun=0s-1dtur-thu=0s-1dtur-tue=0s-1dtur-wed=0s-1dwed=0s-1dadddisabled=yes fri=17h30m-19hmon=17h30m-19hname=kids sat=17h30m-19h30msun=17h30m-19hthu=17h30m-19htue=17h30m-19hwed=17h30m-19h/ip pooladdname=dhcp ranges=192.168.10.10-192.168.10.254/ip dhcp-serveraddaddress-pool=dhcpinterface=bridge lease-time=10mname=dhcp1/ip smb usersset[finddefault=yes]disabled=yes/queue simpleaddcomment=Arduino-Boxmax-limit=10/10name=Arduino-Boxtarget=192.168.10.112/32disabled=yesaddcomment=Arduino-Garazmax-limit=10/10name=Arduino-Garaztarget=192.168.10.110/32disabled=yes/routing tableadddisabled=nofib name=useWG/disk settingssetauto-media-interface=bridge/interfacebridge portaddbridge=bridge comment=defconfinterface=ether2addbridge=bridge comment=defconfinterface=ether3addbridge=bridge comment=defconfinterface=ether4addbridge=bridge comment=defconfinterface=ether5addbridge=bridge comment=defconfinterface=wifi1-5gaddbridge=bridge comment=defconfinterface=wifi2-2g/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=LAN/ipv6 settingssetdisable-ipv6=yes/interfacedetect-internetsetdetect-interface-list=none/interfacelist memberaddinterface=bridge list=LANinterface=ether1-WAN list=WANaddinterface=AirVPN_Swedenlist=WAN/interfacewifi access-listaddaction=reject allow-signal-out-of-range=10sdisabled=nointerface=wifi1-5gsignal-range=-120..-85addaction=reject allow-signal-out-of-range=10sdisabled=nointerface=wifi2-2gsignal-range=-120..-85/interfacewifi capsmansetca-certificate=autoenabled=yespackage-path=""require-peer-certificate=noupgrade-policy=require-same-version/interfacewifi provisioningaddaction=create-enabled disabled=nomaster-configuration=wifi-conf-5Ghzsupported-bands=5ghz-ax/interfacewifi provisioningaddaction=create-enabled disabled=nomaster-configuration=wifi-conf-2.4Ghzsupported-bands=2ghz-ax/interfacewireguard peersaddallowed-address=0.0.0.0/0endpoint-address=se3.vpn.airdns.org endpoint-port=51820interface=AirVPN_Swedenname=peer1 persistent-keepalive=35spreshared-key="xxx"public-key="xxx"/iot lora traffic optionssetcrc-errors=no/ip addressaddaddress=192.168.10.1/24comment=defconfinterface=bridge network=192.168.10.0addaddress=10.142.189.241interface=AirVPN_Swedennetwork=10.142.189.0/ip dhcp-clientaddcomment=defconfinterface=ether1-WAN/ip dhcp-server leaseaddaddress=192.168.10.50client-id=1:a8:a1:59:44:6f:3bcomment=MiniPCmac-address=A8:A1:59:44:6F:3Brate-limit=1000M/1000Mserver=dhcp1addaddress=192.168.10.70client-id=1:4:cf:8c:e8:42:18comment="Vacuum"mac-address=04:CF:8C:E8:42:18server=dhcp1/ip dhcp-server networkaddaddress=192.168.10.0/24comment="VPN DNS Servers"dns-server=192.168.10.2gateway=192.168.10.1/ip dnssetallow-remote-requests=yes servers=8.8.8.8,8.8.4.4/ip dnsstaticaddaddress=192.168.10.1comment=defconf disabled=yes name=router.lan type=A/ip firewall address-listaddaddress=192.168.10.51disabled=yes list=Local-Internetcomment="Users using Local Internet only"addaddress=192.168.10.XXdisabled=yes list=No-Internetcomment="Users with NO internet access at all"addaddress=se3.vpn.airdns.org list=3rdPartyVPNaddaddress=dns.airservers.org list=3rdPartyVPNaddaddress=192.168.10.50comment=MiniPClist=Authorizedaddaddress=192.168.10.60comment=M12Pro list=Authorizedaddaddress=192.168.10.101comment="Tower"list=Authorized/ip firewall filteraddaction=accept chain=input comment="defconf: accept established,related,untracked"connection-state=established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment="defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input comment="admin access"in-interface-list=LAN src-address-list=Authorizedaddaction=accept chain=input comment="users to services"dst-port=53in-interface-list=LAN protocol=udp src-address-list=Local-Internetaddaction=accept chain=input comment="users to services"dst-port=53in-interface-list=LAN protocol=tcp src-address-list=Local-Internetaddaction=drop chain=input comment="drop all else"addaction=accept chain=forward comment="defconf: accept in ipsec policy"ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"connection-state=established,related disabled=yes hw-offload=yesaddaction=accept chain=forward comment="defconf: accept established,related, untracked"connection-state=established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"connection-state=invalidaddaction=accept chain=forward comment="local internet access"in-interface-list=LANout-interface-list=WAN src-address-list=Local-Internetaddaction=accept chain=forward  comment="Sweden access"in-interface-list=LANout-interface=AirVPN_Swedensrc-address-list=!No-Internetaddaction=accept chain=forward comment="port forwarding"connection-nat-state=dstnataddaction=drop chain=forward comment="drop all else"/ip firewall mangleaddaction=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets"new-mss=clamp-to-pmtuout-interface=AirVPN_Swedenprotocol=tcp tcp-flags=syn/ip firewall nataddaction=masquerade chain=srcnat comment="defconf: masquerade"ipsec-policy=out,noneout-interface-list=WANaddaction=dst-nat chain=dstnat dst-port=53protocol=udp src-address-list=!Local-Internetto-addresses=10.128.0.1addaction=dst-nat chain=dstnat dst-port=53protocol=tcp src-address-list=!Local-Internetto-addresses=10.128.0.1addaction=dst-nat chain=dstnat comment=Loxonedst-port=7777in-interface=ether1-WAN log=yes log-prefix=Loxoneprotocol=tcp to-addresses=192.168.10.100addaction=dst-nat chain=dstnat comment="Transmission BT - Work"dst-port=7778in-interface=ether1-WAN log=yes protocol=tcp to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=54518in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=tcp to-addresses=192.168.10.101addaction=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=54518in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=udp to-addresses=192.168.10.101action=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=54519in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=tcp to-addresses=192.168.10.101action=dst-nat chain=dstnat comment="Transmission BT - VPN"dst-port=54519in-interface=AirVPN_Swedenlog-prefix=TransmissionBTprotocol=udp to-addresses=192.168.10.101/ip firewall service-portsetftp disabled=yes/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip kid-control deviceaddmac-address=60:45:CB:9A:3F:F0 name=Toweruser=system-dummyaddmac-address=64:DD:E9:32:45:19name="Mi12 Pro;2"user=system-dummyaddmac-address=04:CF:8C:E8:42:18name="Vacuum"user=system-dummy/ip routeadddisabled=nodistance=1dst-address=0.0.0.0/0gateway=AirVPN_Swedenrouting-table=useWG scope=30suppress-hw-offload=notarget-scope=10adddisabled=nodistance=1dst-address=10.128.0.1/32gateway=AirVPN_Swedenrouting-table=main scope=30suppress-hw-offload=notarget-scope=10/ip servicesettelnet disabled=yessetftp disabled=yessetssh port=2222/ipv6 firewall filteraddchain=input action=dropaddchain=forward action=drop/routing ruleaddaction=lookup-only-in-table comment=ZigBee-Hubdisabled=nosrc-address=192.168.10.20/32table=mainaddaction=lookup-only-in-table comment=Rigdisabled=nosrc-address=192.168.10.49/32table=mainaddaction=lookup-only-in-table comment=Mini-PC disabled=yes src-address=192.168.10.50/32table=mainaddaction=lookup comment="Rest of LAN thru Sweden"disabled=nosrc-address=192.168.10.0/24table=useWG/system clocksettime-zone-name=Europe/Prague/system identitysetname="MikroTik hAP AX3"/system notesetshow-at-login=no/system ntp clientsetenabled=yes/system ntp client serversaddaddress=0.cz.pool.ntp.orgaddaddress=time1.google.comaddaddress=time2.google.com/system routerboard mode-buttonsetenabled=yes on-event=dark-mode/system routerboard wps-buttonsetenabled=yes on-event=wps-accept/system scriptaddcomment=defconf dont-require-permissions=noname=dark-mode owner=*sys policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source="\r\
    \n   :if ([system leds settings get all-leds-off] = \"never\") do={\r\
    \n     /system leds settings set all-leds-off=immediate \r\
    \n   } else={\r\
    \n     /system leds settings set all-leds-off=never \r\
    \n   }\r\
    \n "/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=LAN....Also do not quite understand your setupIf you have exceptions for traffic not going out to Sweden in routing............192.168.10.20 - zigbee hub192.168.10.49 - rig192.168.10.50 - minipcThen what is their relations ship to the firewall address lists.  You clearly want their traffic not to go out Sweden VPN sowhich category do they fall into.........Local Internet?No internet?Why do you bother have a 192.168.10.2   DNS entry for /ip dhcp-serverBut then have a static /IP DNS setting for 192.168.10.1  ???

---
### Post 16
Author: Unknown
Date: Unknown

1. butt ugly format for export.................Which command to use then? without Verbose?2. Also, pay more attention to security this opens up winbox to the entire internet.add action=accept chain=input comment="allow Winbox" port=8291 protocol=tcpSimply only allow admin "authorized IPs" to access the router via the input chain, job done!!changed to:7    ;;; allow Winboxchain=input action=accept protocol=tcp src-address-list=Authorized port=8291 log=no log-prefix=""3.Use only one of the clamp mangle rules not both.Ok testing which one will behave better4. If doing ssh to router, then drop the dstnat rule ( only if ssh is a server running on LAN).SSH Router rule is disabled , I just have it in case I would need it in Future/ip firewall nat add action=dst-nat chain=dstnat comment="SSH Router" disabled=yes dst-port=2220 in-interface=ether1-WAN log=yes protocol=tcp to-addresses=192.168.10.1 to-ports=22225.Your queue rules are meaningless, unless I misunderstood simple queues, and thus you should disable them for now and articulate what it is you wish to accomplish.Then this will likely precipitate disabling fastrack.If you mean those...If I recall correctly is was following some guide to set some speedlimit and track / monitor data transfer. I guess it can be disabled or removed.../queue simple add comment=Arduino-Box max-limit=10/10 name=Arduino-Box target=192.168.10.112/32/queue simple add comment=Arduino-Garaz max-limit=10/10 name=Arduino-Garaz target=192.168.10.110/326. As for adding another VPN location, another instance of wireguard or both,You would need to provide more details............... What does the provider give to you for this functionality, ........???Well I will just generate/download new config and this is how config looks:Current Sweden IPv4Code:Select all[Interface]Address=10.142.189.241/32PrivateKey=xxx
MTU=1320DNS=10.128.0.1[Peer]PublicKey=xxxPresharedKey=xxxEndpoint=se3.vpn.airdns.org:51820AllowedIPs=0.0.0.0/0PersistentKeepalive=15Swiss - seems like there is just "Endpoint " name difference, rest is the same (also keys)Code:Select allEndpoint=ch3.vpn.airdns.org:51820then there is an option to use IPv4 + IPv6Code:Select all[Interface]Address=10.142.189.241/32,fd7d:76ee:e68f:a993:d32f:26f3:cf63:5f5a/128PrivateKey=xxx
MTU=1320DNS=10.128.0.1,fd7d:76ee:e68f:a993::1[Peer]PublicKey=xxxPresharedKey=xxxEndpoint=ch3.vpn.airdns.org:51820AllowedIPs=0.0.0.0/0,::/0PersistentKeepalive=15vpn-gen1.JPGvpn-gen2.JPG7. Also do not quite understand your setupIf you have exceptions for traffic not going out to Sweden in routing............192.168.10.20 - zigbee hub192.168.10.49 - rig192.168.10.50 - minipcThose are clients which I need time to time Enable or Disable from VPN. This was the only way I found to be working eficientlyNot on VPN (local country IP)/routing rule add action=lookup-only-in-table comment=Rig disabled=no src-address=192.168.10.49/32 table=mainon VPN (eg. Sweden IP)/routing rule add action=lookup-only-in-table comment=Mini-PC disabled=yes src-address=192.168.10.50/32 table=mainThen what is their relations ship to the firewall address lists. You clearly want their traffic not to go out Sweden VPN sowhich category do they fall into.........Local Internet?No internet?This is what im confused about why to add those clients also to Firewall address list.Mainly i need (per your categorization)VPN Internet 3-5 clientsLocal Internet - the rest XX clientsNo Internet - rarely 1-2clients (as i'm thinking maybe more clients could be blocked as they are mostly locally controlled, like some smart devices via hub)8. Why do you bother have a 192.168.10.2 DNS entry for /ip dhcp-serverBut then have a static /IP DNS setting for 192.168.10.1 ???192.168.10.2 is a PiHole serverstatic is disabled -/ip dns static add address=192.168.10.1 comment=defconf disabled=yes name=router.lan type=AI'm using mostly WinBox to config and therefor I use those disable/enable options, mostly not to forget how it was setup , in case I need to switch back.As when I need to deeply setup something which I did few months ago and then disabled because various reasons, I wont remember and need to spend time googling or looking into config backupseg. Point 4 SSH ruleI'm still after 2y not very efficient with Mikrotik router setup, as u can see advanced settings are difficult for me...

---
### Post 17
Author: Unknown
Date: Unknown

No worries, doing well! Will look at this again later.Understand about the wireguard.......Here is an example of your situation I saw elsewhere and the only difference was the endpoint address, but one needed a second interface./interface wireguardadd listen-port=51020 mtu=1420 name=Surfshark1add listen-port=51080 mtu=1420 name=Surfshark2/interface wireguard peersadd allowed-address=0.0.0.0/0 endpoint-address=address1.surfshark.com\endpoint-port=52222interface=Surfshark1 name=wg-country1\persistent-keepalive=30s public-key="====="add allowed-address=0.0.0.0/0 endpoint-address=address2.surfshark.com\endpoint-port=52222interface=Surfshark2  name=wg-country2 \persistent-keepalive=35s public-key="****"/ip addressadd address=10.20.30.2/24 comment=VPN1 interface=Surfshark1 network=10.20.30.0add address=10.20.30.2/24 comment=VPN2 interface=Surfshark2 network=10.20.30.0

---
### Post 18
Author: Unknown
Date: Unknown

Just now finalized / tried to sync with the Config you modified, hopefully now better for you to read01-default08-edit.rsc10. why this Internet detection setting need to be OFF? some security issue? or whatCode:Select all/interfacedetect-internetsetdetect-interface-list=none11. into this list /ip firewall address-list  - i should add all clients on my network and decide their rights? or only those with which I need to switch VPN/noVPN, maybe different VPN country laterCode:Select all/ip firewall address-listaddaddress=192.168.10.51disabled=yes list=Local-Internetcomment="Users using Local Internet only"addaddress=192.168.10.XXdisabled=yes list=No-Internetcomment="Users with NO internet access at all"addaddress=se3.vpn.airdns.org list=3rdPartyVPNaddaddress=dns.airservers.org list=3rdPartyVPNaddaddress=192.168.10.50comment=MiniPClist=Authorizedaddaddress=192.168.10.60comment=M12Pro list=Authorizedaddaddress=192.168.10.101comment="Tower"list=AuthorizedDoing the /ip firewall address-list, is it necessary to do enable/disable over here /routing rule ?Code:Select all/routing ruleaddaction=lookup-only-in-table comment=ZigBee-Hubdisabled=nosrc-address=192.168.10.20/32table=mainaddaction=lookup-only-in-table comment=Rigdisabled=nosrc-address=192.168.10.49/32table=mainaddaction=lookup-only-in-table comment=Mini-PC disabled=yes src-address=192.168.10.50/32table=main----EDIT: I guess I find the problem...seems like/ip firewall address-listrules are interfering with/routing ruleThis is the part which I dont fully understand yet , why to keep both list maintained with clientsAs when I temporary disabledadd action=drop chain=forward comment="drop all else"rule, everything started to work...So then i've added/ip firewall address-listadd address=192.168.10.0/24 list=Local-Internetit started to work smoother as when wasadd action=drop chain=forward comment="drop all else"disabledso those 2 lists needs to be tuned, as in previous VPN setup i was only using/routing rule

---
### Post 19
Author: Unknown
Date: Unknown

It will work properly when you are clearer on requirements.What you are doing is work arounds to ensure traffic flows, the to your expectations.The problem is your actual expectations dont match your up to this point to the discussion previous aka the directions...Step back.Firewall rules are simply to allow or deny traffic permissions.Routing rules are for determining which path traffic will take.you havea.   some user that should get no internet (not many)  this list of users is identified by No-Internetb.   some users should go out local WAN and not go out Sweden,  this list of users is identified by Local-InternetThe firewall rules were setup to (order being important)first allow those users designated to use the local WAN are allowed to the internetNext  the rest of the users will be allowed to use Sweden for internet but not those on the No-Internet list as they are not allowed any access.Drop all elseDONE:There should be no need to change the rules.Your problem is inaccurate assessment of what the lists are for, and if you need to fix anything, fix the entries in the firewall address list.As far as routing goes.Routing rules capture all traffic so one needs to make sure that anybody not going out sweden for internet, aka going out local for internet, is identified first.Hence your route rule should include-  local WAN source IP table main- local WAN source IP table main....etc....-sweden WAN the rest of the subnet. table=useWGDONE:++++++++++++++++++++++++++++++++++++++++++++++++However that seems to not work for you for some reason.So please explain what traffic did not work...........WHat traffic worked when you removed the rule............... that is where the issue lies.....Detect internet has caused and continues to cause weird issues, so we remove it.

---
### Post 20
Author: Unknown
Date: Unknown

By adding another wireguard vpn and possibly changing which go to which vpn add complications and changes requirements and should have been identified at the beginning.You will have to start mangling unless you can contain users within subnets.  SubnetA goes to sweden,  SubnetB, goes to London,  SubnetC goes out local WAN,  subnetD, has no internet etc..Another approach is to use WIFI to let users decide which vpn they are going out on.SSID-SwedenSSID-Londonand of course only the users with the correct password can actually use them.Very easy to assign a vlan (subnet ) to wifi and thus avoid mangling.

---
