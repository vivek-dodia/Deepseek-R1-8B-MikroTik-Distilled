---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=14&t=196254&p=1005467#p1005467
crawled_date: 2025-02-02T21:24:49.837292
section: mikrotik_forum
type: forum_thread
---

### Author: Wed May 17, 2023 12:30 pm
Date: Unknown

Hi allI have several routers, RB4011 and Hap AC3, with a GRE tunnel built between them.In my configuration, the OSPF protocol does not work with ROS V6 and ROS V7, and this configuration does not work when I have ROS V7 and ROS V7.But this configuration works absolutely fine between ROS V6 and ROS V6.Below are the configurations from the two systems:R1:/interface greadd comment=gre-222 local-address=172.18.221.1 mtu=1280 name=gre-222 remote-address=172.18.221.2/ip ipsec policy groupadd name=mkrt-222/ip ipsec profileset [ find default=yes ] dh-group=modp2048 enc-algorithm=aes-128add dh-group=modp1024 dpd-interval=10s name=profile_1 nat-traversal=no/ip ipsec peeradd address=2.2.2.2/32 comment=peer-222 exchange-mode=ike2 local-address=1.1.1.1 name=peer-222 profile=profile_1/ip ipsec proposalset [ find default=yes ] enc-algorithms=aes-128-cbcadd enc-algorithms=aes-128-cbc,3des name=proposal1/ip ipsec identityadd comment=peer-222 peer=peer-222 policy-template-group=mkrt-222 secret=^PQ~4LQ5P/iC5*D/ip ipsec policyadd comment=IPSec-222 dst-address=172.18.221.2/32 peer=peer-222 proposal=proposal1 src-address=172.18.221.1/32 tunnel=yes/ip routeadd disabled=yes distance=150 dst-address=192.168.0.0/16 gateway=gre-222/routing ospf instanceset [ find default=yes ] router-id=192.168.221.1/routing ospf networkadd area=backbone network=172.18.221.0/30R2:/ip ipsec peeradd address=1.1.1.1/32 exchange-mode=ike2 local-address=2.2.2.2 name=peer-222 profile=profile_1/ip ipsec proposalset [ find default=yes ] auth-algorithms=md5 enc-algorithms=aes-128-cbc,twofishadd enc-algorithms=aes-128-cbc,3des name=proposal1/ip ipsec identityadd peer=peer-222 policy-template-group=mkrt-222/ip ipsec policyadd comment=IPSec-222 dst-address=172.18.221.1/32 peer=peer-222 proposal=proposal1 src-address=172.18.221.2/32 tunnel=yes/ip routeadd disabled=no distance=1 dst-address=192.168.0.0/16 gateway=gre-222 pref-src="" routing-table=main scope=30 suppress-hw-offload=yes target-scope=10/routing ospf interface-templateadd area=backbone auth-id=1 cost=10 disabled=yes interfaces=bridge networks=192.168.222.0/24 priority=1add area=backbone auth-id=1 cost=10 disabled=yes interfaces=gre-222 networks=172.18.222.0/30 priority=1 type=ptp/routing ruleadd action=lookup disabled=no dst-address=172.18.222.2/32 interface=gre-222 routing-mark=main src-address=172.18.222.1/32 table=main/routing ospf instanceadd disabled=yes name=default originate-default=never router-id=192.168.222.1/routing ospf areaadd disabled=yes instance=default name=backbone/ip addressadd address=172.18.221.2/30 comment=ipsec-222 interface=gre-221 network=172.18.221.0Also, please see the block diagram:ros6-vs-ros7.jpgLog Ros V7screen14.28.07.jpgWhat are the options for solving the problem?


---
### Author: Mon May 22, 2023 7:38 pm
Date: Unknown

```
19:58:17route,ospf,packet log-ospf:default{version:2router-id:10.10.222.1}backbone{0.0.0.0}interface{p2p172.18.254.1%gre-justhost}neighbor{router-id:10.255.254.1state:ExStart}send
DD to172.18.254.2InitMasterMoresequence1712849818
```

hello,I set up the fire wall rule right away, turned on logging and noticed one peculiarity, for some reason traffic goes through the external interface, although it should not go there, it should go inside the protocol grefrom your latest ospf log ...Code:Select allthat would be impossible for the ospf to have split routing.exstart means both ospf routers are in touch.your previous log even said dr/bdr election: me - that means there are no split routing. the ospf router are ok but the mtu is too small.if your isp has icmp filter along the path - that could be overcome with fragmentation set to yes.there are ospf interface passive options - but i don't think that it will help. neither with ip route rule/pbr to direct the ospf hello to go into the tunnel.hmm... how about injecting a static route with Lower metrics than those to internet, on both router to be used by the ospf?ok. have a try and good luckI'm off for rest.


---
### Author: Tue May 23, 2023 7:40 pm
Date: Unknown

```
hub properties:spoke:wan ip:10.10.10.1/3010.10.10.2/30gre ip:172.16.1.1/30172.16.1.2/30lo0:172.16.1.11/32172.16.1.12/32dummy-servers:192.168.2.0/24dummy-LAN:192.168.1.0/24hub config:interfaces,---[admin@hub]>/interface/printFlags:R-RUNNINGColumns:NAME,TYPE,ACTUAL-MTU,L2MTU,MAC-ADDRESS#   NAME     TYPE        ACTUAL-MTU  L2MTU  MAC-ADDRESS0R ether1   ether150052:54:00:00:01:011R gre1     gre-tunnel1476655352R lo0      bridge1500655355E:E0:F0:3D:42:C63R servers  bridge15006553522:A9:AD:57:D8:6E--->dummyforconnectivity test.ip addresses,---[admin@hub]>/ip address/printColumns:ADDRESS,NETWORK,INTERFACE# ADDRESS         NETWORK      INTERFACE010.10.10.1/3010.10.10.0ether11172.16.1.11/32172.16.1.11lo02192.168.2.1/24192.168.2.0servers3172.16.1.1/30172.16.1.0gre1

greinterface,---[admin@hub]>/interface/greprintdetailFlags:X-disabled;R-running0R name="gre1"mtu=autoactual-mtu=1476local-address=10.10.10.1remote-address=10.10.10.2keepalive=10s,10dscp=inherit clamp-tcp-mss=yes dont-fragment=noallow-fast-path=yes

ospf instance,---[admin@hub]>/routing/ospf/instance/printdetailFlags:X-disabled,I-inactive0name="default"version=2vrf=main router-id=172.16.1.11redistribute=connected

ospf area,---[admin@hub]>/routing/ospf/area/printdetailFlags:X-disabled,I-inactive,D-dynamic;T-transit-capable0name="backbone"instance=defaultarea-id=0.0.0.0type=defaultospfinterface---[admin@hub]>/routing/ospf/interface/printFlags:D-dynamic0D address=172.16.1.1%gre1 area=backbone state=dr network-type=broadcast bdr=172.16.1.2cost=1priority=128retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40sospf neighbor,---[admin@hub]>/routing/ospf/neighbor/printdetailFlags:V-virtual;D-dynamic0D instance=defaultarea=backbone address=172.16.1.2priority=1router-id=172.16.1.12dr=172.16.1.1bdr=172.16.1.2state="Full"state-changes=10adjacency=8m34stimeout=35slsa,---[admin@hub]>/routing/ospf/lsa/printdetailFlags:S-self-originated,F-flushing,W-wraparound;D-dynamic0SD instance=defaulttype="external"originator=172.16.1.11id=10.10.10.0sequence=0x80000005age=1422checksum=0xA6>body=options=E
        netmask=255.255.255.252forwarding-address=0.0.0.0metric=1type-1route-tag=01D instance=defaulttype="external"originator=172.16.1.12id=10.10.10.0sequence=0x80000002age=1467checksum=0xC890body=options=E
        netmask=255.255.255.252forwarding-address=0.0.0.0metric=20type-1route-tag=02SD instance=defaulttype="external"originator=172.16.1.11id=172.16.1.0sequence=0x80000003age=1373checksum=0xE6E5body=options=E
        netmask=255.255.255.252forwarding-address=0.0.0.0metric=1type-1route-tag=03SD instance=defaulttype="external"originator=172.16.1.11id=172.16.1.11sequence=0x80000005age=1572checksum=0x8636body=options=E
        netmask=255.255.255.255forwarding-address=0.0.0.0metric=1type-1route-tag=04SD instance=defaulttype="external"originator=172.16.1.11id=192.168.2.0sequence=0x80000005age=1561checksum=0xBD5Cbody=options=E
        netmask=255.255.255.0forwarding-address=0.0.0.0metric=1type-1route-tag=05SD instance=defaultarea=backbone type="router"originator=172.16.1.11id=172.16.1.11sequence=0x80000016age=552checksum=0x62CAbody=options=E bits=E
            type=network id=172.16.1.1data=172.16.1.1metric=16D instance=defaultarea=backbone type="router"originator=172.16.1.12id=172.16.1.12sequence=0x80000008age=556checksum=0x7C4Abody=options=E bits=E
            type=stub id=192.168.1.0data=255.255.255.0metric=10type=stub id=172.16.1.12data=255.255.255.255metric=10type=network id=172.16.1.1data=172.16.1.2metric=107SD instance=defaultarea=backbone type="network"originator=172.16.1.11id=172.16.1.1sequence=0x80000003age=553checksum=0x87B9body=netmask=255.255.255.252router-id=172.16.1.11router-id=172.16.1.12ip routeprint,---[admin@hub]>/ip route/printFlags:D-DYNAMIC;A-ACTIVE;c,o,y-COPYColumns:DST-ADDRESS,GATEWAY,DISTANCE
    DST-ADDRESS     GATEWAY          DISTANCE
D o10.10.10.0/30172.16.1.2%gre1110DAc10.10.10.0/30ether10DAc172.16.1.0/30gre10DAc172.16.1.11/32lo00DAo172.16.1.12/32172.16.1.2%gre1110DAo192.168.1.0/24172.16.1.2%gre1110DAc192.168.2.0/24servers0pingandtraceroute test,---[admin@hub]>/ping count=3192.168.1.1src-address=192.168.2.1SEQ HOST                                     SIZE TTL TIME       STATUS0192.168.1.1566441ms512us1192.168.1.15664236ms625us2192.168.1.1566432ms937ussent=3received=3packet-loss=0%min-rtt=32ms937usavg-rtt=103ms691usmax-rtt=236ms625us[admin@hub]>/tool/traceroute192.168.1.1src-address=192.168.2.1Columns:ADDRESS,LOSS,SENT,LAST,AVG,BEST,WORST,STD-DEV#  ADDRESS      LOSS  SENT  LAST   AVG  BEST  WORST  STD-DEV1192.168.1.10%45.9ms105.222.37.1
```

```
interface,---[admin@spoke649]>/interfaceprintFlags:D-dynamic,X-disabled,R-running,S-slave#     NAME                                TYPE       ACTUAL-MTU L2MTU  MAX-L2MTU MAC-ADDRESS0R  ether1                              ether150052:54:00:00:02:011R  LAN                                 bridge15006553572:C6:C9:6A:15:822R  gre1                                gre-tunnel1476655353R  lo0                                 bridge1500655352A:79:11:82:99:2Dip addresses,---[admin@spoke649]>/ip addressprintFlags:X-disabled,I-invalid,D-dynamic#   ADDRESS            NETWORK         INTERFACE010.10.10.2/3010.10.10.0ether11172.16.1.12/32172.16.1.12lo02192.168.1.1/24192.168.1.0LAN3172.16.1.2/30172.16.1.0gre1

srcnat on waninterface,---[admin@spoke649]>/ip firewall natprintde  detailFlags:X-disabled,I-invalid,D-dynamic0chain=srcnat action=masqueradeout-interface=ether1

greinterface,---[admin@spoke649]>/interfacegreprintde    detailFlags:X-disabled,R-running0R name="gre1"mtu=autoactual-mtu=1476local-address=10.10.10.2remote-address=10.10.10.1keepalive=10s,10dscp=inherit clamp-tcp-mss=yes dont-fragment=noallow-fast-path=yes

ospf instance,---[admin@spoke649]>/routing ospf instanceprintdetailFlags:X-disabled,*-default0*name="default"router-id=172.16.1.12distribute-default=never redistribute-connected=as-type-1redistribute-static=noredistribute-rip=noredistribute-bgp=noredistribute-other-ospf=nometric-default=1metric-connected=20metric-static=20metric-rip=20metric-bgp=autometric-other-ospf=autoin-filter=ospf-inout-filter=ospf-outospf area,---[admin@spoke649]>/routing ospf areaprintdetailFlags:X-disabled,I-invalid,*-default0*name="backbone"instance=defaulttype=defaultarea-id=0.0.0.0ospfinterface---[admin@spoke649]>/routing ospfinterfaceprintdetailFlags:X-disabled,I-inactive,D-dynamic,P-passive0interface=gre1 cost=10priority=1authentication=none authentication-key=""authentication-key-id=1network-type=broadcast instance-id=0retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40suse-bfd=no1DPinterface=lo0 cost=10priority=1authentication=none authentication-key=""authentication-key-id=1network-type=broadcast instance-id=0retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40suse-bfd=no2Dinterface=LAN cost=10priority=1authentication=none authentication-key=""authentication-key-id=1network-type=broadcast instance-id=0retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40suse-bfd=noospf network,---[admin@spoke649]>/routing ospf networkprintdetailFlags:X-disabled,I-invalid0network=172.16.1.0/30area=backbone1network=172.16.1.12/32area=backbone2network=192.168.1.0/24area=backbone

ospf neighbor,---[admin@spoke649]>/routing ospf neighborprintdetail0instance=defaultrouter-id=172.16.1.11address=172.16.1.1interface=gre1 priority=128dr-address=172.16.1.1backup-dr-address=172.16.1.2state="Full"state-changes=5ls-retransmits=0ls-requests=0db-summaries=0adjacency=16m35sospf lsa,---[admin@spoke649]>/routing ospfinterfaceprintdetailFlags:X-disabled,I-inactive,D-dynamic,P-passive0interface=gre1 cost=10priority=1authentication=none authentication-key=""authentication-key-id=1network-type=broadcast instance-id=0retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40suse-bfd=no1DPinterface=lo0 cost=10priority=1authentication=none authentication-key=""authentication-key-id=1network-type=broadcast instance-id=0retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40suse-bfd=no2Dinterface=LAN cost=10priority=1authentication=none authentication-key=""authentication-key-id=1network-type=broadcast instance-id=0retransmit-interval=5stransmit-delay=1shello-interval=10sdead-interval=40suse-bfd=no[admin@spoke649]>/routing ospf lsaprintdetail
 instance=defaultarea=backbone type=router id=172.16.1.11originator=172.16.1.11sequence-number=0x80000013age=1437checksum=0x68C7options="E"body=flags=EXTERNAL
     links(type,id,data,metric)Transit172.16.1.1172.16.1.11instance=defaultarea=backbone type=router id=172.16.1.12originator=172.16.1.12sequence-number=0x80000005age=1413checksum=0x8247options="E"body=flags=EXTERNAL
     links(type,id,data,metric)Stub192.168.1.0255.255.255.010Stub172.16.1.12255.255.255.25510Transit172.16.1.1172.16.1.210instance=defaultarea=backbone type=network id=172.16.1.1originator=172.16.1.11sequence-number=0x80000001age=1437checksum=0x8BB7options="E"body=netmask=255.255.255.252routerId=172.16.1.11routerId=172.16.1.12instance=defaultarea=external type=as-external id=10.10.10.0originator=172.16.1.11sequence-number=0x80000004age=1420checksum=0xC5Foptions="E"body=netmask=255.255.255.252forwarding-address=0.0.0.0route-tag=0x0metric=1type1

 instance=defaultarea=external type=as-external id=10.10.10.0originator=172.16.1.12sequence-number=0x80000001age=1439checksum=0xCA8Foptions="E"body=netmask=255.255.255.252forwarding-address=0.0.0.0route-tag=0x0metric=20type1

 instance=defaultarea=external type=as-external id=172.16.1.0originator=172.16.1.11sequence-number=0x80000002age=1283checksum=0xE8E4options="E"body=netmask=255.255.255.252forwarding-address=0.0.0.0route-tag=0x0metric=1type1

 instance=defaultarea=external type=as-external id=172.16.1.11originator=172.16.1.11sequence-number=0x80000004age=1553checksum=0x8835options="E"body=netmask=255.255.255.255forwarding-address=0.0.0.0route-tag=0x0metric=1type1

 instance=defaultarea=external type=as-external id=192.168.2.0originator=172.16.1.11sequence-number=0x80000004age=1487checksum=0xBF5Boptions="E"body=netmask=255.255.255.0forwarding-address=0.0.0.0route-tag=0x0metric=1type1

ip routeprint,---[admin@spoke649]>/ip routeprintFlags:X-disabled,A-active,D-dynamic,C-connect,S-static,r-rip,b-bgp,o-ospf,m-mme,B-blackhole,U-unreachable,P-prohibit#      DST-ADDRESS        PREF-SRC        GATEWAY            DISTANCE0ADC10.10.10.0/3010.10.10.2ether101ADC172.16.1.0/30172.16.1.2gre102ADo172.16.1.11/32172.16.1.11103ADC172.16.1.12/32172.16.1.12lo004ADC192.168.1.0/24192.168.1.1LAN05ADo192.168.2.0/24172.16.1.1110pingandtraceroute test,---[admin@spoke649]>ping count=3172.16.1.11src-address=172.16.1.12SEQ HOST                                     SIZE TTL TIME  STATUS0172.16.1.11566430ms1172.16.1.1156648ms2172.16.1.11566440mssent=3received=3packet-loss=0%min-rtt=8msavg-rtt=26msmax-rtt=40ms[admin@spoke649]>/tool traceroute192.168.2.1src-address=192.168.1.1# ADDRESS                          LOSS SENT    LAST     AVG    BEST   WORST STD-DEV STATUS1192.168.2.10%43.5ms16.43.536.213.7
```

hello bigdrive, and @mcducharme.just to let you know,just done the local back to back test for @bigdrive :that v6.49 and v7.6 are working.as well both v7.6.i could only test gre. mtu 1476.yes. there are slightly different settings on the ospf interface. i choose broadcast for the gre interface.v7.6 as hub. v7.6 and v6.49 as spokes. those spokes with physical interface srcnat, not on the gre tunnel.  and the hub is plain no nat.+++ edit, ok.tested v7.6 as hub, and v6.49 as spoke (with srcnat).Code:Select allspoke v6.49 configCode:Select allok. hope this helps, and have a nice try. i'm sorry for this bad layout - i dont know how to fix it.


---
### Author: Thu Jun 01, 2023 8:56 am
Date: Unknown

Hello wiserouteSettings/ip ipsec policyThe default is 255255.pngI put up only gre protocol47.pngAfter that everything workedOf course, you need to change on both sides


---
### Author: Thu Jun 01, 2023 10:36 am
Date: Unknown

[*]Settings/ip ipsec policyThe default is 255[*]did you move the hub to the cloud already?

