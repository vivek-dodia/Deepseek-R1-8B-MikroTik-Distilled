# Thread Information
Title: Thread-213360
Section: RouterOS
Thread ID: 213360

# Discussion

## Initial Question
Hello everybody!I have RouterOS 7.17rc3 (try latest OS)Main aim of router is NAT and routing trafficRouter have 1 default route via ether1 (static route) and 1 VPN connectionMy task is: Router traffic to listed resources (dynamic changes with dns) via VPN connectionAll work fine if setup Route Rule and set src_ip & routing table.But if I want to use Mangle (src_address list, dst_address list) - it is now work.How to fix is?My current config is:
```
[dline-local@r-nat.dl-net.ru]>/export# 2024-12-18 17:26:13 by RouterOS 7.17rc3# system id = XxmLaV5VF4G#/ip vrfadddisabled=yes interfaces=vpn-de name=openai/routing tableadddisabled=nofib name=VPN/ip firewall address-listaddaddress=api.openai.com list=route_to_vpn/ip firewall mangleaddaction=mark-connection chain=prerouting dst-address-list=route_to_vpn log=yes log-prefix="MARK CONNECTION OUT"new-connection-mark=conn-VPNaddaction=mark-routing chain=prerouting connection-mark=conn-VPN connection-state=""dst-address-list=route_to_vpn log=yes log-prefix="MARK ROUTE OUT"new-routing-mark=VPN \
    passthrough=noaddaction=mark-connection chain=preroutingin-interface=vpn-de log=yes log-prefix="MARK CONN IN"new-connection-mark=incoming-VPNaddaction=mark-routing chain=prerouting connection-mark=incoming-VPNin-interface=vpn-de log=yes log-prefix="MARK ROUTE IN"new-routing-mark=main passthrough=no/ip firewall nataddaction=masquerade chain=srcnat comment="OUT (Mangle)"log=yes log-prefix="NAT MANGLE"out-interface=vpn-deaddaction=src-nat chain=srcnat comment=OUT dst-address=!10.0.0.0/8log-prefix="NAT REG"out-interface=publicsrc-address-list=!dedicated-white-ip to-addresses=white_ip/ip routeadddisabled=nodistance=10dst-address=0.0.0.0/0gateway=white_ip pref-src=""routing-table=main scope=30suppress-hw-offload=notarget-scope=10adddisabled=nodistance=1dst-address=10.20.0.0/16gateway=10.20.1.65pref-src=""routing-table=main scope=30suppress-hw-offload=notarget-scope=10adddisabled=nodistance=20dst-address=0.0.0.0/0gateway=192.168.41.1pref-src=""routing-table=main scope=30suppress-hw-offload=notarget-scope=10vrf-interface=vpn-deadddisabled=nodst-address=0.0.0.0/0gateway=vpn-de routing-table=VPN suppress-hw-offload=noadddisabled=nodistance=1dst-address=1.0.0.1/32gateway=vpn-de pref-src=""routing-table=main scope=30suppress-hw-offload=notarget-scope=10My logs:
```

```
r-nat:MARK CONNECTION OUT prerouting:in:natout:(unknown0),connection-state:newsrc-mac42:fa:40:e4:85:ac,proto TCP(SYN),10.20.5.154:46153->172.66.0.243:443,len60r-nat:MARK ROUTE OUT prerouting:in:natout:(unknown0),connection-mark:conn-VPN connection-state:newsrc-mac42:fa:40:e4:85:ac,proto TCP(SYN),10.20.5.154:46153->172.66.0.243:443,len60r-nat:VPN NAT LOG srcnat:in:natout:vpn-de,connection-mark:conn-VPN connection-state:newsrc-mac42:fa:40:e4:85:ac,proto TCP(SYN),10.20.5.154:46153->172.66.0.243:443,len60r-nat:MARK CONN IN prerouting:in:vpn-deout:(unknown0),connection-mark:conn-VPN connection-state:established,snat proto TCP(SYN,ACK),172.66.0.243:443->192.168.41.50:46153,NAT172.66.0.243:443->(192.168.41.50:46153->10.20.5.154:46153),len60r-nat:MARK ROUTE IN prerouting:in:vpn-deout:(unknown0),connection-mark:incoming-VPN connection-state:established,snat proto TCP(SYN,ACK),172.66.0.243:443->192.168.41.50:46153,NAT172.66.0.243:443->(192.168.41.50:46153->10.20.5.154:46153),len60r-nat:MARK CONNECTION OUT prerouting:in:natout:(unknown0),connection-mark:incoming-VPN connection-state:established,snat src-mac42:fa:40:e4:85:ac,proto TCP(SYN),10.20.5.154:46153->172.66.0.243:443,NAT(10.20.5.154:46153->192.168.41.50:46153)->172.66.0.243:443,len60r-nat:MARK ROUTE OUT prerouting:in:natout:(unknown0),connection-mark:conn-VPN connection-state:established,snat src-mac42:fa:40:e4:85:ac,proto TCP(SYN),10.20.5.154:46153->172.66.0.243:443,NAT(10.20.5.154:46153->192.168.41.50:46153)->172.66.0.243:443,len60r-nat:MARK CONN IN prerouting:in:vpn-deout:(unknown0),connection-mark:conn-VPN connection-state:established,snat proto TCP(SYN,ACK),172.66.0.243:443->192.168.41.50:46153,NAT172.66.0.243:443->(192.168.41.50:46153->10.20.5.154:46153),len60r-nat:MARK ROUTE IN prerouting:in:vpn-deout:(unknown0),connection-mark:incoming-VPN connection-state:established,snat proto TCP(SYN,ACK),172.66.0.243:443->192.168.41.50:46153,NAT172.66.0.243:443->(192.168.41.50:46153->10.20.5.154:46153),len60r-nat:MARK CONN IN prerouting:in:vpn-deout:(unknown0),connection-mark:incoming-VPN connection-state:established,snat proto TCP(SYN,ACK),172.66.0.243:443->192.168.41.50:46153,NAT172.66.0.243:443->(192.168.41.50:46153->10.20.5.154:46153),len60r-nat:MARK ROUTE IN prerouting:in:vpn-deout:(unknown0),connection-mark:incoming-VPN connection-state:established,snat proto TCP(SYN,ACK),172.66.0.243:443->192.168.41.50:46153,NAT172.66.0.243:443->(192.168.41.50:46153->10.20.5.154:46153),len60

---
```

## Response 1
Can anybody help me? ---

## Response 2
I would if I could instead what you were rambling about. I have no clue as to what you are trying to accomplish.a. identify users/devices, groups of users/devices, including external and internat and adminb. identify what traffic each needsc. identify any vpn traffic or port fowarding trafficd. discuss WANS how many types, static/dynamic, public private, purpose.... and usage of eache. network diagram helpful.f. full config not snippets. ---