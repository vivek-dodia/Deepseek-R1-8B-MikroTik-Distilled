---
title: Thread-214280
url: https://forum.mikrotik.com/viewtopic.php?t=214280&sid=49f92a630bc7970d8ca50523be880e8f
thread_id: 214280
section: RouterOS
post_count: 16
date_crawled: 2025-02-03T20:38:51.551409
---

### Post 1
Author: Unknown
Date: Unknown

Hello.I am experiencing a situation where my router is being continuously flooded with external attempts to connect to admin services. My logs are completely full of entries like this, occurring every second:Block-Admin input: in:ether1-isp out:(unknown 0), connection-state:new src-mac 28:52:61:f0:d8:19, proto TCP (SYN), 186.233.113.120:11628->201.212.96.246:443, len 60Currently, I have only 2 admin services available from my LAN segment and none from WAN. I would like to know whether it is a good practice or not to add this firewall ruleadd action=drop chain=input comment="Block Admin from WAN" disabled=no dst-port=21,22,23,80,443,8291,8728,8729 in-interface-list=WAN log=yes log-prefix=Block-Admin \protocol=tcpThanks in advance

---
### Post 2
Author: Unknown
Date: Unknown

/export file=anynameyouwish ( minus router serial number, any public WANIP information, keys etc. )

---
### Post 3
Author: Unknown
Date: Unknown

While waiting for config: generally it's good practice (required actually) to drop everythingexceptbare minimum of allowed services (e.g. wireguard/IPsec tunnels from whitelisted remote addresses). And it's normalnot tolog dropped attempts ... because those log entries don't give any information or value at all.

---
### Post 4
Author: Unknown
Date: Unknown

Concurring with mks.Routers/devices connected to the internet with a publicly routable IP often get hundreds or thousands of such scanning/probing traffic. There's really no way around this.It's the correct thing to block these attempts. Usually these are not logged - they really don't add anything of value. (Turning on debugging temporarily for verifying that they work correctly is of course good practice.)I also concur with mks that generally firewalls should be configured to1. allow some specific traffic (the bare minimum - so if you need some sort of VPN access, well there's really not much you can do about allowing connections to that specific port... whitelists can be used where applicable) This means to *not* single out specific things to block, but single out specifically what you want to allow. This should be a way shorter list and way easier to produce and maintain.2. drop everything elseIf you only want to apply these rules to external traffic, a qualifier such as in-interface-list=WAN can be used. (Based on default configuration.)

---
### Post 5
Author: Unknown
Date: Unknown

Thanks for the quick response.I've trimmed the config file a bit and also changed the IP segments, but everything makes sense.Thanks again

---
### Post 6
Author: Unknown
Date: Unknown

why are you logging this? This is normal traffic on the InternetCode:Select all/ip firewall filteraddaction=drop chain=input comment="Block Admin from WAN"dst-port=\21,22,23,80,443,8291,8728,8729in-interface-list=WAN log-prefix=\Block-Adminprotocol=tcpadd a jump for WAN to the top of the firewall and cut everything thereCode:Select alladdaction=jump chain=input comment="Input_WAN"in-interface-list=WAN jump-target=Input_WANaddaction=accept chain=Input_WANprotocol=icmpaddaction=accept chain=Input_WANconnection-state=established,relatedaddaction=drop chain=Input_WAN

---
### Post 7
Author: Unknown
Date: Unknown

Or better yet, just use the default firewall rule "Drop all not coming from LAN" as the last of the chain:Code:Select all/ip firewall filteraddaction=drop chain=inputin-interface-list=!LAN

---
### Post 8
Author: Unknown
Date: Unknown

Not trying to be abrasive, but your firewall rules are kind of a mess. It's very typical of what newcomers produce on their first try, so if you're willing to learn, you'll get there. Just keep up trying/learning/reading. Just be careful: there are *lots* of "tutorials" on youtube and other places that are of *very* bad quality.Group your chains! Only a specific chain is executed for a packet (at a time) so separating and intermixing rules doesn't hinder the router from doing its job, but it makes it much harder for us, anyone or even yourself to understand exactly what's going on.A good start for an input firewall ruleset is the following:1. drop connection state invalid2. accept connection state established/related3. accept all traffic with in-interface lo (loopback traffic)4. accept all icmp5. accept external connections that you want to enable - in your case udp 13231 for wireguard*** This was the global part. From now on we do local traffic filtering.6. accept udp 7 from LAN (this is echo service udp - you may not want or need this)7. accept tcp 7 from LAN (this echo service tcp - you may not want or need this)8. accept udp 53 from LAN (dns udp)9. accept tcp 53 from LAN (dns tcp)10. accept tcp 22 from LAN (ssh config)11. accept tcp 80 from LAN (webfig config)12. accept tcp 8291 from LAN (winbox config)*** And now we drop *everything* that we didn't allow13. drop (everything, unconditionally) - you might want to have this rule disabled when you set it, and then enable it using safe mode, so you don't get locked out of your routerOf course you might (should, probably) want to adjust these according to what exactly you want/need. For example it's generally a good idea to disable webfig, if you don't use it to configure your router. If you need additional things allowed, those have to be added as well.Also, it's very good practice to add some short but descriptive comment for all your rules, so you can come in later and see at a glance what everything does.A note about the echo service on port 7. Some programs and apps - especially on smartphones - like to use this to detect network access. It's mostly harmless to allow it and may help them provide a more consistent interface. All things that I have seen work without it tooSo it's basically a preference.EDIT: It seems Mikrotiks don't support the echo protocol at all. Wouldn't have thought.

---
### Post 9
Author: Unknown
Date: Unknown

Not trying to be abrasive, but your firewall rules are kind of a mess. It's very typical of what newcomers produce on their first try, so if you're willing to learn, you'll get there. Just keep up trying/learning/reading. Just be careful: there are *lots* of "tutorials" on youtube and other places that are of *very* bad quality.Not taken! I'm here to learn. All filter rules commented as 'defcon' (0 to 10) belong to the router's default config and I kept them in exact same order. I only added rules 11 to 18. In the case of NAT rules, rule 0 belongs to default config and I added the rest. I didn't change the order of them when I exported all config but in both pictures you can see the current order of them.

---
### Post 10
Author: Unknown
Date: Unknown

First, regarding the ordering of rules. It's best to keep the rules grouped by chains. It makes things clearer. The order of rules *within* a chain matters, between different chains it doesn't.The default firewall basically gives you what you wound get in most consumer routers. The difference is that here you can customize them as much as you want.While the default rules are written well, they are not the best in terms of being used as starting point for customization. I'm specifically not the biggest fan of the approach presented in them to do many things in one rule. I like separate/clear rules. Also they use a fall through approach to handling LAN traffic, which I'm also not a big fan of.I think the rules I gave are a better point for further customization, but - as always - preferences may vary. As with many things in Linux, the firewall gives you a lot of options to do things as you like. But this also gives you a lot of rope to hang yourself with. It's the admin's job to ensure a consistent/correct set of rules, which is easiest done by maintaining a consistent approach to writing them.All in all: My usual suggestion for someone who wants to customize their firewall is to just scrap the default and start from the beginning with whatever approach they most prefer, instead of patching the default around.

---
### Post 11
Author: Unknown
Date: Unknown

Thank you for your detailed response. I have carefully read your recommendations and I think I understand your point of view. I will wait for other people's opinions to finally decide which path I will take.I really appreciate the time you have dedicated to responding. Very grateful! I equally appreciate those who have responded previously!

---
### Post 12
Author: Unknown
Date: Unknown

Nobody asked for just part of your config..........geezSo guess what I have to make up shit ..........thats funVersion1-vlans.........Code:Select all/interfacebridgeaddname=bridge-lan protocol-mode=none vlan-filtering=no{changethisto yesasthelaststep}/interfacevlanaddinterface=bridge-lan name=iot44  vlan-id=44addinterface=bridge-lan name=main33  vlan-id=33/interfacewireguardaddlisten-port=13231mtu=1420name=wireguard1/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LANaddname=TRUSTED/ip pooladdname=main_pool ranges=192.168.33.10-192.168.33.96addname=iot_pool ranges=192.168.44.2-192.168.44.32/interfacebridge portaddbridge=bridge-lan ingress-filtering=yes frame-types=admit-only-priority-and-untaggedinterface=ether2 pvid=33addbridge=bridge-lan ingress-filtering=yes frame-types=admit-only-priority-and-untaggedinterface=ether3 pvid=33addbridge=bridge-lan ingress-filtering=yes frame-types=admit-only-priority-and-untaggedinterface=ether4 pvid=44addbridge=bridge-lan ingress-filtering=yes frame-types=admit-only-priority-and-untaggedinterface=ether5 pvid=44/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/interfacebridge vlanaddbridge=bridge-lan tagged=bridge-lan untagged=ether2,ether3  vlan-id=33addbridge=bridge-lan tagged=bridge-lan untagged=ether4,ether5  vlan-id=44/interfacelist memberaddinterface=ether1 list=WANaddinterface=main33 list=LANaddinterface=iot44 list=LANaddinterface=wireguard1 list=LANaddinterface=main33 list=TRUSTEDaddinterface=wireguard1 list=TRUSTED/interfacewireguard peersaddallowed-address=192.168.55.2/24interface=wireguard1publickey="----"comment="admin laptop"addallowed-address=192.168.55.3/24interface=wireguard1publickey="++++"comment="admin smartphone"/ip dhcp-clientaddcomment=defconfinterface=ether1default-route=yes/ip dhcp-serveraddaddress-pool=main_pool always-broadcast=yes comment=dhcp-server-lan \interface=main33  lease-time=5mname=dhcp-server-mainaddaddress-pool=iot_pool always-broadcast=yes comment=dhcp-server-lan \interface=iot44 lease-time=5mname=dhcp-server-iot/ip dhcp-server networkaddaddress=192.168.33.0/24dns-server=192.168.33.1gateway=192.168.33.1addaddress=192.168.44.0/24dns-server=192.168.44.1gateway=192.168.44.1/ip dnssetallow-remote-requests=yes servers=9.9.9.9{change it back to DOH once everythingelseisworkingandwillusebetter dstnat rules too}/ip addressaddaddress=192.168.33.1/24interface=main33 network=192.168.33.0addaddress=192.168.44.1/24interface=iot44 network=192.168.44.0addaddress=192.168.55.1/24interface=wireguard1 network=192.168.55.0/ip firewall address-listaddaddress=192.168.33.XYlist=Authorizedcomment="admin local device #1"addaddress=192.168.33.ABlist=Authorizedcomment="admin local device #2"addaddress=192.168.33.GHlist=Authorizedcomment="admin local device #3"addaddress=192.168.55.2list=Authorizedcomment="remote admin laptop"addaddress=192.168.55.3list=Authorizedcomment="remote admin smartphone"/ip firewall filteraddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input comment="admin access"in-interface-list=TRUSTED src-address-list=Authorizedaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53protocol=udpaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53protocol=tcpaddaction=drop chain=input comment="Drop all else"{insertthisrulelast}++++++++++addaction=accept chain=forward comment="defconf: accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=accept chain=forward comment="internet traffic"in-interface-list=LANout-interface-list=WANaddaction=accept chain=forward comment="trusted to iot"in-interface-list=TRUSTED dst-address=192.168.44.0/24addaction=accept chain=forward comment="wg to main"in-interface=wireguard1 dst-address=192.168.33.0/24addaction=accept chain=forward comment="port forwarding"connection-nat-state=dstnataddaction=drop chain=forward comment="Drop all else"/ip firewall nataddaction=masquerade chain=srcnat comment="defconf: masquerade"\
    ipsec-policy=out,noneout-interface-list=WAN/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetssh address=192.168.33.0/24setapi disabled=yessetwinbox address=192.168.33.0/24,192.168.55.0/24setapi-ssl disabled=yes/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTED.....Version2- Bridge for main, port for iot............Code:Select all/interfacebridgeaddname=bridge-lan protocol-mode=none/interfacewireguardaddlisten-port=13231mtu=1420name=wireguard1/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LANaddname=TRUSTED/ip pooladdname=main_pool ranges=192.168.33.10-192.168.33.96addname=iot_pool ranges=192.168.44.2-192.168.44.32/interfacebridge portaddbridge=bridge-laninterface=ether2addbridge=bridge-laninterface=ether3addbridge=bridge-laninterface=ether4/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/interfacelist memberaddinterface=ether1 list=WANaddinterface=bridge-lan list=LANaddinterface=ether5 list=LANaddinterface=wireguard1 list=LANaddinterface=bridge-lan list=TRUSTEDaddinterface=wireguard1 list=TRUSTED/interfacewireguard peersaddallowed-address=192.168.55.2/24interface=wireguard1publickey="----"comment="admin laptop"addallowed-address=192.168.55.3/24interface=wireguard1publickey="++++"comment="admin smartphone"/ip dhcp-clientaddcomment=defconfinterface=ether1default-route=yes/ip dhcp-serveraddaddress-pool=main_pool always-broadcast=yes comment=dhcp-server-lan \interface=bridge-lan  lease-time=5mname=dhcp-server-mainaddaddress-pool=iot_pool always-broadcast=yes comment=dhcp-server-lan \interface=ether5 lease-time=5mname=dhcp-server-iot/ip dhcp-server networkaddaddress=192.168.33.0/24dns-server=192.168.33.1gateway=192.168.33.1addaddress=192.168.44.0/24dns-server=192.168.44.1gateway=192.168.44.1/ip dnssetallow-remote-requests=yes servers=9.9.9.9{change it back to DOH once everythingelseisworkingandwillusebetter dstnat rules too}/ip addressaddaddress=192.168.33.1/24interface=bridge-lan network=192.168.33.0addaddress=192.168.44.1/24interface=ether5  network=192.168.44.0addaddress=192.168.55.1/24interface=wireguard1 network=192.168.55.0/ip firewall address-listaddaddress=192.168.33.XYlist=Authorizedcomment="admin local device #1"addaddress=192.168.33.ABlist=Authorizedcomment="admin local device #2"addaddress=192.168.33.GHlist=Authorizedcomment="admin local device #3"addaddress=192.168.55.2list=Authorizedcomment="remote admin laptop"addaddress=192.168.55.3list=Authorizedcomment="remote admin smartphone"/ip firewall filteraddaction=accept chain=input comment=\"defconf: accept established,related,untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=input comment="defconf: drop invalid"connection-state=\
    invalidaddaction=accept chain=input comment="defconf: accept ICMP"protocol=icmpaddaction=accept chain=input comment=\"defconf: accept to local loopback (for CAPsMAN)"dst-address=127.0.0.1addaction=accept chain=input comment="admin access"in-interface-list=TRUSTED src-address-list=Authorizedaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53protocol=udpaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53protocol=tcpaddaction=drop chain=input comment="Drop all else"{insertthisrulelast}++++++++++addaction=accept chain=forward comment="defconf: accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="defconf: accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related hw-offload=yesaddaction=accept chain=forward comment=\"defconf: accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="defconf: drop invalid"\
    connection-state=invalidaddaction=accept chain=forward comment="internet traffic"in-interface-list=LANout-interface-list=WANaddaction=accept chain=forward comment="trusted to iot"in-interface-list=TRUSTED dst-address=192.168.44.0/24addaction=accept chain=forward comment="wg to main"in-interface=wireguard1 dst-address=192.168.33.0/24addaction=accept chain=forward comment="port forwarding"connection-nat-state=dstnataddaction=drop chain=forward comment="Drop all else"/ip firewall nataddaction=masquerade chain=srcnat comment="defconf: masquerade"\
    ipsec-policy=out,noneout-interface-list=WAN/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetssh address=192.168.33.0/24setapi disabled=yessetwinbox address=192.168.33.0/24,192.168.55.0/24setapi-ssl disabled=yes/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTED

---
### Post 13
Author: Unknown
Date: Unknown

Nobody asked for just part of your config..........geezSo guess what I have to make up shit ..........thats funHi Anav,I truly appreciate the help, but put yourself in my position. I'm caught between accepting help from people offering their knowledge selflessly and exposing my entire router configuration in an internet forum. The choice isn't easy.Frankly, I would have preferred to read, 'hey, give me the full config, there are well-intentioned people here.' If this bothers you, you're free to decide whether to help or not, and I'm free to accept help while limiting the information I share.

---
### Post 14
Author: Unknown
Date: Unknown

I'll try to upload the full config today but I will change all IP segments and individual IP addresses for each device

---
### Post 15
Author: Unknown
Date: Unknown

It's perfectly fine to obfuscate sensitive parts of config ... if that's done in consistent matter .... e.g. replace actual IP address with, say, X.Y.Z.W ... as long as all occurences of same IP address is replaced by same string of characters. And if you have different IPs, obfuscate them with different string of characters but keep some consistency (e.g. if second IP address is from same /24 IP subnet, then write it as X.Y.Z.a).But don't get paranoid, unless you're running kind of ISP obfuscating private IP addresses won't add much to security. I'm fine telling everybody that my management IP subnet is 192.168.99.0/24 and subnet for PV inverter is 192.168.44.0/24 (so I have room for another 252 inverters).

---
### Post 16
Author: Unknown
Date: Unknown

Hello. I finally had time to upload the config file.I'm still migrating some devices from my old LAN to the new main LAN segment, and this week I replaced a dumb switch with a managed one. Now I can start defining VLANs for the Guest WiFi network, the IoT LAN segment, and some other stuff.Thanks!

---
