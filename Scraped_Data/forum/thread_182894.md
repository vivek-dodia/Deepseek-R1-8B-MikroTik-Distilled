---
title: Thread-182894
url: https://forum.mikrotik.com/viewtopic.php?t=182894&sid=49f92a630bc7970d8ca50523be880e8f
thread_id: 182894
section: RouterOS
post_count: 97
date_crawled: 2025-02-03T14:12:14.782703
---

### Post 1
Author: Unknown
Date: Unknown

i have a dynamic changing ipv6 prefix. For some reason it's very dynamic an changes multiple times a day and i end up with multiple ipv6 addresses on the client's.https://www.ripe.net/publications/docs/ ... ed-harmfulThere under 5.2 is this mentioned: "If the CPE knows that the delegated prefix has changed, it should send out RA packets with a prefix valid lifetime of 0 to tell all devices that the old addresses are no longer valid."Is RouterOS sending an RA with a lifetime of 0 when the prefix changes? Or is there some way to do it with a script?

---
### Post 2
Author: Unknown
Date: Unknown

Is RouterOS sending an RA with a lifetime of 0 when the prefix changes? Or is there some way to do it with a script?No, it isn't doing this. I'm not sure how to fix it with a script, it may be possible. This is something I hope they will fix soon in RouterOS v7.

---
### Post 3
Author: Unknown
Date: Unknown

I think it's something that RouterOS should support natively (eventually). But it should be doable using lease script too. You need to add previous prefix in /ipv6/nd with zero lifetime. I don't know if there's separate event for releasing old prefix and getting new one. If there is, and it's in some variable set by script, it should be very easy. If not, you'd need to save previous prefix in some global variable and use that.Edit: Actually, probably not that easy, because prefix that lease script see can be e.g. /56, but you'd need to advertise /64s used on individual interfaces, so that can be quite a bit of scripting.

---
### Post 4
Author: Unknown
Date: Unknown

Edit: Actually, probably not that easy, because prefix that lease script see can be e.g. /56, but you'd need to advertise /64s used on individual interfaces, so that can be quite a bit of scripting.Im not familiar with Mikrotik Scripting but would it be simple to just send a RA lifetime 0 bevor a prefix is Advertised? I guess in a simple network without multiple ipv6 networks this would not be to bad?

---
### Post 5
Author: Unknown
Date: Unknown

Yes and no. You can add config for advertising old prefix, but you first need to find out what it is. Because if you add it using address with from-pool, what prefix is selected is internal mechanism, you don't know for sure what exact prefix it will be. So you'll probably have to take one that was selected, but it depends on whether it's stil there when lease script runs after the change.

---
### Post 6
Author: Unknown
Date: Unknown

Hello,I am using RouterOS 7.1.1 and i have dynamic IPv6 /56 range from ISP.My lan-clients (android 12, windows 10/11) are keeping the old IPv6 address and getting the new ones after some time, however it is the issue that you described.Seems like well known issue, where IETF also stated workarounds - section 5.1 - Improvements to SLAAChttps://datatracker.ietf.org/doc/html/d ... ection-5.1So, any chance that we can expect this implemented natively via RouterOS update?

---
### Post 7
Author: Unknown
Date: Unknown

There's always chance, but someone needs to convince MikroTik. Before that happens, you're on your own. After a not really enjoyable masochistic session with RouterOS scripting, I'm pretty sure it's doable in some way with that. Here is what I came up with (DHCPv6 client lease script):Code:Select all:if ($"pd-valid" = 1) do={
  :log info ("### acquired prefix: ".$"pd-prefix")
} else={
  :log info ("### lost prefix: ".$"pd-prefix")
  :local Addresses [/ipv6 address find from-pool=dhcp-pool]
  :log info $Addresses
  :foreach Address in=$Addresses do={
    :local Tmp [/ipv6 address get $Address address]
    :local Prefix ([:pick $Tmp 0 ([:len $Tmp] - 4)]."/64")
    :log info ("Prefix: ".$Prefix)
    :local Interface [/ipv6 address get $Address interface]
    :log info ("Interface: ".$Interface)
    :do {
      /ipv6 nd prefix add interface=$Interface prefix=$Prefix preferred-lifetime=0 valid-lifetime=0
    } on-error={
      :log warn "failed: /ipv6 nd prefix add interface=$Interface prefix=$Prefix preferred-lifetime=0 valid-lifetime=0"
    }
  }
}It's basic proof of concept, whichalmostworks. Aside from zero robustness, the problem is that when I'm trying to add prefix with zero lifetime, same dynamic prefix already exists, so it fails. But it has to exist, because otherwise I wouldn't be able to find what I need to add. Also, when I look at it now, I could have started there, and not from IPv6 address. The solution would be either to somehow delay the command to add zero-lifetime prefix, after the old dynamic one is removed (I'm not sure how, except maybe with horrible hack using scheduler), or script the whole address assignment, instead of using from-pool (which may not be too difficult). If anyone wants to play further, I wish you good luck.As for me, my frustration level is high enough to last me for a while. I don't know if it's just me, but RouterOS scripting is so unintuitive and unfriedly, as if it was one of design goals. For example, I wanted to get prefix properly from any address. So I have an address:[sob@CHR5] > :put [/ipv6 address get [find interface=test2 from-pool=dhcp-pool] address]2001:db8:0:123:234:5678:9abc:def0/64And I want only first 64 bits:[sob@CHR5] > :put ([/ipv6 address get [find interface=test2 from-pool=dhcp-pool] address] & ffff:ffff:ffff:ffff::)Script Error: cannot compute bitwise "and" of string and ipv6 prefixOops. But I can do this and it works:[sob@CHR5] > :put ([:toip6 "2001:db8::123:234:5678:9abc:def0"] & ffff:ffff:ffff:ffff::)2001:db8:0:123::Fine, then I'll just do this:[sob@CHR5] > :put ([:toip6 [/ipv6 address get [find interface=test2 from-pool=dhcp-pool] address]] & ffff:ffff:ffff:ffff::)[sob@CHR5] >What?! (edit: I see it now, it doesn't like address ending with /64, I'd have to strip that first; so ok, it's my mistake, but it's one such problem after another)

---
### Post 8
Author: Unknown
Date: Unknown

Ok i see a script is kinda bad. And there should no need for it anyway. A "Simple" thing like acquiring an ip prefix should just work. But i found something.Since 2 Days i log DHCP on debug. Now i found something that happens bevor every new prefix:Code:Select all21:54:52 dhcp,debug,packet send pppoe-out1 -> ff02::1:2%50 
21:54:52 dhcp,debug,packet type: solicit 
21:54:52 dhcp,debug,packet transaction-id: aeb768Oh the Router just solicit a new prefix! Every Day! GreatHow can i stop this?Edit:It's kinda simple:Code:Select all21:54:40 pppoe,ppp,info pppoe-out1: terminating... 
21:54:40 pppoe,ppp,info pppoe-out1: disconnected 
21:54:40 pppoe,ppp,info pppoe-out1: initializing... 
21:54:40 pppoe,ppp,info pppoe-out1: waiting for packets... 
21:54:41 interface,info pppoe-out1 detect UNKNOWN 
21:54:41 dhcp,debug rebinding with any server... 
21:54:41 pppoe,ppp,info pppoe-out1: connecting... 
21:54:42 pppoe,ppp,info pppoe-out1: authenticated 
21:54:42 pppoe,ppp,info pppoe-out1: connected 
21:54:42 interface,info pppoe-out1 detect UNKNOWN 
21:54:42 dhcp,debug rebinding with any server...pppoe Connection from the Provider goes down. I guess they do this every 24H on a Privat VDSL Connection to reset the V4... But i should get 180 Days with my V6 Prefix. Provider is 1&1 with a VDSL Bitstream Access to "Deutsche Telekom"After the pppoe disconnect RouterOS tries 4 rebinds on DHCPV6 Client. After 4 rebind there is a solicit.In the configuration from Deutsch Telekom the DHCPV6 Client is in the pppoe Connection.Is there a way to change the behavior of RouterOS? Pause the DHCPV6 Client when there is no pppoe connection?

---
### Post 9
Author: Unknown
Date: Unknown

Basic idea about handling broken connections is that one must not assume that re-established connections will be able to handle previously used addresses. That's even more the case with PtP connections (such as PPPoE) where whatever client has is routed from ISP towards client.So it's the only right thing for DHCP (and DHCPv6) client to do the full handshake. It's then up to DHCP server to give out addresses according to admin's policy.Many ISPs have policy of (deliberately) changing addresses and prefixes for varous reasons (most of them have to do with <something> their clients). And the only proper technical way to deal with it is to acquire static IP address and/or IPv6 prefix from ISP (sometimes this comes with additional cost).

---
### Post 10
Author: Unknown
Date: Unknown

Right... Since 20 Years we try to implement ipv6 and now its just time to "fix" every ISP in the World... More and more servers have no ipv4 anymore (for various reasons)So what we do now? NAT?Found a Internet Draft:https://datatracker.ietf.org/doc/html/d ... c-renum-01And it ends in rfc9096:https://datatracker.ietf.org/doc/html/rfc9096@Mikrotik could you please implement rfc9096?

---
### Post 11
Author: Unknown
Date: Unknown

No amount of NATing will save your ongoing connections, they'll just break. Your ISP doing the disconnects in the middle of evening is .... (insert your favourite curse word).

---
### Post 12
Author: Unknown
Date: Unknown

Is there a way to change the behavior of RouterOS? Pause the DHCPV6 Client when there is no pppoe connection?PPP profile has on-up and on-down event, so you can use them to enable and disable DHCPv6 client. But it may not help, because DHCPv6 client will probably start from scratch anyway when enabled.

---
### Post 13
Author: Unknown
Date: Unknown

No amount of NATing will save your ongoing connections, they'll just break. Your ISP doing the disconnects in the middle of evening is .... (insert your favourite curse word).I have no problem with a Breaking connection. My problem is the somewhat the lifetime of the ipv6 prefix. When i get a new prefix the old ipv6 address on the clients Steys there and is deprecated. The Clients are not able to figure that out in ipv6. The standard lifetime on Mikrotik is 1h and preferred 30minutes. i changed it to 30min and 15min. i don't know what happens when u just lower it further, but i guess at some point, some things are happeningThe goal would be to find a Solution to the prefix lifetime. It seems the Provider changes the prefix about every ~24h. So with the Mikrotik standard config i have ~1 Hour downtime every day... rfc9096 describes how to deal with such a situation.https://datatracker.ietf.org/doc/rfc9096/

---
### Post 14
Author: Unknown
Date: Unknown

PPP profile has on-up and on-down event, so you can use them to enable and disable DHCPv6 client. But it may not help, because DHCPv6 client will probably start from scratch anyway when enabled.My Provider (1&1) is a Reseller from "Deutsche Telekom" the have a so called Bit-stream accesshttps://en.wikipedia.org/wiki/Bit-stream_accesseven my IP Adresse is from Deutsche Telekom. I know the Prefix lifetime from Deutsche Telekom is 180 Days. So i guest with the same IP it's the same DHCP so i have the same time? So something is wrong with the Mikrotik DHCP Client...I just found a Forum Post from my Provider from 2017. The mention a Prefix lifetime from 24h! Without rfc9096 i don't know what to do! Disable -> Enable the pppoe interface every night and hope for the best? But even then i see another problem with the V6 Address Advertisement on RouterOSWhen a Prefix is enabled and advertised in IPv6 Address List and there is a IP with that Prefix on the network it reports: "Duplicate Address Detected" and the Prefix is disabled. But there might be only staled addresses with the same Prefix. After a while they are gone, but RouterOS does not notice this and leaves the prefix disabled. So disable -> enable pppoe could lead to this problem...Theres a reason for rfc9096

---
### Post 15
Author: Unknown
Date: Unknown

There's no doubt that this should be internal function. If you assign address using from-pool and pool changes, system should handle it. If it automatically advertises current valid prefix, it might as well advertise the old one with zero lifetime, it shouldn't be too difficult to add it. You can write to MikroTik support and report it as bug or as feature request, and you'll see what they tell you.

---
### Post 16
Author: Unknown
Date: Unknown

This issue was already reported in 2013, but apparently still not fixed.  There's scripts in the other threads, also, to try to deal with the problem.Deprecating old IPv6 prefix when removed or replaced RFC6204viewtopic.php?t=73034IPv6 connectivity problems...viewtopic.php?f=13&t=77404

---
### Post 17
Author: Unknown
Date: Unknown

It's standard with IPv6 stuff, "there's not enough demand for it", so it can wait few years... :\

---
### Post 18
Author: Unknown
Date: Unknown

Also, when your IPv6 prefix changes multiple times per day it is probably better to handle it as "ISP does not support IPv6" and unconfigure it.Otherwise you likely would have more problems than benefits due to this situation.And of course, ask ISP to stop that silly behavior.

---
### Post 19
Author: Unknown
Date: Unknown

Also, when your IPv6 prefix changes multiple times per day it is probably better to handle it as "ISP does not support IPv6" and unconfigure it.Otherwise you likely would have more problems than benefits due to this situation.And of course, ask ISP to stop that silly behavior.Or we could just follow RFC9096... This is an updated RFC6204...And i ask my ISP about that silly behavior. In 2017... But they Act like Mikrotik and just don't care...Oh and while you on that thing. Could you just ask all other ISP's in the World to fix that??? Sorry but there is no solution other than RFC9096...

---
### Post 20
Author: Unknown
Date: Unknown

There is a difference between "IPv6 address could sometimes change" (and maybe it would change every night) and "IPv6 address changes multiple times per day".Even when it would be perfectly handled by the router, there would still be issues when the address changes in the middle of your download, for example.It would be inconvenient even when it would be handled immediately.

---
### Post 21
Author: Unknown
Date: Unknown

There is a difference between "IPv6 address could sometimes change" (and maybe it would change every night) and "IPv6 address changes multiple times per day".Even when it would be perfectly handled by the router, there would still be issues when the address changes in the middle of your download, for example.It would be inconvenient even when it would be handled immediately.That's true! But im used to losing my connection every 24 Hours (it's just bad to get another Hour or so on top with that lifetime thing). That's just normal in Germany! The ISP's are selling changing IP addresses as a Privacy feature. If you give a German a fixed IP, he gets upset about his privacy! And even in a business subscription you can end up paying +5€ a month for a fixed IP. The sell "privacy" to Privat Customers and selling fixed addresses to costumers who depend on it. And now i write a Post in an Customer Forum about how bad that is.I wouldn't fuss here if I had another option! Or do you thing the IETF is releasing rfc9096 just for fun? I also think this a a bad idea, but what options are there?Reeboting the Router over night and just eat that even longer downtime? That's kind of an optionBut... Power Outage... Electrician cuts the line... Construction worker destroys the line... Stuff at the Provider... etc...

---
### Post 22
Author: Unknown
Date: Unknown

Until you get built-in suppport from MikroTik, which is the right solution, you can try the following. I couldn't resist and had to try once more. It's still not exactly beautiful, but this time it works. Initial config is (do not use from-pool for addresses):Code:Select all/ipv6 address
add interface=<LAN1> address=::1/64 advertise=yes comment=addr1 disabled=yes
add interface=<LAN2> address=::1/64 advertise=yes comment=addr2 disabled=yes
/ipv6 nd prefix
add interface=<LAN1> prefix=::/64 preferred-lifetime=0s valid-lifetime=0s disabled=yes
add interface=<LAN2> prefix=::/64 preferred-lifetime=0s valid-lifetime=0s disabled=yesActual configuration of addresses is at the first line of script, "name" must match comment given to address, "addr" is partial address what will be combined with prefix.Code:Select all:local Config {{name="addr1";addr="::1:0:0:0:1"};{name="addr2";addr="::2:0:0:0:1"}}

foreach C in=$Config do={
  :local IdAddr [/ipv6 address find comment=($C->"name")]
  :local Interface [/ipv6 address get $IdAddr interface]
  :local Disabled [/ipv6 address get $IdAddr disabled]
  :local IdPrefix [/ipv6 nd prefix find interface=$Interface valid-lifetime="0s"]
  :local OldAddr [/ipv6 address get $IdAddr address]
  :local OldPrefix (([:toip6 [:pick $OldAddr 0 [:find $OldAddr "/"]]] & ffff:ffff:ffff:ffff::)."/64")
  :if ($"pd-valid" = 1) do={
    :local NewAddr (([:toip6 [:pick $"pd-prefix" 0 [:find $"pd-prefix" "/"]]] | [:toip6 ($C->"addr")])."/64")
    :local NewPrefix (([:toip6 [:pick $NewAddr 0 [:find $NewAddr "/"]]] & ffff:ffff:ffff:ffff::)."/64")
    :if ($OldAddr != $NewAddr || $Disabled = true) do={
      :if ($OldPrefix = $NewPrefix)  do={
        /ipv6 nd prefix set $IdPrefix disabled=yes
        :delay 1s
      }
      :log info ($Interface.": new prefix: ".$NewPrefix)
      /ipv6 address set $IdAddr address=$NewAddr disabled=no
      :delay 1s
      :if ($OldPrefix != $NewPrefix && $OldPrefix != ::/64)  do={
        /ipv6 nd prefix set $IdPrefix prefix=$OldPrefix disabled=no
        :log info ($Interface.": expired prefix: ".$OldPrefix)
        :delay 1s
      }
    }
  } else={
    /ipv6 address set $IdAddr disabled=yes
    :delay 1s
    /ipv6 nd prefix set $IdPrefix prefix=$OldPrefix disabled=no
    :log info ($Interface.": expired prefix: ".$OldPrefix)
    :delay 1s
  }
}edit: Improved script

---
### Post 23
Author: Unknown
Date: Unknown

In the context of such scripts: I sometimes notice that it would be desirable to have an option (to each config command) that some setup change is only to be applied to the running router and not to be saved in the flash.  So a reboot would make it fall back to the initially configured state and then you can have a dynamic config that changes using a script.I face a similar issue in a workaround I have made for a bug in the transport network where I need to disable / enable a PPPoE interface but it should not remain disabled when the router is restarted between these actions.In some other router operating systems,everythingin configuration is lost on a reboot unless explicitly "written to flash".  That isn't nice to have either.  But an option to change something without saving it would be nice.

---
### Post 24
Author: Unknown
Date: Unknown

That's true! But im used to losing my connection every 24 Hours (it's just bad to get another Hour or so on top with that lifetime thing). That's just normal in Germany! The ISP's are selling changing IP addresses as a Privacy feature. If you give a German a fixed IP, he gets upset about his privacy! And even in a business subscription you can end up paying +5€ a month for a fixed IP. The sell "privacy" to Privat Customers and selling fixed addresses to costumers who depend on it. And now i write a Post in an Customer Forum about how bad that is.Well I already wrote, it would be possible to live with it when it changes once a day, and during a time you are not likely to be using the computer (maybe 03:00 or so).But the claim was that it changesmultiple times per day.  That is beyond convenient.When it changes only once a day and you can control when it changes (e.g. by reconnecting during the night as some routers for the German market can do) it would be possible to configure the lifetime parameter in such a way that the change would not bother you toos much.If not, you likely need a script like Sob wrote.I wouldn't fuss here if I had another option! Or do you thing the IETF is releasing rfc9096 just for fun? I also think this a a bad idea, but what options are there?Reeboting the Router over night and just eat that even longer downtime? That's kind of an optionBut... Power Outage... Electrician cuts the line... Construction worker destroys the line... Stuff at the Provider... etc...Fortunately here in the Netherlands we do not have this issue and all IP addresses are fixed by default.  At my (and I think all other VDSL and Fiber) providers it only changes when the provider has to do some network changes (maybe once every 3-5 years or so) and at Cable providers it usually does not change unless you power off your router and leave it powered off for more than an hour or so (they apparently use DHCP with a lease lifetime of about an hour).I never hear people complaining about privacy of their IP address.

---
### Post 25
Author: Unknown
Date: Unknown

I never hear people complaining about privacy of their IP address.I guess it's about educating people/customers (even if the subject of education is utter nonsense). In Germany it seems to be privacy on internet. In my country it's section speed measurement on motorways (which is deemed unconstitutional due to privacy concerns), In Netherlands it might be something else (I hope there isn't though).In my country ISPs used to break conenctions once a day (they did it during the night though) and they also tried the privacy bullshit. In reality it was to make some money on people who wanted their IP addresses not changing. Some ISPs still break connections but luckily it's possible to get static address / prefix without supplemental charge (and those connections don't break at all). Somehow our then largest ISP used Deutsche Telekom as a role model ... and now that ISP is not the largest in our country anymore. That's gotta be telling something, isn't it?

---
### Post 26
Author: Unknown
Date: Unknown

I never hear people complaining about privacy of their IP address.I guess it's about educating people/customers (even if the subject of education is utter nonsense). In Germany it seems to be privacy on internet. In my country it's section speed measurement on motorways (which is deemed unconstitutional due to privacy concerns), In Netherlands it might be something else (I hope there isn't though).In the Netherlands we are not that naive that we believe that our privacy on internet is related to our IP address...

---
### Post 27
Author: Unknown
Date: Unknown

@pe1chl: I can see how running-only config could be useful in some cases. Here it doesn't matter much, it could save few flash writes, but it can't get stuck in any unwanted state. Well, shouldn't. The whole thing seems a bit fragile. For example, I had to add delay between the commands, otherwise it didn't work. It looks like as if it works asynchronously and it doesn't wait until command fully completes. So I set new address, and following attempt to change prefix failed.And let me be very clear, this is just workaround, routers are supposed to handle prefix changes (including advertising the old one as dead) themselves. I never liked whole prefix delegation, but it exists and rules are clear.

---
### Post 28
Author: Unknown
Date: Unknown

It's your ISP that's causing the problem, they should be giving persistent /56shttps://www.ripe.net/publications/docs/ ... ed-harmful

---
### Post 29
Author: Unknown
Date: Unknown

It's your ISP that's causing the problem, they should be giving persistent /56shttps://www.ripe.net/publications/docs/ ... ed-harmfulI know #21 ?viewtopic.php?t=182894#p911451Until you get built-in suppport from MikroTik, which is the right solution, you can try the following. I couldn't resist and had to try once more. It's still not exactly beautiful, but this time it works. Initial config is (do not use from-pool for addresses):Code:Select all/ipv6 address
add interface=<LAN1> address=::1/64 advertise=yes comment=addr1 disabled=yes
add interface=<LAN2> address=::1/64 advertise=yes comment=addr2 disabled=yes
/ipv6 nd prefix
add interface=<LAN1> prefix=::/64 preferred-lifetime=0s valid-lifetime=0s disabled=yes
add interface=<LAN2> prefix=::/64 preferred-lifetime=0s valid-lifetime=0s disabled=yesActual configuration of addresses is at the first line of script, "name" must match comment given to address, "addr" is partial address what will be combined with prefix.Code:Select all:local Config {{name="addr1";addr="::1:0:0:0:1"};{name="addr2";addr="::2:0:0:0:1"}}

foreach C in=$Config do={
  :local IdAddr [/ipv6 address find comment=($C->"name")]
  :local Interface [/ipv6 address get $IdAddr interface]
  :local Disabled [/ipv6 address get $IdAddr disabled]
  :local IdPrefix [/ipv6 nd prefix find interface=$Interface valid-lifetime="0s"]
  :local OldAddr [/ipv6 address get $IdAddr address]
  :local OldPrefix (([:toip6 [:pick $OldAddr 0 [:find $OldAddr "/"]]] & ffff:ffff:ffff:ffff::)."/64")
  :if ($"pd-valid" = 1) do={
    :local NewAddr (([:toip6 [:pick $"pd-prefix" 0 [:find $"pd-prefix" "/"]]] | [:toip6 ($C->"addr")])."/64")
    :local NewPrefix (([:toip6 [:pick $NewAddr 0 [:find $NewAddr "/"]]] & ffff:ffff:ffff:ffff::)."/64")
    :if ($OldAddr != $NewAddr || $Disabled = true) do={
      :if ($OldPrefix = $NewPrefix) do={
        /ipv6 nd prefix set $IdPrefix disabled=yes
      }
      /ipv6 address set $IdAddr address=$NewAddr disabled=no
      :if ($OldPrefix != $NewPrefix && $OldPrefix != ::/64)  do={
        :delay 1s
        /ipv6 nd prefix set $IdPrefix prefix=$OldPrefix disabled=no
      }
    }
  } else={
    /ipv6 address set $IdAddr disabled=yes
    :delay 1s
    /ipv6 nd prefix set $IdPrefix prefix=$OldPrefix disabled=no
  }
}thx but i just tried this today:Code:Select all/ipv6 nd prefix
add interface=<LAN1> prefix=::/64 preferred-lifetime=0s valid-lifetime=0s disabled=noendet up with "Status: invalid"Just tried it again and now its working... but Windows and Android are just starting to give themselves some address? (the remain on the clients after disabling advertisement)But i just notice, the handling with a stale v6 on the client is much better todayWindows with a advertised ::/64 and a lifetime of 0:   (after a while there are multiple ipv6...)Code:Select allWindows-IP-Konfiguration

Ethernet-Adapter Ethernet 6:

   Verbindungsspezifisches DNS-Suffix: home
   IPv6-Adresse. . . . . . . . . . . : 5813:200:280f:200:2c48:43a5:51ff:d554
   Temporäre IPv6-Adresse. . . . . . : 5813:200:280f:200:b918:8b6c:f7d:9144
   Verbindungslokale IPv6-Adresse  . : fe80::2c47:43a5:52ff:d454%4So even with multiple stale ipv6, Windows and Android can handle it today... But what does the dyndns client with that? At the moment its just fine....At some point i disabled the v6pool advertisement in /ipv6 address. After that the Windows 10 Client lostimmediatelyall his IPv6! (random? / is there something?)But disable -> enable advertisement just leads to "duplicate address detected" and then you have to disconnect every client from your network to enable it again. Fun!Ok lets Advertise some random prefix and try to remove it again... so advertise 1::/64. advertise 2::/64 with a shorter lifetime. Advertise 3::/64 with a lifetime of 1 Second. They don't go away!So Wireguard does confirm RouterOS is doing what it should do with the prefix lifetime. But does Windows/Android/Whatever even care about that?In Win10 i found:Code:Select allnetsh interface ipv6 show interfaces 4 level=verboseThis shows some lifetime. But its not the advertised lifetime from the router. Also this is not tide to an IP ore something, it's on the Ethernet interface. Windows what are you doing?Could it be that Win 10 and Android 12 just ignore the lifetime of an ipv6 and just use preconfigured settings?

---
### Post 30
Author: Unknown
Date: Unknown

You shouldn't enable "/ipv6 nd prefix" entry manually, it should be done by script when it has old prefix to advertise. Here it works, this is initial state (netsh interface ipv6 show address):Code:Select allAddr Type  DAD State   Valid Life Pref. Life Address
---------  ----------- ---------- ---------- ------------------------
Other      Preferred     infinite   infinite fe80::d4b7:93e0:15dd:6520%2When it gets first prefix, it's added with long lifetime (it's from default config, I'd use something shorter, if it's going to change anyway):Code:Select allAddr Type  DAD State   Valid Life Pref. Life Address
---------  ----------- ---------- ---------- ------------------------
Temporary  Preferred  6d23h59m55s  23h55m14s 2001:db8:aaaa:2:e03f:1316:8927:d9b0
Public     Preferred  29d23h59m58s 6d23h59m58s 2001:db8:aaaa:2:d4b7:93e0:15dd:6520
Other      Preferred     infinite   infinite fe80::d4b7:93e0:15dd:6520%2After prefix changed:Code:Select allAddr Type  DAD State   Valid Life Pref. Life Address
---------  ----------- ---------- ---------- ------------------------
Temporary  Deprecated    1h56m51s         0s 2001:db8:aaaa:2:e03f:1316:8927:d9b0
Public     Deprecated    1h56m51s         0s 2001:db8:aaaa:2:d4b7:93e0:15dd:6520
Temporary  Preferred  6d23h59m52s  23h55m11s 2001:db8:bbbb:2:e03f:1316:8927:d9b0
Public     Preferred  29d23h59m52s 6d23h59m52s 2001:db8:bbbb:2:d4b7:93e0:15dd:6520
Other      Preferred     infinite   infinite fe80::d4b7:93e0:15dd:6520%2Another change:Code:Select allAddr Type  DAD State   Valid Life Pref. Life Address
---------  ----------- ---------- ---------- ------------------------
Temporary  Deprecated    1h55m19s         0s 2001:db8:aaaa:2:e03f:1316:8927:d9b0
Public     Deprecated    1h55m19s         0s 2001:db8:aaaa:2:d4b7:93e0:15dd:6520
Temporary  Deprecated    1h59m54s         0s 2001:db8:bbbb:2:e03f:1316:8927:d9b0
Public     Deprecated    1h59m54s         0s 2001:db8:bbbb:2:d4b7:93e0:15dd:6520
Temporary  Preferred  6d23h59m47s   23h55m6s 2001:db8:cccc:2:e03f:1316:8927:d9b0
Public     Preferred  29d23h59m54s 6d23h59m54s 2001:db8:cccc:2:d4b7:93e0:15dd:6520
Other      Preferred     infinite   infinite fe80::d4b7:93e0:15dd:6520%2So it seems to work fine. Well, almost, one time it got stuck, there was valid IP address with advertise=yes, but RouterOS didn't send any advertisements. It only started after I disabled and enabled it again. Which is unfortunate, but could be probably fixed if script did that after adding address, maybe with some additional delays to give system time to process everything (ugly solution, but...).

---
### Post 31
Author: Unknown
Date: Unknown

I also have public /56 range from ISP in Croatia, EU, and changes several times per day (due to connection braking).@dani, what is trigger for mentioned script? can it be automated?So, we all here agree, that the only and permanent solution is would be the Mikrotik router needs to support RFC 9096https://datatracker.ietf.org/doc/html/rfc9096which is basically newer version of previous RFC6204 ? And this script is kind of workaround?I am thinking of other alternatives:1) Implement new local static IPv6 range for LAN and then do NAT2) Disable IPv6 completely for LANI am sad about both options.

---
### Post 32
Author: Unknown
Date: Unknown

Another workaround that was discussed in older threads about this subject:viewtopic.php?f=2&t=73034Is setting the preferred-lifetime and valid-lifetime to a shorter value, like 10 minutes.  That way, if the prefix changes, the old IPv6 addresses will expire quicker.  There may still be some IPv6 downtime, but it will be shorter (less than 10 minutes, or whatever).

---
### Post 33
Author: Unknown
Date: Unknown

but if we set to 10 minutes, will the client device definitely loose the IPv6 address after 10 minutes. What if HTTP file download is in place that is longer then 10 minutes, IP connection will break, right?

---
### Post 34
Author: Unknown
Date: Unknown

No, the valid lifetime is a bit like the DHCP lease time.  When it expires and the router is still announcing the same prefix, the client will just remain using the same address.(not considering "privacy extensions")I have set the valid lifetime to 8 hours and the preferred lifetime to 1 hour and it works fine.

---
### Post 35
Author: Unknown
Date: Unknown

ok so we are talking about?Code:Select all/ipv6 nd set [ find default=yes ] other-configuration=yes ra-delay=5s ra-interval=5s-30sor:Code:Select all/ipv6 nd prefix default set preferred-lifetime=5m valid-lifetime=10m

---
### Post 36
Author: Unknown
Date: Unknown

I was talking about the second one.  That determines how long a client considers the prefix valid after last having heard about it.The first one describes the announcement interval.  Of course the two should be chosen such that the prefix does not expire before it is being announced again.

---
### Post 37
Author: Unknown
Date: Unknown

Even with a short ra-lifetime, it's not helping for me.  There's the "nd" settings and the "nd prefix" settings.  The "nd" settings have an "ra-lifetime" value, and the "nd prefix" settings have "valid-lifetime" and "preferred-lifetime" values.Code:Select all[admin@MikroTik] /ipv6 nd> print
Flags: X - disabled, I - invalid, * - default
 0  * interface=bridge ra-interval=1m30s-4m30s ra-delay=3s mtu=unspecified reachable-time=unspecified retransmit-interval=unspecified ra-lifetime=10m hop-limit=unspecified
      advertise-mac-address=yes advertise-dns=no managed-address-configuration=no other-configuration=noIt's the "nd prefix" settings that are affecting the ipv6 lifetimes on the clients, and they're stuck at very long default values, and I get an error if I try to change them.Code:Select all[admin@MikroTik] /ipv6 nd prefix> print
Flags: X - disabled, I - invalid, D - dynamic
 0  D prefix=2001:x:x:x::/64 6to4-interface=none interface=bridge on-link=yes autonomous=yes valid-lifetime=4w2d preferred-lifetime=1w(error trying to change the dynamic prefix)Code:Select all[admin@MikroTik] /ipv6 nd prefix> /ipv6 nd prefix set preferred-lifetime=10m valid-lifetime=1h
numbers: 0
failure: can not change dynamic prefixI can't see the lifetime values in windows, but I can in linux.  It's following the 4w2d "nd prefix" values that I can't change.Code:Select allinet6 2001:x:x:x:b:b:b:b/64 scope global dynamic mngtmpaddr
       valid_lft 2591854sec preferred_lft 604654sec
    inet6 2001:x:x:x:a:a:a:a/64 scope global dynamic mngtmpaddr
       valid_lft 2587382sec preferred_lft 600182secIs there some way to set the default values that will get used for the dynamic prefix?

---
### Post 38
Author: Unknown
Date: Unknown

Look at /ipv6/nd/prefix/default.

---
### Post 39
Author: Unknown
Date: Unknown

Look at /ipv6/nd/prefix/default.Thank you!  I didn't see that before.  That did it.Code:Select all[admin@MikroTik] /ipv6 nd prefix default> print
          autonomous: yes
      valid-lifetime: 1h
  preferred-lifetime: 10m

---
### Post 40
Author: Unknown
Date: Unknown

So, we all here agree, that the only and permanent solution is would be the Mikrotik router needs to support RFC 9096https://datatracker.ietf.org/doc/html/rfc9096which is basically newer version of previous RFC6204 ? And this script is kind of workaround?I am thinking of other alternatives:1) Implement new local static IPv6 range for LAN and then do NAT2) Disable IPv6 completely for LANI am sad about both options.No this will not work...I testet with a Win 10 Client. It's kinda impossible to work with.Prefix ra lifetime 10 days > Windows lifetime 10 days > set ra lifetime to 1 hour > Windows lifetime: 7 daysPrefix ra lifetime 10 minutes > Windows lifetime 10 minutes > set ra lifetime 1 hour > Windows lifetime 1 hourPrefix ra lifetime 5 hours > Windows lifetime 5 hours > set ra lifetime 1 hour > Windows  lifetime 5 hourThere is kinda a "low limit" of 7 days lifetime. But when you advertise a lower lifetime, windows will take it. (but you can't put them down any further from there)I tried that yesterday. Today the "low limit" is somehow at 2 hours.You can do whatever you want with the preferred lifetime.I found a description of services yesterday with my provider. They refer to the technical specification 1TR112 of Deutsche Telekom. As far as I understand, this refers in the interesting part to TR-124 of the Broadband Forum.https://www.broadband-forum.org/1tr112:https://www.telekom.de/hilfe/downloads/1tr112.zipTR-124:https://www.broadband-forum.org/download/TR-124.pdfIn both documents the lifetime of an ipv6 prefix is ​​practically not mentioned.1) Implement new local static IPv6 range for LAN and then do NATI could slowly make friends with nat again2) Disable IPv6 completely for LANThere are now a few VPS providers who have switched off IPV4 because it is too complicated. In the long term, I think you will have problems without the V6 just as you would without the V4 today.I can't see the lifetime values in windows, but I can in linux. It's following the 4w2d "nd prefix" values that I can't change.you can see them with:Code:Select allnetsh interface ipv6 show addressesbut if we set to 10 minutes, will the client device definitely loose the IPv6 address after 10 minutes. What if HTTP file download is in place that is longer then 10 minutes, IP connection will break, right?As long as the router has the prefix, that shouldn't happen. from what I've seen so far, the client always gets the prefix renewed in less than 1 minute. But if the router distributes a new prefix, you just want to get rid of the old one as quickly as possible, since this leads to connection problems.After prefix changed:Code:Select allAddr Type  DAD State   Valid Life Pref. Life Address
---------  ----------- ---------- ---------- ------------------------
Temporary  Deprecated    1h56m51s         0s 2001:db8:aaaa:2:e03f:1316:8927:d9b0
Public     Deprecated    1h56m51s         0s 2001:db8:aaaa:2:d4b7:93e0:15dd:6520
Temporary  Preferred  6d23h59m52s  23h55m11s 2001:db8:bbbb:2:e03f:1316:8927:d9b0
Public     Preferred  29d23h59m52s 6d23h59m52s 2001:db8:bbbb:2:d4b7:93e0:15dd:6520
Other      Preferred     infinite   infinite fe80::d4b7:93e0:15dd:6520%2Another change:Code:Select allAddr Type  DAD State   Valid Life Pref. Life Address
---------  ----------- ---------- ---------- ------------------------
Temporary  Deprecated    1h55m19s         0s 2001:db8:aaaa:2:e03f:1316:8927:d9b0
Public     Deprecated    1h55m19s         0s 2001:db8:aaaa:2:d4b7:93e0:15dd:6520
Temporary  Deprecated    1h59m54s         0s 2001:db8:bbbb:2:e03f:1316:8927:d9b0
Public     Deprecated    1h59m54s         0s 2001:db8:bbbb:2:d4b7:93e0:15dd:6520
Temporary  Preferred  6d23h59m47s   23h55m6s 2001:db8:cccc:2:e03f:1316:8927:d9b0
Public     Preferred  29d23h59m54s 6d23h59m54s 2001:db8:cccc:2:d4b7:93e0:15dd:6520
Other      Preferred     infinite   infinite fe80::d4b7:93e0:15dd:6520%2So it seems to work fine. Well, almost, one time it got stuck, there was valid IP address with advertise=yes, but RouterOS didn't send any advertisements. It only started after I disabled and enabled it again. Which is unfortunate, but could be probably fixed if script did that after adding address, maybe with some additional delays to give system time to process everything (ugly solution, but...).With all these expired prefixes everything works? I can't imagine, probably because these are documentation prefixes? I notice that it works better on modern clients these days, but not 100%. For example the Twitter App and the picture cdn, which sometimes take 5 seconds to establish a connection. In the Chrome browser under Android and Windows again no problems...And without a real v6 connection, this test will lead to nothing anyway? What could possibly go wrong?

---
### Post 41
Author: Unknown
Date: Unknown

With all these expired prefixes everything works?My observation is that devices tend to "invent" IPv6 addresses once in a while even if prefix doesn't change. They will start to use new address for new connections, but will keep using depreciated addresses for already established connections.This of course only works if prefix doesn't change and the old address is still valid in context of subnet.

---
### Post 42
Author: Unknown
Date: Unknown

With all these expired prefixes everything works?My observation is that devices tend to "invent" IPv6 addresses once in a while even if prefix doesn't change. They will start to use new address for new connections, but will keep using depreciated addresses for already established connections.This of course only works if prefix doesn't change and the old address is still valid in context of subnet.that's exactly how ipv6 is supposed to work.  When the preferred lifetime has expired, the devices invent a new address.  The only problem with the changing prefixes is that the devices continue to use the deprecated and these can no longer be routed.  and there is probably no way to get rid of them.

---
### Post 43
Author: Unknown
Date: Unknown

My observation is that devices tend to "invent" IPv6 addresses once in a while even if prefix doesn't change. They will start to use new address for new connections, but will keep using depreciated addresses for already established connections.This of course only works if prefix doesn't change and the old address is still valid in context of subnet.that's exactly how ipv6 is supposed to work.  When the preferred lifetime has expired, the devices invent a new address.  The only problem with the changing prefixes is that the devices continue to use the deprecated and these can no longer be routed.  and there is probably no way to get rid of them.Well, it is kind of optional.  It is called "privacy extensions".  It is useful when you have a device that connects to multiple networks, e.g. a laptop or phone that you take with you and connect to all kinds of networks.  Or it could be argued it has some value when your IP prefix changes all the time.When you are not doing that (e.g. it is a fixed PC at home or a laptop you only use in the home) this is not so useful and you can just turn it off and reduce the confusion and clutter.Without privacy extensions, the lower 64 bits of the IPv6 address are always the same.  That means that even when your prefix changes, due to connecting to another network, the lower bits remain the same and e.g. a website could track you by looking at these bits only.I don't use this so I have a fixed IPv6 address on my machine, which is useful as I run some services on it.

---
### Post 44
Author: Unknown
Date: Unknown

With all these expired prefixes everything works? I can't imagine, probably because these are documentation prefixes?Depends on how you define everything. Not access to internet, obviously, but that's not needed for "lab" test (if I dared to call few CHRs a lab). But otherwise it seems good. Windows accept new prefixes and zero preferred lifetime of old ones. Running ping switches to new address when it becomes available. I'm too lazy to reconfigure stuff for real addresses, but there's no reason why it would work differently with them.

---
### Post 45
Author: Unknown
Date: Unknown

Depends on how you define everything. Not access to internet, obviously, but that's not needed for "lab" test (if I dared to call few CHRs a lab). But otherwise it seems good. Windows accept new prefixes and zero preferred lifetime of old ones. Running ping switches to new address when it becomes available. I'm too lazy to reconfigure stuff for real addresses, but there's no reason why it would work differently with them.Yes, but then you don't see the problem either. it's "only" the problem that clients use an outdated v6 to get on the internet and that doesn't work thanks to the prefix change.Years ago I found rfc4192. Sometimes I also saw 2 active prefixes at the same time on "German routers". But there is no documentation about how this should work. The dhcpv6 client only gives me 1 prefix. Run 2 dhcpv6 clients? On the other hand, the pppoe connection is simply terminated...

---
### Post 46
Author: Unknown
Date: Unknown

Didn't I just describe you that client uses current address with non-zero lifetime? I'd swear I did.

---
### Post 47
Author: Unknown
Date: Unknown

Years ago I found rfc4192. Sometimes I also saw 2 active prefixes at the same time on "German routers". But there is no documentation about how this should work. The dhcpv6 client only gives me 1 prefix. Run 2 dhcpv6 clients? On the other hand, the pppoe connection is simply terminated...Well, when the PPPoE connection bounces, the DHCPv6 client should immediately re-do its request and when it receives a different prefix than before it should declare the old one stale and use the new one to populate the address pool, which should trigger an address reassignment on all interfaces that use that pool.The whole topic of this discussion is (I think) that this does not happen in MikroTik routers, while it does happen in almost all other routers (including typical German routers like AVM Fritz!Box).It seems a bit like a philosophical issue.  I remember the times when one could just unplug an ethernet cable from a switch and plug it into another switchport without the user ever noticing it.Then later came the times where at the moment the ethernet link goes down, all open connections routed over that link are immediately disconnected, the IP address removed, etc etc.Even now, often when you unplug/re-plug the ethernet on a Linux system it will often not re-do the DHCP request by itself.  While other operating systems do that.It is a similar situation to reconnect of PPPoE.   Probably quite some changes have to be made to stock software by MikroTik to make it all working, although it seems that lately in Linux (and with systemd) it is often working more like in Windows.   Which can be a blessing or a bad thing, depending on the situation and your view.

---
### Post 48
Author: Unknown
Date: Unknown

I improved the script a bit (edited in original post), added delay after each command that changes address or prefix, it seems to fix things getting weirdly stuck. And here is how it works:Code:Select all13:46:46 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:47 dhcp,error  address received from the server differs from 2001:db8:aa::/56
13:46:47 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:48 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:50 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:51 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:52 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:53 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:54 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:55 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:56 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:57 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:57 system,info IPv6 address changed
13:46:58 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:5c5f:3a8c:7402:429f->2001:db8::1, len 40
13:46:58 system,info radvd prefix changed
13:46:58 script,info test2: expired prefix: 2001:db8:aa:2::/64
13:46:59 script,info test2: new prefix: 2001:db8:bb:2::/64
13:46:59 system,info IPv6 address changed
13:47:00 system,info radvd prefix changed
13:47:00 script,info test2: expired prefix: 2001:db8:aa:2::/64
13:47:03 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:aa:2:4805:f1c1:a903:b393->2001:db8::1, len 40
13:47:08 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:bb:2:4805:f1c1:a903:b393->2001:db8::1, len 40
13:47:09 firewall,info prerouting: in:test2 out:(unknown 0), src-mac 00:0c:29:07:cc:58, proto ICMP (type 128, code 0), 2001:db8:bb:2:4805:f1c1:a903:b393->2001:db8::1, len 40There's running ping from Windows client to 2001:db8::1. At 13:46:47 router tries to renew original prefix 2001:db8:aa::/56, gets another one, but doesn't like it at first. Lease script is called at 13:46:57 to release original prefix. At 13:46:59 it's called again to add new 2001:db8:bb::/56. Since 13:47:08 pings use new source address from new prefix. So this works. There's small outage, but it's bearable (not that there's any other choice). I don't like the extra delays added by script, but it doesn't work reliably without them. Additional improvement could be updating of some firewall rule(s) to reset tcp connections from old prefix, because client may still try to continue with them. It's possible that ISP does that too, but doing it yourself can't hurt.

---
### Post 49
Author: Unknown
Date: Unknown

Do you think your script would work, when it gets a new prefix after rebooting the router?  Would the old prefix survive the reboot?  I think that would be the main time I could get a new prefix (after rebooting).

---
### Post 50
Author: Unknown
Date: Unknown

Both changed addresses and prefixes are set the same way as if you did it manually, so as long as there's no power outage at the same exact moment when the changes are written (so that it would fail), their state will be kept.

---
### Post 51
Author: Unknown
Date: Unknown

It looks like it's the "IPv6 ND Prefix" defaults that are the important values.  I don't think the ND RA Interval and RA Lifetime are as important.After the Preferred Lifetime, Windows 10 deprecates the address.  And after the Valid Lifetime, it removes it completely.  I tested it.

---
### Post 52
Author: Unknown
Date: Unknown

I just got a Fritzbox 7412 with firtz os 06.87 (German router) attached to my DSL. I guess that this router sets the lifetime of the old one to 0 before it changes the prefix.(also the preferred lifetime)Code:Select allSchnittstelle 4: Ethernet 6

Adresstyp  DAD-Status  Gültigkeit Bevorzugt Adresse
---------  ----------- ---------- ---------- ------------------------
Öffentlich Verworfen     1h54m29s         0s 2003:d1:9704:2700:2c48:43a5:51ff:d554
Temporär   Verworfen     1h54m29s         0s 2003:d1:9704:2700:3906:12c9:3b86:6b22
Öffentlich Bevorzugt     1h59m48s     29m46s 2003:d1:9733:7900:2c48:43a5:51ff:d554
Temporär   Bevorzugt     1h59m48s     29m46s 2003:d1:9733:7900:3906:12c9:3b86:6b22
Öffentlich Verworfen     1h59m45s         0s 2003:d1:9738:7900:2c48:43a5:51ff:d554
Temporär   Verworfen     1h59m45s         0s 2003:d1:9738:7900:3906:12c9:3b86:6b22
Öffentlich Verworfen     1h59m48s         0s fd00::2c48:33a5:51ff:d554
Temporär   Verworfen     1h59m48s         0s fd00::3906:52c9:3b86:6b22
Andere     Bevorzugt     infinite   infinite fe80::2c48:53a5:51ff:d554%4Those were 2 prefix changes. Due to the fact that Windows lifetime changes are more or less irrelevant, these have remained the same, although I would assume that they have also been set to 0.there is also a setting when you want to have your 24-hour forced separation

---
### Post 53
Author: Unknown
Date: Unknown

Preferred lifetime is reset to zero, so client won't use those addresses for anything new, that's the main important part. Valid lifetime is shortened, I'm not sure if it's just Windows or some standard, but it seems as not a bad idea. What I find clearly stupid is changing prefix by cutting off the old one completely. I don't know if it actually happens, but if it does, it breaks all existing connections. So if you try to continue with existing connections for a while and it works, it's nice bonus. And if it doesn't, something on the way (ISP's router) should probably reset them anyway. If not, you'd have to do it yourself.

---
### Post 54
Author: Unknown
Date: Unknown

Well for sure they do this on IPv4 (where it is not possible to do it an other way under PPP) and so it would not surprise me if it is the same on IPv6.It is why those AVM routers have that option to disconnect/reconnect in the middle of the night to hopefully have less impact on the usage.Without that, it could happen at any time (the disconnect happens from the ISP at 24h intervals) and it would impact connections.Still, I am happy that we do not have that sillyness here.

---
### Post 55
Author: Unknown
Date: Unknown

It could work relatively well if done properly. Mainly there shouldn't be hard cutoff. So router would get prefix A, with maximum lifetime reflecting planned rollover. Then it would get new prefix B few hours in advance, before expiration of prefix A. Prefix A's preferred lifetime would be lowered to zero, but both would still work. New connections would use address from prefix B, while old ones would have chance to finish with prefix A. If there were at least few hours of overlap, it would be enough for mosts.But personally I'm all for static config. My favourite is what my home ISP does, they provide addresses on paper. Unfortunatelly only IPv4 so far, but I hope they will do the same with IPv6, when they finally get to it (at least they still have enough public IPv4 addresses to give to customers for free; I didn't want to look greedy, so I only asked for two). While this kind of manual config may seem not very user-friendly, I don't see it as problem, anyone can enter few numbers, and it forces ISP to plan ahead and not do annoying random changes on a whim.

---
### Post 56
Author: Unknown
Date: Unknown

We get both: our address on paper, and auto-configuration via PPPoE and DHCPv6.When the address changes for some reason, we get a new letter with the new address.To me, that has only happened as a result of changes I initiated myself (changing of subscription, changing from DSL-from-the-CO to DSL-from-the-curb, changing ISP).I have heard that some people got enforced changes.  But it is rare.  So no practical need to fiddle with this.In Germany it is normal to get a new address once a day.  I don't know how/where one would get a new address several times per day, that seems annoying to me.

---
### Post 57
Author: Unknown
Date: Unknown

... changing from DSL-from-the-CO to DSL-from-the-curb ...One of ISPs in our country even doesn't change DHCP-assigned IP address when changing from DSL[*] to FO (FTTH). Router remained the same during this operation. Only later I asked for a static IP address and they used the paper-style of assignment.[*] it was even more complicated than that: ISP was leasing bandwidth on copper line from Telekom while Telekom was providing ISDN over same pair. Technically, though, this detail doesn't matter, it's still DSL. But it was ethernet over VDSL type of connection, not PPPoEoA. And obviously this ISP uses same backbone servers for any physical access technology they might use.

---
### Post 58
Author: Unknown
Date: Unknown

Yes that can be done, but usually it is only done by smaller ISPs who use only a single central PPPoE server where all customers on all line types come together.

---
### Post 59
Author: Unknown
Date: Unknown

Yes that can be done, but usually it is only done by smaller ISPs who use only a single central PPPoE server where all customers on all line types come together.As I wrote, the ISP doesn't use PPPoE, they use "straight" ethernet (over whatever L1 technology). And the ISP is not exactly small, not for our country, it's using quite a few /16 address chunks. Indeed they do struggle a bit due their "flat" subscribers' network lately.

---
### Post 60
Author: Unknown
Date: Unknown

It could work relatively well if done properly. Mainly there shouldn't be hard cutoff. So router would get prefix A, with maximum lifetime reflecting planned rollover. Then it would get new prefix B few hours in advance, before expiration of prefix A. Prefix A's preferred lifetime would be lowered to zero, but both would still work. New connections would use address from prefix B, while old ones would have chance to finish with prefix A. If there were at least few hours of overlap, it would be enough for mosts.That's what providers have done in the past. But in the meantime the connection is simply broken off or I just didn't watch it anymore. I would guess rfc4192 for that...On the other hand, there has always been a separation in 24 hours in Germany, we are used to it, but due to the life time situation, it is very annoying.

---
### Post 61
Author: Unknown
Date: Unknown

EDIT: Note that the script code in this post was last updated on 23 February 2023Sorry for the thread bump, but this seemed the best place to put this.Inspired by previous postings here, I have taken a swing at implementing RFC6204/RFC7084/RFC9096 via scripting.  But this time, in such a way that you can still use v6 prefix pools.  You should be able to drop this script in place on a router otherwise configured as you would expect (DHCPv6 client obtaining delegated prefix from ISP, and then assigning longer prefixes out of the dynamic pool that's generated to various interfaces), and it will "just work".  In my limited testing so far, it seems to be pretty robust.  Note, though, that so far I have only tested under 6.49.x.  Feedback appreciated if you give it a try.I almost despaired at being able to get this to work, since the dynamic pool created by the DHCPv6 client (and thus the Used Prefixes assigned from that pool) is *instantly* deleted prior to the on-lease-change script running, so it was impossible to grab a list of the used prefixes that needed to be invalidated from '/ipv6 pool used'.  Fortunately, despite that, the dynamically-generated neighbor discovery prefixes still exist 1-2 seconds after that...which is weird (and I'm not sure we can count on this to always be the case in future RouterOS versions), but for now I'll take it.  The only way to resolve those back to a specific DHCPv6 client instance is by checking to see if a particular ND prefix is covered by the freshly-revoked delegated prefix; if it is, then it is included in the list of prefixes that the script generates static ND prefixes for with 0 lifetimes.Sob mentioned in the commentary for his initial version that his script would sometimes abort if he tried to add a static ND prefix that overlapped with a dynamic one that hadn't been cleared out yet, which is why he abandoned trying to support prefix pools.  I account for that by wrapping the add within a 'do on-error={}' block, and attempting the add/remove cycle four times.  If you get re-assigned the same prefix by ISP/upstream router, no harm done.  If you don't, dynamic prefixes will (in my experience) clear out in time for at least a couple of the adds to work.One weird glitch I ran into was that, in the event you do get re-assigned the same prefix, occasionally the static ND prefix add would successfully happen, and then the DHCP client would re-add the overlapping dynamic prefixes before the script was able to remove the static ones.  When this happened, RouterOS would stop transmitting unsolicited router advertisements for those prefixes.  So as a workaround, upon successfully obtaining a lease, this script will disable and re-enable the associated addresses, which effectively re-generates the dynamic ND prefixes, fixing the problem.To implement, simply copy-and-paste the script into the Advanced (tab) > Script block for your DHCPv6 client instance.  I would also recommend that you set '/ipv6 nd set [find] ra-delay=0'.  Also, you should set 'multicast-helper=full' on any MikroTik WiFi access point interfaces, in order to increase the chances that all of your wireless clients will actually receive any of these router advertisements (though if you run non-MikroTik APs that do not support doing multicast-to-unicast for IPv6 ND/RA traffic, hopefully the fact that the script adds the retired prefixes many times in a row within a few seconds will mean that at least one gets through to everybody on your LAN).  Hope this proves helpful to someone.Quite frankly, at this point in the second half of 2022 with RouterOS 7.4.1 being out, it's simply embarrassing that MikroTik still does not implement this as a first-party feature and that we have to resort to such hackery as this...at the same time, though, I'm once again thankful that ROS is so flexible that sometimes it is possible to work around shortcomings like this with the native scripting.`Code:Select all:global dhcpv6rafix
:set dhcpv6rafix ($dhcpv6rafix + 1)
:local invalid6prefixes [/ipv6 nd prefix print as-value where prefix in $"pd-prefix"]

:global ra6gettemp do={
  :return [/ipv6 nd prefix find where !dynamic and interface=($1->"interface") and prefix=($1->"prefix") and preferred-lifetime~"^0s\$" and valid-lifetime~"^0s\$"]
}

:global ra6removetemp do={
  :global ra6gettemp
  :foreach x in=$1 do={
    /ipv6 nd prefix remove [$ra6gettemp $x]
  }
}

:local ra6invalidate do={
  :global ra6removetemp
  :if ([:len $1] < 1) do={
    :return 0
  }

  [$ra6removetemp $1]
  :delay 1
  :foreach x in=$1 do={
    :do { /ipv6 nd prefix add interface=($x->"interface") prefix=($x->"prefix") preferred-lifetime=0 valid-lifetime=0 } on-error={ }
  }
}

:local checkstucktempra do={
  :global ra6gettemp
  :global ra6removetemp
  :local foundstuck 0

  :foreach x in=$2 do={
    :if ([:len [$ra6gettemp $x]] > 0) do={
      :set foundstuck 1
    }
  }
  :if ($foundstuck != 0) do={
    :delay 10
    :local pooladdrs [/ipv6 address find where address in $1 and from-pool~".+"]
    [$ra6removetemp $2]
    /ipv6 address disable $pooladdrs
    /ipv6 address enable $pooladdrs
  }
}

:if (![:tobool [:tonum ($"pd-valid")]]) do={
  :delay 2
  :for i from=0 to=2 do={
    [$ra6invalidate $invalid6prefixes]
    :delay 1
  }
} else={
  [$checkstucktempra $"pd-prefix" $invalid6prefixes]
}

:if ($dhcpv6rafix < 2) do={
  :set ra6removetemp
  :set ra6gettemp
  :set dhcpv6rafix
} else={
  :set dhcpv6rafix ($dhcpv6rafix - 1)
}

---
### Post 62
Author: Unknown
Date: Unknown

Inspired by previous postings here, I have taken a swing at implementing RFC6204/RFC7084/RFC9096 via scripting.  But this time, in such a way that you can still use v6 prefix pools.Thank you SO much for developing and testing this!I just redid my IPv6 config and moved from the old approach to your script. First tests seem to be very promising. Old prefixes are marked as deprecated when I receive a new one and routing generally works.

---
### Post 63
Author: Unknown
Date: Unknown

I'm from Germany. Our best computer magazine from Heise "CT" has tested various routers for IPv6 functionality. The test was generally quite sobering.What I found frightening was this central sentence:"Mikrotik has failed since 2013 to teach its RouterOS to correctly handle the dynamic IPv6 prefixes common to residential connections."That is why Mikrotik-RouterOS was not tested at all. 29 other manufacturers have been tested, and this will give a very bad reputation to mikrotik routeros in germany!Here dynamic prefixes are standard for private connections on most ISPs. I hope that mikrotik addresses this issue soon.I am personally a great fan of mikrotik routeros because of its stability, freedom and feature richness, but some things take a very long time to be "repaired". (for example OpenVPN on udp)Thank for that script to workaround the missing basic ipv6 feature in routeros.

---
### Post 64
Author: Unknown
Date: Unknown

On the other hand, I can sort of understand that MikroTik cannot handle ALL special cases in ALL countries.  Dynamic IP address in the way it is done in Germany is quite unique I think.(other countries have dynamic address that changes when the connection is interrupted and re-made, but Germany forcefully changes the address even when you remain connected)MikroTik sell all over the world, not only in Germany.  E.g. here in the Netherlands it is still very common to have VDSL to homes, I have VDSL to a curb cabinet that is connected to fiber, but I need a VDSL modem to cover the last 100m.  MikroTik do not support that *AT ALL*, they say "but fiber is the future".We have had long discussions about supporting VDSL SFP modules, but it simply doesn't happen.  In Baltic and Scandinavian countries, everyone seems to have fiber.So your situation certainly isn't unique.  You are victim of having an unusual setup.  AVM supports it properly, but AVM is German.

---
### Post 65
Author: Unknown
Date: Unknown

RouterOS should definitely handle this, changing prefixes is valid config. After all, D in DHCP means dynamic and not necessarily only "not assigned manually", prefix can change too. But that forcibly changing prefixes for customers "just because" is horrible idea, that's also true.

---
### Post 66
Author: Unknown
Date: Unknown

The handling of dynamic addresses in DHCP(v6) works OK, the problem is only that those addresses are further distributed into the network using other mechanisms like SLAAC and *there* it does not relay the change of prefix in a proper and timely manner...But, I would not be surprised when there are many client devices that don't handle it well either.The only real solution probably is to do, like in IPv4, NAT between a fixed local network address and the dynamically assigned prefix of the day.

---
### Post 67
Author: Unknown
Date: Unknown

There's RFC for it, mentioned in this thread, about how CPE devices should handle changing prefixes (advertise old one with zero lifetime). It doesn't seem difficult to add built-in support for that.

---
### Post 68
Author: Unknown
Date: Unknown

> The only real solution probably is to do, like in IPv4, NAT between a fixed local network address and the dynamically assigned prefix of the day.No, it's not. The proper solution is readdressing of the network. If you still need some internal communication, you have Link-Local addresses - your printers or home automation will use LL for communication. Or you could configure additional ULA prefix.> Dynamic IP address in the way it is done in Germany is quite unique I think.However the problem is really big in Germany, due to prefix changing every night with some ISPs, it is not unique to Germany. I've encountered it with my an LTE connection in another country when I have configured the Mikrotik LTE card to prefer another channel. After disconnecting and reconnecting to LTE I got a different IPv6 prefix and in the result lost IPv6 Internet access in LAN.

---
### Post 69
Author: Unknown
Date: Unknown

I wanted to use the script(s) provided here to solve the sticky (expired) IPv6 address-issue, however, using Mikrotik's integrated 5G/LTE/3G-modem, I don't have anything set under the DHCPv6 client section.The only way, I got IPv6 running on the clients in that scenario at all, was to set the "IPv6 interface" to "bridge" in the APN-settings for the lte1-interface.Once it reconnects, while the clients get the new /64 prefix from the ISP connection, it still sticks to the previous ones, effectively rendering the IPv6 part unusable.I've also reported that issue to Mikrotik as other (way cheaper routers) also get it done correctly, including the ZTE MC801A and the Acer Predator 5G.

---
### Post 70
Author: Unknown
Date: Unknown

I think MikroTik fixed it on 7.8?viewtopic.php?p=982113#p982113

---
### Post 71
Author: Unknown
Date: Unknown

Not really, at least not in my scenario. Also, instead of doing something about it, "they" are busy selling me a bug as a feature, quote:"It is not a bug, but a consequence of periodic LTE disconnects. When clients receive RA (route announcements) they have time to live and clients respect it, eg after lte1 was disconnected/reconnected it have different IPv6 settings/RA, but clients do not know about what previous setting connection IPv6 settings are not valid and from they perspective previously received IPv6 settings are still perfectly fine till they expire."They forgot to explain how other routers manage to do exactly that then as there, mysteriously the IPv6 connection doesn't break with the same provider and of course thus the same prefix changes. Breaking IPv6 standards or not, I'd be happy if they'd then implement a checkbox with "simulate cheap home routers which don't break the IPv6 connection when used with reconnecting-happy ISPs".I don't want to do them any wrong, at least they quickly reply, but I can't get rid of the impression that they stubbornly assume some hypothetical ideal of providers who neither disconnect a mobile connection on a regular basis nor change the IPv6 prefix. While both would certainly be desirable, it is not a realistic scenario, at least not for private contracts so Mikrotik's argument chain is somewhat far-fetched and doesn't meet everyday life's usage.

---
### Post 72
Author: Unknown
Date: Unknown

Dynamic IPv6 is because of bad ISPs to begin with:https://www.ripe.net/publications/docs/ ... ed-harmfulThe solution, but still doesn't solve dynamic crap:https://datatracker.ietf.org/doc/html/rfc8978

---
### Post 73
Author: Unknown
Date: Unknown

I don't have anything set under the DHCPv6 client section.`LTE does not use DHCPv6 for communicating v6 address assignments.  It essentially uses RAs and SLAAC.  So it would do you no good to try to set up a DHCPv6 client.The script I wrote that does a "poor man's" implementation of RFC 9096 for the DHCPv6 client depends on a feature within the ROS DHCPv6 client that fires off a script in the event something changes with regard to the status of the DHCP lease.  There doesn't seem to be any kind of analogue to this that fires off after an LTE interface connect/disconnect event that you could hook into in order to run a script in the same way.  About the best advice I can give you is that you will probably have to take the same basic principles, but come up with a script that fires off at some interval of your choosing (using /system/scheduler) in order to check to see if any address change has happened since the last time it checked.`Once it reconnects, while the clients get the new /64 prefix from the ISP connection, it still sticks to the previous ones, effectively rendering the IPv6 part unusable.`By "it" do you mean the hosts on the networks ("clients") or the router itself?  I assume you mean the hosts?  Just want to confirm I'm understanding correctly.`Not really, at least not in my scenario. Also, instead of doing something about it, "they" are busy selling me a bug as a feature`While I find the current situation with MikroTik and many facets of their IPv6 implementation frustrating as well, let's at least be honest about words and semantics.What you are experiencing is not a bug, nor a feature.  It is rather a distinct LACK of a feature.So MikroTik support is 100% correct about the underlying reason for the issue.  It's just that the part they left out in their description is that there is a standard way of communicating the deprecation of old addresses to hosts on the network: one that uses the exact same mechanism (ICMPv6 Router Advertisements) that told those same hosts about those addresses in the first place.  It has been brought up multiple times in this thread already.  It is described in RFC 9096.There is no "bug" for MikroTik to fix.  They just need to take the time to implement RFC 9096 in their software, both for the DHCPv6 client component, as well as for the LTE component.The LTE IPv6 stuff on RouterOS also kills me for a completely different reason (unrelated to the current discussion), which is that it's the one and only place within all of ROS where they are actually implementing a ICMPv6 Neighbor Discovery Proxy (RFC 4389).  [EDITto add: it's also the only part of RouterOS that listens for, accepts, and acts properly on Router Advertisements from upstream routers!  Yes "accept-router-advertisements" exists under /ipv6/settings, but it is so horribly broken and useless!]  So the code exists!, but one can only take advantage of it IF one needs to proxy NS/NA from/to LTE, but not between any two arbitrary interface types.  Argh!  Anyway, I digress...

---
### Post 74
Author: Unknown
Date: Unknown

I think MikroTik fixed it on 7.8?`And what in the release notes so far leads you to believe that?`The solution, but still doesn't solve dynamic crap:https://datatracker.ietf.org/doc/html/rfc8978`Please try to keep up.  RFC 6204 was published 12 years ago.  Many consumer platforms' IPv6 stacks already implement it on the client side.  MikroTik just needs to implement it in their router software.

---
### Post 75
Author: Unknown
Date: Unknown

@littleendian: In general regarding dynamic addresses when the link is (re-)established, this is unfortunately how most mobile network operators (MNOs) manages standard consumer subscriptions today which is usually not a problem for the everyday smartphone user.In addition to dynamically assigned prefix and ipv4 addresses, outbound ports such as SMTP are usually blocked. Allthough many MNOs often offers extra services or special subscriptions for "Mobile WiFi Hotspots" where you get fixed addresses the same ports are still beeing blocked.In order to get a fixed and customizable prefix without any blocked ports, you usually have to sign up for a corporate subscription.EDIT:Two possible ways to get around this (for the advanced home user) is to either hack the IMEI or create your own tunnel to a VPS.

---
### Post 76
Author: Unknown
Date: Unknown

All,I just edited my previous reply with my DHCPv6 client script in order to replace it with an updated version.The original version of the script that I published here would indiscriminately disable and re-enable the IPv6 address during every lease renewal, in order to force the dynamic ND prefix entry to be re-generated.  Though this was not noticeable in most cases, it was a nuisance if the DHCPv6 server was using a very short lease time; for example, if DHCPv6 server was issuing 1 minute long leases, the client would renew at lease-time/2 or every 30 seconds.  So there would be an IPv6 reachability issue every 30 seconds for everyone on the network.I've rewritten the script to try to be more robust, and to only bounce the IPv6 address when needed.  If you use the script, please let me know about your experiences with it, positive or negative.

---
### Post 77
Author: Unknown
Date: Unknown

Many thanks for the elaborate reply, NathanA!LTE does not use DHCPv6 for communicating v6 address assignments.  It essentially uses RAs and SLAAC.  So it would do you no good to try to set up a DHCPv6 client.Already thought so, yes. In this case, I would need that announcement to the clients that they shall refrain from still using the deprecated prefixes from the former cellular session.The script I wrote that does a "poor man's" implementation of RFC 9096 for the DHCPv6 client depends on a feature within the ROS DHCPv6 client that fires off a script in the event something changes with regard to the status of the DHCP lease.Which is a gorgeous achievement, however I wonder why an end user has to come with that and the manufacturer fails on providing it. At least for my taste, the Mikrotik routers are expensive enough to rightfully expect basic features to work out of the box.About the best advice I can give you is that you will probably have to take the same basic principles, but come up with a script that fires off at some interval of your choosing (using /system/scheduler) in order to check to see if any address change has happened since the last time it checked.Well, although not ideal in the way that other "unexpected" disconnects may occur due to maintenances or other network issues which would then not be covered, as a first approach, it would already be great if I could trigger that "former prefix invalidation" together with the lte1 (dis)connect every 24 hours in a script. Indirectly, I could prevent that stale IPv6 connection by (dis)connecting the ethernet and wifi interfaces altogether, but for obvious LAN disconnect reasons which come along with that, it is technically even less desirable.By "it" do you mean the hosts on the networks ("clients") or the router itself?  I assume you mean the hosts?Yes, you interpreted it in the way the message was supposed to be, technically speaking.While I find the current situation with MikroTik and many facets of their IPv6 implementation frustrating as well, let's at least be honest about words and semantics.I can see and agree that at the end of course it is always a matter of definition and the question of who doesn't stick to a standard correctly, how much the other then should try to work around it and who should be blamed by whom.There is also tons of philosophy around, e.g. some love NAT for the oh so increased privacy (and basic "protection" against inbound initiated connection attempts while others say "the enemy knows the system" à la Shannon and we should go back to end to end connectivity and put firewalls in between of the paranoia gets too strong (exaggerating on purpose of course).What you are experiencing is not a bug, nor a feature.  It is rather a distinct LACK of a feature.That I interpret as "someone else provided the poison and Mikrotik so far hasn't come up with an antidote yet".That might be true by the RFC doctrine described for IPv6, but given that many ISPs apparently couldn't care less and implement questionable network behaviours, it is a feature which should at least be optionally available in RouterOS, call it a check mark "silly ISPs compatibility mode".It's just that the part they left out in their description is that there is a standard way of communicating the deprecation of old addresses to hosts on the network: [...]And what prevents Mikrotik to just implement this feature? If ZTE, Acer, Huawei, Samsung and whonot can implement it on their simple CPEs, why don't they?There is no "bug" for MikroTik to fix.But maybe to enable proper use of their products with not so seldom stubborn ISPs. Otherwise they would consequently have to advertise their routers to be only used in conjunction with business plans and ISPs which never disconnect and never change any prefix please.Yes "accept-router-advertisements" exists under /ipv6/settings, but it is so horribly broken and useless!]However, certainly not a bug as MikroTik does everything right here as well, no?

---
### Post 78
Author: Unknown
Date: Unknown

There is also tons of philosophy around`I will definitely cop to personally falling more in the camp of caring about practicality, vs. philosophy.  One example is that I'm not about to blame ISPs for not necessarily being able to adhere to people's idealized versions of what they should or shouldn't do, or how they should or shouldn't architect their networks.`What you are experiencing is not a bug, nor a feature.  It is rather a distinct LACK of a feature.That I interpret as "someone else provided the poison and Mikrotik so far hasn't come up with an antidote yet".`That seems like a fair assessment to me, in this particular case.  Fact is, all those people who hate stateful host configuration protocols like DHCP (in host mode, vs. PD mode) and put the "idealized" SLAAC up on a pedestal are partly to blame for getting us all into this mess to begin with, at least IMO.I don't blame MikroTik for not having implemented this RFC -- or any RFC -- on day one.  Such an expectation would be completely unreasonable.  I also don't blame the network operators, either.  The situation just is what it is.  The nature of internet "standards" is that they are rather ad hoc anyway.  I mean, not even the people who came up with SLAAC had (apparently!) originally considered that thismightturn out to be a problem (introduced by the very nature of a stateless protocol to begin with!), which is why this had to get addressed in a separate set of RFCs years later in thefirstplace.In this case, I'm mostly salty about it because it's been...checks notes...12 years.`[...] given that many ISPs apparently couldn't care less and implement questionable network behaviours [...]`Considering how large in scale -- both active-user-number wise as well as just physically/geographically in terms of raw coverage area -- most mobile networks are, as well as the levels of redundancy they are required to build into it in order to carry the kinds of uptimes they are expected to provide, I do think it's amusing that you're under the impression that it must beso easyfor them all to just provide static addressing at all times for 100% of users on top of all of that.(Also not saying it's impossible for them to do, either.  But the nature of the problem is not as simple as most seem to think.)`And what prevents Mikrotik to just implement this feature?`Well I don't work for them, so...don't know, ask them?  My best guess is that they simply haven't gotten to it yet.  But I would happily join you in urging them to consider making it more of a priority than it (clearly) has been to-date.`Yes "accept-router-advertisements" exists under /ipv6/settings, but it is so horribly broken and useless!]However, certainly not a bug as MikroTik does everything right here as well, no?`Ahahaha, you must not have finished reading my entire posting history here if you are under the impression that I think MT does "everything right".  LOL!  I regularly call them out when it's merited.

---
### Post 79
Author: Unknown
Date: Unknown

And what prevents Mikrotik to just implement this feature?Well I don't work for them, so...don't know, ask them?  My best guess is that they simply haven't gotten to it yet.  But I would happily join you in urging them to consider making it more of a priority than it (clearly) has been to-date.In any software team, there is always more work than can be done with the available staff.And the available staff will always be limited, if not by budget then by shortages on the workforce market.When looking at their job positions page, they have plenty of available positions, but of course the primary restrictions of living in Latvia and speaking fluent Latvian will limit the available persons...

---
### Post 80
Author: Unknown
Date: Unknown

And then there is the possibility of outsourcing, but it can be a pretty a tough challenge if the organization is small or lacks experience. If you are lucky enough to find a working team with the right skills, it's worth every penny.

---
### Post 81
Author: Unknown
Date: Unknown

And what in the release notes so far leads you to believe that?Do you have some eye defects? I clearly linked to the change log from MikroTik regarding V7.8.viewtopic.php?p=982113#p982113Please try to keep up.  RFC 6204 was published 12 years ago.  Many consumer platforms' IPv6 stacks already implement it on the client side.  MikroTik just needs to implement it in their router software.RFC6204 doesn't say jack squat about crappy dynamic prefixes. But RFC8978 does, please try to keep up.

---
### Post 82
Author: Unknown
Date: Unknown

And what in the release notes so far leads you to believe that?Do you have some eye defects?`Yes, but mostly brain defects!`I clearly linked to the change log from MikroTik regarding V7.8.`Sorry, my browser did not jump down to the specific post in that very long thread the first time I clicked on your link, before responding.So instead I saw the changlog for 7.8beta2, because that's what the thread you linked to was supposed to be discussing, and which lists only the following 3 IPv6-related items, none of which include the one change that the poster you linked to referenced:`Code:Select all*) ipv6 - added "pref64" option configuration for RA;
*) ipv6 - limited "hop-limit" parameter value range to 255;
*) ipv6 - made distributed DNS lifetime RFC8106 compliant;`It looks like the 4th "ipv6" change entry you're pointing out silently appeared in the logs for 7.8rc1.  I will have to load the latest RC up on a router in the lab and explicitly test for this.`RFC6204 doesn't say jack squat about crappy dynamic prefixes.`So you didn't read it, then.`But RFC8978 does`RFC8978 is mostly an empty advisory document that basically says "dynamic prefixes are kinda bad, but here's the reasons they might be in use".  Other than to acknowledge that there's a problem that exists, it's not really helpful to anybody in this thread, which is mostly discussingthe client side, and being a client on the receiving end of such dynamic prefixes.  The only mitigation advice they give to end-users is to lower the address lifetimes in the RAs that your router sends out, which...duh?  But even if you lower them to the advised 45min/90min values, you're still likely to have IPv6 internet unreachability issues lasting several minutes after a renumbering event!The real solution to this is RFC6204 / 7084 (an update of 6204) / 9096 (an update of 7084),which your 8978 even acknowledges in section 4!And which is the very same and very specific feature request we have all been discussing in this thread prior to your arrival.Finally, I'm sorry to have to be the one to tell you this, but the world will never be rid of "crappy dynamic prefixes".  That's just reality staring us all in the face.

---
### Post 83
Author: Unknown
Date: Unknown

Interestingly, while the issue remains unresolved for Windows and Mac OS, Android (12) doesn't seem to have any issue with the "orphaned" IPv6 addresses and seemlessly continues to provide a working IPv6 connection with not a single lost packet during persistent icmp echo reply requests.Which for me - independently from Mikrotik's decision not to implement that "invalidation" of old prefixes via router announcements - raises the question why the other operating systems fail to recognize the latest usable address and why they allow to have multiple public addresses on their interfaces then in the first place.

---
### Post 84
Author: Unknown
Date: Unknown

Android has a couple of funny limitations in its network code, maybe the limitation to one active IPv6 prefix is one of them.It would mean a newly announced prefix automatically replaces all older ones.

---
### Post 85
Author: Unknown
Date: Unknown

Good point and while I get Android's irony in this case outcome-wise, still I wonder why multiple addresses renders the whole connection useless under Windows and Mac OS then.Shouldn't they also fall back to one apparantly usable eventually?

---
### Post 86
Author: Unknown
Date: Unknown

They will.  But it takes too long for the users.  I can understand that, when your address (prefix) is changing all the time.In my case it doesn't, and I have no problem with it on any OS.  But for those that have this problem it can be annoying.Another "similar" Android issue: when you setup an IKEv2 VPN it can accept only a single remote subnet.  In RouterOS you can configure multiple subnets in ipsec "mode configs" (as "split include") but Android will activate only the first and will ignore all others.  That makes the split include feature useless for me, I still have to use the "set default route to VPN".It does not seem that Android programmers implement standards.  They do some quick-and-dirty work that is to their own liking.

---
### Post 87
Author: Unknown
Date: Unknown

I´ve created a feature request at MikroTik about exact this topic (SUP-108243). MT is aware about the problem and  pointed out that they are working on it:hc_473.jpgSo let´s wait for one of the next ROS updates

---
### Post 88
Author: Unknown
Date: Unknown

Well, there are many things that they are working on, but cannot provide any ETAI would say the only positive point is that you did not get a "nobody is asking for that, we won't spend time on that!" reply.

---
### Post 89
Author: Unknown
Date: Unknown

I just edited my previous reply with my DHCPv6 client script in order to replace it with an updated version.First of all thanks for @Sob fortaking the first (published) swing here at the changing ipv6 prefixand for you @NathanA forcreating a robust version of it which implements RFC6204/RFC7084/RFC9096as it did not peaked anyone interest toprovide a solutionbefore, although @IPANetEngineer did provide the command for NAT66.So my big ask is whether are you @NathanA (or anyone else) willing to create two additional versions of the script: one for NPTv6NPTv6 sample rules by @SobCode:Select all/ipv6 firewall mangle
add chain=postrouting action=snpt src-address=fd00:1234:5678:9a00::/56 src-prefix=fd00:1234:5678:9a00::/56 dst-prefix=publ:icpr:efix:b700::/56
add chain=prerouting action=dnpt dst-address=publ:icpr:efix:b700::/56 src-prefix=publ:icpr:efix:b700::/56 dst-prefix=fd00:1234:5678:9a00::/56and another one for NAT66NAT sample config by @IPANetEngineerCode:Select all/ipv6 firewall nat
add action=masquerade chain=srcnat dst-address=2000::/3 src-address=\
    200:c01d:c01a:beef::7ac0/128 to-address=2603:XXXX:XXXX:XXXX::2/128in order to avoid the not so convenient effect that the dynamic address and prefix assignment by the ISP changes the addresses in one's network (so joining "the typical Unix hacker [who] never can remember what thePRINTcommand is called this week" (Ed Post, Real Programmers Don't Use PASCAL) one many not know what the IPv6 address of the printer is this day). I do knowsome of the limitations of ULAandsolution for part of it in certain situation.By the way does anyone know how to subnet in case the ISP only provides a /64 address (for the router) and a /64 prefix (for the network behind the router)?

---
### Post 90
Author: Unknown
Date: Unknown

By the way does anyone know how to subnet in case the ISP only provides a /64 address (for the router) and a /64 prefix (for the network behind the router)?You cannot subnet a /64.  Ask your provider for more space (a /60 or a /56 or a /48).It could be you already GET more space but have not yet understood how to activate it (with proper DHCPv6 client configuration)...

---
### Post 91
Author: Unknown
Date: Unknown

You cannot subnet a /64.  Ask your provider for more space (a /60 or a /56 or a /48).This request is just as successful as asking the state to lower the standard VAT rate...It could be you already GET more space but have not yet understood how to activate it (with proper DHCPv6 client configuration)...I rarely use the world impossible, however in this case I do: no amount of tinkering with DHCPv6 client configuration (prefix-hint and pool-prefix-length parameters) results in different prefix in case the T&C specifies /64 (and more often than not ISPs are not that bad at implementing T&C in case it is advantageous for them).

---
### Post 92
Author: Unknown
Date: Unknown

Ok, but I have read several times on the forum that people got a /64 but when they requested a /60 they got that instead.(I think sometimes after releasing the previous /64 first)All ISPs here (that have IPv6) issue a /48 to residential users.  I think that is exaggeration to the other end of the scale, but at least I have no shortage.And it is "fixed" as well (i.e. it only changes when there is a restructuring in the network, not at some interval or on re-connection).

---
### Post 93
Author: Unknown
Date: Unknown

Apparently the original topic discussed here (changing prefix does not result in deleting old prefix at clients) has been fixed in version 7.9beta.So it could be a good idea for those affected by that to test this version.

---
### Post 94
Author: Unknown
Date: Unknown

Apparently the original topic discussed here (changing prefix does not result in deleting old prefix at clients) has been fixed in version 7.9beta.So it could be a good idea for those affected by that to test this version.It's fixed, via hack. But still it doesn't resolve the issue with DNS host names. You need complex DDNS setup for running applications at home.Static PD is the right way.

---
### Post 95
Author: Unknown
Date: Unknown

Apparently the original topic discussed here (changing prefix does not result in deleting old prefix at clients) has been fixed in version 7.9beta.So it could be a good idea for those affected by that to test this version.It's fixed, via hack.What hack are we talking about?

---
### Post 96
Author: Unknown
Date: Unknown

With 7.9beta4, IPv6 now also seems to work in conjunction with cellular ISPs which regularly change the prefix via lte1 without having to reset the clients.

---
### Post 97
Author: Unknown
Date: Unknown

So my big ask is whether are you @NathanA (or anyone else) willing to create two additional versions of the script: one for NPTv6NPTv6 sample rules by @Soband another one for NAT66NAT sample config by @IPANetEngineerin order to avoid the not so convenient effect that the dynamic address and prefix assignment by the ISP changes the addresses in one's network (so joining "the typical Unix hacker [who] never can remember what thePRINTcommand is called this week" (Ed Post, Real Programmers Don't Use PASCAL) one many not know what the IPv6 address of the printer is this day). ...Thanks@Kentzoforcreating the scripts for the NTPv6 scenario.

---
