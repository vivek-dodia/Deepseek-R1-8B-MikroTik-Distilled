---
title: Untitled Thread
source_url: https://forum.mikrotik.com/viewtopic.php?f=7&t=209909&p=1091519#p1091519
crawled_date: 2025-02-02T21:58:30.757559
section: mikrotik_forum
type: forum_thread
keywords: nat, filter, bridge, vlan, configuration, setup
---

### Author: Tue Aug 06, 2024 12:14 pm
Date: Unknown

```
slaves-static=yes
```

```
/interface wifi
# managed by CAPsMAN
# mode: AP, SSID: lan.robtor.de, channel: 5240/n
set [ find default-name=wifi2 ] configuration.manager=capsman .mode=ap disabled=no name=wifi2LAN
# managed by CAPsMAN
# mode: AP, SSID: lan.robtor.de, channel: 2417/n
set [ find default-name=wifi1 ] configuration.manager=capsman .mode=ap disabled=no name=wifiLAN
# managed by CAPsMAN
# mode: AP, SSID: smarthome.robtor.de
add configuration.mode=ap disabled=no mac-address=4A:A9:8A:E8:E3:0E master-interface=wifiLAN name=wifiSMARTHOME
# managed by CAPsMAN
# mode: AP, SSID: Bar Wifi Gast
add configuration.mode=ap disabled=no mac-address=4A:A9:8A:E8:E3:11 master-interface=wifi2LAN name=wifi2GUEST
# managed by CAPsMAN
# mode: AP, SSID: fon.robtor.de
add configuration.mode=ap disabled=no mac-address=4A:A9:8A:E8:E3:0F master-interface=wifiLAN name=wifiFON
# managed by CAPsMAN
# mode: AP, SSID: Bar Wifi Gast
add configuration.mode=ap disabled=no mac-address=4A:A9:8A:E8:E3:10 master-interface=wifiLAN name=wifiGUEST
/interface wifi cap
set caps-man-addresses=172.20.0.1 certificate=CAP-48A98AE8E30C discovery-interfaces=vlanMGM enabled=yes lock-to-caps-man=yes slaves-static=yes
```

Hey guys, I actually have some weird behavior in my CAPsMAN setup with a plenty of CAP-AC's and a RB3011 as the controller.I recently switched to the wifi-qcom-ac driver to have 802.11r and WPA3. Unfortunately this driver does not support vlan taggingyet.So I figured out to do the vlan tagging on the bridge with bridge vlan filtering. For this I had to enable theCode:Select alloption on the CAP's.(See this post:viewtopic.php?t=202476)Sometimes this worked very well. I actually named the nowstaticslave interfaces by myself to identify them and then added them to the bridge and configured the vlan tag.But sometimes when I run upgrades or reprovision the CAP's, the interfaces are named again wifi1, wifi2, ... and all the vlan configuration is broken an my whole wifi network does not work anymore!Does anybody have an idea why this happens? The slaves-static is always enabled. Is the renaming of the interfaces an issue? Or do I have to add some additional configuration on the CAPsMAN's side?Here's my config of the CAP:Code:Select allBut sometimes after reprovisioning the configuration ends up with a total mess, e.g. the "lan.robtor.de" is then named wifi1 and then is even not a memeber of the bridge and thus does not get any vlan tag.


---
### Author: Wed Aug 07, 2024 8:28 pm
Date: Unknown

```
/interface wifi provisioning
add action=create-dynamic-enabled disabled=no master-configuration=GuestWiFi_2Ghz-Auto_AX name-format=2G-%I- slave-configurations=BearsTV_2Ghz-Auto_AX,BearsOffice_2Ghz-Auto_AX supported-bands=2ghz-ax
add action=create-enabled disabled=no master-configuration=GuestWifi-2Ghz-Auto-qcom-AC name-format=2G-%I slave-configurations=BearsTV-2Ghz-Auto-qcom-AC,BearsOffice-2Ghz-Auto-qcom-AC supported-bands=2ghz-n
add action=create-dynamic-enabled disabled=no master-configuration=GuestWiFi_5Ghz-Auto_AX name-format=5G-%I slave-configurations=BearsTV_5Ghz-Auto_AX,BearsOffice_5Ghz-Auto_AX supported-bands=5ghz-ax
add action=create-enabled disabled=no master-configuration=GuestWiFi-5Ghz-Auto-qcom-AC name-format=5G-%I slave-configurations=BearsTV-5Ghz-Auto-qcom-AC,BearsOffice-5Ghz-Auto-qcom-AC supported-bands=5ghz-ac

/interface wifi datapath
add bridge=all-vlan-bridge disabled=no name=vlan10_BearsNet vlan-id=10
add bridge=all-vlan-bridge client-isolation=yes disabled=no name=vlan129_BearsTV vlan-id=129
add bridge=all-vlan-bridge client-isolation=yes disabled=no name=vlan40_GuestWiFi vlan-id=40
add bridge=all-vlan-bridge client-isolation=yes disabled=no name=QCOM-AC-Guest
add bridge=all-vlan-bridge client-isolation=yes disabled=no name=QCOM-AC-BearsTV
add bridge=all-vlan-bridge disabled=no name=QCOM-AC-BearsOffice
```

```
/interface wifi
# managed by CAPsMAN
# mode: AP, SSID: Bears Guest, channel: 2412/n
set [ find default-name=wifi1 ] configuration.antenna-gain=3 .manager=capsman .mode=ap disabled=no
# managed by CAPsMAN
# mode: AP, SSID: Bears Guest, channel: 5805/ac/eC
set [ find default-name=wifi2 ] configuration.antenna-gain=6 .manager=capsman .mode=ap disabled=no
# managed by CAPsMAN
# mode: AP, SSID: Bears TV
add disabled=no mac-address=C6:AD:34:B9:35:EE master-interface=wifi1 name=wifi3
# managed by CAPsMAN
# mode: AP, SSID: Bears Office
add disabled=no mac-address=C6:AD:34:B9:35:EF master-interface=wifi1 name=wifi4
# managed by CAPsMAN
# mode: AP, SSID: Bears TV
add disabled=no mac-address=C6:AD:34:B9:35:F0 master-interface=wifi2 name=wifi5
# managed by CAPsMAN
# mode: AP, SSID: Bears Office
add disabled=no mac-address=C6:AD:34:B9:35:F1 master-interface=wifi2 name=wifi6
/interface wifi cap
set discovery-interfaces=bridgeLocal enabled=yes slaves-static=yes
/interface bridge
add admin-mac=C4:AD:34:B9:35:EC auto-mac=no comment=defconf ingress-filtering=no name=bridgeLocal port-cost-mode=short pvid=88 vlan-filtering=yes

/interface bridge port
add bridge=bridgeLocal comment=defconf ingress-filtering=no interface=ether1 internal-path-cost=10 path-cost=10 pvid=88
add bridge=bridgeLocal comment=defconf ingress-filtering=no interface=sfp1 internal-path-cost=10 path-cost=10
add bridge=bridgeLocal interface=wifi1 pvid=40
add bridge=bridgeLocal interface=wifi2 pvid=40
add bridge=bridgeLocal interface=wifi3 pvid=129
add bridge=bridgeLocal interface=wifi5 pvid=129
add bridge=bridgeLocal interface=wifi4 pvid=10
add bridge=bridgeLocal interface=wifi6 pvid=10
/interface bridge vlan
add bridge=bridgeLocal tagged=bridgeLocal vlan-ids=88
add bridge=bridgeLocal untagged=wifi4,wifi6 vlan-ids=10
add bridge=bridgeLocal untagged=wifi3,wifi5 vlan-ids=129
add bridge=bridgeLocal untagged=ether1 vlan-ids=10
```

I'm also experiencing this same issue.  Followed MikroTik documentation within their Wiki, and even adjusted the CAPsMAN provisioning to be "create enabled" instead of "create dynamic enabled".When "pushing" new config, or re-provisioning the CAP running qcom-ac driver, the WLAN interfaces change and increment; breaking the bridge and vlan assignment for the WLAN SSID's.But yet, when I was "testing" the Datapath setting in CAPsMan for sending VLAN-ID.. it works-- the cap running qcom-ac driver receives it on the bridge interface and a PVID is set... However, CAPsMAN complains. MikroTik Documentation states that is invalid configuration.We're also seeing antenna-gain is broken for sector antenna [mANTBoxes],  It is defaulting to zero.  We usually reduce the gain.Here is ours.Code:Select allThen here is a cap side -Code:Select all


---
### Author: [SOLVED]Thu Aug 15, 2024 10:15 am
Date: Unknown

After asking about this functionality I received the following answer:robtor"wifi - added "slave-name-format";" just adds more control on how virtual interfaces can be named.Regarding the forum post you linked, a lot of issues can be caused by re-provision, there seems to be a misconception that configuration needs to be "pushed" via help of provisioning the interfaces. That is not the case, provision must be done only initially, and is done automatically upon CAP joining if there are matching provisioning rules that are enabled.If you adjust any configuration profile that is linked to provisioned interface, all changes will be "pushed" as soon as you apply changes to the profile. With no need to re-create already existing interface.Provisioning itself is not for sending configuration, it is for essentially creating a new interface. In most cases, there is no reason to perform manual provisioning once you already have CAP interfaces running.Now, if create-enabled together with slave-static is used and interface names change after reboot or upgrade, please let us know viasupport@mikrotik.comalong with details of what was upgraded/rebooted. In our tests, names should not change, and references to CAP interfaces should work, and not be lost, both on CAPsMAN and CAP side, even if virtual CAP interface is renamed on CAP.At least it is not the solution for my problem,but, and I say many thanks to @Guntis for that, I totally misunderstood the purpose of the provisioning function.As I now understand correctly, the use of theProvisionbutton in winbox or the corresponding command is not necessary when changing configurations. As it is only for creating the new (virtual) interfaces on the CAPs.It's a pity that this command is not documented, because from the naming I always thought it means "push all new configuration to the CAPs". I used it andneververified if the configuration was already on the CAPs beforeThe explanation by @Guntis is from this thread:viewtopic.php?t=209903


---
### Author: Fri Aug 16, 2024 8:45 pm
Date: Unknown

@Robtor - thanks for sharing this information.it is very unclear and yet to be documented "feature" regarding the Provisioning functionality.   It does not do what we logically think it'll do, so why is the Provision function there?

