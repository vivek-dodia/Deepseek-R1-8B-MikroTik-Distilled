# Document Information
Title: PPPoE
Section: mikrotik_docs
Source: https://help.mikrotik.com/docs/spaces/ROS/pages/2031625/PPPoE,

# Content
# Overview
Point to Point over Ethernet (PPPoE) is simply a method of encapsulating PPP packets into Ethernet frames. PPPoE is an extension of the standard Point to Point Protocol (PPP) and it the successor of PPPoA. PPPoE standard is defined inRFC 2516. The PPPoE client and server work over any Layer2 Ethernet level interface on the router, for example, Wireless, Ethernet, EoIP, etc. Generally speaking, PPPoE is used to hand out IP addresses to clients based on authentication by username (and also if required, by workstation) as opposed to workstation only authentication where static IP addresses or DHCP are used. It is advised not to use static IP addresses or DHCP on the same interfaces as PPPoE for obvious security reasons.
# Introduction
PPPoE provides the ability to connect a network of hosts over a simple bridging access device to a remote Access Concentrator.
Supported connections:
# PPPoE Operation
PPPoE has two distinct stages(phases):
# Discovery phase
There are four steps to the Discovery stage. When it completes, both peers know the PPPoESESSION_IDand the peer's Ethernet address, which together define the PPPoE session uniquely:
PPPoE Active Discovery Session Confirmation (PADS) -When thePADRis received, the Access Concentrator generates a unique session identification (ID) for the Point-to-Point Protocol (PPP) session and returns this ID to the PPPoE client in thePADSpacket. This packet is sent to the unicast address of the client.
PPPoE session termination:
# Session phase
When the discovery stage is completed, both peers knowPPPoE Session IDand other peer'sEthernet (MAC) addresswhich together defines the PPPoE session. PPP frames are encapsulated in PPPoE session frames, which have Ethernet frame type0x8864.When a server sends confirmation and a client receives it, PPP Session is started that consists of the following stages:
PPPoE server sendsEcho-Requestpackets to the client to determine the state of the session, otherwise, the server will not be able to determine that session is terminated in cases when a client terminates session without sendingTerminate-Requestpacket.
# MTU
Typically, the largest Ethernet frame that can be transmitted without fragmentation is 1500 bytes. PPPoE adds another 6 bytes of overhead and the PPP field adds two more bytes, leaving 1492 bytes for IP datagram. Therefore max PPPoE MRU and MTU values must not be larger than 1492.
TCP stacks try to avoid fragmentation, so they use an MSS (Maximum Segment Size). By default, MSS is chosen as MTU of the outgoing interface minus the usual size of the TCP and IP headers (40 bytes), which results in 1460 bytes for an Ethernet interface. Unfortunately, there may be intermediate links with lower MTU which will cause fragmentation. In such a case TCP stack performs path MTU discovery. Routers that cannot forward the datagram without fragmentation are supposed to drop the packet and sendICMP-Fragmentation-Requiredto originating host. When a host receives such an ICMP packet, it tries to lower the MTU. This should work in the ideal world, however in the real world many routers do not generate fragmentation-required datagrams, also many firewalls drop all ICMP datagrams.
The workaround for this problem is toadjust MSSif it is too big.
# PPPoE Client
# Properties
Property | Description
----------------------
ac-name(string; Default:"") | Access Concentrator name, this may be left blank and the client will connect to any access concentrator on the broadcast domain
add-default-route(yes|no; Default:no) | Enable/Disable whether to add default route automatically
allow(mschap2|mschap1|chap|pap; Default:mschap2,mschap1,chap,pap) | allowed authentication methods, by default all methods are allowed
default-route-distance(byte [0..255]; Default:1) | sets distance value applied to auto created default route, if add-default-route is also selected
dial-on-demand(yes|no; Default:no) | connects to AC only when outbound traffic is generated. If selected, then route with gateway address from 10.112.112.0/24 network will be added while connection is not established.
interface(string; Default: ) | interface name on which client will run
keepalive-timeout(integer; Default:60) | Sets keepalive timeout in seconds.
max-mru(integer; Default:1460) | Maximum Receive Unit
max-mtu(integer; Default:1460) | Maximum Transmission Unit
mrru(integer: 512..65535|disabled; Default:disabled) | maximum packet size that can be received on the link. If a packet is bigger than tunnel MTU, it will be split into multiple packets, allowing full size IP or Ethernet packets to be sent over the tunnel.
name(string; Default:pppoe-out[i]) | name of the PPPoE interface, generated by RouterOS if not specified
password(string; Default: ) | password used to authenticate
profile(string; Default:default) | Specifies which PPP profile configuration will be used when establishing the tunnel.
service-name(string; Default:"") | specifies the service name set on the access concentrator, can be left blank to connect to any PPPoE server
use-peer-dns(yes|no; Default:no) | enable/disable getting DNS settings from the peer
user(string; Default:"") | username used for authentication
username used for authentication
# Status
Command/interface pppoe-client monitorwill display current PPPoE status.
```
/interface pppoe-client monitor
```
Available read only properties:
Property | Description
----------------------
ac-mac(MAC address) | MAC address of the access concentrator (AC) the client is connected to
ac-name(string) | name of the Access Concentrator
active-links(integer) | Number of bonded MLPPP connections, ('1' if not using MLPPP)
encoding(string) | encryption and encoding (if asymmetric, separated with '/') being used in this connection
local-address(IP Address) | IP Address allocated to client
remote-address(IP Address) | Remote IP Address allocated to server (ie gateway address)
mru(integer) | effective MRU of the link
mtu(integer) | effective MTU of the link
service-name(string) | used service name
status(string) | current link status. Available values are:dialing,verifying password...,connected,disconnected.
uptime(time) | connection time displayed in days, hours, minutes and seconds
# Scanner
PPPoE Scanner allows scanning all active PPPoE servers in the layer2 broadcast domain. Command to run scanner is as follows:
```
/interface pppoe-client scan [interface]
```
Available read only properties:
Property | Description
----------------------
service(string) | Service name configured on server
mac-address(MAC) | Mac address of detected server
ac-name(string) | name of the Access Concentrator
# PPPoE Server
There are two types of interface (tunnel) items in PPPoE server configuration - static users and dynamic connections. An interface is created for each tunnel established to the given server. Static interfaces are added administratively if there is a need to reference the particular interface name (in firewall rules or elsewhere) created for the particular user. Dynamic interfaces are added to this list automatically whenever a user is connected and its username does not match any existing static entry (or in case the entry is active already, as there can not be two separate tunnel interfaces referenced by the same name - setone-session-per-hostvalue if this is a problem). Dynamic interfaces appear when a user connects and disappear once the user disconnects, so it is impossible to reference the tunnel created for that use in router configuration (for example, in firewall), so if you need a persistent rule for that user, create a static entry for him/her. Otherwise, it is safe to use a dynamic configuration.
# Access concentrator
```
/interface pppoe-server server
```
# Properties
Property | Description
----------------------
authentication(mschap2 | mschap1 | chap | pap; Default:"mschap2, mschap1, chap, pap") | Authentication algorithm
default-profile(string; Default:"default") |
interface(string; Default:"") | Interface that the clients are connected to
keepalive-timeout(time; Default:"10") | Defines the time period (in seconds) after which the router is starting to send keepalive packets every second. If there is no traffic and no keepalive responses arrive for that period of time (i.e. 2 * keepalive-timeout), the non responding client is proclaimed disconnected.
max-mru(integer; Default:"1480") | Maximum Receive Unit. The optimal value is the MTU of the interface the tunnel is working over reduced by 20 (so, for 1500-byte Ethernet link, set the MTU to 1480 to avoid fragmentation of packets)
max-mtu(integer; Default:"1480") | Maximum Transmission Unit. The optimal value is the MTU of the interface the tunnel is working over reduced by 20 (so, for 1500-byte Ethernet link, set the MTU to 1480 to avoid fragmentation of packets)
max-sessions(integer; Default:"0") | Maximum number of clients that the AC can serve. '0' = no limitations.
mrru(integer: 512..65535 | disabled; Default:"disabled") | Maximum packet size that can be received on the link. If a packet is bigger than tunnel MTU, it will be split into multiple packets, allowing full size IP or Ethernet packets to be sent over the tunnel.
one-session-per-host(yes | no; Default:"no") | Allow only one session per host (determined by MAC address). If a host tries to establish a new session, the old one will be closed.
pppoe-over-vlan-range(integer 1..4094; Default:"") | This setting allows a PPPoE server to operate over 802.1Q VLANs. By default, a PPPoE server only accepts untagged packets on its interface. However, in scenarios where clients are on separate VLANs, instead of creating multiple 802.1Q VLAN interfaces and bridging them together or configuring individual PPPoE servers for each VLAN, you can specify the necessary VLANs directly in the PPPoE server settings.When you specify the VLAN IDs, the PPPoE server will accept both untagged packets and 802.1Q tagged packets from clients, and it will reply using the same VLAN. This setting can also be applied to both CVLAN and SVLAN interfaces. For example, when theuse-service-tag=yesoption is used on aVLAN interface, enabling QinQ setups as well.The setting supports a range of VLAN IDs, as well as individual VLANs specified using comma-separated values. For example: pppoe-over-vlan-range=100-115,120,122,128-130.
service-name(string; Default:"") | The PPPoE service name. Server will accept clients which sends PADI message with service-names that matches this setting or if service-name field in PADI message is not set.
This setting allows a PPPoE server to operate over 802.1Q VLANs. By default, a PPPoE server only accepts untagged packets on its interface. However, in scenarios where clients are on separate VLANs, instead of creating multiple 802.1Q VLAN interfaces and bridging them together or configuring individual PPPoE servers for each VLAN, you can specify the necessary VLANs directly in the PPPoE server settings.
When you specify the VLAN IDs, the PPPoE server will accept both untagged packets and 802.1Q tagged packets from clients, and it will reply using the same VLAN. This setting can also be applied to both CVLAN and SVLAN interfaces. For example, when theuse-service-tag=yesoption is used on aVLAN interface, enabling QinQ setups as well.
```
use-service-tag=yes
```
The setting supports a range of VLAN IDs, as well as individual VLANs specified using comma-separated values. For example: pppoe-over-vlan-range=100-115,120,122,128-130.
The PPPoE server (access concentrator) supports multiple servers for each interface - with differing service names. The access concentrator name and PPPoE service name are used by clients to identify the access concentrator to register with. The access concentrator name is the same as the identity of the router displayed before the command prompt. The identity may be set within the/system identitysubmenu.
Specifying MRRU means enabling MP (Multilink PPP) over a single link. This protocol is used to split big packets into smaller ones.  Their MRRU is hardcoded to 1614. This setting is useful to overcome PathMTU discovery failures. The MP setting should be enabled on both peers.
# Quick Example
# PPPoE Client
To configure MikroTik RouterOS to be a PPPoE client, just add a PPPoE-client with the following parameters as in the example:
```
[admin@MikroTik] > interface pppoe-client add interface=ether2 password=StrongPass service-name=pppoeservice name=PPPoE-Out disabled=no user=MT-User
[admin@MikroTik] > interface pppoe-client print
Flags: X - disabled, I - invalid, R - running
0  R name="PPPoE-Out" max-mtu=auto max-mru=auto mrru=disabled interface=ether2 user="MT-User"
password="StrongPass" profile=default keepalive-timeout=10 service-name="pppoeservice" ac-name=""
add-default-route=no dial-on-demand=no use-peer-dns=no allow=pap,chap,mschap1,mschap2
```
# PPPoE Server
To configure MikroTik RouterOS to be an Access Concentrator (PPPoE Server):
```
[admin@MikroTik] > /ip pool
add name=pppoe-pool ranges=10.0.0.2-10.0.0.5
[admin@MikroTik] > /ppp profile
add local-address=10.0.0.1 name=for-pppoe remote-address=pppoe-pool
[admin@MikroTik] > /ppp secret
add name=MT-User password=StrongPass profile=for-pppoe service=pppoe
[admin@MikroTik] > /interface pppoe-server server
add default-profile=for-pppoe disabled=no interface=ether3 service-name=pppoeservice
```