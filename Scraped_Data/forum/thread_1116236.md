---
title: Thread-1116236
url: https://forum.mikrotik.com/viewtopic.php?p=1116236&sid=49f92a630bc7970d8ca50523be880e8f#p1116236
thread_id: 1116236
section: RouterOS
post_count: 3
date_crawled: 2025-02-03T14:14:36.213180
---

### Post 1
Author: Unknown
Date: Unknown

Hello everyone,I’m trying to replace the IliadBox with an RB4011 on my FTTH GPON line. As many of you might know, configuring a personal router on this line is not straightforward. Although I’m not a networking expert, I’ve done my best to set up a working configuration.Current network topology:IB-RB4011.jpgCurrently, I’m using the RB4011 in cascade with the IliadBox, which forwards all traffic to an Ethernet port of the MikroTik. However, this setup limits the maximum speed to 1 Gbps (Ethernet), while the IliadBox has a single 2.5 Gbps port. For this reason, I want to remove the IliadBox and connect the ONT output directly to the RB4011’s SFP+ port via an adapter.Details about the Iliad connection:The IPv4 connection provided by Iliad seems to rely on IPv6 encapsulation. For clarity, I intercepted a TCP packet between the ONT and the IliadBox using an hAP ac2 in switch mode with mirroring enabled:ont-ibox-tcp-pcap.jpgFrom what I’ve found online:Iliad's connection is IPv6 only, and IPv4 connectivity is achieved through MAP-E.The assigned IPv4 is usually shared with four users, but in my case, I have a full IP range (all ports are available to me).Iliad provides a guide for custom configurations (Guide MikroTik and VoIP), but it seems incomplete or incorrect.As far as I understand, MAP-E requires IPIPv6 (supported by RouterOS), and since I have access to the full range of ports, I don’t need to configure NAT for port redirection.To configure a personal router on the Iliad FTTH network, the following steps are required:-Creation of theIPIP6 tunnel+IPv6 of the tunnel(calculated by combining the IPv6-PD, IPv4 in hexadecimal format, and the assigned port range).+IPv6 of the remote BR(obtained by analyzing an IPv4 packet encapsulated in IPv6).+Public IPv4 assigned by the ISP.-DHCPv6 configuration on VLAN 836-cloning the MAC address and ClientIDof IBox (not sure about that, and I don't know how to get DUID from the IliadBox) for proper authentication.This allows obtaining the IPv6, IPv6-PD, and properly configuring the tunnel.Attempted configuration:I found a configuration online that appears to work in similar scenarios. I tried to adapt it to my network, connecting the ONT to RB4011’s Ethernet port 9 (temporarily via Ethernet). However, I couldn’t connect to the internet, and the IliadBox was not correctly "replaced".# 2024-12-24 12:06:40 by RouterOS 7.16.2# software id = YIFI-TGP1## model = RB4011iGS+# serial number = xxxxxxxxxxxx/interface bridgeadd name=BR-WANadd name=BR1 protocol-mode=none vlan-filtering=yes/interface ethernetset [ find default-name=ether1 ] comment=WANset [ find default-name=ether2 ] comment=CAPs-LABset [ find default-name=ether3 ] comment=CAPs-cantinaset [ find default-name=ether4 ] comment=cap-SALAset [ find default-name=ether5 ] comment=PTOPM_linkset [ find default-name=ether9 ] comment=WAN-TEST mac-address=\38:aa:bb:cc:dd:ee mtu=1540set [ find default-name=ether10 ] comment=WAN-IBOX/interface ipipv6add !keepalive local-address=2a01:---:----:----:0:----:----:0 mtu=1540 name=\ipipv6-tunnel1 remote-address=2a01:----:----:----:----:----:----:406/interface wireguardadd listen-port=13231 mtu=1420 name=wireguard1/interface vlanadd interface=BR1 name=BASE_VLAN vlan-id=99add interface=BR1 name=GUEST_VLAN vlan-id=20add interface=BR1 name=IOT_VLAN vlan-id=10add interface=BR1 name=PRV_VLAN vlan-id=30add interface=BR-WAN mtu=1540 name=WAN-836 vlan-id=836/interface listadd name=WANadd name=VLANadd name=BASEadd name=IOTadd name=PRVadd name=alowed_to_PRINTadd name=GUEST/interface wifi channeladd band=2ghz-n comment=iot disabled=no name=channel-iot reselect-interval=\2h58m..3hadd band=5ghz-n comment=prv disabled=no name=channel-prv reselect-interval=\3h1m..3h4madd band=5ghz-n comment=guests disabled=no name=channel-gst/interface wifi datapathadd bridge=BR1 disabled=no name=DP_MANUAL/ip pooladd name=IOT_POOL ranges=192.168.10.2-192.168.10.254add name=GUEST_POOL ranges=192.168.20.2-192.168.20.254add name=PRV_POOL ranges=192.168.30.2-192.168.30.254add name=BASE_POOL ranges=192.168.0.10-192.168.0.254/ip dhcp-serveradd address-pool=IOT_POOL interface=IOT_VLAN name=IOT_DHCPadd address-pool=GUEST_POOL interface=GUEST_VLAN lease-time=20m name=\GUEST_DHCPadd address-pool=PRV_POOL interface=PRV_VLAN name=PRV_DHCPadd address-pool=BASE_POOL interface=BASE_VLAN name=BASE_DHCP/ipv6 pooladd name=ipv6-pool1 prefix=::/64 prefix-length=64/portset 0 name=serial0set 1 name=serial1/interface bridge portadd bridge=BR1 interface=ether2add bridge=BR1 interface=ether3add bridge=BR1 interface=ether4add bridge=BR1 interface=ether5add bridge=BR1 disabled=yes interface=cap-wifi24-iot-CANTINA pvid=10add bridge=BR1 disabled=yes interface=cap-wifi50-prv-CANTINA pvid=30add bridge=BR1 disabled=yes interface=wifi50-gst-CANTINA pvid=20add bridge=BR-WAN interface=WAN-836add bridge=BR-WAN interface=ether9/ip neighbor discovery-settingsset discover-interface-list=!dynamic/interface bridge vlanadd bridge=BR1 tagged=BR1,ether2,ether3,ether4,ether5 vlan-ids=10add bridge=BR1 tagged=BR1,ether2,ether3,ether4,ether5 vlan-ids=20add bridge=BR1 tagged=BR1,ether2,ether3,ether4,ether5 vlan-ids=30add bridge=BR1 tagged=BR1,ether3,ether4,ether5,ether2 vlan-ids=99/interface list memberadd interface=ether1 list=WANadd interface=BASE_VLAN list=VLANadd interface=IOT_VLAN list=VLANadd interface=GUEST_VLAN list=VLANadd interface=PRV_VLAN list=VLANadd interface=BASE_VLAN list=BASEadd interface=wireguard1 list=VLANadd interface=PRV_VLAN list=PRVadd interface=IOT_VLAN list=IOTadd interface=BASE_VLAN list=alowed_to_PRINTadd disabled=yes interface=IOT_VLAN list=alowed_to_PRINTadd interface=GUEST_VLAN list=GUESTadd interface=ether10 list=WAN/interface wifi capsmanset ca-certificate=none enabled=yes interfaces=BR1 package-path="" \require-peer-certificate=no upgrade-policy=none/interface wifi provisioningadd action=create-enabled disabled=noadd action=create-dynamic-enabled disabled=no master-configuration=cfg-prv \slave-configurations=cfg-gst supported-bands=5ghz-ax/interface wireguard peersadd allowed-address=192.168.100.99/32 .....add allowed-address=192.168.100.100/32 ..../ip addressadd address=<84....IPv4-from ISP>/32 interface=ipipv6-tunnel1 network=<84....IPv4-from ISP>add address=192.168.0.1/24 interface=BASE_VLAN network=192.168.0.0add address=192.168.10.1/24 interface=IOT_VLAN network=192.168.10.0add address=192.168.20.1/24 interface=GUEST_VLAN network=192.168.20.0add address=192.168.30.1/24 interface=PRV_VLAN network=192.168.30.0add address=192.168.100.1/24 comment=Wireguard interface=wireguard1 network=\192.168.100.0/ip dhcp-server lease....../ip dhcp-server networkadd address=192.168.0.0/24 dns-server=192.168.0.1 gateway=192.168.0.1add address=192.168.10.0/24 dns-server=192.168.0.1 gateway=192.168.10.1add address=192.168.20.0/24 dns-server=192.168.0.1 gateway=192.168.20.1add address=192.168.30.0/24 dns-server=192.168.0.1 gateway=192.168.30.1/ip dnsset allow-remote-requests=yes servers=8.8.8.8,1.1.1.1/ip firewall filter/ip firewall natadd action=masquerade chain=srcnat comment="IPv6-tunnel masquerade" \out-interface=ipipv6-tunnel1/ip firewall raw/ip routeadd disabled=no distance=1 dst-address=0.0.0.0/0 gateway=ipipv6-tunnel1 \routing-table=main scope=30 suppress-hw-offload=no target-scope=10/ipv6 routeadd disabled=no distance=1 dst-address=2a01:----:----:PREFIX-ipv6::/60 gateway=BR-WAN \routing-table=main scope=30 suppress-hw-offload=no target-scope=10/ip serviceset www-ssl disabled=no/ipv6 addressadd address=2a01:----:----:PREFIX-ipv6::/60 advertise=no interface=ipipv6-tunnel1add address=::192.168.0.1 from-pool=ipv6-pool interface=BASE_VLAN/ipv6 dhcp-clientadd add-default-route=yes interface=WAN-836 pool-name=ipv6-pool request=\address,prefix/tool snifferset filter-interface=ether8 streaming-enabled=yes streaming-server=\192.168.0.14Request for assistance:Could someone kindly guide me through the configuration process? I’m sure many people are in the same situation, "left stranded" by the ISP, which prefers to enforce the use of their router.I also tried sniffing packets on eth9 (mirrored on eth8 and streamed to my local address on the Wireshark port), but it seems there is no destination found for the packets. I’m not an expert, so can someone suggest a way to debug my configuration, establish an IPv6 connection, and hopefully achieve full IPv4 and IPv6 connectivity?Thank you very much to anyone who can help!

---
### Post 2
Author: Unknown
Date: Unknown

AFAIK the required helpers for the MAP-E, MAP-T, 464XLAT and Lw4o6 methods are missing from RouterOS, the only successful implementations I've seen use DS-Lite. If enough people ask Mikrotik to add some/all of them it might eventually happen.

---
### Post 3
Author: Unknown
Date: Unknown

Thank you for your reply. In my case, an IPIPv6 tunnel with IPv4 packets encapsulated into IPv6 would work well, as described in the Iliad guide or as someone has done on open wrt. However, the official documentation appears to contain inaccuracies.It’s my fault think that ipipv6 won’t be the way?

---
