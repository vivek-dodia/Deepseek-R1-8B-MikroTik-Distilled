# Thread Information
Title: Untitled Thread
Section: mikrotik_forum
Thread ID: 214207

# Discussion

## Initial Question
Author: Sat Jan 25, 2025 7:26 pm
``` addaction=drop chain=forward comment="Drop all inter-VLAN traffic"\in-interface-list=ALL_VLANS log=yes log-prefix="Dropped by inter-vlan"\out-interface-list=ALL_VLANS ``` ``` addaction=accept chain=forward \ dst-address=192.168.99.2\ src-address=192.168.50.26 ``` ``` 1?:[LOCALHOST]pmtu15001:_gateway8.447ms1:_gateway2.106ms2:noreply3:noreply ``` ``` # 2025-01-25 16:29:04 by RouterOS 7.17# software id = SOFTWARE_ID## model = CCR2004-1G-12S+2XS# serial number = SERIAL_NUMBER/interfacebridgeaddname="bridge[LAN]"vlan-filtering=yes/interfaceethernetset[finddefault-name=ether1]name="ether1[INFRA]"set[finddefault-name=sfp-sfpplus1]name="sfp-sfpplus1[WAN]"set[finddefault-name=sfp-sfpplus11]name="sfp-sfpplus11[UPLINK_TRUENAS]"set[finddefault-name=sfp-sfpplus12]name=\"sfp-sfpplus12[UPLINK_SWITCH_2.5G]"/interfacevlanaddinterface="bridge[LAN]"name=Guestvlan-id=98addinterface="bridge[LAN]"name=Infrastructurevlan-id=99addinterface="bridge[LAN]"name=IoTvlan-id=30addinterface="bridge[LAN]"name=Securityvlan-id=101addinterface="bridge[LAN]"name=Serversvlan-id=100addinterface="bridge[LAN]"name=Trustedvlan-id=50addinterface="bridge[LAN]"name=Workvlan-id=20addinterface="sfp-sfpplus1[WAN]"name=pppoe-vlan vlan-id=201/interfacepppoe-clientaddadd-default-route=yes disabled=nointerface=pppoe-vlan name=\"pppoe-out1[CL]"use-peer-dns=yes user=PPPOE_USERNAME_HERE/interfacelistaddname=WANaddname=ALL_VLANS/ip pooladdname=dhcp_pool_infra ranges=192.168.99.100-192.168.99.254addname=dhcp_pool_guest ranges=192.168.98.2-192.168.98.254addname=dhcp_pool_trusted ranges=192.168.50.100-192.168.50.254addname=dhcp_pool_servers ranges=192.168.100.100-192.168.100.254addname=dhcp_pool_security ranges=192.168.101.100-192.168.101.254/ip dhcp-serveraddaddress-pool=dhcp_pool_infrainterface=Infrastructurelease-time=8hname=\"dhcp[INFRA]"addaddress-pool=dhcp_pool_guestinterface=Guestname="dhcp[GUEST]"addaddress-pool=dhcp_pool_trustedinterface=Trustedlease-time=1hname=\"dhcp[TRUSTED]"addaddress-pool=dhcp_pool_serversinterface=Serverslease-time=8hname=\"dhcp[SERVERS]"addaddress-pool=dhcp_pool_securityinterface=Securitylease-time=4hname=\"dhcp[SECURITY]"/portset0name=serial0/interfacebridge portaddbridge="bridge[LAN]"interface="ether1[INFRA]"pvid=99addbridge="bridge[LAN]"interface="sfp-sfpplus12[UPLINK_SWITCH_2.5G]"addbridge="bridge[LAN]"interface="sfp-sfpplus11[UPLINK_TRUENAS]"/ip settingssetrp-filter=strict/interfacebridge vlanaddbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"untagged="ether1[INFRA]"\ vlan-ids=99addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=20addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=30addbridge="bridge[LAN]"tagged="bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]\ ,sfp-sfpplus11[UPLINK_TRUENAS]"vlan-ids=50addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=98addbridge="bridge[LAN]"tagged="bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]\ ,sfp-sfpplus11[UPLINK_TRUENAS]"vlan-ids=100addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=101/interfacelist memberaddinterface="pppoe-out1[CL]"list=WANaddinterface=Infrastructurelist=ALL_VLANSaddinterface=Trustedlist=ALL_VLANSaddinterface=Serverslist=ALL_VLANSaddinterface=Securitylist=ALL_VLANSaddinterface=IoTlist=ALL_VLANSaddinterface=Worklist=ALL_VLANSaddinterface=Guestlist=ALL_VLANS/ip addressaddaddress=192.168.99.1/24interface=Infrastructurenetwork=192.168.99.0addaddress=192.168.20.1/24interface=Worknetwork=192.168.20.0addaddress=192.168.30.1/24interface=IoTnetwork=192.168.30.0addaddress=192.168.50.1/24interface=Trustednetwork=192.168.50.0addaddress=192.168.98.1/24interface=Guestnetwork=192.168.98.0addaddress=192.168.100.1/24interface=Serversnetwork=192.168.100.0addaddress=192.168.101.1/24interface=Securitynetwork=192.168.101.0/ip dhcp-server leaseaddaddress=192.168.101.2mac-address=MAC_ADDRESS server=\"dhcp[SECURITY]"addaddress=192.168.101.3client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[SECURITY]"addaddress=192.168.99.50client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[INFRA]"addaddress=192.168.50.2client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[TRUSTED]"addaddress=192.168.50.26client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[TRUSTED]"addaddress=192.168.50.4client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[TRUSTED]"addaddress=192.168.99.26client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[INFRA]"/ip dhcp-server networkaddaddress=192.168.50.0/24gateway=192.168.50.1addaddress=192.168.98.0/24gateway=192.168.98.1addaddress=192.168.99.0/24gateway=192.168.99.1addaddress=192.168.100.0/24gateway=192.168.100.1addaddress=192.168.101.0/24gateway=192.168.101.1/ip firewall address-listaddaddress=192.168.100.99list=MGMT_Serversaddaddress=192.168.50.2list=MGMT_Trustedaddaddress=192.168.99.0/24list=MGMT_IPsaddaddress=192.168.50.26list=MGMT_IPsaddaddress=192.168.101.2list=IPs_SimpliSafeaddaddress=192.168.101.3list=IPs_Nestaddaddress=192.168.50.4list=IPs_NordVPNaddaddress=192.168.50.3list=IPs_NordVPNaddaddress=192.168.99.0/24list=IPs_Infrastructureaddaddress=192.168.99.26list=MGMT_IPs/ip firewall filteraddaction=accept chain=input connection-state=established, relatedaddaction=drop chain=input connection-state=invalid log=yes log-prefix=\"Invalid input:"addaction=accept chain=inputin-interface="!pppoe-out1[CL]"protocol=icmpaddaction=drop chain=inputin-interface="pppoe-out1[CL]"log=yes log-prefix=\"Dropped by input from WAN catch-all"addaction=fasttrack-connection chain=forward comment=Forward\ connection-state=established, related hw-offload=yesaddaction=accept chain=forward connection-state=established, relatedaddaction=drop chain=forward connection-state=invalid log=yes log-prefix=\"Invalid forward:"addaction=accept chain=forward dst-port=443, 53, 123out-interface-list=WAN \ protocol=udpaddaction=accept chain=forward dst-port=80, 443, 8080, 53, 853\out-interface-list=WAN protocol=tcpaddaction=accept chain=forward dst-port=1723out-interface-list=WAN \ protocol=tcp src-address-list=IPs_NordVPNaddaction=accept chain=forward dst-port=500, 1194, 4500, 51820\out-interface-list=WAN protocol=udp src-address-list=IPs_NordVPNaddaction=accept chain=forward dst-port=8890, 8899out-interface-list=WAN \ protocol=tcp src-address-list=IPs_SimpliSafeaddaction=accept chain=forward dst-port=11095out-interface-list=WAN \ protocol=tcp src-address-list=IPs_Nestaddaction=accept chain=forward connection-state=""out-interface-list=WAN \ protocol=icmpaddaction=accept chain=forward dst-address=192.168.99.2src-address=\192.168.50.241addaction=accept chain=forward comment="Allow MGMT IPs to access everything"\out-interface-list=ALL_VLANS src-address-list=MGMT_IPsaddaction=drop chain=forward comment="Drop all inter-VLAN traffic"\in-interface-list=ALL_VLANS log=yes log-prefix="Dropped by inter-vlan"\out-interface-list=ALL_VLANSaddaction=drop chain=forward connection-state=newin-interface=\"pppoe-out1[CL]"addaction=drop chain=forward comment="Forward Drop Catch-All"log=yes \ log-prefix="Dropped by forward catch-all"/ip firewall nataddaction=masquerade chain=srcnatout-interface="pppoe-out1[CL]"/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/system identitysetname=WilderRouter/system notesetshow-at-login=no/system routerboard settingssetenter-setup-on=delete-key ``` ``` # 1970-01-10 01:14:35 by RouterOS 7.17# software id = SOFTWARE_ID## model = CRS310-8G+2S+# serial number = SERIAL_NUMBER/interfacebridgeaddadmin-mac=MAC_ADDRESSauto-mac=nocomment=defconf name=\"bridge[LAN]"vlan-filtering=yes/interfaceethernetset[finddefault-name=ether1]name="ether1[INFRA]"set[finddefault-name=ether2]name="ether2[AP_BASEMENT]"set[finddefault-name=ether3]name="ether3[UPLINK_STUDY]"set[finddefault-name=ether5]name="ether5[TRUSTED_VLAN_TEMP]"set[finddefault-name=ether7]name="ether7[SERVER_VLAN_TEMP]"set[finddefault-name=ether8]name="ether8[TRUENAS_SERVER]"set[finddefault-name=sfp-sfpplus2]name="sfp-sfpplus2[UPLINK_ROUTER]"/interfacevlanaddinterface="bridge[LAN]"name=Infrastructurevlan-id=99/interfacelistaddname=LAN/interfacebridge portaddbridge="bridge[LAN]"comment=defconfinterface="ether1[INFRA]"pvid=99addbridge="bridge[LAN]"comment=defconfinterface="ether2[AP_BASEMENT]"addbridge="bridge[LAN]"comment=defconfinterface="ether3[UPLINK_STUDY]"\ pvid=50addbridge="bridge[LAN]"comment=defconfinterface=ether4addbridge="bridge[LAN]"comment=defconfinterface=\"ether5[TRUSTED_VLAN_TEMP]"pvid=50addbridge="bridge[LAN]"comment=defconfinterface=ether6addbridge="bridge[LAN]"comment=defconfinterface="ether7[SERVER_VLAN_TEMP]"\ pvid=100addbridge="bridge[LAN]"comment=defconfinterface="ether8[TRUENAS_SERVER]"\ pvid=100addbridge="bridge[LAN]"comment=defconfinterface=sfp-sfpplus1addbridge="bridge[LAN]"comment=defconfinterface=\"sfp-sfpplus2[UPLINK_ROUTER]"/ip firewall connection trackingsetudp-timeout=10s/interfacebridge vlanaddbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"untagged=\"ether1[INFRA]"vlan-ids=99addbridge="bridge[LAN]"tagged=\"sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"vlan-ids=98addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"vlan-ids=20addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"vlan-ids=30addbridge="bridge[LAN]"tagged=\"sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"untagged=\"ether3[UPLINK_STUDY],ether5[TRUSTED_VLAN_TEMP]"vlan-ids=50addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"untagged=\"ether8[TRUENAS_SERVER],ether7[SERVER_VLAN_TEMP]"vlan-ids=100addbridge="bridge[LAN]"tagged=\"sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"vlan-ids=101/interfacelist memberaddinterface="bridge[LAN]"list=LANaddinterface=Infrastructurelist=LAN/interfaceovpn-server serveraddmac-address=MAC_ADDRESS name=ovpn-server1/ip addressaddaddress=192.168.99.2/24interface=Infrastructurenetwork=192.168.99.0/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/system identitysetname=WilderSwitch2.5G/system notesetshow-at-login=no ``` Hello all, I am still very new to a lot of networking concepts. I am confused about using firewall rules for inter-VLAN communication between specific IPs.I have been watching lots of videos on RouterOS configurations and have been reading documentation (the quality of the documentation is incredible, but things are still sinking in due to the learning curve).I am trying to understand granting inter-VLAN access between specific IPs, and seem to be missing something. I want to allow my laptop (assigned 192.168.50.26) to access my switch configuration via WinBox (assigned 192.168.99.2)Configuration Overview:Router - CCR2004-1G-12S+2XSSwitch - CRS310-8G+2S+The router is connected to the switch using a VLAN trunk port. The bridge VLANs in question here are:- Infrastructure: PVID 99- Trusted: PVID 50Interface VLANs:- Infrasstructure: PVID 99, DHCP Server assigns addresses in the range 192.168.99.1/24.- Trusted: PVID 50, DHCP Server assigns addresses in the range 192.168.50.1/24.The router is assigned the ip 192.168.99.1.A bridge exists that has the VLANs above defined and they tag the bridge (IPs are given out to each interface-defined VLAN), and the port interface being used as an uplink to the switch. The bridge has 'vlan filtering' enabled.Since the ports are all connected to the same bridge, my understanding is that they can communicate with each other by default since they are combined as a single 'bridge' interface.The switch also has a bridge and bridge vlans defined. The vlans have the router uplink port interface tagged, as well as another vlan trunk port that connects to a wifi access point.The switch is assigned the ip 192.168.99.2.My router firewall is set up to have an input and forward drop catch-all at the bottom of the filter list.I have a firewall rule to drop all inter-VLAN traffic:
```
But right before that inter-VLAN drop all rule, I have this rule to specifically allow traffic between my laptop:
```

```
When I try to connect to WinBox, I hang on the "Connecting to 192.168.99.2..." page, and it does not progress. When I look at the firewall filter rules tab in the router, I see that the ip-specific 'accept' rule defined above increases the Bytes/Packets numbers while this connection is trying to be made. The same thing happens when I run 'ping 192.168.99.2' from my laptop.When I run 'tracepath 192.168.99.2' from my laptop, I get the following:
```

```
My confusion is why is it 'accepted' traffic, but the connection is not established.If anyone can give pointers or correct my incorrect assumptions, that would be great!Please let me know if I can provide any additional information.I will include the output from 'export file=FILENAME' below for both the router and switch.--------------------------------------------------------------------------------------------------Router Configuration Export:
```

```
--------------------------------------------------------------------------------------------------Switch Configuration Export:
```

```
---
```

## Response 1
Author: [SOLVED]Sun Jan 26, 2025 4:32 am
``` # 2025-01-25 16:29:04 by RouterOS 7.17# software id = SOFTWARE_ID## model = CCR2004-1G-12S+2XS# serial number = SERIAL_NUMBER/interfacebridgeaddname="bridge[LAN]"vlan-filtering=yes/interfaceethernetset[finddefault-name=ether1]name=OffBridge1set[finddefault-name=sfp-sfpplus2]name="sfp-sfpplus2[INFRA]"set[finddefault-name=sfp-sfpplus1]name="sfp-sfpplus1[WAN]"set[finddefault-name=sfp-sfpplus11]name="sfp-sfpplus11[UPLINK_TRUENAS]"set[finddefault-name=sfp-sfpplus12]name="sfp-sfpplus12[UPLINK_SWITCH_2.5G]"/interfacevlanaddinterface="bridge[LAN]"name=Guestvlan-id=98addinterface="bridge[LAN]"name=Infrastructurevlan-id=99addinterface="bridge[LAN]"name=IoTvlan-id=30addinterface="bridge[LAN]"name=Securityvlan-id=101addinterface="bridge[LAN]"name=Serversvlan-id=100addinterface="bridge[LAN]"name=Trustedvlan-id=50addinterface="bridge[LAN]"name=Workvlan-id=20addinterface="sfp-sfpplus1[WAN]"name=pppoe-vlan vlan-id=201/interfacepppoe-clientaddadd-default-route=yes disabled=nointerface=pppoe-vlan name=\"pppoe-out1[CL]"use-peer-dns=yes user=PPPOE_USERNAME_HERE/interfacelistaddname=WANaddname=LANaddname=TRUSTED/ip pooladdname=dhcp_pool_infra ranges=192.168.99.100-192.168.99.254addname=dhcp_pool_guest ranges=192.168.98.2-192.168.98.254addname=dhcp_pool_trusted ranges=192.168.50.100-192.168.50.254addname=dhcp_pool_servers ranges=192.168.100.100-192.168.100.254addname=dhcp_pool_security ranges=192.168.101.100-192.168.101.254addname=dhcp_pool_work ranges=192.168.20.100-192.168.20.254addname=dhcp_pool_iot ranges=192.168.30.100-192.168.30.254/ip dhcp-serveraddaddress-pool=dhcp_pool_infrainterface=Infrastructurelease-time=8hname=\"dhcp[INFRA]"addaddress-pool=dhcp_pool_guestinterface=Guestname="dhcp[GUEST]"addaddress-pool=dhcp_pool_trustedinterface=Trustedlease-time=1hname=\"dhcp[TRUSTED]"addaddress-pool=dhcp_pool_serversinterface=Serverslease-time=8hname=\"dhcp[SERVERS]"addaddress-pool=dhcp_pool_securityinterface=Securitylease-time=4hname=\"dhcp[SECURITY]"addaddress-pool=dhcp_pool_workinterface=Worklease-time=8hname=\"dhcp[WORK]"addaddress-pool=dhcp_pool_iotinterface=IoTlease-time=4hname=\"dhcp[IoT]"/portset0name=serial0/interfacebridge portaddbridge="bridge[LAN]"ingress-filtering=yes frame-types=admit-only-priority-and-untaggedinterface="sfp-sfpplus2[INFRA]"pvid=99addbridge="bridge[LAN]"ingress-filtering=yes frame-types=admit-only-vlan-taggedinterface="sfp-sfpplus12[UPLINK_SWITCH_2.5G]"addbridge="bridge[LAN]"ingress-filtering=yes frame-types=admit-only-vlan-taggedinterface="sfp-sfpplus11[UPLINK_TRUENAS]"/ip settingssetrp-filter=loose/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/interfacebridge vlanaddbridge="bridge[LAN]"tagged="bridge[LAN]","sfp-sfpplus12[UPLINK_SWITCH_2.5G]"untagged="sfp-sfpplus2[INFRA]"\ vlan-ids=99addbridge="bridge[LAN]"tagged="bridge[LAN]","sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=20, 30, 98, 101addbridge="bridge[LAN]"tagged="bridge[LAN]","sfp-sfpplus12[UPLINK_SWITCH_2.5G]","sfp-sfpplus11[UPLINK_TRUENAS]"\ vlan-ids=50, 100/interfacelist memberaddinterface="pppoe-out1[CL]"list=WANaddinterface=Infrastructurelist=LANaddinterface=Trustedlist=LANaddinterface=Serverslist=LANaddinterface=Securitylist=LANaddinterface=IoTlist=LANaddinterface=Worklist=LANaddinterface=Guestlist=LANaddinterface=Trustedlist=TRUSTEDaddinterface=OffBridge1list=TRUSTED/ip addressaddaddress=192.168.99.1/24interface=Infrastructurenetwork=192.168.99.0addaddress=192.168.20.1/24interface=Worknetwork=192.168.20.0addaddress=192.168.30.1/24interface=IoTnetwork=192.168.30.0addaddress=192.168.50.1/24interface=Trustednetwork=192.168.50.0addaddress=192.168.98.1/24interface=Guestnetwork=192.168.98.0addaddress=192.168.100.1/24interface=Serversnetwork=192.168.100.0addaddress=192.168.101.1/24interface=Securitynetwork=192.168.101.0addaddress=192.168.55.1/30interface=OffBridge1network=192.168.55.0/ip dhcp-server leaseaddaddress=192.168.101.2mac-address=MAC_ADDRESS server=\"dhcp[SECURITY]"addaddress=192.168.101.3client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[SECURITY]"addaddress=192.168.99.50client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[INFRA]"addaddress=192.168.50.2client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[TRUSTED]"addaddress=192.168.50.26client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[TRUSTED]"addaddress=192.168.50.4client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[TRUSTED]"addaddress=192.168.99.26client-id=CLIENT_ID mac-address=\ MAC_ADDRESS server="dhcp[INFRA]"/ip dhcp-server networkaddaddress=192.168.50.0/24gateway=192.168.50.1dns-server=192.168.50.1addaddress=192.168.98.0/24gateway=192.168.98.1dns-server=192.168.98.1addaddress=192.168.99.0/24gateway=192.168.99.1dns-server=192.168.99.1addaddress=192.168.100.0/24gateway=192.168.100.1dns-server=192.168.100.1addaddress=192.168.101.0/24gateway=192.168.101.1dns-server=192.168.101.1addaddress=192.168.20.0/24gateway=192.168.20.1dns-server=192.168.20.1addaddress=192.168.30.0/24gateway=192.168.30.1dns-server=192.168.30.1/ip firewall address-listaddaddress=192.168.100.99list=MGMT_Serversaddaddress=192.168.99.0/24list=MGMT_IPsaddaddress=192.168.101.2list=IPs_SimpliSafeaddaddress=192.168.101.3list=IPs_Nestaddaddress=192.168.50.4list=IPs_NordVPNaddaddress=192.168.50.3list=IPs_NordVPNaddaddress=192.168.99.0/24list=IPs_Infrastructureaddaddress=192.168.99.26list=MGMT_IPsaddaddress=192.168.50.2list=Authorizedaddaddress=192.168.50.26list=Authorizedaddaddress=192.168.55.2list=Authorized/ip firewall filteraddaction=accept chain=input connection-state=established, relatedaddaction=drop chain=input connection-state=invalid log=yes log-prefix=\"Invalid input:"addaction=accept chain=inputin-interface=protocol=icmpaddaction=accept chain=input comment="admin access"in-interface-list=TRUSTED src-address=list=Authorizedaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53, 123protocol=udpaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53protocol=tcpaddaction=drop chain=input comment="Drop all else"{insertthisrulelast}addaction=fasttrack-connection chain=forward comment=Forward\ connection-state=established, related hw-offload=yesaddaction=accept chain=forward connection-state=established, related, untrackedaddaction=drop chain=forward connection-state=invalid log=yes log-prefix=\"Invalid forward:"addaction=accept chain=forwardin-interface-list=LANout-interface-list=WAN dst-port=443protocol=udpaddaction=accept chain=forwardin-interface-list=LANout-interface-list=WAN dst-port=80, 443, 8080, 853protocol=tcpaddaction=accept chain=forwardin-interface=Trustedsrc-address-list=IPs_NordVPNout-interface-list=WAN dst-port=1723protocol=tcpaddaction=accept chain=forwardin-interface=Trustedsrc-address-list=IPs_NordVPNout-interface-list=WAN dst-port=500, 1194, 4500, 51820protocol=udpaddaction=accept chain=forwardin-interface=Securitysrc-address-list=IPs_SimpliSafeout-interface-list=WAN dst-port=8890, 8899protocol=tcpaddaction=accept chain=forwardin-interface=Securitysrc-address-list=IPs_Nestout-interface-list=WAN dst-port=11095protocol=tcpaddaction=accept chain=forwardin-interface=Trustedsrc-address=192.168.50.241dst-address=192.168.99.2addaction=accept chain=forwardin-interface-list=TRUSTED src-address-list=Authorizedout-interface-list=LAN comment="admin to all vlans"addaction=drop chain=forward comment="Drop all else"/ip firewall nataddaction=masquerade chain=srcnatout-interface="pppoe-out1[CL]"/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTED/system identitysetname=WilderRouter/system notesetshow-at-login=no/system routerboard settingssetenter-setup-on=delete-key/system ntp clientsetenabled=yes/system ntp serversetenabled=yes manycast=yes/system ntp client serversaddaddress={a pool near you}addaddress={another pool near you} ``` ``` # 1970-01-10 01:14:35 by RouterOS 7.17# software id = SOFTWARE_ID## model = CRS310-8G+2S+# serial number = SERIAL_NUMBER/interfacebridgeaddadmin-mac=MAC_ADDRESSauto-mac=nocomment=defconf name=\"bridge[LAN]"vlan-filtering=yes/interfaceethernetset[finddefault-name=ether1]name="ether1[INFRA]"set[finddefault-name=ether2]name="ether2[AP_BASEMENT]"set[finddefault-name=ether3]name="ether3[UPLINK_STUDY]"set[finddefault-name=ether4]name=OffBridge4set[finddefault-name=ether5]name="ether5[TRUSTED_VLAN_TEMP]"set[finddefault-name=ether7]name="ether7[SERVER_VLAN_TEMP]"set[finddefault-name=ether8]name="ether8[TRUENAS_SERVER]"set[finddefault-name=sfp-sfpplus2]name="sfp-sfpplus2[UPLINK_ROUTER]"/interfacevlanaddinterface="bridge[LAN]"name=Trustedvlan-id=50/interfacelistaddname=TRUSTED/interfacebridge portaddbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-priority-and-untaggedinterface="ether1[INFRA]"pvid=99addbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-vlan-taggedinterface="ether2[AP_BASEMENT]"addbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-priority-and-untaggedinterface="ether3[UPLINK_STUDY]"pvid=50addbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-priority-and-untaggedinterface="ether5[TRUSTED_VLAN_TEMP]"pvid=50addbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-priority-and-untaggedinterface="ether7[SERVER_VLAN_TEMP]"pvid=100addbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-priority-and-untaggedinterface="ether8[TRUENAS_SERVER]"pvid=100addbridge="bridge[LAN]"ingress-filtering=yes frame-type=admit-only-vlan-taggedinterface="sfp-sfpplus2[UPLINK_ROUTER]"/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=TRUSTED/interfacebridge vlanaddbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]","ether2[AP_BASEMENT]"untagged="ether1[INFRA]"vlan-ids=99addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]","ether2[AP_BASEMENT]"vlan-ids=98, 101addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"vlan-ids=20, 30addbridge="bridge[LAN]"tagged="bridge[LAN]","sfp-sfpplus2[UPLINK_ROUTER]","ether2[AP_BASEMENT]"untagged="ether3[UPLINK_STUDY]","ether5[TRUSTED_VLAN_TEMP]"vlan-ids=50addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"untagged="ether8[TRUENAS_SERVER]","ether7[SERVER_VLAN_TEMP]"vlan-ids=100/interfacelist memberaddinterface=Trustedlist=TRUSTEDaddinterface=OffBridge4list=TRUSTED/ip addressaddaddress=192.168.50.X/24interface=Trustednetwork=192.168.50.0/ip dnssetserver=192.168.50.1/ip routeadddst-address=0.0.0.0/0gateway=192.168.50.1/tool mac-serversetallowed-interface-list=none/tool mac-server mac-winboxsetallowed-interface-list=TRUSTED/system ntp clientsetenabled=yes/system ntp client serversaddaddress=192.168.50.1/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/system identitysetname=WilderSwitch2.5G/system notesetshow-at-login=no ``` Why do you have seven vlans and only 5 pools? You are missing an IOT vlan and the work vlan.If you have a trusted network, why is an infrastructure IP identified as Management IPwhy are you using a management single 1gig port for infrastructure vlan ???Changing this to 10gig port and keeping the ethernet port for off bridge access and safe spot to configure router from.why would you put two IPs in the trusted network and attach them to a third party VPN?? illogical and not a secure practice.If you want to do something like that make users that need to access nord vpn a different vlan....... much easier to config as well this way.(heck the easiest way is to use a WLAN for that purpose and only give the password to those that need it......... they choose when to use that pathway!! )(however, the use of nordvpn is not normal, it should be handled by the router.......... )It is not clear what you are trying to accomplish in the forward chain. Its not the place for port forwarding rules for example.Perhaps you are taking the unique step of only allowing certain ports...........never seen it done before but looks cool.Due to lack of clarity I have probably made some wrong assumptions, so consider it a discussion.Also I might add, your use of quotation marks for names only leads to unnecessary errors when configuring.ROUTER:.......
```
.......SWITCH:The trusted subnet is vlan50 not 99.why did you leave out ether4 on ethernet.............If not being used will use for same offbridge access.....
```

```
---
```

## Response 2
Author: Mon Jan 27, 2025 10:10 pm
``` addaction=accept chain=forward connection-state=""dst-address=\192.168.50.239src-address=192.168.99.26 ``` ``` # 2025-01-27 13:32:56 by RouterOS 7.17# software id = SOFTWARE_ID## model = CCR2004-1G-12S+2XS# serial number = SERIAL_NUMBER/interfacebridgeaddname="bridge[LAN]"vlan-filtering=yes/interfaceethernetset[finddefault-name=ether1]name="ether1[INFRA]"set[finddefault-name=sfp-sfpplus1]name="sfp-sfpplus1[WAN]"set[finddefault-name=sfp-sfpplus11]name="sfp-sfpplus11[UPLINK_TRUENAS]"set[finddefault-name=sfp-sfpplus12]name=\"sfp-sfpplus12[UPLINK_SWITCH_2.5G]"/interfacevlanaddinterface="bridge[LAN]"name=Guestvlan-id=98addinterface="bridge[LAN]"name=Infrastructurevlan-id=99addinterface="bridge[LAN]"name=IoTvlan-id=30addinterface="bridge[LAN]"name=Mainvlan-id=50addinterface="bridge[LAN]"name=Securityvlan-id=101addinterface="bridge[LAN]"name=Serversvlan-id=100addinterface="bridge[LAN]"name=Workvlan-id=20addinterface="sfp-sfpplus1[WAN]"name=pppoe-vlan vlan-id=201/interfacepppoe-clientaddadd-default-route=yes disabled=nointerface=pppoe-vlan name=\"pppoe-out1[CL]"use-peer-dns=yes user=PPPOE_USERNAME/interfacelistaddname=WANaddname=ALL_VLANSaddname=Infra/ip pooladdname=dhcp_pool_infra ranges=192.168.99.100-192.168.99.254addname=dhcp_pool_guest ranges=192.168.98.2-192.168.98.254addname=dhcp_pool_main ranges=192.168.50.100-192.168.50.254addname=dhcp_pool_servers ranges=192.168.100.100-192.168.100.254addname=dhcp_pool_security ranges=192.168.101.100-192.168.101.254/ip dhcp-serveraddaddress-pool=dhcp_pool_infrainterface=Infrastructurelease-time=8hname=\"dhcp[INFRA]"addaddress-pool=dhcp_pool_guestinterface=Guestname="dhcp[GUEST]"addaddress-pool=dhcp_pool_maininterface=Mainlease-time=1hname=\"dhcp[MAIN]"addaddress-pool=dhcp_pool_serversinterface=Serverslease-time=8hname=\"dhcp[SERVERS]"addaddress-pool=dhcp_pool_securityinterface=Securitylease-time=4hname=\"dhcp[SECURITY]"/portset0name=serial0/interfacebridge portaddbridge="bridge[LAN]"interface="ether1[INFRA]"pvid=99addbridge="bridge[LAN]"frame-types=admit-only-vlan-taggedinterface=\"sfp-sfpplus12[UPLINK_SWITCH_2.5G]"addbridge="bridge[LAN]"interface="sfp-sfpplus11[UPLINK_TRUENAS]"/ip neighbor discovery-settingssetdiscover-interface-list=Infra/ip settingssetrp-filter=strict/interfacebridge vlanaddbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"untagged="ether1[INFRA]"\ vlan-ids=99addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=20addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=30addbridge="bridge[LAN]"tagged="bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]\ ,sfp-sfpplus11[UPLINK_TRUENAS]"vlan-ids=50addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=98addbridge="bridge[LAN]"tagged="bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]\ ,sfp-sfpplus11[UPLINK_TRUENAS]"vlan-ids=100addbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus12[UPLINK_SWITCH_2.5G]"vlan-ids=101/interfacelist memberaddinterface="pppoe-out1[CL]"list=WANaddinterface=Infrastructurelist=ALL_VLANSaddinterface=Mainlist=ALL_VLANSaddinterface=Serverslist=ALL_VLANSaddinterface=Securitylist=ALL_VLANSaddinterface=IoTlist=ALL_VLANSaddinterface=Worklist=ALL_VLANSaddinterface=Guestlist=ALL_VLANSaddinterface=Infrastructurelist=Infra/ip addressaddaddress=192.168.99.1/24interface=Infrastructurenetwork=192.168.99.0addaddress=192.168.20.1/24interface=Worknetwork=192.168.20.0addaddress=192.168.30.1/24interface=IoTnetwork=192.168.30.0addaddress=192.168.50.1/24interface=Mainnetwork=192.168.50.0addaddress=192.168.98.1/24interface=Guestnetwork=192.168.98.0addaddress=192.168.100.1/24interface=Serversnetwork=192.168.100.0addaddress=192.168.101.1/24interface=Securitynetwork=192.168.101.0/ip dhcp-server leaseaddaddress=192.168.101.2mac-address=MAC_ADDRESS_HERE server=\"dhcp[SECURITY]"addaddress=192.168.101.3client-id=CLIENT_ID_HERE mac-address=\ MAC_ADDRESS_HERE server="dhcp[SECURITY]"addaddress=192.168.99.50client-id=CLIENT_ID_HERE mac-address=\ MAC_ADDRESS_HERE server="dhcp[INFRA]"addaddress=192.168.50.2client-id=CLIENT_ID_HERE mac-address=\ MAC_ADDRESS_HERE server="dhcp[MAIN]"addaddress=192.168.50.26client-id=CLIENT_ID_HERE mac-address=\ MAC_ADDRESS_HERE server="dhcp[MAIN]"addaddress=192.168.50.4client-id=CLIENT_ID_HERE mac-address=\ MAC_ADDRESS_HERE server="dhcp[MAIN]"addaddress=192.168.99.26client-id=1CLIENT_ID_HERE mac-address=\ MAC_ADDRESS_HERE server="dhcp[INFRA]"/ip dhcp-server networkaddaddress=192.168.50.0/24gateway=192.168.50.1addaddress=192.168.98.0/24gateway=192.168.98.1addaddress=192.168.99.0/24gateway=192.168.99.1addaddress=192.168.100.0/24gateway=192.168.100.1addaddress=192.168.101.0/24gateway=192.168.101.1/ip firewall address-listaddaddress=192.168.100.99list=IPs_Serversaddaddress=192.168.101.2list=IPs_SimpliSafeaddaddress=192.168.101.3list=IPs_Nestaddaddress=192.168.50.4list=IPs_NordVPNaddaddress=192.168.50.3list=IPs_NordVPNaddaddress=192.168.99.0/24list=IPs_Infrastructure/ip firewall filteraddaction=accept chain=input connection-state=established, relatedaddaction=drop chain=input connection-state=invalid log=yes log-prefix=\"Invalid input:"addaction=accept chain=inputin-interface="!pppoe-out1[CL]"protocol=icmpaddaction=drop chain=inputin-interface="pppoe-out1[CL]"log=yes log-prefix=\"Dropped by input from WAN catch-all"addaction=fasttrack-connection chain=forward comment=Forward\ connection-state=established, related hw-offload=yesaddaction=accept chain=forward connection-state=established, relatedaddaction=drop chain=forward connection-state=invalid log=yes log-prefix=\"Invalid forward:"addaction=accept chain=forward connection-state=""dst-address=\192.168.50.239src-address=192.168.99.26addaction=accept chain=forward comment="VLAN Internet Access Only"\ connection-state=newin-interface-list=ALL_VLANSout-interface-list=WANaddaction=drop chain=forward comment="Drop all inter-VLAN traffic"disabled=\ yesin-interface-list=ALL_VLANS log=yes log-prefix=\"Dropped by inter-vlan"out-interface-list=ALL_VLANSaddaction=drop chain=forward connection-state=newin-interface=\"pppoe-out1[CL]"addaction=drop chain=forward comment="Forward Drop Catch-All"log=yes \ log-prefix="Dropped by forward catch-all"/ip firewall nataddaction=masquerade chain=srcnatout-interface="pppoe-out1[CL]"/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/system clocksettime-zone-name=America/Chicago/system identitysetname=WilderRouter/system notesetshow-at-login=no/system routerboard settingssetenter-setup-on=delete-key/tool mac-serversetallowed-interface-list=Infra/tool mac-server mac-winboxsetallowed-interface-list=Infra ``` ``` # 1970-01-12 03:32:20 by RouterOS 7.17# software id = SOFTWARE_ID## model = CRS310-8G+2S+# serial number = SERIAL_NUMBER/interfacebridgeaddadmin-mac=MAC_ADDRESS_HEREauto-mac=nocomment=defconf name=\"bridge[LAN]"vlan-filtering=yes/interfaceethernetset[finddefault-name=ether1]name="ether1[INFRA]"set[finddefault-name=ether2]name="ether2[AP_BASEMENT]"set[finddefault-name=ether3]name="ether3[UPLINK_STUDY]"set[finddefault-name=ether5]name="ether5[MAIN_VLAN_TEMP]"set[finddefault-name=ether7]name="ether7[SERVER_VLAN_TEMP]"set[finddefault-name=ether8]name="ether8[TRUENAS_SERVER]"set[finddefault-name=sfp-sfpplus2]name="sfp-sfpplus2[UPLINK_ROUTER]"/interfacevlanaddinterface="bridge[LAN]"name=Infrastructurevlan-id=99/interfacelistaddname=LANaddname=Infra/interfacebridge portaddbridge="bridge[LAN]"comment=defconf frame-types=\ admit-only-untagged-and-priority-taggedinterface="ether1[INFRA]"pvid=99addbridge="bridge[LAN]"comment=defconfinterface="ether2[AP_BASEMENT]"addbridge="bridge[LAN]"comment=defconf frame-types=\ admit-only-untagged-and-priority-taggedinterface="ether3[UPLINK_STUDY]"\ pvid=50addbridge="bridge[LAN]"comment=defconfinterface=ether4addbridge="bridge[LAN]"comment=defconf frame-types=\ admit-only-untagged-and-priority-taggedinterface=\"ether5[MAIN_VLAN_TEMP]"pvid=50addbridge="bridge[LAN]"comment=defconfinterface=ether6addbridge="bridge[LAN]"comment=defconf frame-types=\ admit-only-untagged-and-priority-taggedinterface=\"ether7[SERVER_VLAN_TEMP]"pvid=100addbridge="bridge[LAN]"comment=defconf frame-types=\ admit-only-untagged-and-priority-taggedinterface=\"ether8[TRUENAS_SERVER]"pvid=100addbridge="bridge[LAN]"comment=defconfinterface=sfp-sfpplus1addbridge="bridge[LAN]"comment=defconf frame-types=admit-only-vlan-tagged \interface="sfp-sfpplus2[UPLINK_ROUTER]"/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=Infra/interfacebridge vlanaddbridge="bridge[LAN]"tagged=\"bridge[LAN],sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"untagged=\"ether1[INFRA]"vlan-ids=99addbridge="bridge[LAN]"tagged=\"sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"vlan-ids=98addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"vlan-ids=20addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"vlan-ids=30addbridge="bridge[LAN]"tagged=\"sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"untagged=\"ether3[UPLINK_STUDY],ether5[MAIN_VLAN_TEMP]"vlan-ids=50addbridge="bridge[LAN]"tagged="sfp-sfpplus2[UPLINK_ROUTER]"untagged=\"ether8[TRUENAS_SERVER],ether7[SERVER_VLAN_TEMP]"vlan-ids=100addbridge="bridge[LAN]"tagged=\"sfp-sfpplus2[UPLINK_ROUTER],ether2[AP_BASEMENT]"vlan-ids=101/interfacelist memberaddinterface="bridge[LAN]"list=LANaddinterface=Infrastructurelist=LANaddinterface=Infrastructurelist=Infra/interfaceovpn-server serveraddmac-address=MAC_ADDRESS_HERE name=ovpn-server1/ip addressaddaddress=192.168.99.2/24interface=Infrastructurenetwork=192.168.99.0/ip hotspot profileset[finddefault=yes]html-directory=hotspot/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip routeadddistance=1gateway=192.168.99.1/ip servicesettelnet disabled=yessetftp disabled=yessetwww disabled=yessetapi disabled=yessetapi-ssl disabled=yes/system identitysetname=WilderSwitch2.5G/system notesetshow-at-login=no/tool mac-serversetallowed-interface-list=Infra/tool mac-server mac-winboxsetallowed-interface-list=Infra ``` I looked through anav's config snippets and read through this forum post about configuring VLANs using a "Switch with a separate router (RoaS)":viewtopic.php?f=13&t=143620&sid=8e93ad3 ... 71#p706997Note: The Infrastructure contains the IPs I give out to my router, switch, and access point.A few things I updated from my last config post:- Updated the vlan named 'Trusted' to 'Main'.- Changed trunk ports to use bridge port VLAN frame types 'admit only VLAN tagged'.- Changed access ports to use bridge port VLAN frame types 'admit only untagged and priority tagged'.- On the router, I set the Neighbor List Discovery Settings to only use the Interface tied to the Infrastructure VLAN.- On the switch, I also set the Neighbor List Discovery Settings to only use the Interface tied to the Infrastructure VLAN.- On the switch, the router's IP (192.168.99.1) was set as the gateway for the default Dst. Address.My scenario:I have a device connected to the router on the Infrastructure VLAN (192.168.99.26), and am trying to ping a PC connected to the switch on the Main VLAN (192.168.50.239). The packets are hitting my firewall rule:
```
But no response is allowed. The switch seems to eat the response.Based on the responses from anav and sid5632, i feel like I am missing something while thinking through how my switch handles a packet in response to a request.Any insights, docs, or forum posts on this issue would be very helpful.Thank you!Updated configs (sorry about any strange config formatting, it is the output directly from exporting from the WinBox GUI):Router:
```

```
Switch:
```