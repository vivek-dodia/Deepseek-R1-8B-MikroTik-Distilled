---
title: Thread-1120193
url: https://forum.mikrotik.com/viewtopic.php?p=1120193&sid=49f92a630bc7970d8ca50523be880e8f#p1120193
thread_id: 1120193
section: RouterOS
post_count: 19
date_crawled: 2025-02-03T13:39:20.974302
---

### Post 1
Author: Unknown
Date: Unknown

According to the changelog for 7.15 stable a new feature was finally added to the /ip/dns service in RouterOS:https://download.mikrotik.com/routeros/7.15/CHANGELOGCode:Select all*)dns-added VRF support;However I cant make this to work in 7.15.1 stable nor 7.15.2 stable (or 7.16beta2).I can verify that the VRF is properly setup along with the routing tables because I can reach the ether1 interface both locally (on the same external switch as ether1 is connected to) as well as being routed through what this VRF is using as its default gateway.Also outgoing ping and traceroute from the Mikrotik device (CRS326) towards 1.1.1.1 works.But when I do a DNS-lookup locally I get an error:Code:Select all/put[:resolve ntp.se]failure:dns server failureSame with going to System->Packages in webfig I get:Code:Select allERROR:couldnotresolve dns name(timeout)The /ip/dns config is pretty straight forward:Code:Select all/ip dnssetservers=1.1.1.1vrf=VRF-MGMTSo what am I missing here, have someone in here managed to get the VRF-support for /ip/dns to be working?

---
### Post 2
Author: Unknown
Date: Unknown

Im guessing noone in here are using /ip/dns along with VRF?

---
### Post 3
Author: Unknown
Date: Unknown

The broken VRF-support fÃ¶r /ip/dns have been confirmed for both CRS326-24S+2Q+ and CRS112-8G-4S using both RouterOS 7.15.2 stable and 7.16beta4 testing.Anyone in here who managed to get it working on these or some other Mikrotik model?

---
### Post 4
Author: Unknown
Date: Unknown

Interesting - I have a VRF in which I have an interface getting a DHCP address and the DNS, however the DNS is still placed in the main VRF. Probably another bug.Code:Select all[admin@router4]>/ip/vrf/printFlags:X-disabled;*-builtin0;;;FrontVRF
      name="wan"interfaces=ether7,ether81*name="main"interfaces=all[admin@router4]>/ip/dhcp-client/printColumns:INTERFACE,USE-PEER-DNS,ADD-DEFAULT-ROUTE,STATUS,ADDRESS# INTERFACE  USE-PEER-DNS  ADD-DEFAULT-ROUTE  STATUS  ADDRESS0ether8     yes           yes                bound192.168.2.238/24[admin@router4]>/ip/dns/printservers:dynamic-servers:192.168.2.1use-doh-server:verify-doh-cert:nodoh-max-server-connections:5doh-max-concurrent-queries:50doh-timeout:5sallow-remote-requests:yes
          max-udp-packet-size:4096query-server-timeout:2squery-total-timeout:10smax-concurrent-queries:100max-concurrent-tcp-sessions:20cache-size:2048KiBcache-max-ttl:1waddress-list-extra-time:0svrf:main
                   cache-used:41KiBSetting manually the DNS seems to work.Code:Select all[admin@router4]>/ip/dns/setvrf=wan servers=192.168.2.1[admin@router4]>/ip/dns/printservers:192.168.2.1dynamic-servers:use-doh-server:verify-doh-cert:nodoh-max-server-connections:5doh-max-concurrent-queries:50doh-timeout:5sallow-remote-requests:yes
          max-udp-packet-size:4096query-server-timeout:2squery-total-timeout:10smax-concurrent-queries:100max-concurrent-tcp-sessions:20cache-size:2048KiBcache-max-ttl:1waddress-list-extra-time:0svrf:wan
                   cache-used:42KiB[admin@router4]>:resolve www.yahoo.fr[admin@router4]>put[:resolve www.yahoo.fr]13.248.158.7[admin@router4]>put[:resolve mikrotik.com]159.148.172.205[admin@router4]>/put[:resolve ntp.se]194.58.200.20Now what doesn't work anymore is using the Mikrotik as a DNS server in the main VRF. Opening a ticket with the support.

---
### Post 5
Author: Unknown
Date: Unknown

exact same problem here on 2 CCR2004-16G-2S+ on latest stable ROSv7.15.3as soon as DNS is put in a VRF other than "main" resolving gets broken and stops to work, despite VRF routing table is set properly and a "ping vrf=vrfXYZ IP.of.DNS.Srv" is working and shows reachabilitycreated a support ticket SUP-160816

---
### Post 6
Author: Unknown
Date: Unknown

Thanks!So then we can hopefully rule out that this would be some kind of misconfiguration on my side.Question is how the quality assurance works over at Mikrotik or how their config to validate this feature looks like?I have also filed a support ticket SUP-156966 on 24th of june which gives that it have now passed 1 month and 1 week without any reply from Mikrotik on this issue

---
### Post 7
Author: Unknown
Date: Unknown

SUbscribing to this topic because I think I am suffering from the same bug.

---
### Post 8
Author: Unknown
Date: Unknown

logicly you wouldn't be able toresolvefrom the main table if theDNSis in thevrf.

---
### Post 9
Author: Unknown
Date: Unknown

Im suffering the same issue on 	CRS310-8G+2S+ router os 7.15.3I have my ip address in a vrf on a specific management vlan. default route points in that vrf also but when i set dns that i can ping in the vrf from the device and set them in the vrf, i cant resolve anything

---
### Post 10
Author: Unknown
Date: Unknown

I have opened a ticket with the support and they acknowledged the problem...Currently VRF is supported for incoming DNS requests (if your router is the DNS server and it gets requests on VRF interfaces).VRF for outgoing requests is not supported yet (your router connects to DNS server from VRF interface), it is in "To do" list.Unfortunately we cannot give a clear ETA when this feature will be implemented. You will however receive an automated message when this will be fixed.

---
### Post 11
Author: Unknown
Date: Unknown

Yep, there was a photo posted some time ago, about picture on the box and actual contents, cannot find it right now, but this one will do:

---
### Post 12
Author: Unknown
Date: Unknown

Logged with support #[SUP-173653]VRF is supported only for incoming DNS requests (if your router is the DNS server, and it gets requests on VRF interfaces).VRF for outgoing requests is not supported yetUnfortunately, giving any ETA for when the feature will be implemented is impossible.

---
### Post 13
Author: Unknown
Date: Unknown

Hello,Soo... just barging in..Can someone please explain below (how it works if possible):*) dns - added VRF support (CLI only);(taken from some change-logs of a recent ROS version)Thanks and regards,Paul

---
### Post 14
Author: Unknown
Date: Unknown

Responding to my own post, it seems that this is no longer CLI only, I think newer Winbox versions matches this option in DNS, ability to select VRF.Someone please correct me, maybe there is more to it. I would very much like DNS to work on any VRF, not only main or whatever I (single only) select in DNS section.Regards,Paul

---
### Post 15
Author: Unknown
Date: Unknown

Responding to my own post, it seems that this is no longer CLI only, I think newer Winbox versions matches this option in DNS, ability to select VRF.Someone please correct me, maybe there is more to it. I would very much like DNS to work on any VRF, not only main or whatever I (single only) select in DNS section.Regards,PaulhiDNS is not yet fully VRF aware as i was told by MT support last year (unfortunately i cannot look back into the SUP ticket as of no tickets are shown to me in my account weirdly)VRF setting here is more to be understand like to tell the DNS service on which VRF it will LISTEN for DNS REQs rather than making upstream requests in that VRF (which is not working up until this day)

---
### Post 16
Author: Unknown
Date: Unknown

As for the ticket system: there is a default filter to show only open issues in the list. you need to change the filter to "any status".

---
### Post 17
Author: Unknown
Date: Unknown

As for the ticket system: there is a default filter to show only open issues in the list. you need to change the filter to "any status".bummer ... thanks for the hint.

---
### Post 18
Author: Unknown
Date: Unknown

Responding to my own post, it seems that this is no longer CLI only, I think newer Winbox versions matches this option in DNS, ability to select VRF.Someone please correct me, maybe there is more to it. I would very much like DNS to work on any VRF, not only main or whatever I (single only) select in DNS section.Regards,PaulhiDNS is not yet fully VRF aware as i was told by MT support last year (unfortunately i cannot look back into the SUP ticket as of no tickets are shown to me in my account weirdly)VRF setting here is more to be understand like to tell the DNS service on which VRF it will LISTEN for DNS REQs rather than making upstream requests in that VRF (which is not working up until this day)so here is the last answer i got in SUP-160816SUP-160816_03-01-2025.png

---
### Post 19
Author: Unknown
Date: Unknown

Eagerly awaiting to see this feature implemented in 7.18

---
