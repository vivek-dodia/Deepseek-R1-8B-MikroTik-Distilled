---
title: Thread-214261
url: https://forum.mikrotik.com/viewtopic.php?t=214261&sid=49f92a630bc7970d8ca50523be880e8f
thread_id: 214261
section: RouterOS
post_count: 9
date_crawled: 2025-02-03T20:40:27.674578
---

### Post 1
Author: Unknown
Date: Unknown

Hi, I'm setting up new home network with vlans, first time using it. Now I've set up 6 VLANs and the idea is that vlan50 will be my main home network and management vlan for wired devices on ports 3-6 and vlan60 for iot devices, and all VLANs 10,20,30,40,50,60 will be on trunk ports 1-2 for 2 tp-link omada APs, and ports 7,8 and usb will be uplink wan ports, its kind of working but my problem is that I don't know how to efficently allow internet connectivity for all vlans (its working with this config), but drop access to other vlans and block access to router itself withou losing wan connectivity, and this is my main issue.Can somebody please review this configuration and suggest some security and performance improvements?I hope that my intention is clear enough.Ty

---
### Post 2
Author: Unknown
Date: Unknown

Your config is understandable but a network diagram with trunk and access ports is highly advisable because on some ports which claim to be access ones there aren't any visible PVIDs

---
### Post 3
Author: Unknown
Date: Unknown

You made the error of having a bridge subnet, get rid of it and assign another VLAN.  Due to this you failed to clearly identify this other subnet which seems to be at least intended for ports 4,5,6 and sfp-sfpplus1 ????You also seem to be adding WAN ports to the Bridge which is not usually required in most scenarios.You also do not seem to know how to use vlans properly when it comes to /interface bridge ports and /interface bridge vlans.You have duplicate pools,  both  pokucni and pool6  are identical???If vlan50 is home then WTF is 192.168.88 subnet??   Should I assume this is for the admin only???Why if there are six vlans now ( seven when you remove bridge from doing anything directly with a subnet and assign a vlan to .88)  do you have 8 pools??(four for apartments 1-4,  one home, one iot,)Vlans required because the ISP provides connectivity via a VLANdo NOTrequire pools, servers, gateways etc.....Bridge ports should EITHER be in one of three formatsaccess port(going to dumb device)add bridge=bridge ingress-filtering=yes  frame-types=admit-only-priority-and-untagged interface=X pvid=YYtrunk port(going to smart device)add bridge=bridge ingress-filtering=yes  frame-types=admit-only-vlan-tagged interface=AHybrid port(rare going to device such ad voip phone or unifi ap)add bridge=bridge interface=B pvid=ZZChange detect internet TO:noneDont think you quite understand firewall rules yet.  What is the purpose of the first rule given the third rule.add action=accept chain=input in-interface=vlan50-home-lanadd action=drop chain=input disabled=yes in-interface-list=guest-vlanadd action=drop chain=input comment="defconf: drop all not coming from LAN" \in-interface-list=!LANIF not using IPV6 suggest disabling and removing any associated lists and filter rulesSuggest readingthe following link first to help understand where I am coming from.viewtopic.php?t=143620Feel free to ask questions but it would be premature for me to comment on the file as its to full of basic errors at the moment, so more understanding is required.

---
### Post 4
Author: Unknown
Date: Unknown

Hi, thanks for pointing me to that topic about VLANs, I've already read it before but not very carefully obviously, I think that now I have basic understanding of VLANs, the way I've set it before was working but I felt it was wrong, that's why I've asked here. Previous setup was mainly defconf with added VLANs (early alpha ver.), that's why it was so full of every kind of s**t in it.Is this now attached export at least little bit better, and is solid foundation for fine tuning the setup, I know I need to narrow down ADMIN right rules to some /29 subnet?ISP provides connectivity via roof 5g device/antena with dhcp server and the router inside for home network and phone port, I've found that their vlans are 100 and 101 for internet and phone and moved their router downstream on Mikrotik ether6 for phone connection and its working this way. Also tried to make that router part of my network to use it at as a dump switch or bring internet connectivity to it and make separate network (guest wifi maybe, any use case considering I have to have it plugged in for phone connection) but could't find a way, probably need to setup some kind of server on that port (some advice on that would be great?).You also seem to be adding WAN ports to the Bridge which is not usually required in most scenarios.WAN ports to the Bridge, don't know where I did that?Please comment and suggestTy

---
### Post 5
Author: Unknown
Date: Unknown

Remove  router serial number from posted configs.

---
### Post 6
Author: Unknown
Date: Unknown

Just to be clear,  do you have two lines coming from the ISP device and plugged into the routerOne for internet and your router gets an IP address on the 100 subnet? and the other for TelephoneORYou have one line coming from the ISP device and from this you want to use one DHCP from the ISP for the routerv100 to give the router its WANIP,  and then also send v101 to ether6 for phone distribution.I will assume the latter is correct.However, its not clear to me what is going on for ether8,  is that your ISP incoming traffic?If ether6 is going to phone distribution what device is connected to ether6 that can read vlan tags and then distribute phone traffic?What is on ether1,ether2,,ether7  ????

---
### Post 7
Author: Unknown
Date: Unknown

I have one line from ISP device carrying vlan 100internet and 101phone connected to ether8 on Mikrotik, that line is bound with MAC address of ISPs inside router (or its working just as switch I don't know) and that's why I've set custom MAC on ether8 , I moved that inside ISPs router downstream behind Mikrotik on ether6 and that device can read vlan tags and then distribute phone traffic unaware of Mikrotik in between. So yes ISP incoming traffic is on ether8. Everything is working fine with this setup,now I want, if its possible, to use that ISP inside router for something else not just phone distribution since I need it for phone I tought of using it as part of my network as dump switch or bring up the internet connection on it somehow (spoof it that it thinks its still connected to that ISP device on the roof directly), I like fiddling with this stuff, don't we all here? I've managed to bring it online I think (led indicator online was lit when I created second vlan100 interface under ether6, also tried to create dhcp server on it) but connecting laptop to one of its ports couldn't get IP, maybe I need some dhcp relay pointing to that other device? But this isn't something I couldn't live without;) Hope I manged to describe it understandably, maybe I could draw a diagram if not?Considering other ports, ether7 is for WAN failover connection, there I'll plug little portable  wifi APhttps://www.protis.hr/products/details/ ... o-ap/39873in wisp mode so when I turn on hotspot on my phone its connection is auto distributed to home network (I have this in my current setup with MT HEX S as router). Ether1 and 2 are going to 2 Tp-link VLAN aware wifi APs.Another thing I was planning was to use Mikrotik radius server for wifi users ppsk authorization (vlan aware, one ssid > multiple vlans), but I don't think MT radius support it?Hope I shed some light on it?Remove router serial number from posted configs.Ty, I tought hide-sensitive on export removes ALL sensitive?

---
### Post 8
Author: Unknown
Date: Unknown

hide sensitive was valid for ver6  not ver7.

---
### Post 9
Author: Unknown
Date: Unknown

1.   One bridge, add both ISP vlans to the single bridge!2.  Recommend changing ether8 to an EDGE port to avoid potential interference.3. Pools rationalized ( 7,9 duplicates) plus only 6 vlans so only 6 Pools.4.  The APs should also have the home vlan unless nobody at home is allowed wifi ;-P  plus of course the AP should get its IP address on the trusted subnet.5.  There is no point to VLAN interface list, its a duplicate of LAN list!6. Are you sure on Wireguard peers the endpoint port is the same? ( probably as they have diff addresses, I changed interface port on router wireguard as they are for the most part meaningless)7. Dont forget to tag the bridge itself8. WHY /29 for the four apartment vlans??  It only provide 5 useable IPs for each subnet ? Since your pools match I suppose its what you want.9. I understand why you have an IP address for the backup wan on ether7.  BUT DHCP server makes no sense, so removed.......... it may be my lack of understanding of how it works though10./ Static DNS to .88 not helpful and removed.11.  Dont understand any of your debrid rules and thus removed. Good idea to clamp for mtu on both of  the third party VPNs,I provided two examples to use as one may work better than the other.........12. Also dumped the raw rules.  Best if you explain what you are trying to accomplish to sort out ideal config13. Your routing appears confused including duplicate routes, but probably just me.  What IPs need to go out wireguard and do you know which wireguard.SUMMARY:  unable to complete analysis without a detailed requirements discussion on how one expects users to use the various WANS  ( primary,  wireguard1, wireguard 2 and of course backup ).In some way, via IPs  one has to identify which IPs  ( source of traffic )  are going out which WAN, by IP, by firewall address list, by subnet.There may be specific WANIPs ( does not include ones own generally speaking so I am talking for www traffic ) which can also provide some guidance...................Code:Select all# model = RB5009UPr+S+# serial number =/interfacebridgeaddadmin-mac=78:9A:18:72:36:7Eauto-mac=nocomment=defconf name=bridge \
    port-cost-mode=shortvlan-filtering=yes/interfaceethernetset[finddefault-name=ether2]poe-out=offset[finddefault-name=ether8]mac-address=C0:D7:AA:16:A2:B0/interfacewireguardaddlisten-port=51020mtu=1420name=Surfshark_Beogradaddlisten-port=51080mtu=1420name=Surfshark_London/interfacevlanaddcomment=apartman1interface=bridge name=vlan10-app1 vlan-id=10addcomment=apartman2interface=bridge name=vlan20-app2 vlan-id=20addcomment=apartman3interface=bridge name=vlan30-app3 vlan-id=30addcomment=apartman4interface=bridge name=vlan40-soba vlan-id=40addcomment=home-lan-pokucniinterface=bridge name=vlan50-home-lan vlan-id=50addcomment=home-lan-iot_&_guest_wifiinterface=bridge name=vlan60-iot \
    vlan-id=60addcomment=t-com_internet_vlaninterface=bridge name=vlan100-internet \
    vlan-id=100addcomment=T-com_telefon_vlaninterface=bridge name=vlan101-telefon vlan-id=\101/interfacelistaddcomment=defconf name=WANaddcomment=defconf name=LANaddname=ADMIN/interfacewireless security-profilesset[finddefault=yes]supplicant-identity=MikroTik/ip pooladdname=dhcp_pool2 ranges=10.10.10.2-10.10.10.6addname=dhcp_pool3 ranges=10.20.20.2-10.20.20.6addname=dhcp_pool4 ranges=10.30.30.2-10.30.30.6addname=dhcp_pool5 ranges=10.40.40.2-10.40.40.6addname=dhcp_pool6 ranges=192.168.0.100-192.168.0.254addname=dhcp_pool7 ranges=10.60.60.2-10.60.60.254/ip dhcp-serveraddaddress-pool=dhcp_pool2interface=vlan10-app1 lease-time=15mname=dhcp1addaddress-pool=dhcp_pool3interface=vlan20-app2 lease-time=15mname=dhcp2addaddress-pool=dhcp_pool4interface=vlan30-app3 lease-time=15mname=dhcp3addaddress-pool=dhcp_pool5interface=vlan40-soba lease-time=15mname=dhcp4addaddress-pool=dhcp_pool6interface=vlan50-home-lan lease-time=23h59m59s\
    name=dhcp5addaddress-pool=dhcp_pool7interface=vlan60-iot lease-time=23h59m59sname=\
    dhcp6/routing tableadddisabled=nofib name=use_Surfshark_bgadddisabled=nofib name=use_Surfshark_Londonadddisabled=nofib name=use_T-Com_5g/user-manager profileaddname=pokucni-home name-for-users=home-lan validity=unlimited/user-manager useraddname=pokucni-home-lan/interfacebridge portaddbridge=bridge ingress-filtering=yes frame-types=admit-only-vlan-taggedinterface=ether1 comment=AP1addbridge=bridge ingress-filtering=yes frame-types=admit-only-vlan-taggedinterface=ether2 comment=AP2addbridge=bridge ingress-filtering=yes  frame-types=admit-only-untagged-and-priority-taggedinterface=ether3 pvid=50addbridge=bridge ingress-filtering=yes  frame-types=admit-only-untagged-and-priority-taggedinterface=ether4 pvid=50addbridge=bridge ingress-filtering=yes  frame-types=admit-only-untagged-and-priority-taggedinterface=ether5 pvid=50addbridge=bridge ingress-filtering=yes frame-types=admit-only-vlan-taggedinterface=ether6  comment="VOIP trunk"addbridge=bridge ingress-filtering=yes frame-types=admit-only-untagged-and-priority-taggedinterface=sfp-sfpplus1 pvid=50addbridge=bridge ingress-filtering=yes frame-types=admit-only-vlan-taggedinterface=ether8  comment="trunk from ISP"edge=yes/ip firewall connection trackingsetudp-timeout=10s/ip neighbor discovery-settingssetdiscover-interface-list=ADMIN/ipv6 settingssetdisable-ipv6=yes/interfacebridge vlanaddbridge=bridge tagged=bridge,ether1,ether2  vlan-ids=10,20,30,40,60addbridge=bridge tagged=bridge,ether1,ether2  untagged=ether3,ether4,ether5,sfp-sfpplus1  vlan-ids=50addbridge=bridge tagged=bridge,ether8  vlan-ids=100addbridge=bridge tagged=bridge,ether8,ether6  vlan-ids=101/interfacedetect-internetsetdetect-interface-list=none/interfacelist memberaddinterface=vlan100-internet list=WANaddinterface=vlan101-telefon list=WANaddinterface=ether8 list=WANaddinterface=ether7 list=WANaddinterface=Surfshark_Beogradlist=WANaddinterface=Surfshark_Londonlist=WANaddinterface=vlan10-app1 list=LANaddinterface=vlan20-app2 list=LANaddinterface=vlan30-app3 list=LANaddinterface=vlan40-soba list=LANaddinterface=vlan50-home-lan list=LANaddinterface=vlan60-iot list=LANaddcomment=admin-VLANinterface=vlan50-home-lan list=ADMIN/interfaceovpn-server serveraddmac-address=FE:EF:53:F5:A3:AD name=ovpn-server1/interfacewireguard peersaddallowed-address=0.0.0.0/0endpoint-address=rs-beg.prod.surfshark.com \
    endpoint-port=51820interface=Surfshark_Beogradname=wg-beograd \
    persistent-keepalive=30spublic-key="====="addallowed-address=0.0.0.0/0endpoint-address=uk-lon.prod.surfshark.com \
    endpoint-port=51820interface=Surfshark_Londonname=wg-london \
    persistent-keepalive=30spublic-key="-----"/ip addressaddaddress=10.14.0.2/24comment=VPN-bginterface=Surfshark_Beogradnetwork=\10.14.0.0addaddress=10.14.0.2/24comment=VPN-loninterface=Surfshark_Londonnetwork=\10.14.0.0addaddress=192.168.2.1/24comment=wisp-AIRLIVEinterface=ether7 network=\192.168.2.0addaddress=10.10.10.1/29comment=apartman1interface=vlan10-app1 network=\10.10.10.0addaddress=10.20.20.1/29comment=apartman2interface=vlan20-app2 network=\10.20.20.0addaddress=10.30.30.1/29comment=apartman3interface=vlan30-app3 network=\10.30.30.0addaddress=10.40.40.1/29comment=apartman4-sobainterface=vlan40-soba \
    network=10.40.40.0addaddress=192.168.0.1/24comment=home-lan-pokucniinterface=vlan50-home-lan \
    network=192.168.0.0addaddress=10.60.60.1/24comment=iot-homeinterface=vlan60-iot network=\10.60.60.0/ip dhcp-clientaddadd-default-route=nocomment=T-Com_5ginterface=vlan100-internet script=":\
    if (\$bound=1) do={\
    \n/ip route add distance=1 gateway=\$\"gateway-address\" routing-table=use\
    _T-Com_5g comment=\"T-Com_5g\"\
    \n/ip route set [find comment=\"T-Com_5g-main\"] gateway=\$\"gateway-addre\
    ss\"\
    \n/ip route set [find comment=\"recursive-T-Com_5g\"] gateway=\$\"gateway-\
    address\"\
    \n/file print file=(\"5g-gw.txt\")\
    \n:delay 3\
    \n/file set contents=\$\"gateway-address\" (\"5g-gw.txt\")\
    \n} else={\
    \n/ip route remove [/ip route find comment=\"T-Com_5g\"]\
    \n}"use-peer-dns=no/ip dhcp-server networkaddaddress=10.10.10.0/29dns-server=192.168.0.1gateway=10.10.10.1addaddress=10.20.20.0/29dns-server=192.168.0.1gateway=10.20.20.1addaddress=10.30.30.0/29dns-server=192.168.0.1gateway=10.30.30.1addaddress=10.40.40.0/29dns-server=192.168.0.1gateway=10.40.40.1addaddress=10.60.60.0/24dns-server=192.168.0.1gateway=10.60.60.1addaddress=192.168.0.0/24dns-server=192.168.0.1gateway=192.168.0.1/ip dnssetallow-remote-requests=yes servers=149.154.159.92,162.252.172.57,1.1.1.1/ip firewall address-list{usestaticdhcp leases}addaddress=192.168.0.Alist=Authorizedcomment="admin desktop"addaddress=192.168.0.Blist=Authorizedcomment="admin laptop"addaddress=192.168.0.Clist=Authorizedcomment="admin laptop wifi"addaddress=192.168.0.Dlist=Authorizedcomment="admin smartphone/ipad wifi"/ip firewall filteraddaction=accept chain=input comment="accept established,related,untracked"\
    connection-state=established,related,untrackedaddaction=drop chain=input comment="drop invalid"connection-state=invalidaddaction=accept chain=input comment="accept ICMP"protocol=icmpaddaction=accept chain=input comment="accept ADMIN to all"in-interface-list=ADMIN src-address=Authorizedaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53,123protocol=udpaddaction=accept chain=input comment="users to services"in-interface-list=LAN dst-port=53protocol=tcpaddaction=drop chain=input comment="drop all else"{insertthisrule here butaslastrule to avoid getting lockedout}addaction=accept chain=forward comment="accept in ipsec policy"\
    ipsec-policy=in,ipsecaddaction=accept chain=forward comment="accept out ipsec policy"\
    ipsec-policy=out,ipsecaddaction=fasttrack-connection chain=forward comment="defconf: fasttrack"\
    connection-state=established,related disabled=yes hw-offload=yesaddaction=accept chain=forward comment=\"accept established,related, untracked"connection-state=\
    established,related,untrackedaddaction=drop chain=forward comment="drop invalid"connection-state=invalidaddaction=accept chain=forward comment="internet traffic"in-interface-list=LANout-interface-list=WANaddaction=accept chain=forward comment="admin access to LAN"in-interface-list=ADMIN src-address-list=Authorizedaddaction=accept chain=forward comment="port forwarding"connection-nat-state=dstnataddaction=drop chain=forward comment="drop everything else"/ip firewall mangleaddaction=change-mss chain=forward comment="Clamp MSS to PMTU for Outgoing packets"new-mss=clamp-to-pmtuout-interface=Surfshark_Beogradpassthrough=yes protocol=tcp tcp-flags=synaddaction=change-mss chain=forwardnew-mss=1380out-interface=Surfshark_Londonprotocol=tcp tcp-flags=syn tcp-mss=1381-65535/ip firewall nataddaction=masquerade chain=srcnat comment="WAN masquerade"ipsec-policy=\out,noneout-interface-list=WAN/ip ipsec profileset[finddefault=yes]dpd-interval=2mdpd-maximum-failures=5/ip route
UNKNOWN PURPOSES/ip servicesetwww-ssl disabled=no/ipv6 firewall filteraddchain=input action=dropaddchain=forward action=drop/radiusaddaddress=127.0.0.1comment=wifi-authentification service=dhcp,dot1x/radius incomingsetaccept=yes/routing rule
UNKNOWN PURPOSES/system clocksettime-zone-name=Europe/Zagreb/system notesetshow-at-login=no/tool mac-serversetallowed-interface-list=ADMIN/tool mac-server mac-winboxsetallowed-interface-list=ADMIN/tool netwatchaddcomment=T-Com_5g_checkdisabled=nodown-script=""host=8.8.8.8\
    http-codes=""packet-size=64test-script=""type=icmp up-script=""/user-managersetcertificate=*0enabled=yes/user-manager routeraddaddress=192.168.0.75name=omada-controller/user-manager user-profileaddprofile=pokucni-home user=pokucni-home-lan

---
